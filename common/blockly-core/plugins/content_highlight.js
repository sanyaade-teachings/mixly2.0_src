/*! For license information please see index.js.LICENSE.txt */
!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("blockly/core"));else if("function"==typeof define&&define.amd)define(["blockly/core"],e);else{var i="object"==typeof exports?e(require("blockly/core")):e(t.Blockly);for(var r in i)("object"==typeof exports?exports:t)[r]=i[r]}}(this,(t=>(()=>{"use strict";var e={573:e=>{e.exports=t}},i={};function r(t){var o=i[t];if(void 0!==o)return o.exports;var s=i[t]={exports:{}};return e[t](s,s.exports,r),s.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var i in e)r.o(e,i)&&!r.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var o={};return(()=>{r.r(o),r.d(o,{ContentHighlight:()=>n});var t=r(573);function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function i(t,i){for(var r=0;r<i.length;r++){var o=i[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,(void 0,s=function(t,i){if("object"!==e(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,"string");if("object"!==e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(o.key),"symbol"===e(s)?s:String(s)),o)}var s}var s=[t.Events.VIEWPORT_CHANGE,t.Events.BLOCK_MOVE,t.Events.BLOCK_DELETE],n=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.workspace_=t,this.width_=0,this.height_=0,this.top_=0,this.left_=0,this.lastScale_=1,this.cachedContentMetrics_=void 0}var r,o;return r=e,(o=[{key:"init",value:function(e){e=Number(e),this.padding_=isNaN(e)?10:e,this.svgGroup_=t.utils.dom.createSvgElement(t.utils.Svg.G,{class:"contentAreaHighlight"},null);var i=String(Math.random()).substring(2),r=t.utils.dom.createSvgElement(new t.utils.Svg("mask"),{id:"contentAreaHighlightMask"+i},this.svgGroup_);t.utils.dom.createSvgElement(t.utils.Svg.RECT,{x:0,y:0,width:"100%",height:"100%",fill:"white"},r),this.rect_=t.utils.dom.createSvgElement(t.utils.Svg.RECT,{x:0,y:0,rx:t.Bubble.BORDER_WIDTH,ry:t.Bubble.BORDER_WIDTH,fill:"black"},r),this.background_=t.utils.dom.createSvgElement(t.utils.Svg.RECT,{x:0,y:0,width:"100%",height:"100%",mask:"url(#contentAreaHighlightMask"+i+")"},this.svgGroup_);var o=this.workspace_.getTheme();this.theme_=o.getComponentStyle("workspaceBackgroundColour")||"#ffffff",this.applyColor_();var s=this.workspace_.getMetricsManager();this.cachedContentMetrics_=s.getContentMetrics(!0),this.resize_(this.cachedContentMetrics_);var n=s.getAbsoluteMetrics();this.position_(this.cachedContentMetrics_,n),this.svgGroup_.style.transition="opacity 0.25s";var a=this.workspace_.getParentSvg();a.firstChild?a.insertBefore(this.svgGroup_,a.firstChild):a.appendChild(this.svgGroup_),this.onChangeWrapper_=this.onChange_.bind(this),this.workspace_.addChangeListener(this.onChangeWrapper_)}},{key:"dispose",value:function(){this.svgGroup_&&t.utils.dom.removeNode(this.svgGroup_),this.onChangeWrapper_&&this.workspace_.removeChangeListener(this.onChangeWrapper_)}},{key:"onChange_",value:function(e){if(e.type===t.Events.THEME_CHANGE)this.applyColor_();else if(-1!==s.indexOf(e.type)){var i=this.workspace_.getMetricsManager();e.type!==t.Events.VIEWPORT_CHANGE&&(this.cachedContentMetrics_=i.getContentMetrics(!0),this.resize_(this.cachedContentMetrics_));var r=i.getAbsoluteMetrics();this.position_(this.cachedContentMetrics_,r)}else if(e.type===t.Events.BLOCK_DRAG)this.handleBlockDrag_(e);else if(e.type===t.Events.BLOCK_CHANGE){var o=this.workspace_.getMetricsManager();this.cachedContentMetrics_=o.getContentMetrics(!0),this.resize_(this.cachedContentMetrics_)}}},{key:"handleBlockDrag_",value:function(t){this.svgGroup_.setAttribute("opacity","1")}},{key:"applyColor_",value:function(){var e=t.utils.colour.blend("#000",this.theme_,.1),i=t.utils.colour.blend("#fff",this.theme_,.1),r="#ffffff"===this.theme_||"#fff"===this.theme_?e:i;this.background_.setAttribute("fill",this.theme_);var o=this.workspace_.getTheme();r!==(o.getComponentStyle("workspaceBackgroundColour")||"#ffffff")&&(o.setComponentStyle("workspaceBackgroundColour",r),this.workspace_.setTheme(o))}},{key:"resize_",value:function(t){var e=t.width?t.width+2*this.padding_:0,i=t.height?t.height+2*this.padding_:0;e!==this.width_&&(this.width_=e,this.rect_.setAttribute("width",e)),i!==this.height_&&(this.height_=i,this.rect_.setAttribute("height",i))}},{key:"position_",value:function(t,e){var i=-this.workspace_.scrollY,r=-this.workspace_.scrollX,o=this.workspace_.scale,s=e.top+t.top*o-i-this.padding_*o,n=e.left+t.left*o-r-this.padding_*o;s===this.top_&&n===this.left_&&this.lastScale_===o||(this.top_=s,this.left_=n,this.lastScale_=o,this.rect_.setAttribute("transform","translate("+n+","+s+") scale("+o+")"))}}])&&i(r.prototype,o),Object.defineProperty(r,"prototype",{writable:!1}),e}()})(),o})()));