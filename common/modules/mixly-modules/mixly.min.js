function toByteArray(t){var o=[];for(let e=0;e<t.length;e++){var i=t.charCodeAt(e);i<=255&&o.push(i)}return o}function fromByteArray(e){return String.fromCharCode.apply(String,e)}function crc32(t,e=0){t instanceof Array&&(t=fromByteArray(t));var o=[];for(let t,e=0;e<256;e++){t=e;for(let e=0;e<8;e++)t=1&t?3988292384^t>>>1:t>>>1;o[e]=t}let i=-1-e;for(let e=0;e<t.length;e++)i=i>>>8^o[255&(i^t.charCodeAt(e))];return(-1^i)>>>0}function zipLongest(){var o=[].slice.call(arguments);return o.reduce(function(e,t){return e.length>t.length?e:t},[]).map(function(e,t){return o.map(function(e){return e[t]})})}(()=>{"use strict";goog.require("microbitFs"),goog.provide("fsWrapper");var l=null,r=["create","exists","getStorageRemaining","getStorageSize","getStorageUsed","getUniversalHex","ls","read","readBytes","remove","size","write"];fsWrapper.setupFilesystem=function(){var t=null,o=null,e=$.get("../common/micropython/microbit-micropython-v1.hex",function(e){t=e}).fail(function(){console.error("Could not load the MicroPython v1 file.")}),i=$.get("../common/micropython/microbit-micropython-v2.hex",function(e){o=e}).fail(function(){console.error("Could not load the MicroPython v2 file.")});return $.when(e,i).done(function(){t&&o||console.error("There was an issue loading the MicroPython Hex files."),l=new microbitFs.MicropythonFsHex([{hex:t,boardId:39169},{hex:o,boardId:39171}],{maxFsSize:20480}),r.forEach(function(e){fsWrapper[e]=function(){return l[e].apply(l,arguments)}})})},fsWrapper.getBytesForBoardId=function(e){if("9900"==e||"9901"==e)return l.getIntelHexBytes(39169);if("9903"==e||"9904"==e)return l.getIntelHexBytes(39171);throw Error("Could not recognise the Board ID "+e)},fsWrapper.getIntelHexForBoardId=function(e){if("9900"==e||"9901"==e)var t=l.getIntelHex(39169);else{if("9903"!=e&&"9904"!=e)throw Error("Could not recognise the Board ID "+e);t=l.getIntelHex(39171)}for(var o=new Uint8Array(t.length),i=0,r=t.length;i<r;i++)o[i]=t.charCodeAt(i);return o.buffer},fsWrapper.importHexFiles=function(e){e=l.importFilesFromHex(e,{overwrite:!0,formatFirst:!0});if(e.length)return e;throw new Error("The filesystem in the hex file was empty")},fsWrapper.importHexAppended=function(e){e=microbitFs.getIntelHexAppendedScript(e);if(e)return l.ls().forEach(function(e){l.remove(e)}),l.write("main.py",e),["main.py"];throw new Error("No appended code found in the hex file")}})(),goog.provide("Mixly"),(()=>{goog.require("Mixly"),goog.provide("Mixly.MJSON");const a=Mixly["MJSON"];a.operate=(e,t)=>{var o,i={...e};for(o in i){var r=i[o];if(0<r.length&&"object"==typeof r||"object"==typeof r){var l,n=a.operate(r,t);for(l in n)i[o][l]=n[l]}else if("string"==typeof r)try{i[o]=t(i[o])}catch(e){}}return i},a.decode=e=>a.operate(e,decodeURIComponent),a.encode=e=>a.operate(e,encodeURIComponent),a.parse=e=>{let t=null;try{t=JSON.parse(e)}catch(e){console.log(e)}return t},a.stringify=e=>{let t="";try{t=JSON.stringify(e)}catch(e){console.log(e)}return t},a.get=e=>goog.getJSON(e)})(),(()=>{goog.require("Mixly"),goog.provide("Mixly.MString");var e=Mixly["MString"];e.tpl=(e,t)=>{if("string"==typeof e&&t instanceof Object)for(var o in t){var i=new RegExp("{[s]*"+o+"[s]*}","gim");e=e.replace(i,t[o])}return e}})(),goog.require("PouchDB"),goog.require("Mixly"),goog.provide("Mixly.Storage"),(()=>{goog.require("Mixly"),goog.provide("Mixly.Url");const{Url}=Mixly;Url.urlToJson=e=>{function n(e,t,o){var i;if(-1!==t.indexOf("."))i=t.substring(0,t.indexOf(".")),t=t.substring(t.indexOf(".")+1,t.length),void 0===e[i]&&(e[i]={}),e[i]=n(e[i],t,o);else{var r=decodeURIComponent(o),l=decodeURIComponent(t);if(isNaN(r))switch(r.toLowerCase()){case"true":e[l]=!0;break;case"false":e[l]=!1;break;case"undefined":e[l]=void 0;break;case"null":e[l]=null;break;default:e[l]=r}else e[l]=+r}return e}for(var t,o={},i=e.slice(e.indexOf("?")+1).split("&"),r=0;r<i.length;r++){t=i[r].split("=");try{o=n(o,t[0].replaceAll("@","=").replaceAll("$","&"),t[1].replaceAll("@","=").replaceAll("$","&"))}catch(e){o=n(o,t[0],t[1])}}return o},Url.jsonToUrl=(t,o=null)=>{var i="";if(t instanceof String||t instanceof Number||t instanceof Boolean)try{var e=(e=o.toString().replaceAll("=","@")).replaceAll("&","$"),r=(r=t.toString().replaceAll("=","@")).replaceAll("&","$");i+="&"+e+"="+encodeURIComponent(r)}catch(e){i+="&"+o+"="+encodeURIComponent(t)}else $.each(t,function(e){e=null==o?e:o+(t instanceof Array?"["+e+"]":"."+e);i+="&"+Url.jsonToUrl(this,e)});return i.substr(1)},Url.getConfig=()=>{var t="";try{t=window.location.href.replaceAll("#","")}catch(e){t=window.location.href}t=t.substring(t.indexOf("?")+1,t.length);return Url.urlToJson(t)},Url.changeURLArg=(url,arg,argVal)=>{var pattern=arg+"=([^&]*)",replaceText=arg+"="+argVal,tmp,tmp;return url.match(pattern)?(tmp="/("+arg+"=)([^&]*)/gi",tmp=url.replace(eval(tmp),replaceText),tmp):url.match("[?]")?url+"&"+replaceText:url+"?"+replaceText},Url.CRC32=(e,t=10)=>{var o=function(){let t;var o=[];for(let e=0;e<256;e++){t=e;for(let e=0;e<8;e++)t=1&t?3988292384^t>>>1:t>>>1;o[e]=t}return o}(),i=function(t){t=t.replace(/\r\n/g,"\n");let o="";for(let e=0;e<t.length;e++){var i=t.charCodeAt(e);i<128?o+=String.fromCharCode(i):o=127<i&&i<2048?(o+=String.fromCharCode(i>>6|192))+String.fromCharCode(63&i|128):(o=(o+=String.fromCharCode(i>>12|224))+String.fromCharCode(i>>6&63|128))+String.fromCharCode(63&i|128)}return o}(e);let r=-1;for(let e=0;e<i.length;e++)r=r>>>8^o[255&(r^i.charCodeAt(e))];return(r=(-1^r)>>>0).toString(t)},Url.initFingerprintJS=()=>{FingerprintJS.load().then(e=>e.get()).then(e=>{var e=e.visitorId,t=parseInt(e,16).toString(32);Config.BOARD.visitorId={str16:e,str32:t,str16CRC32b:Url.CRC32(e,16),str32CRC32b:Url.CRC32(t,16)},console.log(Config.BOARD)}).catch(e=>{console.error(e),console.log(Config.BOARD)})},Url.getIPAddress=()=>{var e=window.location.host.match(/[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+\.?/g);return e&&0<e.length?e[0]:null}})(),goog.provide("Mixly.Web.Utilities");class struct{static lut={b:{u:DataView.prototype.getInt8,p:DataView.prototype.setInt8,bytes:1},B:{u:DataView.prototype.getUint8,p:DataView.prototype.setUint8,bytes:1},h:{u:DataView.prototype.getInt16,p:DataView.prototype.setInt16,bytes:2},H:{u:DataView.prototype.getUint16,p:DataView.prototype.setUint16,bytes:2},i:{u:DataView.prototype.getInt32,p:DataView.prototype.setInt32,bytes:4},I:{u:DataView.prototype.getUint32,p:DataView.prototype.setUint32,bytes:4},q:{u:DataView.prototype.getInt64,p:DataView.prototype.setInt64,bytes:8},Q:{u:DataView.prototype.getUint64,p:DataView.prototype.setUint64,bytes:8}};static pack(...e){var t=e[0];let o=0;var i=e.slice(1);if(t.replace(/[<>]/,"").length!=i.length)throw"Pack format to Argument count mismatch";let r=[],l=!0;for(let e=0;e<t.length;e++)if("<"==t[e])l=!0;else if(">"==t[e])l=!1;else{d=s=a=n=void 0;var n=t[e],a=i[o];if(!(n in struct.lut))throw"Unhandled character '"+n+"' in pack format";var s=struct.lut[n].bytes,d=new DataView(new ArrayBuffer(s));(n=struct.lut[n].p.bind(d))(0,a,l);for(let e=0;e<s;e++)r.push(d.getUint8(e));o++}return r}static unpack(e,t){let o=0,i=[],r=!0;for(var l of e)if("<"==l)r=!0;else if(">"==l)r=!1;else{s=a=n=void 0;var n=l;if(!(n in struct.lut))throw"Unhandled character '"+n+"' in unpack format";var a=struct.lut[n].bytes,s=new DataView(new ArrayBuffer(a));for(let e=0;e<a;e++)s.setUint8(e,255&t[o+e]);n=struct.lut[n].u.bind(s),i.push(n(0,r)),o+=a}return i}static calcsize(t){let o=0;for(let e=0;e<t.length;e++)"<"!=t[e]&&">"!=t[e]&&(o+=struct.lut[t[e]].bytes);return o}}function*makeFileIterator(e){for(var t of e.split(/\r?\n/))yield t.trim();return""}goog.require("Mixly"),goog.provide("Mixly.Web"),goog.require("Mixly"),goog.provide("Mixly.WebCompiler"),goog.require("Mixly"),goog.provide("Mixly.WebSocket"),(()=>{goog.require("Mixly.Url"),goog.provide("Mixly.Config");const{Config:a,Url:s}=Mixly,d=(a.SELECTED_BOARD={},a.BOARD={},{thirdPartyBoard:!(a.SOFTWARE={})}),c={burn:"None",upload:"None",nav:"None",serial:"None",saveMixWithCode:!0},u={version:"Mixly2.0"};a.init=()=>{var e,t,o,i,r,l={...d,...s.getConfig()},n=(a.BOARD=goog.getJSON("./config.json",c),"object"==typeof l&&({thirdPartyBoard:n,boardImg:e,boardIndex:t,boardType:o,boardName:i,filePath:r}=l,n=n??!1,a.BOARD={...a.BOARD,thirdPartyBoard:n,boardImg:e,boardIndex:t,boardType:o,boardName:i,filePath:r},delete l.thirdPartyBoard,delete l.boardImg,delete l.boardIndex,delete l.boardType,delete l.boardName,delete l.filePath),console.log("Config.BOARD:",a.BOARD),"../../../");a.SOFTWARE=goog.getJSON(n+"sw-config.json",u),"object"==typeof l&&(a.SOFTWARE={...a.SOFTWARE,...l}),a.pathPrefix=n,console.log("Config.SOFTWARE:",a.SOFTWARE),$.getScript("../../../common/modules/web-modules/fp.min.js",()=>{}).fail(()=>{})},a.init(),a.USER={theme:"light",language:"zh-hans",winSize:1,blockRenderer:"geras",compileCAndH:"true"}})(),(()=>{goog.require("Mixly.Config"),goog.provide("Mixly.Env");var{Env:e,Config:t}=Mixly,t=t["SOFTWARE"];e.isElectron=!0,e.hasSocketServer=!!t?.webSocket?.enabled,e.hasCompiler=!!t?.webCompiler?.enabled,e.clientPath=null,e.currentPlatform=null,e.python3Path=null,e.pyFilePath=null,e.indexDirPath=null,e.srcDirPath=null,e.winSize=null,e.defaultXML=null,e.thirdPartyCSS=[],e.thirdPartyJS=[],e.templatePath=goog.normalizePath_(goog.basePath+"../template/"),e.isElectron=!!window?.process?.versions?.electron,e.isElectron&&(e.indexDirPath=__dirname)})(),(()=>{goog.require("tippy"),goog.require("Mixly"),goog.provide("Mixly.FooterLayer");const o={allowHTML:!0,trigger:"manual",interactive:!0,hideOnClick:!1,maxWidth:"none",offset:[0,6]};Mixly.FooterLayer=class{constructor(e,t){this.config=t??{},this.config.tippy={...o,...this.config.tippy??{}},this.domId=e,this.layer=null,this.addClickEvent()}addClickEvent(){$("#"+this.domId).off().click(()=>{this.layer?.length&&!this.layer[0].state.isDestroyed?this.layer[0].state.isShown?(this.layer[0].destroy(),this.layer=null):this.layer[0].show():(this.show(),this.layer[0].show())})}show(){if(!this.layer?.length){var e=this.config["onShow"];"function"==typeof e&&e();const t=this,{onMount:o,onHidden:i}=this.config.tippy;this.layer=tippy("#"+this.domId,{...this.config.tippy,onMount(e){$(e.popper).find(".footer-layer-close").off().click(function(){e.destroy(),t.layer=null}),"function"==typeof o&&o(e)},onHidden(e){t.layer=null,"function"==typeof i&&i(e)}})}}updateContent(e){this.config.tippy.content=e}destroy(){this.layer?.length&&!this.layer[0].state.isDestroyed&&this.layer[0].destroy()}}})(),goog.provide("Mixly.JSFuncs"),goog.require("Mixly.Config"),Mixly.JSFuncs.getPlatform=function(){return Mixly.Config.BOARD.boardType},(()=>{goog.require("Mixly"),goog.provide("Mixly.LocalStorage");const r=Mixly["LocalStorage"],o=window["localStorage"];r.write=(e,t)=>{o&&(o[e]=t)},r.read=e=>o&&o[e]?o[e]:"",r.writeJson=(e,t,o=!0)=>{o||(t={...t,...r.readJson(e)});try{var i=JSON.stringify(t);r.write(e,i)}catch(e){console.log(e)}},r.readJson=e=>{e=r.read(e);try{return JSON.parse(e)}catch(e){return console.log(e),null}}})(),(()=>{goog.require("Mixly"),goog.provide("Mixly.MArray");const i=Mixly["MArray"];i.equals=(e,t)=>{if(e!==t){if(!(e instanceof Object&&t instanceof Object))return!1;if(e.constructor!==t.constructor)return!1;for(var o in e)if(e.hasOwnProperty(o)){if(!t.hasOwnProperty(o))return!1;if(e[o]!==t[o]){if("object"!=typeof e[o])return!1;if(!i.equals(e[o],t[o]))return!1}}for(o in t)if(t.hasOwnProperty(o)&&!e.hasOwnProperty(o))return!1}return!0},i.remove=(e,t)=>{t=e.indexOf(t);return e.splice(t,1),e},i.unique=e=>Array.from(new Set(e))})(),(()=>{goog.require("Mixly.Env"),goog.provide("Mixly.Modules");const{Env:e,Modules:t}=Mixly;var o,i,r;e.isElectron&&(t.path=require("path"),t.child_process=require("child_process"),t.fs=require("fs"),t.fs_extra=require("fs-extra"),t.fs_extend=require("../../../common/modules/node-modules/fsExtend.js"),t.compressing=require("compressing"),t.json2md=require("json2md"),t.electron=require("electron"),t.chokidar=require("chokidar"),t.clipboard=t.electron.clipboard,t.os=require("os"),t.electron_remote=require("@electron/remote"),o=t["electron_remote"],{path:o,fs_extend:i,app:r}=(t.app=o.app,t.currentWebContents=o.getCurrentWebContents(),t.currentWindow=o.getCurrentWindow(),t.lodash_fp=require("lodash/fp"),t.node_downloader_helper=require("node-downloader-helper"),e.currentPlatform=t.os.platform(),t),"darwin"===e.currentPlatform?e.clientPath=o.resolve(r.getPath("exe"),"../../../../"):e.clientPath=o.resolve(r.getPath("exe"),"../"),e.pyFilePath=o.resolve(e.clientPath,"mixpyBuild/mixly.py"),"win32"===e.currentPlatform?e.python3Path=o.resolve(e.clientPath,"mixpyBuild/win_python3/python3.exe"):(e.python3Path="/usr/bin/python3",i.isfile("/usr/local/bin/python3")&&(e.python3Path="/usr/local/bin/python3")),e.srcPath=o.resolve(e.indexDirPath,"../"))})(),goog.require("Mixly.MJSON"),goog.require("Mixly.Config"),goog.require("Mixly.Env"),goog.provide("Mixly.Msg"),goog.provide("Mixly.ScriptLoader"),goog.require("Mixly.Env"),goog.require("Mixly.Config"),Mixly.ScriptLoader.loadScript=function(e){for(var t,o=!0,i=document.getElementsByTagName("script"),r=0;r<i.length;r++)i[r]&&i[r].src&&-1!=i[r].src.indexOf(e)&&(o=!1);o&&((t=document.createElement("script")).setAttribute("type","text/javascript"),t.setAttribute("src",e),document.getElementsByTagName("head").item(0).appendChild(t))},Mixly.ScriptLoader.removeScript=function(e){var t=document.getElementsByTagName("script");-1!==e.indexOf("../")&&(e=e.substring(e.lastIndexOf("../")+3,e.length));for(var o=0;o<t.length;o++)t[o]&&t[o].src&&-1!=t[o].src.indexOf(e)&&t[o].parentNode.removeChild(t[o])},Mixly.ScriptLoader.loadLangJs=function(t,o,e){var i,r=document.querySelectorAll("script"),l=[];for(let e=0;e<r.length;e++)r[e]&&r[e].src&&-1!=r[e].src.indexOf(t+".js")&&(i=r[e].src.replace(t+".js",o+".js"),r[e].parentNode.removeChild(r[e]),l.push(i));for(let e=0;e<Mixly.Env.thirdPartyJS.length;e++)Mixly.Env.thirdPartyJS[e]=Mixly.Env.thirdPartyJS[e].replace(t+".js",o+".js");LazyLoad.js(l,function(){e()})},Mixly.ScriptLoader.commonJs=[],Mixly.ScriptLoader.clientJs=[],Mixly.ScriptLoader.webJs=[],Mixly.ScriptLoader.load=function(){var o=Mixly.Config.pathPrefix;function e(t){for(let e=0;e<t.length;e++)Mixly.ScriptLoader.loadScript(o+t[e])}Mixly.Env.isElectron?e(Mixly.ScriptLoader.clientJs):e(Mixly.ScriptLoader.webJs)};class Regression{constructor(){this.x=[],this.y=[],this.n=0,this.beta=1,this.alpha=0}fit(e,t){this.x=e,this.y=t,this.n=e.length,this.beta=this.getBeta(),this.alpha=this.getAlpha(this.beta)}predict(e){var t=[];for(const o of e=Array.isArray(e)?e:[e])t.push(this.alpha+o*this.beta);return t}getBeta(){return(this.sum(this.x,(e,t)=>e*this.y[t])*this.n-this.sum(this.x)*this.sum(this.y))/(this.sum(this.x,e=>e*e)*this.n-Math.pow(this.sum(this.x),2))}getAlpha(e){return this.avg(this.y)-this.avg(this.x)*e}sum(t,e=(e,t)=>e){let o=0;var i=e;for(let e=0;e<t.length;e++){var r=t[e];o+=i(r,e)}return o}avg(e){return this.sum(e)/e.length}}const regression=new Regression;function resetOptions(){var e,t=Mixly.Modules.highcharts.getOptions();for(e in t)"function"!=typeof t[e]&&delete t[e];Mixly.Modules.highcharts.setOptions(Mixly.Charts.lightTheme)}function getCol(e,t){for(var o=[],i=0;i<e.length;i++)o[i]=e[i][t];return o}function reverseMatrix(e){for(var t=[],o=0;o<e[0].length;o++){t[o]=[];for(var i=0;i<e.length;i++)t[o][i]=e[i][o]}return t}function getNumber(e){var t=e.match(/-?([0-9]\d*(\.\d*)*(\e\+[0-9]*)*|0\.[0-9]\d*)/g),o=[];if(t)for(var i=0;i<t.length;i++)o.push(parseFloat(t[i]));return o}goog.require("Highcharts"),goog.require("Mixly.Env"),goog.require("Mixly.Modules"),goog.require("Mixly.Config"),goog.provide("Mixly.Charts"),Mixly.Modules.highcharts=Highcharts,Mixly.Charts.startTime=0,Mixly.Charts.oldTime=0,Mixly.Charts.nowTime=0,Mixly.Charts.pointNum=100,Mixly.Charts.xData=[],Mixly.Charts.yData=[],Mixly.Charts.data=[],Mixly.Charts.darkTheme={colors:"#2b908f #90ee7e #f45b5b #7798BF #aaeeee #ff0066 #eeaaee #55BF3B #DF5353 #7798BF #aaeeee".split(" "),chart:{backgroundColor:{linearGradient:{x1:0,y1:0,x2:1,y2:1},stops:[[0,"#2a2a2b"],[1,"#3e3e40"]]},style:{fontFamily:"'Unica One', sans-serif"},plotBorderColor:"#606063"},title:{style:{color:"#E0E0E3",textTransform:"uppercase",fontSize:"20px"}},subtitle:{style:{color:"#E0E0E3",textTransform:"uppercase"}},xAxis:{gridLineColor:"#707073",labels:{style:{color:"#E0E0E3"}},lineColor:"#707073",minorGridLineColor:"#505053",tickColor:"#707073",title:{style:{color:"#A0A0A3"}}},yAxis:{gridLineColor:"#707073",labels:{style:{color:"#E0E0E3"}},lineColor:"#707073",minorGridLineColor:"#505053",tickColor:"#707073",tickWidth:1,title:{style:{color:"#A0A0A3"}}},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.85)",style:{color:"#F0F0F0"}},plotOptions:{series:{dataLabels:{color:"#F0F0F3",style:{fontSize:"13px"}},marker:{lineColor:"#333"}},boxplot:{fillColor:"#505053"},candlestick:{lineColor:"white"},errorbar:{color:"white"}},legend:{backgroundColor:"rgba(0, 0, 0, 0.5)",itemStyle:{color:"#E0E0E3"},itemHoverStyle:{color:"#FFF"},itemHiddenStyle:{color:"#606063"},title:{style:{color:"#C0C0C0"}}},credits:{style:{color:"#666"}},labels:{style:{color:"#707073"}},drilldown:{activeAxisLabelStyle:{color:"#F0F0F3"},activeDataLabelStyle:{color:"#F0F0F3"}},navigation:{buttonOptions:{symbolStroke:"#DDDDDD",theme:{fill:"#505053"}}},rangeSelector:{buttonTheme:{fill:"#505053",stroke:"#000000",style:{color:"#CCC"},states:{hover:{fill:"#707073",stroke:"#000000",style:{color:"white"}},select:{fill:"#000003",stroke:"#000000",style:{color:"white"}}}},inputBoxBorderColor:"#505053",inputStyle:{backgroundColor:"#333",color:"silver"},labelStyle:{color:"silver"}},navigator:{handles:{backgroundColor:"#666",borderColor:"#AAA"},outlineColor:"#CCC",maskFill:"rgba(255,255,255,0.1)",series:{color:"#7798BF",lineColor:"#A6C7ED"},xAxis:{gridLineColor:"#505053"}},scrollbar:{barBackgroundColor:"#808083",barBorderColor:"#808083",buttonArrowColor:"#CCC",buttonBackgroundColor:"#606063",buttonBorderColor:"#606063",rifleColor:"#FFF",trackBackgroundColor:"#404043",trackBorderColor:"#404043"}},Mixly.Charts.lightTheme={colors:"#7cb5ec #f7a35c #90ee7e #7798BF #aaeeee #ff0066 #eeaaee #55BF3B #DF5353 #7798BF #aaeeee".split(" "),chart:{backgroundColor:null,style:{fontFamily:"Dosis, sans-serif"}},title:{style:{fontSize:"16px",fontWeight:"bold",textTransform:"uppercase"}},tooltip:{borderWidth:0,backgroundColor:"rgba(219,219,216,0.8)",shadow:!1},legend:{backgroundColor:"#F0F0EA",itemStyle:{fontWeight:"bold",fontSize:"13px"}},xAxis:{gridLineWidth:1,labels:{style:{fontSize:"12px"}}},yAxis:{minorTickInterval:"auto",title:{style:{textTransform:"uppercase"}},labels:{style:{fontSize:"12px"}}},plotOptions:{candlestick:{lineColor:"#404048"}}},Mixly.Modules.highcharts.setOptions(Mixly.Charts.lightTheme),Mixly.Charts.lightTheme=$.extend(!0,{},Mixly.Modules.highcharts.getOptions(),{}),Mixly.Charts.chart=null,Mixly.Charts.draw=null,Mixly.Charts.addData=null,Mixly.Charts.init=function(e,t){var o=Mixly.Config["USER"],{dataDrawId:o,yMinId:i,yMaxId:r}=("dark"===o.theme?Mixly.Modules.highcharts.setOptions(Mixly.Charts.darkTheme):resetOptions(),Mixly.Charts.startTime=Number(new Date),Mixly.Charts.nowTime=Mixly.Charts.startTime,Mixly.Charts.oldTime=Mixly.Charts.nowTime,Mixly.Charts.xData=[],Mixly.Charts.yData=[],Mixly.Charts.data=[],t.id),i=$("#"+i),r=$("#"+r);Mixly.Charts.chart=Mixly.Modules.highcharts.chart(o,{chart:{type:"line"},title:{text:indexText["串口数据"]},credits:{enabled:!1},xAxis:{title:{enabled:!0,text:indexText["时间/ms"]},lineWidth:2},yAxis:{title:{text:indexText["串口数据"]},endOnTick:!0,lineWidth:2},series:[{name:indexText["串口数据"]+"1",data:[]}]}),r.val()&&i.val()&&void 0!==Mixly.Charts?.chart?.yAxis&&(o=r.val()||100,r=i.val()||0,Mixly.Charts.chart.yAxis[0].setExtremes(r,o)),e&&(Mixly.Charts.draw=window.setInterval(()=>{Mixly.Charts.drawLines(t)},100))},Mixly.Charts.drawLines=function(e){var{yMinId:t,yMaxId:o}=e.id,t=$("#"+t),o=$("#"+o),t=(o.val()&&t.val()&&void 0!==Mixly.Charts?.chart?.yAxis&&(o=o.val()||100,t=t.val()||0,Mixly.Charts.chart.yAxis[0].setExtremes(t,o)),0),o=(t=0<Mixly.Charts.data.length&&0<Mixly.Charts.data[0].length?Mixly.Charts.data[0][0]:t)+100,i=(0<Mixly.Charts.data.length&&Mixly.Charts.data.length<Mixly.Charts.pointNum?(regression.fit(Mixly.Charts.xData,Mixly.Charts.yData),o=regression.predict([Mixly.Charts.pointNum]),0<Mixly.Charts.data.length&&o<Mixly.Charts.data[Mixly.Charts.data.length-1][0]&&(o=Mixly.Charts.data[Mixly.Charts.data.length-1][0]),Mixly.Charts.chart.xAxis[0].setExtremes(t,o)):Mixly.Charts.data.length>=Mixly.Charts.pointNum&&(o=Mixly.Charts.data[Mixly.Charts.pointNum-1][0],Mixly.Charts.chart.xAxis[0].setExtremes(t,o)),[]);i[0]=getCol(Mixly.Charts.data,0);for(var r=0;r<Mixly.Charts.chart.series.length;r++)i[1]=getCol(Mixly.Charts.data,r+1),Mixly.Charts.chart.series[r].setData(reverseMatrix(i),!0,!1,!1);Mixly.Charts.update(e)},Mixly.Charts.addData=function(e){var t=Number(new Date),o=getNumber(e);if(50<t-Mixly.Charts.nowTime&&o&&0<o.length){Mixly.Charts.oldTime=Mixly.Charts.nowTime,Mixly.Charts.nowTime=t;for(var i=[Mixly.Charts.nowTime-Mixly.Charts.startTime,o[0]],r=1;r<o.length;r++)i.push(o[r]);for(;Mixly.Charts.data.length>Mixly.Charts.pointNum;)Mixly.Charts.data.shift();for(Mixly.Charts.data.length<Mixly.Charts.pointNum&&(Mixly.Charts.xData.push(Mixly.Charts.data.length),Mixly.Charts.yData.push(Mixly.Charts.nowTime-Mixly.Charts.startTime)),Mixly.Charts.data.push(i);Mixly.Charts.chart&&Mixly.Charts.chart.series&&Mixly.Charts.chart.series.length<o.length;)Mixly.Charts.chart.addSeries({name:indexText["串口数据"]+(Mixly.Charts.chart.series.length+1),data:[]})}},Mixly.Charts.update=function(e){var t=e.id["pointNumId"];if(+$("#"+t+" option:selected").val()!=Mixly.Charts.pointNum){try{Mixly.Charts.chart.destroy()}catch(e){console.log(e)}Mixly.Charts.pointNum=+$("#"+t+" option:selected").val(),Mixly.Charts.draw&&(clearInterval(Mixly.Charts.draw),Mixly.Charts.init(!0,e))}},Mixly.Charts.destroy=()=>{try{Mixly.Charts.chart&&Mixly.Charts.chart.destroy(),Mixly.Charts.chart=null}catch(e){console.log(e)}Mixly.Charts.stopRefresh()},Mixly.Charts.stopRefresh=()=>{Mixly.Charts.draw&&clearInterval(Mixly.Charts.draw),Mixly.Charts.addData&&clearInterval(Mixly.Charts.addData)},(()=>{goog.provide("Mixly.Title"),goog.require("Mixly.Config");let{Config:e,Title:o}=Mixly;var{BOARD:t,SOFTWARE:i}=e;i?.version&&t?.boardType?(o.title=i.version+" For "+t.boardType,document.title=o.title):o.title=document.title,o.NOWTITLE=o.title,o.updeteVersionNumber=e=>{try{o.NOWTITLE=document.title.replace(/Mixly[\s]?[\d.]+/g,"Mixly "+e),document.title=o.NOWTITLE}catch(e){console.log(e)}},o.getVersionNumber=()=>{try{return o.NOWTITLE=document.title.match(/Mixly[\s]?[\d.]+/g),o.NOWTITLE}catch(e){return console.log(e),""}},o.updeteFilePath=function(e){try{var t=o.NOWTITLE.match(/\([^\n\r]+\)/g);o.NOWTITLE=t?document.title.replace(/\([^\n\r]+\)/g,"("+e+")"):document.title+" ("+e+")",document.title=o.NOWTITLE}catch(e){console.log(e)}},o.getFilePath=()=>{try{var e=document.title.match(/(?<=\()[^\n\r]+(?=\))/g);if(e&&0<e.length)return e[0]}catch(e){console.log(e)}return null},o.updateTitle=e=>{o.NOWTITLE=e,document.title=e}})(),goog.provide("Mixly.Tools"),goog.require("Mixly.Config"),Mixly.Tools.messageDecode=t=>{if(t)try{let e=decodeURIComponent(t.replace(/_([0-9a-fA-F]{2})/gm,"%$1"));return e=unescape(e.replace(/\\(u[0-9a-fA-F]{4})/gm,"%$1"))}catch(e){}return t},Mixly.Tools.strToByte=e=>{for(var t,o=e.length,i=[],r=0;r<o;r++)65536<=(t=e.charCodeAt(r))&&t<=1114111?(i.push(t>>18&7|240),i.push(t>>12&63|128),i.push(t>>6&63|128),i.push(63&t|128)):2048<=t&&t<=65535?(i.push(t>>12&15|224),i.push(t>>6&63|128),i.push(63&t|128)):128<=t&&t<=2047?(i.push(t>>6&31|192),i.push(63&t|128)):i.push(255&t);return new Int8Array(i)},Mixly.Tools.uint8ArrayToStr=e=>{for(var t="",o=0;o<e.length;o++)var i=e[o].toString(16),t=t+" "+(i=i.length%2==1?"0"+i:i).toUpperCase();return t},(()=>{goog.require("Mixly.Url"),goog.require("Mixly.Modules"),goog.provide("Mixly.Electron");var{Modules:e,Electron:t}=Mixly;const{electron_remote:o,path:i}=e,{Menu:r,BrowserWindow:l}=o;t.newBrowserWindow=(e,t={})=>{r.setApplicationMenu(null);const o=new l({show:!1,minHeight:400,minWidth:700,width:0,height:0,icon:i.resolve(__dirname,"../../files/mixly.ico"),webPreferences:{nodeIntegration:!0,enableRemoteModule:!0,contextIsolation:!1,spellcheck:!1},...t.window??{}});return o.loadFile(e),o.once("ready-to-show",()=>{o.maximize(),o.show()}),o}})(),(()=>{"use strict";goog.require("Blockly"),goog.require("Mixly.Env"),goog.require("Mixly.Modules"),goog.require("Mixly.Config"),goog.require("Mixly.ScriptLoader"),goog.provide("Code");const{Env,Modules,Config,ScriptLoader}=Mixly,{fs}=Modules,{BOARD,USER}=Config;if(Code.LANGUAGE_NAME={"zh-hans":"简体中文","zh-hant":"繁體中文",en:"English",spa:"Español"},Code.LANGUAGE_RTL=["ar","fa","he","lki"],Code.workspace=null,Code.getStringParamFromUrl=function(e,t){e=location.search.match(new RegExp("[?&]"+e+"=([^&]+)"));return e?decodeURIComponent(e[1].replace(/\+/g,"%20")):t},Code.getLang=function(){var e=Code.getStringParamFromUrl("lang","");return e=void 0===Code.LANGUAGE_NAME[e]?"zh-hans":e},Code.isRtl=function(){return-1!=Code.LANGUAGE_RTL.indexOf(Code.LANG)},Code.loadBlocks=function(e){try{var t=window.sessionStorage.loadOnceBlocks}catch(e){t=null}var o;"BlocklyStorage"in window&&1<window.location.hash.length?BlocklyStorage.retrieveXml(window.location.hash.substring(1)):t?(delete window.sessionStorage.loadOnceBlocks,o=Blockly.Xml.textToDom(t),Blockly.Xml.domToWorkspace(o,Code.workspace)):e?(o=Blockly.Xml.textToDom(e),Blockly.Xml.domToWorkspace(o,Code.workspace)):"BlocklyStorage"in window&&window.setTimeout(BlocklyStorage.restoreBlocks,0)},Code.changeEditorTheme=function(){var e=document.getElementById("aceTheme"),e=e.options[e.selectedIndex].value;null!=editor&&editor.setOption("theme",e),null!=editor_side_code&&editor_side_code.setOption("theme",e)},Code.bindClick=function(e,t){(e="string"==typeof e?document.getElementById(e):e)&&(e.addEventListener("click",t,!0),e.addEventListener("touchend",t,!0))},Code.importPrettify=function(){},Code.getBBox_=function(e){for(var t=e.offsetHeight,o=e.offsetWidth,i=0,r=0;i+=e.offsetLeft,r+=e.offsetTop,e=e.offsetParent;);return{height:t,width:o,x:i,y:r}},Code.LANG=Code.getLang(),Code.TABS_=["blocks","arduino","xml"],Code.selected="blocks",Code.tabClick=function(e){if("tabon"==document.getElementById("tab_xml").className){var t=document.getElementById("content_xml").value,o=null;try{o=Blockly.Xml.textToDom(t)}catch(e){if(!window.confirm(MSG.badXml.replace("%1",e)))return}o&&(Code.workspace.clear(),Blockly.Xml.domToWorkspace(o,Code.workspace))}"tabon"==document.getElementById("tab_blocks").className&&Code.workspace.setVisible(!1);for(var i=0;i<Code.TABS_.length;i++){var r=Code.TABS_[i];document.getElementById("tab_"+r).className="taboff",document.getElementById("content_"+r).style.visibility="hidden"}Code.selected=e,document.getElementById("tab_"+e).className="tabon",document.getElementById("content_"+e).style.visibility="visible",Code.renderContent(),"blocks"==e&&Code.workspace.setVisible(!0),Blockly.svgResize(Code.workspace)},Code.renderContent=function(){var e,t,o=document.getElementById("content_"+Code.selected);"content_xml"==o.id?(e=document.getElementById("content_xml"),t=Blockly.Xml.workspaceToDom(Code.workspace),t=Blockly.Xml.domToPrettyText(t),e.value=t,e.focus()):"content_javascript"==o.id?Code.attemptCodeGeneration(Blockly.JavaScript):"content_python"==o.id?Code.attemptCodeGeneration(Blockly.Python):"content_php"==o.id?Code.attemptCodeGeneration(Blockly.PHP):"content_dart"==o.id?Code.attemptCodeGeneration(Blockly.Dart):"content_lua"==o.id&&Code.attemptCodeGeneration(Blockly.Lua),"object"==typeof PR&&PR.prettyPrint()},Code.attemptCodeGeneration=function(e){var t=document.getElementById("content_"+Code.selected);t.textContent="",Code.checkAllGeneratorFunctionsDefined(e)&&(e=e.workspaceToCode(Code.workspace),t.textContent=e,t.className=t.className.replace("prettyprinted",""))},Code.checkAllGeneratorFunctionsDefined=function(e){for(var t=Code.workspace.getAllBlocks(!1),o=[],i=0;i<t.length;i++){var r=t[i].type;e[r]||-1==o.indexOf(r)&&o.push(r)}var l,n=0==o.length;return n||(l="The generator code for the following blocks not specified for "+e.name_+":\n - "+o.join("\n - "),Blockly.alert(l)),n},Code.init=function(){Code.initLanguage(!0),document.getElementById("aceTheme")&&document.getElementById("aceTheme").addEventListener("change",Code.changeEditorTheme,!0);Code.isRtl()},Code.initLanguage=function(e=!1){var t,o=Code.isRtl(),i=(document.dir=o?"rtl":"ltr",Code.LANG=USER.language??"zh-hans",document.head.parentElement.setAttribute("lang",Code.LANG),[]);for(t in Code.LANGUAGE_NAME)i.push([Code.LANGUAGE_NAME[t],t]);i.sort(function(e,t){return e[0]>t[0]?1:e[0]<t[0]?-1:0});for(var r=document.getElementById("toolbox").getElementsByTagName("category"),l=0;l<r.length;l++)MSG[r[l].id]&&(r[l].setAttribute("name",MSG[r[l].id]),e?r[l].hasAttribute("toolboxitemid")||(r[l].setAttribute("toolboxitemid",r[l].id),r[l].setAttribute("name",MSG[r[l].id])):document.getElementById(r[l].id+".label")&&(document.getElementById(r[l].id+".label").innerText=MSG[r[l].id]));document.getElementById("copyright").textContent=MSG.copyright;for(var n,a=document.getElementsByClassName("textVar"),l=0;n=a[l];l++)n.textContent=MSG.textVariable;for(var s,d=document.getElementsByClassName("listVar"),l=0;s=d[l];l++)s.textContent=MSG.listVariable},Code.runJS=function(){Blockly.JavaScript.INFINITE_LOOP_TRAP="  checkTimeout();\n";var timeouts=0,checkTimeout=function(){if(1e6<timeouts++)throw MSG.timeout},code=Blockly.JavaScript.workspaceToCode(Code.workspace);Blockly.JavaScript.INFINITE_LOOP_TRAP=null;try{eval(code)}catch(e){alert(MSG.badCode.replace("%1",e))}},Code.discard=function(){var e=Code.workspace.getAllBlocks().length;(e<2||window.confirm(Blockly.Msg.DELETE_ALL_BLOCKS.replace("%1",e)))&&(Code.workspace.clear(),window.location.hash)&&(window.location.hash="")},Code.LANG=USER.language??"zh-hans",document.write('<script src="'+Config.pathPrefix+"common/msg/"+Code.LANG+'.js"><\/script>\n'),BOARD?.langFileDir)if("object"==typeof BOARD.langFileDir)for(let i=0,len=BOARD.langFileDir.length;i<len;i++)ScriptLoader.loadScript(BOARD.langFileDir[i]+"/"+Code.LANG+".js");else ScriptLoader.loadScript(BOARD.langFileDir+"/"+Code.LANG+".js");Code.loadThirdPartyLanJs=()=>{if(Env.isElectron)try{var e=Env.indexDirPath;if(fs.existsSync(e+"/libraries/ThirdParty/"))for(var t=fs.readdirSync(e+"/libraries/ThirdParty/"),o=0;o<t.length;o++)if(fs.existsSync(e+"/libraries/ThirdParty/"+t[o]+"/"))try{if(fs.existsSync(e+"/libraries/ThirdParty/"+t[o]+"/language/"+Code.LANG+".js")&&(ScriptLoader.loadScript("libraries/ThirdParty/"+t[o]+"/language/"+Code.LANG+".js"),Env.thirdPartyJS.push("libraries/ThirdParty/"+t[o]+"/language/"+Code.LANG+".js")),fs.existsSync(e+"/libraries/ThirdParty/"+t[o]+"/language/"))for(var i=fs.readdirSync(e+"/libraries/ThirdParty/"+t[o]+"/language/"),r=0;r<i.length;r++)fs.existsSync(e+"/libraries/ThirdParty/"+t[o]+"/language/"+i[r]+"/"+Code.LANG+".js")&&(ScriptLoader.loadScript("libraries/ThirdParty/"+t[o]+"/language/"+i[r]+"/"+Code.LANG+".js"),Env.thirdPartyJS.push("libraries/ThirdParty/"+t[o]+"/language/"+i[r]+"/"+Code.LANG+".js"))}catch(e){console.log(e)}}catch(e){console.log(e)}},Code.loadThirdPartyLanJs()})(),(()=>{goog.require("Mixly.Config"),goog.require("Mixly.MJSON"),goog.provide("Mixly.Command");const{Config:e,Command:l,MJSON:t}=Mixly,n=e["SOFTWARE"];l.DEFAULT={obj:"",func:"",args:[]},l.parse=e=>t.decode(t.parse(e)),l.run=t=>{if(n?.debug&&console.log("收到指令：",t),"object"==typeof t){var{obj:t,func:o,args:i}=t={...l.DEFAULT,...t},t=t.split(".");if(0!==t.length){let e=window[t[0]];if(e){t.shift();for(var r of t)if(!(e=e[r]))return;try{e[o]&&e[o](...i)}catch(e){console.log(e)}}}}}})(),goog.provide("Mixly.CssLoader"),goog.require("Mixly.Config"),goog.require("Mixly.Env"),Mixly.CssLoader.loadCss=function(e){for(var t,o=!0,i=document.getElementsByTagName("link"),r=0;r<i.length;r++)i[r]&&i[r].href&&-1!=i[r].href.indexOf(e)&&(o=!1);o&&((t=document.createElement("link")).setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",e),document.getElementsByTagName("head").item(0).appendChild(t))},Mixly.CssLoader.removeCss=function(e){for(var t=document.getElementsByTagName("link"),o=0;o<t.length;o++){t[o].href;t[o]&&t[o].href&&-1!=t[o].href.indexOf(e)&&t[o].parentNode.removeChild(t[o])}},Mixly.CssLoader.commonCss=["common/css/root.css","common/ui/layui/css/layui.css","common/css/ACEfont.css","common/css/fontello.css","common/css/nav.css","common/css/library.css","common/css/drag.css","common/css/button.css","common/css/xscrollbar.css","common/css/tippy-ext.css","common/css/scrollbar.css","common/css/select2.min.css","common/css/select2-ext.css","common/css/xterm.css"],Mixly.CssLoader.clientCss=[],Mixly.CssLoader.webCss=[],Mixly.CssLoader.load=function(){var o=Mixly.Config.pathPrefix;function e(t){for(let e=0;e<t.length;e++)Mixly.CssLoader.loadCss(o+t[e])}e(Mixly.CssLoader.commonCss),Mixly.Env.isElectron?e(Mixly.CssLoader.clientCss):e(Mixly.CssLoader.webCss)},Mixly.CssLoader.load(),goog.require("Mixly.FooterLayer"),goog.provide("Mixly.FooterBar"),(()=>{goog.require("layui"),goog.require("store"),goog.require("Mixly.Env"),goog.require("Mixly.Config"),goog.require("Mixly.Modules"),goog.require("Mixly.LocalStorage"),goog.require("Mixly.CssLoader"),goog.provide("Mixly.Loading");var e,{Env:t,Config:o,Modules:i,Loading:r}=Mixly,l=layui["laytpl"];let n=null;if((n=t.isElectron?({fs_extra:e,path:s}=i,s=s.resolve(t.clientPath,"./setting/config.json"),e.readJsonSync(s,{throws:!1})):store.get("mixly2.0-config"))&&(o.USER={...o.USER,...n}),o.USER.themeAuto&&(e=window.matchMedia("(prefers-color-scheme: light)"),o.USER.theme=e.matches?"light":"dark"),o.USER.languageAuto)switch(navigator.language){case"zh-CN":o.USER.language="zh-hans";break;case"zh-HK":case"zh-SG":case"zh-TW":o.USER.language="zh-hant";break;default:o.USER.language="en"}console.log("Config.USER",o.USER);let a;a="dark"===o.USER.theme?"#181818":"#fff",r.CSS_CONFIG={dark:{loading:"#181818",loadingLeftDiv:"#333333",loadingTopDiv:"#2F4056",loadingBottomDiv:"#007acc",body:"#181818"},light:{loading:"#fff",loadingLeftDiv:"#ddd",loadingTopDiv:"#009688",loadingBottomDiv:"#05bbaa",body:"#fff"}},r.TEMPLATE_RAW=goog.get(t.templatePath+"/skeleton.html"),r.TEMPLATE_RENDER=l(r.TEMPLATE_RAW).render(r.CSS_CONFIG[o.USER.theme]);var s=i.currentWindow;const d=o.USER.theme;s&&s.setBackgroundColor(a),$("html").append(r.TEMPLATE_RENDER),window.addEventListener("DOMContentLoaded",()=>{"dark"===d?$("body").addClass("dark"):$("body").addClass("light")})})(),(()=>{goog.require("layui"),goog.require("Mixly.Tools"),goog.require("Mixly.Env"),goog.require("Mixly.Config"),goog.require("Code"),goog.provide("Mixly.XML");const{Env:e,Config:t,XML:o}=Mixly;var i,r=t["BOARD"];const l=layui["laytpl"];o.TEMPLATE_DIR_PATH=goog.normalizePath_(goog.basePath+"../template/"),o.TEMPLATE_CONFIG=[{type:"LOADER_DIV",path:"/loader-div.html",config:{btnName:indexText["取消"]},appendToBody:!0},{type:"SELECTOR_DIV",path:"/selector-div.html",config:{btn1Name:indexText["取消"],btn2Name:indexText["确定"]},appendToBody:!0},{type:"SIMULATOR_DIV",path:"/simulator-div.html",config:{},appendToBody:!0},{type:"BOARD_SELECTOR",path:"/board-selector-div.html",config:{},appendToBody:!1},{type:"PORT_SELECTOR",path:"/port-selector-div.html",config:{selectPort:indexText["选择串口"],noPort:indexText["无可用串口"]},appendToBody:!1},{type:"BOARD_CONFIG_ELEMENT",path:"/board-config-element-div.html",config:{apply:"应用",reset:"复位"},appendToBody:!1},{type:"PARSE_MIX_ERROR_DIV",path:"/parse-mix-error-div.html",config:{},appendToBody:!1},{type:"READ_BITMAP_DIV",path:"/read-bitmap-div.html",config:{},appendToBody:!1},{type:"SEARCH_DIV",path:"/search-div.html",config:{search:indexText["查找"]},appendToBody:!1},{type:"PROGRESS_BAR_DIV",path:"/progress-bar-div.html",config:{},appendToBody:!1},{type:"LIB_MANAGER_DIV",path:"/lib-manager-div.html",config:{},appendToBody:!1},{type:"APP_DIV",path:"/app.html",config:{outputAceName:indexText["输出"],row:indexText["行"],column:indexText["列"],unknown:indexText["未知"],config:indexText["配置板卡"],selected:indexText["已选择"],on:indexText["在"]},appendToBody:!1},{type:"BOARD_CONFIG_MENU_DIV",path:"/board-config-menu-div.html",config:{},appendToBody:!1},{type:"EXAMPLE_MENU_DIV",path:"/example-menu-div.html",config:{},appendToBody:!1}],o.TEMPLATE_ENV={LOADER_DIV:!0,SELECTOR_DIV:!0,SIMULATOR_DIV:e.isElectron&&r?.nav?.compile,BOARD_SELECTOR:!0,PORT_SELECTOR:!(r?.nav?.run||r?.nav?.cancel||r?.nav?.webrun||r?.nav?.webcancel||!e.isElectron&&!e.hasSocketServer),BOARD_CONFIG_ELEMENT:r?.nav?.compile,PARSE_MIX_ERROR_DIV:!0,READ_BITMAP_DIV:!0,SEARCH_DIV:!0,PROGRESS_BAR_DIV:e.isElectron&&r?.nav?.setting?.thirdPartyLibrary,LIB_MANAGER_DIV:e.isElectron&&r?.nav?.setting?.thirdPartyLibrary,APP_DIV:!0,BOARD_CONFIG_MENU_DIV:!0,EXAMPLE_MENU_DIV:!0},o.TEMPLATE_STR={},o.TEMPLATE_STR_RENDER={},o.TEMPLATE_DOM={},o.CATEGORIES_STR={},o.getDom=(e,t={})=>$(l(e).render(t)),o.render=(e,t={})=>{var o,i={};for(o in t)"function"==typeof t[o]?i[o]=t[o]():i[o]=t[o];return l(e).render(i)},o.convert=function(e,t){for(var o="",i=!0,r=e.length,l=0;l<r;l++)"<"===e[l]?i=!1:">"===e[l]&&(i=!0),t&&!i&&l+1<r&&"\\"===e[l]&&'"'===e[l+1]&&(l+=1),!t&&!i&&0<l&&"\\"!==e[l-1]&&'"'===e[l]&&(o+="\\"),o+=e[l];return o};for(i of o.TEMPLATE_CONFIG){var{type:n,path:a,config:s,appendToBody:d}=i;o.TEMPLATE_ENV[n]&&(a=goog.get(o.TEMPLATE_DIR_PATH+a))&&(o.TEMPLATE_STR[n]=a,o.TEMPLATE_STR_RENDER[n]=o.render(a,s),o.TEMPLATE_DOM[n]=o.getDom(a,s),d)&&$("body").append(o.TEMPLATE_DOM[n])}if("object"===layui._typeof(r.board))for(var c in r.board){var u=r.board[c];"object"===layui._typeof(u)&&"string"===layui._typeof(u.xmlPath)&&(u=goog.get(u.xmlPath))&&(o.CATEGORIES_STR[c]=u)}window.addEventListener("load",()=>{for(var e of o.TEMPLATE_CONFIG){var{type:e,appendToBody:t}=e;o.TEMPLATE_ENV[e]&&o.TEMPLATE_DOM[e]&&t&&$("body").append(o.TEMPLATE_DOM[e])}})})(),(()=>{goog.require("Mixly.Modules"),goog.require("Mixly.Env"),goog.require("Mixly.Electron"),goog.provide("Mixly.Electron.CloudDownload");var{Modules:e,Electron:t}=Mixly;const i=t["CloudDownload"],{fs_extra:s,fs_extend:d,node_downloader_helper:c,path:u}=e;i.getJson=(e,t,o)=>{e?i.download(e,t).then(e=>{if(e[0])throw e[0];return s.readJson(e[1])}).then(e=>{o([null,e])}).catch(e=>{o([e,null])}):o(["url读取出错！",null])},i.download=(l,n,a={})=>new Promise((t,e)=>{var o={progress:null,end:null,error:null};a="object"!=typeof a?o:{...o,...a};try{s.ensureDirSync(n);var i=u.basename(l),r=u.resolve(n,"./"+i);d.isfile(r)&&s.removeSync(r)}catch(e){return void t([e,l])}o=c.DownloaderHelper,i=new o(l,n,{override:!0,timeout:15e3,retry:!1});i.on("progress",e=>{"function"==typeof a.progress&&a.progress(e)}),i.on("end",e=>{"function"==typeof a.end&&a.end(e),t([null,e.filePath])}),i.on("error",e=>{console.log("Download Failed",e),"function"==typeof a.error&&a.error(e),t([e,l])}),i.on("timeout",()=>{console.log("Download Timeout"),"function"==typeof a.timeout&&a.timeout("Download Timeout"),t(["Download Timeout",l])}),i.start().catch(e=>{console.log("Download Failed",e),"function"==typeof a.error&&a.error(e),t([e,l])})})})(),(()=>{goog.require("Mixly.Command"),goog.require("Mixly.Modules"),goog.require("Mixly.Config"),goog.require("Mixly.Electron"),goog.provide("Mixly.Electron.Events");const{Command:o,Modules:e,Config:t,Electron:i}=Mixly;var{}=i;const r=t["SOFTWARE"];e.ipcRenderer=require("electron").ipcRenderer,e.ipcRenderer.on("command",(e,t)=>{r.debug&&console.log("receive -> ",t);t=o.parse(t);o.run(t)})})(),(()=>{goog.require("Code"),goog.require("Mixly.Modules"),goog.require("Mixly.Config"),goog.require("Mixly.Env"),goog.require("Mixly.Electron"),goog.provide("Mixly.Electron.WikiManager");const{Modules:e,Config:t,Env:s,Electron:o}=Mixly,i=o["WikiManager"],d=t["BOARD"],{path:c,fs:u,fs_extra:p,fs_extend:g,json2md:A,electron_remote:r}=e,l=r["ipcMain"],n=require("electron-localshortcut");class a{constructor(e,t=null){this.gotoInfo=t,this.updateContentFile(),this.win=o.newBrowserWindow(e),this.isDestroyed=!1,this.addReceiveCommandEvent(),this.addLocalShortcutEvent(),this.win.on("close",()=>{this.isDestroyed=!0}),$(window).unload(()=>{this.isDestroyed||this.win.close()})}addLocalShortcutEvent(){n.register(this.win,"CmdOrCtrl+Shift+I",()=>{this.isDestroyed||this.win.webContents.toggleDevTools()}),n.register(this.win,"CmdOrCtrl+R",()=>{this.reload()})}addReceiveCommandEvent(){l.on("command",(e,t)=>{"object"==typeof t&&"getPath"===t.func&&this.updateWiki()})}sendCommand(e){this.isDestroyed||"object"!=typeof e||this.win.webContents.send("command",e)}reload(){this.isDestroyed||(this.updateContentFile(),this.win.reload())}getPagePath(e,t){if("object"!=typeof t||!e.length)return null;if(1===e.length){for(var o in t){o=t[o];if(o?.link?.title===e[0]){var{title:o,source:i}=o.link;if(o===e[0]&&"string"==typeof i)try{var r=i.match(/(?<=(\?file=))[^\s]*/g);if(r?.length)return r[0]}catch(e){console.log(e)}return null}}return null}for(var l in t){var n,l=t[l];if(l&&2===l.length&&l[0].h5===e[0])return(n=[...e]).shift(),this.getPagePath(n,l[1].ul)}}goto(e,t){var o=[],i=this.getPagePath(e,this.contentList);e&&(o.push(i),t&&o.push(t),this.sendCommand({func:"goto",args:o}),this.win.focus())}updateContentFile(){var e,t=c.resolve(s.indexDirPath,"./wiki/content.md"),o=c.resolve(s.indexDirPath,"./wiki/wiki-libs/"+Code.LANG),i=c.resolve(o,"./home"),r=c.resolve(s.indexDirPath,"./libraries/ThirdParty/"),l=(c.resolve(s.clientPath,"./CHANGELOG"),[]);if(g.isfile(i+".md")&&l.push({h4:{link:{title:indexText["首页"],source:"?file="+encodeURIComponent(i)}}}),g.isdir(o)&&(i=this.getContentJson(o,d.boardType))&&l.push(i),g.isdir(r))for(e of u.readdirSync(r)){var n=c.resolve(r,"./"+e+"/wiki/"+Code.LANG);g.isdir(n)&&(n=this.getContentJson(n,e))&&l.push(n)}this.contentList=l;try{var a=A(l).split("\n");for(let e=0;e<a.length;e++)a[e].replaceAll(" ","")?a[e].indexOf("#####")||(a[e]="\n"+a[e]):(a.splice(e,1),e--);p.outputFile(t,a.join("\n"))}catch(e){console.log(e)}}updateWiki(){var e,t,o,i,r=[{default:c.resolve(s.indexDirPath,"./wiki/wiki-libs/"),thirdParty:c.resolve(s.indexDirPath,"./libraries/ThirdParty/"),content:c.resolve(s.indexDirPath,"./wiki/content.md")}];this.gotoInfo&&({page:e,scrollPos:t}=this.gotoInfo,(o=this.getPagePath(this.gotoInfo.page,this.contentList))&&((i=[]).push(o),t&&i.push(t),r[0].goto=i),this.gotoInfo=null),this.sendCommand({func:"setPath",args:r})}getContentJson(e,t=null){var o=c.basename(e).split("-");if(2!==o.length&&!t)return null;var i,r=[],l=(r.push({h5:t??o[1]}),r.push({ul:[]}),r[1])["ul"];for(i of u.readdirSync(e)){var n,a=c.resolve(e,"./"+i);g.isdir(a)?(n=this.getContentJson(a))&&n[1].ul.length&&l.push(n):".md"===c.extname(i)&&2===(n=c.basename(i,".md").split("-")).length&&(a=c.resolve(c.dirname(a),"./"+c.basename(i,".md")),l.push({link:{title:n[1],source:"?file="+encodeURIComponent(a)+' "'+n[1]+'"'}}))}return r}}i.WikiPage=a,i.openWiki=e=>{var t,e=e&&"object"==typeof e?e[Code.LANG]:null;!i.wiki||i.wiki.isDestroyed?(t=c.resolve(s.indexDirPath,"../../../common/wiki/index.html"),g.isfile(t)?i.wiki=new a(t,e):layer.msg(indexText["未找到Wiki页"],{time:1e3})):(t=i.wiki["win"],t&&t.focus(),e&&({page:t,scrollPos:e}=e,i.wiki.goto(t,e)))},i.registerContextMenu=()=>{var e={displayText:indexText["打开Wiki"],preconditionFn:function(e){e=e.block.wiki;return"object"==typeof e&&"object"==typeof e[Code.LANG]&&"object"==typeof e[Code.LANG].page?"enabled":"hidden"},callback:function(e){e=e.block.wiki;i.openWiki(e)},scopeType:Blockly.ContextMenuRegistry.ScopeType.BLOCK,id:"wiki_open",weight:200};Blockly.ContextMenuRegistry.registry.register(e)}})(),(()=>{goog.require("Mixly.Config"),goog.require("Mixly.XML"),goog.require("Mixly.Env"),goog.provide("Mixly.DomOperator");const{DomOperator:t,Config:e}=Mixly,l=e["USER"],i=(t.SerialDom={times:0,getTimes:()=>(this.times=void 0!==this.times?this.times+1:0,10<this.times&&(this.times=0),this.times)},t)["SerialDom"];i.generate=class{constructor(e,t,o){this.mark=i.getTimes(),this.id=this.getId(),this.filter=this.getFilter(),this.lang=o,this.shade=t,this.config=this.getConfig(e),this.htmlStr=this.getHtmlStr(),this.generateDom(),this.destroyed=!1,this.width=null,this.height=null,this.prevPort=null,this.nowPort=null}getConfig(e){return t.getConfig(e,{baudRates:9600,ctrlCBtn:!1,ctrlDBtn:!1,receiveStr:!0,scroll:!0,sendStr:!0,sendWith:"\\r\\n",dtr:!0,rts:!0,pointNum:100,yMax:100,yMin:0})}getHtmlStr(){var{formId:e,setDtrId:t,setRtsId:o,selectPortId:i,selectBaudId:r,connectBtnId:l,sendTypeId:n,sendId:a,sendWithId:s,sendBtnId:d,receiveTypeId:c,scrollId:u,receiveId:p,clearBtnId:g,ctrlCBtnId:A,ctrlDBtnId:h,yMinId:y,yMaxId:m,pointNumId:f,chartSendTypeId:x,chartSendId:b,chartSendWithId:C,chartSendBtnId:v,dataDrawId:B,moveId:E}=this.id,{formFilter:w,setDtrFilter:I,setRtsFilter:M,selectPortFilter:T,selectBaudFilter:k,sendTypeFilter:S,sendWithFilter:D,chartSendTypeFilter:P,tabFilter:O,receiveTypeFilter:L,scrollFilter:F,selectPointNumFilter:R,connectBtnFilter:N}=this.filter,t=`
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label" style="height: 44px;padding-top: 1px;padding-bottom: 1px;">
                <p style="display:inline;">${indexText["串口"]}</p>
                <input style="display:none;">
                <input id="${t}" type="checkbox" title="DTR" lay-filter="${I}" lay-skin="primary" ${this.config.dtr?"checked":""}>
                <input id="${o}" type="checkbox" title="RTS" lay-filter="${M}" lay-skin="primary" ${this.config.rts?"checked":""}>
            </label>
            <div style="position: relative; height: 38px;">
                <div style="position: absolute; left: 0px; right: 64px;">
                    <div class="layui-input-inline" style="width:50%;clear:none;">
                        <select id="${i}" lay-verify="required" lay-filter="${T}"></select>
                    </div>
                    <div class="layui-input-inline" style="width:50%;clear:none;">
                        <select id="${r}" lay-filter="${k}">
                            <option value="9600" ${9600==this.config.baudRates?"selected":""}>9600</option>
                            <option value="19200" ${19200==this.config.baudRates?"selected":""}>19200</option>
                            <option value="28800" ${28800==this.config.baudRates?"selected":""}>28800</option>
                            <option value="38400" ${38400==this.config.baudRates?"selected":""}>38400</option>
                            <option value="57600" ${57600==this.config.baudRates?"selected":""}>57600</option>
                            <option value="115200" ${115200==this.config.baudRates?"selected":""}>115200</option>
                        </select>
                    </div>
                </div>
                <button id="${l}" class="layui-btn layui-btn-normal" style="position: absolute; right: 0px; width: 64px;" lay-filter="${N}">${indexText["打开"]}</button>
            </div>
        </div>`,I=`
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label" style="height: 44px;padding-top: 1px;padding-bottom: 1px;">
                <p style="display:inline;">${indexText["发送数据"]}</p>
                <input style="display:none;">
                <input id="${n}" type="checkbox" title="${indexText["字符串"]}" lay-filter="${S}" lay-skin="primary" checked>
            </label>
            <div style="position: relative; height: 38px;">
                <div class="layui-input-inline" style="position: absolute; right: 128px; left: 0px;clear: none;">
                    <input id="${a}" type="text" name="title" placeholder="${indexText["请输入内容"]}" autocomplete="off" class="layui-input">
                </div>
                <div class="layui-input-inline" style="position: absolute; right: 64px; width: 64px;clear: none;">
                  <select id="${s}" lay-filter="${D}">
                    <option value="no">no</option>
                    <option value="\\n">\\n</option>
                    <option value="\\r">\\r</option>
                    <option value="\\r\\n" selected>\\r\\n</option>
                  </select>
                </div>
                <button id="${d}" class="layui-btn layui-btn-normal" style="position: absolute; right: 0px; width: 64px;">${indexText["发送"]}</button>
            </div>
        </div>`,o=`
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label" style="height: 44px;padding-top: 1px;padding-bottom: 1px;">
                <p style="display:inline;">${indexText["接收数据"]}</p>
                <input style="display:none;">
                <input id="${c}" type="checkbox" title="${indexText["字符串"]}" lay-filter="${L}" lay-skin="primary" checked>
                <input id="${u}" type="checkbox" title="${indexText["滚屏"]}" lay-filter="${F}" lay-skin="primary" checked>
            </label>
            <div class="layui-input-block">
                <textarea
                    readonly
                    id="${p}"
                    name="desc"
                    wrap="off"
                    spellcheck="false"
                    placeholder="${indexText["串口输出"]}"
                    class="layui-textarea"
                    style="height: 220px;"
                ></textarea>
            </div>
        </div>`,M=`
        <div class="layui-form-item layui-form-text">
            <div style="text-align: center;"> 
                <button id="${g}" class="layui-btn layui-btn-danger">${indexText["清空"]}</button>
                ${this.config.ctrlCBtn?`<button id="${A}" class="layui-btn layui-btn-danger">${indexText["中断"]}</button>`:""}
                ${this.config.ctrlDBtn?`<button id="${h}" class="layui-btn layui-btn-danger">${indexText["复位"]}</button>`:""}
            </div>
        </div>`,i=`
        <div class="layui-form-item layui-form-text">
            <div class="layui-input-inline" style="width:15%;clear:none;">
                <label class="layui-form-label">${indexText["最小"]}</label>
                <input id="${y}" type="text" name="title" autocomplete="off" class="layui-input" value="${this.config.yMin}">
            </div>
            <div class="layui-input-inline" style="width:15%;clear:none;">
                <label class="layui-form-label">${indexText["最大"]}</label>
                <input id="${m}" type="text" name="title" autocomplete="off" class="layui-input" value="${this.config.yMax}">
            </div>
            <div class="layui-input-inline" style="width:15%;clear:none;">
                <label class="layui-form-label">${indexText["点数"]}</label>
                <select id="${f}" lay-filter="${R}">
                    <option value="50" ${"50"==this.config.pointNum?"selected":""}>50</option>
                    <option value="100" ${"100"==this.config.pointNum?"selected":""}>100</option>
                    <option value="150" ${"150"==this.config.pointNum?"selected":""}>150</option>
                    <option value="200" ${"200"==this.config.pointNum?"selected":""}>200</option>
                    <option value="250" ${"250"==this.config.pointNum?"selected":""}>250</option>
                    <option value="300" ${"300"==this.config.pointNum?"selected":""}>300</option>
                </select>
            </div>
            <div class="layui-input-inline" style="width:55%;clear:none;">
                <!--
                <label class="layui-form-label" style="height: 44px;padding-top: 1px;padding-bottom: 1px;">
                    <p style="display:inline;">${indexText["发送数据"]}</p>
                    <input style="display:none;">
                    <input id="${x}" type="checkbox" title="${indexText["字符串"]}" lay-filter="${P}" lay-skin="primary" checked>
                </label>
                -->
                <label class="layui-form-label">${indexText["发送数据"]}</label>
                <div style="position: relative;width: 100%;height: 38px;">
                    <div class="layui-input-inline" style="position: absolute;left: 0px;right: 128px;clear: none;bottom: 0px;top: 0px;">
                        <input id="${b}" type="text" name="title" placeholder="${indexText["请输入内容"]}" autocomplete="off" class="layui-input">
                    </div>
                    <div class="layui-input-inline" style="position: absolute;right: 64px;width: 64px;clear: none;bottom: 0px;top: 0px;">
                        <select id="${C}">
                            <option value="no">no</option>
                            <option value="\\n">\\n</option>
                            <option value="\\r">\\r</option>
                            <option value="\\r\\n" selected>\\r\\n</option>
                        </select>
                    </div>
                    <button id="${v}" class="layui-btn layui-btn-normal" style="position: absolute;right: 0px;width: 64px;">${indexText["发送"]}</button>
                </div>
            </div>
        </div>`,T=`
        <div id="${E}" style="height: 10px;width: 100%;"></div>
        <div class="layui-tab" lay-filter="${O}" style="width: 100%;height: 100%;margin-top: 0px;margin-bottom: 0px;position: relative;">
            <ul class="layui-tab-title" style="position: absolute;left: 0px;top: 0px;height: 40px;right: 0px;">
                <li class="layui-this" lay-id="0">${indexText["串口监视器"]}</li>
                <li lay-id="1">${indexText["串口可视化"]}</li>
            </ul>
            <div class="layui-tab-content" style="position: absolute;left: 0px;top: 40px;bottom: 10px;right: 0px;overflow: auto;padding-bottom: 0px;">
                <div class="layui-tab-item layui-show">
                    ${t}
                    ${I}
                    ${o}
                    ${M}
                </div>
                <div class="layui-tab-item">
                    ${i}
                    ${`
        <div class="layui-form-item layui-form-text" style="padding-top: 25px;">
            <div id="${B}" style="width: 100%;overflow-x: auto;">
            </div>
        </div>`}
                </div>
            </div>
        </div>`;return[`
        <div class="layui-form layui-form-pane" id="${e}" lay-filter="${w}">
            ${T}
        </div>`,T]}generateDom(){let o=this.id["formId"],i=this.filter["formFilter"],r=this;layui.use(["layer","form"],function(){var e=layui.form,t=document.createElement("div");t.innerHTML=r.htmlStr[1],t.className="layui-form layui-form-pane",t.id=o,t.style.display="none",t.setAttribute("lay-filter",i),document.body.appendChild(t),e.render(null,i)})}updateDom(){let o=this.id["formId"],i=this.filter["formFilter"],r=this;layui.use(["layer","form"],function(){var e=layui.form,t=document.getElementById(o);r.htmlStr=r.getHtmlStr(),t.innerHTML=r.htmlStr[1],e.render(null,i)})}getId(){return{pageId:"serial-page-"+this.mark,formId:"serial-"+this.mark,setDtrId:"serial-set-dtr-"+this.mark,setRtsId:"serial-set-rts-"+this.mark,selectPortId:"serial-selectport-"+this.mark,selectBaudId:"serial-selectbaud-"+this.mark,connectBtnId:"serial-connectbtn-"+this.mark,sendTypeId:"serial-sendtype-"+this.mark,sendId:"serial-send-"+this.mark,sendWithId:"serial-sendwith-"+this.mark,sendBtnId:"serial-sendbtn-"+this.mark,receiveTypeId:"serial-receivetype-"+this.mark,scrollId:"serial-scroll-"+this.mark,receiveId:"serial-receive-"+this.mark,clearBtnId:"serial-clearbtn-"+this.mark,ctrlCBtnId:"serial-interruptbtn-"+this.mark,ctrlDBtnId:"serial-resetbtn-"+this.mark,yMinId:"serial-ymin-"+this.mark,yMaxId:"serial-ymax-"+this.mark,pointNumId:"serial-pointnum-"+this.mark,chartSendTypeId:"serial-chartsendType-"+this.mark,chartSendId:"serial-chartsend-"+this.mark,chartSendWithId:"serial-chartsendWith-"+this.mark,chartSendBtnId:"serial-chartsendBtn-"+this.mark,dataDrawId:"serial-datadraw-"+this.mark,moveId:"serial-move-"+this.mark}}getFilter(){return{formFilter:"serial-filter-"+this.mark,setDtrFilter:"serial-set-dtr-filter-"+this.mark,setRtsFilter:"serial-set-rts-filter-"+this.mark,selectPortFilter:"serial-select-port-filter-"+this.mark,selectBaudFilter:"serial-select-baud-filter-"+this.mark,sendTypeFilter:"serial-send-type-filter-"+this.mark,sendWithFilter:"serial-send-with-filter-"+this.mark,chartSendTypeFilter:"serial-chart-send-type-filter-"+this.mark,tabFilter:"serial-tab-filter-"+this.mark,receiveTypeFilter:"serial-set-receive-type-filter-"+this.mark,scrollFilter:"serial-scroll-filter-"+this.mark,selectPointNumFilter:"serial-select-point-num-filter-"+this.mark,connectBtnFilter:"serial-connect-btn-filter-"+this.mark}}adjustSerialTool(e,t){var{pageId:o,moveId:i}=this.id,i=("dark"===l.theme&&$("#"+i).css("background-color","#6c6969"),e.css({minWidth:"350px",minHeight:"200px",maxWidth:"710px",maxHeight:"600px",borderRadius:"5px"}),$(window).height()),r=$(window).width();e.css({left:(r-e.width())/2+"px",top:(i-e.height())/2+"px"}),$("#"+o).css({height:"100%",overflow:"hidden",maxWidth:"710px",maxHeight:"600px",minWidth:"350px",minHeight:"200px",borderRadius:"8px"})}open(s=()=>{},d=()=>{}){let c=this;var e=$(window).height(),t=$(window).width();let u=["90%","95%"];this.height&&e>this.height&&100*this.height/e<95&&(u[1]=100*this.height/e+"%"),this.width&&t>this.width&&100*this.width/t<90&&(u[0]=100*this.width/t+"%"),layui.use(["layer","form"],()=>{var e=layui.layer;let o=layui.form,{formId:t,moveId:i,pageId:r,receiveId:l}=c.id,n=c.filter["formFilter"],a=$("#"+l);c.tool=e.open({type:1,id:r,title:!1,area:u,shade:this.shade,closeBtn:1,anim:0,resize:!0,fixed:!0,move:$("#"+i),content:$("#"+t),success:(e,t)=>{e[0].childNodes[1].childNodes[0].classList.remove("layui-layer-close2"),e[0].childNodes[1].childNodes[0].classList.add("layui-layer-close1"),a.val(""),o.render(null,n),c.adjustSerialTool(e,t),s(c)},end:()=>{$(".layui-layer-shade").remove(),d(this.nowPort)},resizing:e=>{var t=$(window).height(),o=$(window).width();e.css({width:e.width()/o*100+"%",height:e.height()/t*100+"%"}),$("#"+r).css("height","100%"),this.width=e[0].clientWidth,this.height=e[0].clientHeight}})})}close(){layer.close(this.tool)}updateTool(e){this.config=this.getConfig(e);var t,o,i,{setDtrId:e,setRtsId:r,selectPortId:l,selectBaudId:n,sendTypeId:a,sendWithId:s,receiveTypeId:d,scrollId:c,yMinId:u,yMaxId:p,pointNumId:g}=this.id,A=layui["form"],e=$("#"+e),r=$("#"+r),l=$("#"+l),n=$("#"+n),a=$("#"+a),s=$("#"+s),h={dtr:e,rts:r,sendStr:a,receiveStr:$("#"+d),scroll:$("#"+c)},y={port:l,baudRates:n,sendWith:s,yMin:$("#"+u),yMax:$("#"+p),pointNum:$("#"+g)};for(t in h)void 0!==this.config[t]&&h[t].prop("checked",this.config[t]);for(o in y)void 0!==this.config[o]&&(i=y[o],$(i).val(this.config[o]));A.render()}formOnClick(e,o,i){layui.use(["layer","form"],()=>{layui.form.on(e+"("+o+")",e=>{var t=this.filter["selectPortFilter"];o===t?e.value!==this.nowPort&&(this.prevPort=this.nowPort,this.nowPort=e.value,i(this.prevPort,this.nowPort,e)):i(this.nowPort,e)})})}elementOnClick(e,t,o){layui.use(["layer","element"],()=>{layui.element.on(e+"("+t+")",e=>{o(this.nowPort,e)})})}btnOnClick(e,t){$("#"+e).off("click").click(()=>{t(this.nowPort)})}onClickSetDtr(e){var t=this.filter["setDtrFilter"];this.formOnClick("checkbox",t,e)}onClickSetRts(e){var t=this.filter["setRtsFilter"];this.formOnClick("checkbox",t,e)}onClickSendType(e){var t=this.filter["sendTypeFilter"];this.formOnClick("checkbox",t,e)}onClickReceiveType(e){var t=this.filter["receiveTypeFilter"];this.formOnClick("checkbox",t,e)}onClickScroll(e){var t=this.filter["scrollFilter"];this.formOnClick("checkbox",t,e)}onClickSelectPort(e){var t=this.filter["selectPortFilter"];this.formOnClick("select",t,e)}onClickSelectBaud(e){var t=this.filter["selectBaudFilter"];this.formOnClick("select",t,e)}onClickSelectPointNum(e){var t=this.filter["selectPointNumFilter"];this.formOnClick("select",t,e)}onClickSelectSendWith(e){var t=this.filter["sendWithFilter"];this.formOnClick("select",t,e)}onClickTab(e){var t=this.filter["tabFilter"];this.elementOnClick("tab",t,e)}onClickConnectBtn(e){var t=this.id["connectBtnId"];this.btnOnClick(t,e)}onClickSendBtn(e){var t=this.id["sendBtnId"];this.btnOnClick(t,e)}onClickChartSendBtn(e){var t=this.id["chartSendBtnId"];this.btnOnClick(t,e)}onClickCtrlCBtn(e){var t=this.id["ctrlCBtnId"];t&&this.btnOnClick(t,e)}onClickCtrlDBtn(e){var t=this.id["ctrlDBtnId"];t&&this.btnOnClick(t,e)}onClickClearBtn(e){var t=this.id["clearBtnId"];this.btnOnClick(t,e)}destroy(){this.tool&&layer.close(this.tool);var e=this.id["formId"];$("#"+e).remove(),this.destroyed=!0}},t.LoaderDomGenerator=(e,t)=>{};t.getConfig=(e,t)=>{var o,i={};for(o in t)if("object"==typeof t[o])if(void 0===e[o])i[o]=t[o];else for(var r in i[o]={},t[o])i[o][r]=e[o][r]??t[o][r];else i[o]=e[o]??t[o];return i}})(),(()=>{goog.require("layui"),goog.require("Mixly.DomOperator"),goog.require("Mixly.Config"),goog.provide("Mixly.LayerExt");const{LayerExt:h,Config:e,DomOperator:i}=Mixly,t=e["USER"],y=layui["layer"];h.SHADE={dark:[[.005,"rgb(46 64 86)"],[.005,"rgb(46 64 86)","40px"]],light:[[.005,"#009688"],[.005,"#009688","40px"]]},h.SHADE_ALL=h.SHADE.light[0],h.SHADE_NAV=h.SHADE.light[1],h.DEFAULT_TITLE_HEIGHT=42,h.DEFAULT_CONFIG={area:["50%","50%"],max:["850px","543px"],min:["350px","243px"],title:"信息",id:"info",content:"",resize:!0,shade:h.SHADE_ALL,success:null,end:null,cancel:null,resizing:null,offset:"auto",fixed:!0,borderRadius:"8px",maxmin:!1,zIndex:19891014},h.updateShade=()=>{["light","dark"].includes(t.theme)||(t.theme="light"),h.SHADE_ALL=h.SHADE[t.theme][0],h.SHADE_NAV=h.SHADE[t.theme][1]},h.openSerialTool=(e,t,o)=>{e=new i.SerialDom.generate(e,h.SHADE_ALL,Code.LANG);return e.open(t,o),e},h.open=n=>{const{id:a,area:e,title:t,content:o,resize:i,shade:r,resizing:l,offset:s,fixed:d,borderRadius:c,maxmin:u,zIndex:p}=n="object"!=typeof n?h.DEFAULT_CONFIG:{...h.DEFAULT_CONFIG,...n};let g=42,A=null;return A=t?"object"!=typeof t||isNaN(parseInt(t[1]))?t:(g=parseInt(t[1]),t[0]):(g=0,!1),y.open({type:1,id:a,title:A,area:e,content:o,shade:r,closeBtn:1,resize:i,fixed:d,offset:s,maxmin:u,zIndex:p,success:function(e,t){y.style(t,{borderRadius:c});var{max:o,min:i,success:r}=n,l=$("#"+a),o=(l.addClass("scrollbar1"),"object"==typeof o&&(e.css({maxWidth:o[0],maxHeight:o[1]}),l.css("maxWidth",o[0]),-1!==o[1].indexOf("%")?l.css("maxHeight",o[1]):l.css("maxHeight",parseInt(o[1])-g+"px")),"object"==typeof i&&(e.css({minHeight:i[1],minWidth:i[0]}),l.css("minWidth",i[0]),-1!==i[1].indexOf("%")?l.css("minHeight",i[1]):l.css("minHeight",parseInt(i[1])-g+"px")),$(window).height()),i=$(window).width(),i=(e.css({left:(i-e.width())/2+"px",top:(o-e.height())/2+"px"}),e.find(".layui-layer-title")),o=(i.css("borderRadius",c+" "+c+" 0px 0px"),l.css("borderRadius","0px 0px "+c+" "+c),e.find(".layui-layer-setwin"));g&&42!==g&&(i.css({height:g+"px","line-height":g+"px"}),o.css({right:"10px",top:"10px"}),l.css({height:e.height()-g+"px"})),"function"==typeof r&&r(e,t)},end:function(){var e=n["end"];"function"==typeof e&&e()},cancel:function(e,t){$("#layui-layer-shade"+e).remove();var o=n["cancel"];"function"==typeof o&&o(e,t)},resizing:function(e){var t=$(window).height(),o=$(window).width(),o=e.width()/o*100+"%",t=e.height()/t*100+"%";e.css({width:o,height:t}),"function"==typeof l&&(e=e.children(".layui-layer-content"),l({layero:[o,t],content:[e.width(),e.height()]}))}})}})(),(()=>{goog.require("Code"),goog.require("layui"),goog.require("Mixly.Env"),goog.require("Mixly.Config"),goog.require("Mixly.Command"),goog.require("Mixly.XML"),goog.provide("Mixly.Nav");const{Env:e,Config:t,Nav:y,XML:m}=Mixly,{BOARD:f,USER:o}=t,{element:x,form:b}=layui;y.DEFAULT_CONFIG={burn:!1,upload:!1,compile:!1,simulate:!1,run:!1,cancel:!1,webrun:!1,webcancel:!1,save:{ino:!1,bin:!1,hex:!1,py:!1,img:!1},setting:{thirdPartyLibrary:!1,wiki:!1}};let r,l="electron",n="electron";y.CONFIG={...y.DEFAULT_CONFIG,...f?.nav??{}},r=y.CONFIG.compile?"c":y.CONFIG.run||y.CONFIG.webrun?y.CONFIG.run?"py":"webpy":"mpy",l=e.hasSocketServer?"websocket":e.hasCompiler?"webcompiler":e.isElectron?"electron":"web",n=e.isElectron?"electron":"web",y.codeEnv=r,y.workingEnv=l,y.operatingEnv=n,y.LEFT_BTN_CONFIG=[{type:"UNDO",class:"icon-ccw",id:"undo-btn",title:"undo(ctrl+z)",href:"#",onclick:"Mixly.Editor.undo()"},{type:"REDO",class:"icon-cw",id:"redo-btn",title:"redo(ctrl+y)",href:"#",onclick:"Mixly.Editor.redo()"},{type:"CONNECT",class:"icon-link",id:"connect-btn",title:"",href:"#",onclick:{web:"Mixly.Web.BU.clickConnect()",webcompiler:"Mixly.Web.BU.clickConnect()"}},{type:"BURN",class:"icon-upload-1",id:"burn-btn",title:"",href:"#",onclick:{electron:{mpy:"Mixly.Electron.BU.initBurn()",c:"Mixly.Electron.ArduShell.burn()"},web:{mpy:"Mixly.Web.BU.initBurn()"},websocket:{mpy:"Mixly.WebSocket.BU.initBurn()"},webcompiler:{mpy:"Mixly.Web.BU.initBurn()"}}},{type:"COMPILE",class:"icon-check",id:"compile-btn",title:"",href:"#",onclick:{electron:{c:"Mixly.Electron.ArduShell.initCompile()"},websocket:{c:"Mixly.WebSocket.ArduShell.initCompile()"},webcompiler:{c:"Mixly.WebCompiler.Compiler.compile()"}}},{type:"UPLOAD",class:"icon-upload",id:"upload-btn",title:"",href:"#",onclick:{electron:{c:"Mixly.Electron.ArduShell.initUpload()",mpy:"Mixly.Electron.BU.initUpload()"},web:{mpy:"Mixly.Web.BU.initUpload()"},webcompiler:{c:"Mixly.WebCompiler.Compiler.upload()",mpy:"Mixly.Web.BU.initUpload()"},websocket:{c:"Mixly.WebSocket.ArduShell.initUpload()",mpy:"Mixly.WebSocket.BU.initUpload()"}}},{type:"SIMULATE",class:"icon-play-circled",id:"simulate_btn",title:"",href:"#",onclick:{electron:{c:"Mixly.AvrSimulate.initSimulate()"}}},{type:"RUN",class:"icon-play-circled",id:"run-btn",title:"",href:"#",onclick:{electron:{py:"Mixly.Electron.PythonShell.run()"}}},{type:"STOP",class:"icon-cancel",id:"stop-btn",title:"",href:"#",onclick:{electron:{py:"Mixly.Electron.PythonShell.stop()"}}},{type:"WEBPY_SETP_RUN",class:"icon-play-circled",id:"step-run-btn",title:"",href:"#",onclick:"pyengine.steprun()"},{type:"WEBPY_RUN",class:"icon-play-circled",id:"run-btn",title:"",href:"#",onclick:"pyengine.run()"},{type:"WEBPY_STOP",class:"icon-cancel",id:"stop-btn",title:"",href:"#",onclick:"pyengine.kill()"},{type:"SERIAL",class:"icon-usb",id:"serial-btn",title:"",href:"#",onclick:{electron:{mpy:"Mixly.Electron.Serial.openTool()",c:"Mixly.Electron.Serial.openTool()"},web:{mpy:"Mixly.Web.Serial.openTool()"},webcompiler:{mpy:"Mixly.Web.Serial.openTool()",c:"Mixly.Web.Serial.openTool()"},websocket:{mpy:"Mixly.WebSocket.Serial.openTool()",c:"Mixly.WebSocket.Serial.openTool()"}}},{type:"STATUS_BAR",class:"icon-window",id:"statusbar-btn",title:"",href:"#",onclick:"Mixly.StatusBar.show(0)"}],y.LEFT_BTN_ENV={UNDO:!0,REDO:!0,CONNECT:!e.isElectron&&"py"!=r&&"webpy"!=r,BURN:y.CONFIG.burn&&!(!e.isElectron&&"MixGo AI"===f?.boardType&&!e.hasSocketServer),COMPILE:y.CONFIG.compile,UPLOAD:y.CONFIG.upload,SIMULATE:y.CONFIG.simulate,RUN:y.CONFIG.run,STOP:y.CONFIG.cancel,WEBPY_SETP_RUN:y.CONFIG.websteprun,WEBPY_RUN:y.CONFIG.webrun,WEBPY_STOP:y.CONFIG.webcancel,SERIAL:"py"!=r&&"webpy"!=r},y.RIGHT_BTN_CONFIG=[{type:"FILE",class:"",id:"file-btn",title:"",href:"javascript:;",onclick:"",children:[{type:"NEW_FILE",class:"icon-doc-new",id:"new-btn",title:"",href:"#",onclick:{electron:"Mixly.Electron.File.newFile()",web:"Mixly.Web.File.new()",webcompiler:"Mixly.Web.File.new()",websocket:"Mixly.Web.File.new()"}},{type:"OPEN_FILE",class:"icon-folder-open-empty",id:"open-btn",title:"",href:"#",onclick:{electron:"Mixly.Electron.File.open()",web:"Mixly.Web.File.open()",websocket:{electron:"Mixly.Electron.File.open()",web:"Mixly.Web.File.open()"},webcompiler:{electron:"Mixly.Electron.File.open()",web:"Mixly.Web.File.open()"}}},{type:"OPEN_FROM_CLOUD",class:"icon-download-cloud-1",id:"open-from-cloud-btn",title:"",href:"#",onclick:{websocket:{web:"Mixly.WebSocket.File.openFromCloud()"}}},{type:"SAVE_FILE",class:"icon-floppy",id:"save-btn",title:"",href:"#",onclick:{electron:"Mixly.Electron.File.save()",websocket:{electron:"Mixly.Electron.File.save()",web:"Mixly.Web.File.save()"},webcompiler:{electron:"Mixly.Electron.File.save()",web:"Mixly.Web.File.save()"},web:"Mixly.Web.File.save()"}},{type:"SAVE_AS_FILE",class:"icon-save-as",id:"save-as-btn",title:"",href:"#",onclick:{electron:"Mixly.Electron.File.saveAs()",websocket:{electron:"Mixly.Electron.File.saveAs()",web:"Mixly.Web.File.saveAs()"},webcompiler:{electron:"Mixly.Electron.File.saveAs()",web:"Mixly.Web.File.saveAs()"},web:"Mixly.Web.File.saveAs()"}},{type:"SAVE_TO_CLOUD",class:"icon-upload-cloud-1",id:"save-to-cloud-btn",title:"",href:"#",onclick:{websocket:{web:"Mixly.WebSocket.File.saveToCloud()"}}},{type:"SAVE_XML",class:"icon-floppy",id:"save-xml-btn",title:"",href:"#",onclick:{web:"save()",websocket:{web:"save()"},webcompiler:{web:"save()"}}},{type:"SAVE_PY",class:"icon-file-code",id:"save-py-btn",title:"",href:"#",onclick:{web:"mixlyjs.savePyFileAs()",websocket:{web:"mixlyjs.savePyFileAs()"},webcompiler:{web:"mixlyjs.savePyFileAs()"}}},{type:"SAVE_INO",class:"icon-file-code",id:"save-ino-btn",title:"",href:"#",onclick:{web:"mixlyjs.saveInoFileAs()",websocket:{web:"mixlyjs.saveInoFileAs()"},webcompiler:{web:"mixlyjs.saveInoFileAs()"}}},{type:"SAVE_HEX",class:"icon-file-code",id:"save-hex-btn",title:"",href:"#",onclick:{web:"mixlyjs.compileMicrobitPy()",websocket:{web:"mixlyjs.compileMicrobitPy()"},webcompiler:{web:"mixlyjs.compileMicrobitPy()"}}},{type:"SAVE_IMG",class:"icon-floppy",id:"save-img-btn",title:"",href:"#",onclick:{web:"mixlyjs.saveBlockImg()",websocket:{web:"mixlyjs.saveBlockImg()"},webcompiler:{web:"mixlyjs.saveBlockImg()"}}},{type:"EXPORT_LIB",class:"icon-export",id:"export-libraries-btn",title:"",href:"#",onclick:{electron:"Mixly.Electron.File.exportLib()"}}]},{type:"SETTING",class:"",id:"setting-btn",title:"",href:"javascript:;",onclick:"",children:[{type:"MANAGE_LIB",class:"icon-menu",id:"manage-libraries-btn",title:"",href:"#",onclick:{electron:"Mixly.Electron.LibManager.showManageDialog()"}},{type:"OTHER_BIN",class:"icon-upload-1",id:"other-burn-btn",title:"",href:"#",onclick:{electron:"Mixly.Electron.BU.burnWithSpecialBin()"}},{type:"WS_CONNECT",class:"icon-link",id:"socket-connect-btn",title:"",href:"#",onclick:{websocket:"Mixly.WebSocket.Socket.clickConnect()"}},{type:"PYTHON_TO_BLOCKLY",class:"toggle-off-1",id:"python-to-blockly-btn",title:"",href:"#",onclick:"Mixly.Editor.py2BlockEditorChangeStatus()"},{type:"OPEN_WIKI",class:"icon-book-open",id:"wiki-btn",title:"",href:"#",onclick:{electron:"Mixly.Electron.WikiManager.openWiki()"}},{type:"FEED_BACK",class:"icon-comment-1",id:"feedback-btn",title:"",href:"#",onclick:"Mixly.Interface.feedback()"}]}],y.RIGHT_BTN_ENV={SETTING:!0,EXPORT_LIB:e.isElectron&&y.CONFIG.setting.thirdPartyLibrary,MANAGE_LIB:e.isElectron&&y.CONFIG.setting.thirdPartyLibrary,OTHER_BIN:y.CONFIG.burn&&"object"==typeof f?.burn?.special,WS_CONNECT:"websocket"===l,FILE:!0,NEW_FILE:!0,OPEN_FILE:!0,OPEN_FROM_CLOUD:!e.isElectron&&e.hasSocketServer,SAVE_FILE:e.isElectron,SAVE_AS_FILE:e.isElectron,SAVE_XML:!e.isElectron,SAVE_PY:!e.isElectron&&y.CONFIG.save.py,SAVE_INO:!e.isElectron&&y.CONFIG.save.ino,SAVE_HEX:!e.isElectron&&y.CONFIG.save.py&&y.CONFIG.save.hex,SAVE_IMG:!e.isElectron&&y.CONFIG.save.img,SAVE_TO_CLOUD:!e.isElectron&&e.hasSocketServer,PYTHON_TO_BLOCKLY:y.CONFIG?.setting?.pythonToBlockly&&["mpy","py","webpy"].includes(r),OPEN_WIKI:e.isElectron&&y.CONFIG.setting.wiki,FEED_BACK:!0},y.generateBtnConfig=(e,t=null)=>{var o={class:e.class,id:e.id,title:e.title,href:e.href},e=e["onclick"];if("string"==typeof e)o.onclick=e;else if("object"==typeof e){e=e[l];if("string"==typeof e)o.onclick=e;else if("object"==typeof e)if(["electron","web"].includes(l)){var i=e[r];if("string"==typeof i)o.onclick=i;else{if(!t)return null;o.onclick=t}}else if(["websocket","webcompiler"].includes(l)){i=e[r],e=e[n];if("string"==typeof i)o.onclick=i;else if("string"==typeof e)o.onclick=e;else if("object"==typeof e){i=e[r];if("string"==typeof i)o.onclick=i;else{if(!t)return null;o.onclick=t}}else{if(!t)return null;o.onclick=t}}else{if(!t)return null;o.onclick=t}else{if(!t)return null;o.onclick=t}}return o};var i,a={type:null,class:"",id:"id",title:"",href:"#",onclick:"",children:null},s=[];for(i of y.LEFT_BTN_CONFIG){var d=(i={...a,...i})["type"];y.LEFT_BTN_ENV[d]&&(d=y.generateBtnConfig(i))&&s.push(d)}var c,u,p=[];for(c of y.RIGHT_BTN_CONFIG){var{type:g,children:A}=c={...a,...c};if(y.RIGHT_BTN_ENV[g]&&"object"==typeof A){var h,g=c["children"],C=y.generateBtnConfig(c,"");C.children=[];for(h of g){var v=h.type;y.RIGHT_BTN_ENV[v]&&(v=y.generateBtnConfig(h))&&C.children.push(v)}p.push(C)}}console.log(s),console.log(p),y.LEFT_BTN_DOM_STR=["",""];for(let e=0;e<s.length;e++)"object"==typeof s[e]&&(u=s[e],y.LEFT_BTN_DOM_STR[0]+="<dd lay-unselect>"+`<a href="${u.href}" class="${u.class}" id="operate-${u.id}" onclick="${u.onclick}"></a>`+"</dd>",y.LEFT_BTN_DOM_STR[1]+=`<button 
                                    type="button"
                                    id="li_${u.id}"
                                    class="layui-btn layui-btn-xs layui-btn-primary"
                                    title="${u.title}"
                                    onclick="${u.onclick}"
                                >
                                    <a id="${u.id}" class="${u.class}"></a>
                                </button>`);y.RIFHT_BTN_DOM_STR="";for(let t=0;t<p.length;t++){y.RIFHT_BTN_DOM_STR+=`<li class="layui-nav-item" style="float:right" lay-unselect>
                                <a href="javascript:;" id="${p[t].id}" style="white-space: nowrap;"></a>
                                <dl class="layui-nav-child">`;for(let e=0;e<p[t].children.length;e++){var{id:B,title:E,href:w,onclick:I}=p[t].children[e],M=p[t].children[e].class;y.RIFHT_BTN_DOM_STR+=`<dd lay-unselect>
                                    <a href='${w}' id='${B}' class='${M}' title='${E}' onclick='${I}'></a>
                                </dd>`}y.RIFHT_BTN_DOM_STR+="</dl></li>"}function T(e,t){var o=document.getElementById(e);o&&("A"==o.tagName&&-1!=o.parentNode.innerHTML.indexOf("<dl")?o.innerHTML=MSG[t]+'<i class="layui-icon layui-icon-down layui-nav-more"></i>':document.getElementById(e).innerHTML=MSG[t])}y.DOM_STR=`
<ul
    id="nav"
    class="layui-nav ${"light"===o.theme?"layui-bg-green":"layui-bg-cyan"}"
    lay-filter="nav-filter"
    style="width: 100vw;display: flex;flex-direction: row;justify-content: space-between;"
>
    <div
        id="nav-left-btn-list"
        style="display: flex;flex-direction: row;justify-content: flex-start;align-items: center;"
    >
        <button
            type="button"
            id="mixly-path"
            class="layui-btn layui-btn-xs layui-btn-primary"
            style="cursor:pointer;"
            onclick="Mixly.${"electron"===l?"Electron.Loader":"Interface"}.onbeforeunload()"
        >
            Mixly
        </button>
        <li class="layui-nav-item" id="li_operate" style="display:none;" lay-unselect>
            <a href="javascript:;" id="operate-btn" style="white-space: nowrap;">
                <span class="layui-nav-more"></span>
            </a>
            <dl class="layui-nav-child">
                <!-- 二级菜单 -->
                ${y.LEFT_BTN_DOM_STR[0]}
            </dl>
        </li>
        ${y.LEFT_BTN_DOM_STR[1]}
    </div>
    <div style="display: inline-flex;flex-direction: row;align-items: center;">
        <a id="copyright"></a>
    </div>
    <div
        id="nav-right-btn-list"
        style="display: inline-flex;flex-direction: row;justify-content: flex-end;align-items: center;"
    >
        <button
            title='状态栏'
            m-id="h-bar"
            class="layui-btn layui-btn-xs layui-btn-primary"
            style="padding: 0 2px;"
        >
            <a
                href="javascript:;"
                class="icon-show-bar-s"
            ></a>
        </button>
        <button
            m-id="v-bar"
            title='侧边栏'
            class="layui-btn layui-btn-xs layui-btn-primary"
            style="padding: 0 2px;"
        >
            <a
                href="javascript:;"
                class="icon-show-bar-e"
            ></a>
        </button>
        <button
            m-id="code-area"
            title='模式切换'
            class="layui-btn layui-btn-xs layui-btn-primary"
            style="padding: 0 2px;"
        >
            <a
                href="javascript:;"
                class="icon-code-1"
                style="font-size: 16px;"
            ></a>
        </button>
        ${m.TEMPLATE_STR_RENDER.BOARD_SELECTOR??""}
        ${m.TEMPLATE_STR_RENDER.PORT_SELECTOR??""}
        ${y.RIFHT_BTN_DOM_STR}
    </div>
</ul>
`,y.LEFT_BTN_LIST=s,y.RIGHT_BTN_LIST=p,Mixly.Nav.MsgById={"undo-btn":"undo","redo-btn":"redo","connect-btn":"connect","burn-btn":"burn","compile-btn":"compile","upload-btn":"upload","step-run-btn":"step_run","run-btn":"run","stop-btn":"stop","serial-btn":"catSerialPort","statusbar-btn":"statusbar","file-btn":"file","new-btn":"new","open-btn":"open","open-from-cloud-btn":"open_from_cloud","save-btn":"save","save-xml-btn":"save_blocks","save-ino-btn":"save_ino","save-img-btn":"save_img","save-py-btn":"save_py","save-hex-btn":"save_hex","save-to-cloud-btn":"save_ser","save-as-btn":"save_as","setting-btn":"setting","language-btn":"language","theme-btn":"theme","import-libraries-btn":"import_libraries","export-libraries-btn":"export_libraries","manage-libraries-btn":"manage_libraries","windows-size-btn":"windowSize","socket-connect-btn":"connect","other-burn-btn":"other_firmware","wiki-btn":"wiki","feedback-btn":"feedback"},y.init=()=>{if($("body").append(y.DOM_STR),y.navBtnConfig={leftBtn:y.LEFT_BTN_LIST,rightBtn:y.RIGHT_BTN_LIST},T("tab_blocks","tab_blocks"),T("tab_arduino","tab_arduino"),"1"===$("#changemod-btn").attr("value")?T("changemod-btn","tab_blocks"):T("changemod-btn","tab_arduino"),y.RIGHT_BTN_ENV.PYTHON_TO_BLOCKLY&&(e=$("#python-to-blockly-btn"),f?.pythonToBlockly??!1?e.html(MSG.disablePythonToBlockly).attr("class","icon-toggle-on-1"):e.html(MSG.enablePythonToBlockly).attr("class","icon-toggle-off-1")),document.getElementById("boardSelector")&&(document.getElementById("boardSelector").placeholder=MSG.fn),T("operate-btn","operate"),T("operate_save_ser_btn","save_ser"),T("change_board_btn","change_board"),T("view_btn","view_btn"),T("save_ser_btn","save_ser"),T("view_file","view_file"),"object"==typeof Mixly.Nav.navBtnConfig.leftBtn){var t=Mixly.Nav.navBtnConfig.leftBtn.length;for(let e=0;e<t;e++){var o=Mixly.Nav.navBtnConfig.leftBtn[e].id,i=Mixly.Nav.MsgById[o];i&&(T(o,i),T("operate-"+o,i))}}if("object"==typeof Mixly.Nav.navBtnConfig.rightBtn){var r=Mixly.Nav.navBtnConfig["rightBtn"],l=r.length;for(let e=0;e<l;e++){var n=r[e].id,a=Mixly.Nav.MsgById[n],s=(a&&T(n,a),Mixly.Nav.navBtnConfig.rightBtn[e])["children"];if("object"==typeof s){var d=s.length;for(let e=0;e<d;e++){var c=s[e].id,u=Mixly.Nav.MsgById[c];u&&T(c,u)}}}}if(x.init(),b.render("select","boards-type-filter"),m.TEMPLATE_ENV.PORT_SELECTOR&&b.render("select","ports-type-filter"),y.navItemId=[],"object"==typeof y.LEFT_BTN_LIST){var p=y.LEFT_BTN_LIST.length;for(let e=0;e<p;e++){var g=y.LEFT_BTN_LIST[e].id;y.navItemId.push("li_"+g)}}var e=$("#nav"),A=$("#nav-left-btn-list"),h=$("#li_operate");if(y.leftWidth=A.offset().left+A.width(),e[0].scrollWidth>e[0].offsetWidth){for(let e=0;e<y.navItemId.length;e++)$("#"+y.navItemId[e]).css("display","none");h.css("display","-webkit-box")}}})(),(()=>{goog.require("Blockly"),goog.require("Mixly.Config"),goog.require("Mixly.Nav"),goog.require("Mixly.XML"),goog.provide("Mixly.Editor");const{Config:r,XML:o,Editor:c}=Mixly,{BOARD:u,USER:l,SOFTWARE:e}=r;c.DIV_NAME={CODE:"code-editor",BLOCK:"block-editor"},c.selected="BLOCK",c.init=()=>{$("#mixly-footer-codelang").html(u.language??"未知"),c.codeEditorInit(),c.blockEditorInit();const{blockEditor:n,codeEditor:a}=c;let s;switch(u.language){case"Python":case"CircuitPython":case"MicroPython":s=Blockly.Python,a.getSession().setMode("ace/mode/python"),a.getSession().setTabSize(4),"dark"===l.theme?a.setTheme("ace/theme/dracula"):a.setTheme("ace/theme/crimson_editor"),c.py2BlockEditorInit(a);break;case"C/C++":s=Blockly.Arduino,a.getSession().setTabSize(2),a.getSession().setMode("ace/mode/c_cpp"),"dark"===l.theme?a.setTheme("ace/theme/dracula"):a.setTheme("ace/theme/xcode");break;default:s=Blockly.Python??Blockly.Arduino}function d(){let e=u.boardIndex??"";return e=e.replaceAll("\\","/"),(u.thirdPartyBoard?e.match(/(?<=boards\/extend\/)[^?\/\\、*\"><|]+/g):e.match(/(?<=boards\/default\/)[^?\/\\、*\"><|]+/g))[0]}c.codeChangeEvent=n.addChangeListener(function(e){if(e.type!==Blockly.Events.UI&&"BLOCK"===c.selected){var t=s.workspaceToCode(n)||"";if(t=t.replace(/(_E[0-9A-F]{1}_[0-9A-F]{2}_[0-9A-F]{2})+/g,function(t){try{return decodeURIComponent(t.replace(/_/g,"%"))}catch(e){return t}}),-1!==u.boardIndex.indexOf("/python_mixpy/"))try{t.match(/(?<![\w+])input\(/g)&&(t="\n"+t)}catch(e){console.log(e)}else if(!("python_skulpt_mixtoy"!==d()&&"python_skulpt_car"!==d()||-1==t.indexOf("import blocktool")&&-1==t.indexOf("import blocklygame")&&-1==t.indexOf("from blocklygame import"))){var o=[];o=t.split("\n");for(var i,r,l=0;l<o.length;l++)0<=o[l].indexOf("block_id")&&(i="",null!=(r=/,?'block_id=[\s\S]*'/.exec(o[l])))&&(i=r[0],o[l]=o[l].replace(i,"")),(0<=o[l].indexOf("import blocktool")||0<=o[l].indexOf("blocktool.highlight"))&&(o[l]="delete");t="";for(l=0;l<o.length;l++)"delete"!=o[l]&&(t+=o[l]+"\n")}a.setValue(t,-1)}}),"true"===e?.socketServer?.enabled&&Mixly.WebSocket.Socket.init()},c.blockEditorInit=()=>{var e=r.pathPrefix+"common/media/",t=$("#toolbox")[0],o=["geras","zelos"].includes(l.blockRenderer)?l.blockRenderer:"geras",i="yes"===l.blocklyShowGrid?{spacing:20,length:3,colour:"#ccc",snap:!0}:{};c.blockEditor=Blockly.inject($("#"+c.DIV_NAME.BLOCK)[0],{media:e,toolbox:t,renderer:o,zoom:{controls:!0,wheel:!0,scaleSpeed:1.03},grid:i}),"dark"===l.theme?c.blockEditor.setTheme(Blockly.Themes.Dark):c.blockEditor.setTheme(Blockly.Themes.Classic)},c.codeEditorInit=()=>{c.codeEditor=ace.edit(c.DIV_NAME.CODE);var e=c["codeEditor"];e.setFontSize(Math.max($("body").width()/85,$("body").height()/85,12)),e.setShowPrintMargin(!1),e.setReadOnly(!0),e.setScrollSpeed(.8),e.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),c.codeEditorAddCommands(),c.codeEditorAddBtn(),c.codeEditorMenuRender(),c.codeEditorAddEvent()},c.py2BlockEditorInit=e=>{var t;"object"==typeof Sk&&"function"==typeof PythonToBlocks&&"function"==typeof Py2blockEditor&&(t=new PythonToBlocks,c.py2BlockEditor=new Py2blockEditor(t,e),Sk.python3=!0)},c.redo=()=>{var{blockEditor:e,codeEditor:t}=c;"BLOCK"===c.selected?e.undo(1):t.redo()},c.undo=()=>{var{blockEditor:e,codeEditor:t}=c;"BLOCK"===c.selected?e.undo(0):t.undo()},c.codeEditorAddCommands=()=>{var e=c["codeEditor"];e.commands.addCommands([{name:"increaseFontSize",bindKey:"Ctrl-=|Ctrl-+",exec:function(e){var t=parseInt(e.getFontSize(),10)||12;e.setFontSize(t+1)}},{name:"decreaseFontSize",bindKey:"Ctrl+-|Ctrl-_",exec:function(e){var t=parseInt(e.getFontSize(),10)||12;e.setFontSize(Math.max(t-1||1))}},{name:"resetFontSize",bindKey:"Ctrl+0|Ctrl-Numpad0",exec:function(e){e.setFontSize(Math.max($("body").width()/85,$("body").height()/85,12))}},{name:"exitCodeEditor",bindKey:"Ctrl+E",exec:function(e){"BLOCK"!==c.selected&&c.items.vDrag.full("POSITIVE")}}])},c.codeEditorAddBtn=()=>{var e=$("#"+c.DIV_NAME.CODE);e.append('<div id="resetFontSize" m-id="resetFontSize" class="code-editor-btn setFontSize" width="32" height="32" style="cursor:hand;display:none;"></div>'),e.append('<div id="increaseFontSize" m-id="increaseFontSize" class="code-editor-btn setFontSize" width="32" height="32" style="cursor:hand;display:none;"></div>'),e.append('<div id="decreaseFontSize" m-id="decreaseFontSize" class="code-editor-btn setFontSize" width="32" height="32" style="cursor:hand;display:none;"></div>'),e.children(".code-editor-btn").click(function(){switch($(this).attr("m-id")){case"resetFontSize":c.codeEditorRstFontSize();break;case"increaseFontSize":c.codeEditorIncFontSize();break;case"decreaseFontSize":c.codeEditorDecFontSize()}})},c.codeEditorShowBtn=()=>{$("#"+c.DIV_NAME.CODE).children(".code-editor-btn").css("display","block")},c.codeEditorHideBtn=()=>{$("#"+c.DIV_NAME.CODE).children(".code-editor-btn").css("display","none")},c.codeEditorMenuRender=()=>{const r=c["codeEditor"];var e='<div style="float:left;">{{d.name}}&nbsp</div><div style="float:right;">&nbsp{{d.hotKey}}</div>';let t=[];if("CODE"===c.selected)switch(t=[{title:o.render(e,{name:indexText["剪切"],hotKey:"Ctrl+X"}),id:"cut"},{title:o.render(e,{name:indexText["复制"],hotKey:"Ctrl+C"}),id:"copy"},{title:o.render(e,{name:indexText["粘贴"],hotKey:"Ctrl+V"}),id:"paste"},{type:"-"},{title:o.render(e,{name:indexText["全选"],hotKey:"Ctrl+A"}),id:"selectall"},{title:o.render(e,{name:indexText["查找"],hotKey:"Ctrl+F"}),id:"find"},{type:"-"},{title:o.render(e,{name:indexText["切换行注释"],hotKey:"Ctrl+/"}),id:"togglecomment"},{title:o.render(e,{name:indexText["切换块注释"],hotKey:"Ctrl+Shift+/"}),id:"toggleBlockComment"},{type:"-"},{title:o.render(e,{name:indexText["退出代码编辑器"],hotKey:"Ctrl+E"}),id:"exitCodeEditor"}],u.language){case"Python":case"CircuitPython":case"MicroPython":t.splice(8,1)}else t=[{title:o.render(e,{name:indexText["打开代码编辑器"],hotKey:""}),id:"openCodeEditor"}];layui.dropdown.render({elem:"#code-editor",trigger:"contextmenu",data:t,className:"editor-dropdown-menu",click:(t,e)=>{switch(t.id){case"selectall":case"find":case"togglecomment":case"toggleBlockComment":case"openCommandPallete":r.execCommand(t.id);break;case"cut":var o=r.selection.isEmpty()?r.selection.getLineRange():r.selection.getRange();r._emit("cut",o),o.isEmpty()||(i=r.session.getTextRange(o),navigator.clipboard.writeText(i).then(e=>{}).catch(e=>{}),r.session.remove(o)),r.clearSelection();break;case"copy":var i=r.getSelectedText();r.clearSelection(),i&&navigator.clipboard.writeText(i).then(e=>{}).catch(e=>{});break;case"paste":navigator.clipboard.readText().then(e=>{r.execCommand(t.id,e)}).catch(e=>{});break;case"openCodeEditor":"CODE"!==c.selected&&c.items.vDrag.full("NEGATIVE");break;case"exitCodeEditor":"BLOCK"!==c.selected&&c.items.vDrag.full("POSITIVE")}}})},c.codeEditorIncFontSize=()=>{var e=c["codeEditor"],t=parseInt(e.getFontSize(),10)||12;e.setFontSize(t+1)},c.codeEditorDecFontSize=()=>{var e=c["codeEditor"],t=parseInt(e.getFontSize(),10)||12;e.setFontSize(Math.max(t-1||1))},c.codeEditorRstFontSize=()=>{var e=c["codeEditor"];e.setFontSize(Math.max($("body").width()/85,$("body").height()/85,12))},c.codeEditorAddEvent=()=>{const t=c["codeEditor"],o=($("#mixly-footer-cursor").hide(),t.on("focus",function(){$("#mixly-footer-cursor").show()}),t.on("blur",function(){$("#mixly-footer-cursor").hide()}),t.getSession())["selection"];o.on("changeCursor",function(){var e=o.getCursor();$("#mixly-footer-row").html(e.row+1),$("#mixly-footer-column").html(e.column+1)}),o.on("changeSelection",function(){var e;o.isEmpty()?$("#mixly-footer-selected").parent().hide():(e=o.getRange(),e=t.session.getTextRange(e),$("#mixly-footer-selected").parent().css("display","inline-flex"),$("#mixly-footer-selected").html(e.length))})},c.blockEditorUpdateCode=()=>{var e=c["blockEditor"];e.fireChangeListener(c.codeChangeEvent)},c.py2BlockEditorChangeStatus=()=>{var e=$("#python-to-blockly-btn");u.pythonToBlockly??!1?(e.html(MSG.enablePythonToBlockly).attr("class","icon-toggle-off-1"),u.pythonToBlockly=!1):(e.html(MSG.disablePythonToBlockly).attr("class","icon-toggle-on-1"),u.pythonToBlockly=!0)}})(),(()=>{goog.require("layui"),goog.require("Mixly.Editor"),goog.provide("Mixly.LevelSelector");const{Editor:o,LevelSelector:i}=Mixly,e=layui["form"];i.nowLevel=-1,i.XML_STR=[`<xml xmlns="https://developers.google.com/blockly/xml">
        <block type="initSettedMap_1">
        </block>
    </xml>`,`<xml xmlns="https://developers.google.com/blockly/xml">
        <block type="initSettedMap_2">
        </block>
    </xml>`,`<xml xmlns="https://developers.google.com/blockly/xml">
        <block type="initSettedMap_3">
        </block>
    </xml>`,`<xml xmlns="https://developers.google.com/blockly/xml">
        <block type="initSettedMap_4">
        </block>
    </xml>`,`<xml xmlns="https://developers.google.com/blockly/xml">
        <block type="initSettedMap_5">
        </block>
    </xml>`,`<xml xmlns="https://developers.google.com/blockly/xml">
        <block type="initSettedMap_6">
        </block>
    </xml>`],i.init=()=>{$("#nav-right-btn-list").prepend(`
        <div
            id="level-selector"
            class="layui-form scrollbar1"
            lay-filter="level-selector-filter"
            style="
                width: 90px;
                height: 28px;
                margin-right: 10px;
            "
        >
            <select id="level-type" spellcheck="false" lay-filter="level-type-filter"></select>
        </div>
    `);var t=$("#level-type");t.empty();for(let e=1;e<7;e++)t.append(`<option value="${e}">${indexText["关卡"]} ${e}</option>`);e.render("select","level-selector-filter"),e.on("select(level-type-filter)",function(e){i.nowLevel!==e.value&&(i.nowLevel=e.value,i.xmlToWorkspace(e.value))})},i.xmlToWorkspace=e=>{if(!(e<1||6<e)){e=i.XML_STR[--e];try{o.blockEditor.clear();var t=Blockly.Xml.textToDom(e);Blockly.Xml.domToWorkspace(t,o.blockEditor),o.blockEditor.scrollCenter()}catch(e){o.blockEditor.clear(),console.log(e)}}}})(),(()=>{goog.require("Blockly"),goog.require("Mixly.XML"),goog.require("Mixly.Editor"),goog.provide("Mixly.ToolboxSearcher");const{XML:t,Editor:b,ToolboxSearcher:e}=Mixly;e.init=function(){this.workspace=new Blockly.Workspace(new Blockly.Options({toolbox:""}));var e=t.TEMPLATE_DOM.SEARCH_DIV;$(".blocklyToolboxDiv").append(e),this.btnDom=e.find("button"),this.inputDom=e.find("input"),this.preKeyText="",this.btnDom.click(()=>{this.startSearch()}),this.inputDom.change(e=>{this.startSearch()}),this.inputDom.bind("input propertychange",e=>{var t=b.blockEditor.getToolbox(),o=t.getToolboxItemById("catSearch"),e=e.target.value;try{if(!e.replaceAll(" ",""))return o.hide(),void this.btnDom.addClass("layui-btn-disabled");o.show(),$(t.HtmlDiv).scrollTop(t.HtmlDiv.scrollHeight)}catch(e){console.log(e)}e===this.preKeyText?this.btnDom.addClass("layui-btn-disabled"):this.btnDom.removeClass("layui-btn-disabled")})},e.getCategoryPath=e=>{let t="";for(;e;e=e.getParent())t=e.toolboxItemDef_.name+(t&&" > "+t);return t},e.searchBlocks=function(x){return new Promise((e,t)=>{var o=b.blockEditor.getToolbox(),i=o.getToolboxItemById("catSearch"),r=[],l=o.getToolboxItems();for(let e=0;l[e];e++){var n,a=l[e];if("catSearch"!==a.id_&&"function"==typeof a.getContents){let o=!0;for(n of a.getContents()){var s,{kind:d,blockxml:c}=n;if("BLOCK"===d){this.workspace.clear();try{Blockly.Xml.domToBlock(c,this.workspace)}catch(e){console.log(e);continue}let t=!1;for(s of this.workspace.getAllBlocks(!0)){var u,p=[...x],g=s["inputList"];for(u of g){var A,h=u["fieldRow"];for(A of h){var y,m=A.getText().toLowerCase();for(let e=0;e<p.length;e++)if(-1!==m.indexOf(p[e])&&(p.splice(e,1),e--,!p.length)){o&&(y=this.getCategoryPath(a),r.push({kind:"LABEL",text:y}),o=!1),r.push(n),t=!0;break}if(t)break}if(t)break}if(t)break}}}}}if(this.workspace.clear(),30<r.length){let e=0;for(;!(r.length<=30&&"LABEL"===r[r.length-1].kind);)"BLOCK"===r[r.length-1].kind&&e++,r.pop();r.pop();let t=0;for(var f of r)"BLOCK"===f.kind&&t++;r.unshift({kind:"LABEL",text:indexText["共搜索到图形块"]+": "+(e+t)+"，"+indexText["显示"]+": "+t+"，"+indexText["请添加关键词以显示全部。例如：管脚 数字"]})}i.updateFlyoutContents(r.length?r:[{kind:"LABEL",text:indexText["无数据"]}]),o.refreshSelection(),$(i.getDiv()).children().first().hasClass("blocklyTreeSelected")||i.getClickTarget().click(),$(o.HtmlDiv).scrollTop(o.HtmlDiv.scrollHeight),e()})},e.startSearch=function(){if(!this.btnDom.hasClass("layui-btn-disabled")){let i=this.inputDom.val();this.preKeyText=i,this.btnDom.addClass("layui-btn-disabled");try{if(!i.replaceAll(" ",""))return}catch(e){console.log(e)}this.inputDom.attr("disabled",!0);const r=this.btnDom.children("i");r.removeClass("layui-icon-search"),r.addClass("layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop"),window.setTimeout(()=>{var e,t=i.split(" "),o=[];for(e in t)t[e]&&o.push(t[e].toLowerCase());this.searchBlocks(o).then(()=>{}).catch(e=>{console.log(e)}).finally(()=>{r.removeClass("layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop"),r.addClass("layui-icon-search"),this.inputDom.removeAttr("disabled")})},100)}},e.restart=function(){this.preKeyText="";var e=b.blockEditor.getToolbox().getToolboxItemById("catSearch");this.inputDom.val(""),e.hide()}})(),(()=>{goog.require("tippy"),goog.require("layui"),goog.require("Mixly.LayerExt"),goog.require("Mixly.Config"),goog.require("Mixly.XML"),goog.require("Mixly.Env"),goog.require("Mixly.ToolboxSearcher"),goog.require("Mixly.Modules"),goog.require("Mixly.MString"),goog.require("Mixly.Editor"),goog.require("Mixly.FooterLayer"),goog.provide("Mixly.Boards");const{Config:e,XML:u,Env:m,ToolboxSearcher:l,Modules:f,MString:x,Editor:n,FooterLayer:p,Boards:b}=Mixly,{form:g,dropdown:t}=layui,{BOARD:C,USER:A,SELECTED_BOARD:v}=e;b.INFO={},b.NAME=[],b.HAS_CONFIG_SETTING=!1,b.init=()=>{if(C.board){let t=0,o={};var i,{board:e={}}=A;for(i in e&&e[C.boardName]&&"object"==typeof e[C.boardName]&&(o=e[C.boardName]),C.board){b.NAME.push(i);var r=C.board[i];if("string"==typeof r)b.INFO[i]={key:r,config:null,default:null,ignore:[]},t++;else if("object"==typeof r){const{key:d=null,config=null,ignore:c=[]}=r;let e=null;if("object"==typeof config){e={};var l=o.default,r=o.key;if("object"==typeof l&&r===d){for(var n in l)if(config[n]&&"object"==typeof config[n]){let e=!0;for(var a of config[n])if(a.key===l[n]){e=!1;break}e&&delete l[n]}else delete l[n];e={...l}}else for(var s in config)"object"==typeof config[s]&&"object"==typeof config[s][0]&&(e[s]=config[s][0].key)}else t++;b.INFO[i]={key:d,config:config,ignore:c,default:e}}}t===b.NAME.length?b.HAS_CONFIG_SETTING=!1:b.HAS_CONFIG_SETTING=!0}else b.NAME.push(C.boardType),b.INFO[C.boardType]={key:null,config:null,default:null,ignore:[]},b.HAS_CONFIG_SETTING=!1;var t=$("#boards-type");if(t.length){t.empty();for(var o of b.NAME)t.append(`<option value="${b.INFO[o]?.key}">${o}</option>`);g.render("select","boards-type-filter")}b.configMenu=new p("mixly-board-config",{tippy:{onMount(e){var t=b.configMenu["list"];const o=b["INFO"];$("#board-config-menu-reset").off().click(function(){for(var e in o[selectedBoardName].default=o[selectedBoardName].default??{},config)defaultConfig[e]=config[e][0].key,$("#board-config-"+e).find("p").text(config[e][0].label);linstance.setProps({})}),b.renderConfigMenu(t)},onHidden(e){b.writeSelectedBoardConfig()}},onShow(){var t,e=b.getSelectedBoardName(),o=b["INFO"],i=o[e]["config"],r=(o[e].default=o[e].default??{},o[e].default),l=[];for(t in i){let e=r[t]??i[t][0].label;var n,a=[];for(n of i[t])r[t]&&n.key===r[t]&&(e=n.label),a.push({title:n.label,id:n.key});r||(e=i[t][0].label),l.push({name:t,label:e,options:a})}o=u.render(u.TEMPLATE_STR.BOARD_CONFIG_MENU_DIV,{list:l,reset:indexText["使用默认配置"],close:indexText["关闭窗口"]});b.configMenu.list=l,b.configMenu.updateContent(o)}})},b.getConfigInfo=e=>{if(!b.INFO[e])return"";var t,o=b.INFO[e]["config"],i=b.INFO[e].default;let r="";for(t in i)if("object"==typeof o[t])for(var l of o[t])if(l.key===i[t]){r+=t+": "+l.label+"<br/>";break}return r},b.updateBoardDefaultConfig=e=>{var{config:t=null}=b.INFO[e];let o=null;if("object"==typeof t)for(var i in o={},t)"object"==typeof t[i]&&"object"==typeof t[i][0]&&(o[i]=t[i][0].key);b.INFO[e].default=o},b.getType=()=>{let e=C.boardIndex??"";return e=e.replaceAll("\\","/"),(C.thirdPartyBoard?e.match(/(?<=boards\/extend\/)[^?\/\\、*\"><|]+/g):e.match(/(?<=boards\/default\/)[^?\/\\、*\"><|]+/g))[0]},b.getSelectedBoardName=()=>$("#boards-type option:selected").text(),b.getSelectedBoardKey=()=>$("#boards-type option:selected").val(),b.setSelectedBoard=(e,t)=>{var o=e.indexOf("@");if(-1!==o&&(e=e.substring(o+1,e.length)),b.NAME.includes(e)){o=b.INFO[e];if(o&&o.key){if($("#boards-type").val(o.key),"object"==typeof t){var i,r=o["config"];for(i in t)if(r[i]&&"object"==typeof r[i]){let e=!0;for(var l of r[i])if(l.key===t[i]){e=!1;break}e&&delete t[i]}else delete t[i];o.default={...t}}g.render("select","boards-type-filter")}b.changeTo(e),b.updateCategories(e),"object"==typeof profile&&profile[e]&&(profile.default=profile[e])}},b.getSelectedBoardConfig=(e=!0)=>{var t=b.getSelectedBoardName();return e?b.INFO[t]?.default??null:b.INFO[t]?.config??null},b.getBoardCommandParam=e=>{if(!b.INFO[e])return null;e=b.INFO[e];let{key:t,ignore:o=[]}=e;var i=e.default;if(!t)return null;e=t.indexOf("@");let r=t=-1!==e?t.substring(0,e):t;if("object"==typeof i){for(var l in r+=":",i)o.includes(l)||(r+=l+"="+i[l]+",");r=r.substring(0,r.length-1)}return r},b.getSelectedBoardCommandParam=()=>{var e=b.getSelectedBoardName();return b.getBoardCommandParam(e)},b.getSelectedBoardConfigParam=e=>{var t=b.getSelectedBoardConfig();return t&&"object"==typeof t?t[e]??"":""},b.changeTo=e=>{(profile="object"==typeof profile?profile:{})[e]?profile.default=profile[e]:profile.default=profile.default??{};var t,o,i,r=b.INFO[e].key;for(t in v)delete v[t];for(o in C)C[o]instanceof Object?v[o]={...C[o]}:v[o]=C[o];if(C.web instanceof Object)for(var l of[{type:"burn",obj:C.web.burn},{type:"upload",obj:C.web.upload}])if(l.obj instanceof Object){let e;for(var n in e=l.obj[r]?{...l.obj,...l.obj[r]}:{...l.obj},b.INFO){n=b.INFO[n].key;e[n]&&delete e[n]}v.web[l.type]=e}for(i of[{type:"burn",obj:C.burn},{type:"upload",obj:C.upload}])if(i.obj instanceof Object){let t;for(var a in t=i.obj[r]?{...i.obj,...i.obj[r]}:{...i.obj},b.INFO){a=b.INFO[a].key;t[a]&&delete t[a]}var s={path:m.clientPath,indexPath:m.indexDirPath,srcPath:m.srcPath};switch(t.type){case"volume":if("win32"==m.currentPlatform)if("string"==typeof t.volumeName)t.volume="VolumeName='"+t.volumeName+"'";else if("object"==typeof t.volumeName){t.volume="VolumeName='"+t.volumeName[0]+"'";for(let e=1;e<t.volumeName.length;e++)t.volume+=" or VolumeName='"+t.volumeName[e]+"'"}else t.volume="VolumeName='CIRCUITPY'";else if("string"==typeof t.volumeName)t.volume=t.volumeName;else if("object"==typeof t.volumeName){t.volume=t.volumeName[0];for(var d=1;d<t.volumeName.length;d++)t.volume+="/"+t.volumeName[d]}else t.volume="CIRCUITPY";break;case"command":var c,u={},p={esptool:"esptool.py",kflash:"kflash.py",stm32loader:"stm32loader.py",stm32bl:"stm32bl.py",ampy:"ampy/cli.py"};for(c in p)u[c]=m.python3Path+'" "{srcPath}/pyTools/'+p[c];if(t.reset){let e="{}";try{e=(e=JSON.stringify(t.reset)).replaceAll('"','\\"'),u.reset=e}catch(e){console.log(e)}}if(t.command=x.tpl(t.command,u),t.command=x.tpl(t.command,s),t.special&&t.special instanceof Array)for(var g in t.special)t.special[g]?.name&&t.special[g]?.command&&(t.special[g].command=x.tpl(t.special[g].command,u),t.special[g].command=x.tpl(t.special[g].command,s))}if("upload"===i.type&&(m.isElectron||m.hasSocketServer)&&t.copyLib){var A=f["path"];if(t.libPath){var h,y=[];for(h of t.libPath)y.push(x.tpl(h,s));t.libPath=y}else m.isElectron?t.libPath=[A.resolve(m.indexDirPath,"build/lib/")]:t.libPath=goog.normalizePath_(m.indexDirPath+"/build/lib/")}(m.isElectron||m.hasSocketServer)&&(A=f["path"],t.filePath?t.filePath=x.tpl(t.filePath,s):m.isElectron?t.filePath=A.resolve(m.indexDirPath,"build/main.py"):t.filePath=goog.normalizePath_(m.indexDirPath+"/build/main.py")),v[i.type]=t}},b.updateCategories=(t,o=!1)=>{if(b.selected!==t||o){b.selected=t,$("#mixly-footer-boardname").html(t),b.INFO[t]&&b.INFO[t].config?$("#mixly-board-config").css("display","inline-flex"):$("#mixly-board-config").css("display","none"),b.configMenu?.length&&!b.configMenu[0].state.isDestroyed&&b.configMenu[0].destroy();let e="";m.isElectron&&(e=m.thirdPartyXML.join(""));var o='<category id="catSearch" hidden="true" colour="#ff6666"><label text="'+indexText["无数据"]+'"></label></category>',i=(e=b.selectCategories(t,e),$("#toolbox")),r=(i.html(b.selectCategories(t,u.CATEGORIES_STR[t]??m.defaultXML)),i.append(e),i.append(o),i.find("category"));for(let e=0;r[e];e++)r[e].hasAttribute("toolboxitemid")||r[e].setAttribute("toolboxitemid",r[e].id);Code.initLanguage(!1),n.blockEditor&&(n.blockEditor.updateToolbox(i[0]),l.restart(),n.blockEditor.scrollCenter(),Blockly.hideChaff())}},b.selectCategories=(e,t)=>{var o=(b.INFO[e].key??"").split(":");if(!o.length)return t;var e=$("<xml></xml>"),i=(e.html(t),e.find("category"));for(let e=0;i[e];e++)if(!b.removeBlocks($(i[e]),o)){var r=$(i[e]).children("block");for(let e=0;r[e];e++)b.removeBlocks($(r[e]),o)}return e.html()},b.removeBlocks=(t,o)=>{var i,r=t.attr("m-show"),l=t.attr("m-hide");if(r||l){let e=!!r;for(i of(r||l).split(" ")){var n=i.split(":"),a=n.length;if([1,2,3].includes(a)){if([2,3].includes(a)){a=3===a?String(n[2]).split(","):[];if(n[0]===o[0]&&n[1]===o[1]){if(!a.length){e=!r;break}for(var s of a)if(s===o[2]){e=!r;break}}}else if(n[0]===o[2]){e=!r;break}if(!e&&r||e&&!r)break}}if(e)return t.remove(),!0}return!1},b.showConfigMenu=()=>{if(!b.configMenu){const l=b.getSelectedBoardName(),n=b["INFO"],a=n[l]["config"],s=(n[l].default=n[l].default??{},n[l].default);let t=[];for(var o in a){let e=s[o]??a[o][0].label;var i,r=[];for(i of a[o])s[o]&&i.key===s[o]&&(e=i.label),r.push({title:i.label,id:i.key});s||(e=a[o][0].label),t.push({name:o,label:e,options:r})}var e=u.render(u.TEMPLATE_STR.BOARD_CONFIG_MENU_DIV,{list:t,reset:indexText["使用默认配置"],close:indexText["关闭窗口"]});b.configMenu=tippy("#mixly-board-config",{allowHTML:!0,content:e,trigger:"manual",interactive:!0,hideOnClick:!1,maxWidth:"none",offset:[0,6],onMount(e){$("#board-config-menu-reset").off().click(function(){for(var e in n[l].default=n[l].default??{},a)s[e]=a[e][0].key,$("#board-config-"+e).find("p").text(a[e][0].label);b.configMenu[0].setProps({})}),$("#board-config-menu-colse").off().click(function(){b.configMenu[0].destroy(),b.configMenu=null}),b.renderConfigMenu(t)},onHidden(e){b.configMenu=null,b.writeSelectedBoardConfig()}})}},b.renderConfigMenu=e=>{const i=b.getSelectedBoardName();for(let o of e)t.render({elem:"#board-config-"+o.name,align:"right",data:o.options,anywhereClose:!0,className:"scrollbar1 editor-dropdown-menu board-config-menu",style:"display:inline-block;box-shadow:1px 1px 30px rgb(0 0 0 / 12%);",ready:function(e,t){var e=$(e),t=$(t),o=(e.css({left:"auto",right:"calc(100vw - "+(t.offset().left+t.outerWidth())+"px)","min-width":t.outerWidth()+"px"}),t.find("p")),i=e.find("li");for(let e=0;i[e];e++){var r=$(i[e]).children("div");r.text()===o.text()&&($(i[e]).css("background-color","#5FB878"),r.css("color","#fff"))}},click:function(e,t){$(this.elem).children("p").text(e.title),b.INFO[i].default[o.name]=e.id,b.configMenu.layer[0].setProps({})}})},b.writeSelectedBoardConfig=()=>{if(m.isElectron){A.board=A.board??{};var e=A["board"],t=(e[C.boardName]=e[C.boardName]??{},e[C.boardName].key=b.getSelectedBoardKey(),b.getSelectedBoardName());if(b.INFO[t]){var t=b.INFO[t].default,{fs_extra:e,path:t}=(e[C.boardName].default={...t},f);try{e.outputJsonSync(t.resolve(m.clientPath,"setting/config.json"),A,{spaces:"    "})}catch(e){console.log(e)}}}}})(),(()=>{goog.require("Mixly.Editor"),goog.require("Mixly.Config"),goog.provide("Mixly.Drag");const{Editor:l,Config:e,Drag:n}=Mixly,a=e["BOARD"];class t{constructor(e,t){this.config={type:"h",elem:null,min:null,full:[!0,!0],ondragStart:null,ondragEnd:null,onfull:null,exitfull:null,sizeChanged:null,...t},this.$container=$("#"+e),this.config.elem||(this.config.elem=[],t=this.$container.children(),this.config.elem.push([$(t.get(0))],[$(t.get(1))]));let o=$("<div></div>"),i=$("<div></div>");e="h"===this.config.type?"s":"w";this.$container.addClass("drag-"+e+"-container"),i.addClass("drag-"+e+"-elem-container"),"h"===this.config.type?(i.css({height:100*this.config.elem[0][0].height()/this.$container.height()+"%"}),o.addClass("drag-s-elem horizontal-line")):(i.css({width:100*this.config.elem[0][0].width()/this.$container.width()+"%"}),(o=$("<div></div>")).addClass("drag-w-elem vertical-line")),i.append(o),this.$container.prepend(i),this.$dragElemContainer=i,this.$dragElem=o,this.size=["100%","0%"],this.onfullMark="POSITIVE",this.prevSize=this.size,this.addEventListener()}addEventListener(){const n=this.$dragElem[0],a=this,s=this.$container[0],{type:d,min:c,elem:e,ondragStart:u,ondragEnd:p,full:g,onfull:A,exitfull:h}=this.config;e[0],e[1];n.onmousedown=function(e){let l;if("h"===d?(l=e.clientY,n.top=n.offsetTop,$("body").addClass("drag-s-resize")):(l=e.clientX,n.left=n.offsetLeft,$("body").addClass("drag-w-resize")),document.onmousemove=function(e){"function"==typeof u&&u();let t,o,i=parseInt(c),r;if(r="h"===d?(t=n.top+(e.clientY-l),o=s.clientHeight-i,e.movementY):(t=n.left+(e.clientX-l),o=s.clientWidth-i,e.movementX),t+=4,g[0]&&r<0&&t<i-.6*i)a.changeSize("0%"),"function"==typeof A&&A("NEGATIVE"),a.onfullMark="NEGATIVE";else if(g[1]&&0<r&&t>o+.8*i)a.changeSize("100%"),"function"==typeof A&&A("POSITIVE"),a.onfullMark="POSITIVE";else if(t<o&&t>i){switch(a.onfullMark){case"NEGATIVE":if("function"!=typeof h||h("POSITIVE"))break;return;case"POSITIVE":if("function"!=typeof h||h("NEGATIVE"))break;return}a.onfullMark=null,a.changeSize(t)}return"function"==typeof p&&p(),!1},document.onmouseup=function(){"h"===d?$("body").removeClass("drag-s-resize"):$("body").removeClass("drag-w-resize"),document.onmousemove=null,document.onmouseup=null},a.end)return!1}}changeSize(t){var e,o,{type:i,elem:r,sizeChanged:l}=this.config,n="h"===i?"height":"width";let a,s,[d,c]=r;if("string"==typeof t&&-1!==t.indexOf("%"))a=t,s=100-parseFloat(a)+"%";else{let e;e="h"===i?this.$container.height():this.$container.width(),a=100*parseFloat(t)/e+"%",s=100*(1-parseFloat(t)/e)+"%"}this.prevSize=this.size,this.size=[a,s],parseFloat(a)?d=[this.$dragElemContainer,...d]:"h"===i?this.$dragElemContainer.css("height","4px"):this.$dragElemContainer.css("width","4px");for(e of d)e.css(n,a);for(o of c)o.css(n,s);"function"==typeof l&&l()}full(e){var{exitfull:t,onfull:o}=this.config;if("function"==typeof t)switch(this.onfullMark){case"NEGATIVE":t("POSITIVE");break;case"POSITIVE":t("NEGATIVE")}"NEGATIVE"===e?(this.onfullMark="NEGATIVE",this.changeSize("0%")):(this.onfullMark="POSITIVE",this.changeSize("100%")),o(e)}exitfull(){if(this.onfullMark){var e=this.config["exitfull"];if("function"==typeof e)switch(this.onfullMark){case"NEGATIVE":e("POSITIVE");break;case"POSITIVE":e("NEGATIVE")}this.onfullMark=null,this.changeSize(this.prevSize[0])}}show(){var e=this.config["exitfull"];if("function"==typeof e)switch(this.onfullMark){case"NEGATIVE":e("POSITIVE");break;case"POSITIVE":e("NEGATIVE")}this.onfullMark=null,this.prevSize&&parseInt(this.prevSize[0])<100&&0<parseInt(this.prevSize[0])?this.changeSize(this.prevSize[0]):this.changeSize("70%")}}n.elems={};n.HorizontalDrag=class extends t{constructor(e,t){super(e,{...t,type:"h"})}},n.VerticalDrag=class extends t{constructor(e,t){super(e,{...t,type:"v"})}},n.init=()=>{n.items={vDrag:n.EditorBarInit(),hDrag:n.statusBarInit()},l.items={...n.items},n.addBtnClickEvent()},n.EditorBarInit=()=>{const{blockEditor:e,codeEditor:o}=l,i=$("#nav").find('button[m-id="v-bar"]').children("a"),r=$("#nav").find('button[m-id="code-area"]').children("a");return new n.VerticalDrag("v-container",{min:"200px",full:[!0,!0],sizeChanged:function(){$(e.getParentSvg()).attr({width:$("#"+l.DIV_NAME.BLOCK).width(),height:$("#"+l.DIV_NAME.BLOCK).height()}),o.resize(),Blockly.fireUiEvent(window,"resize")},onfull:function(e){switch(e){case"POSITIVE":i.removeClass("icon-hide-bar-e").addClass("icon-show-bar-e"),o.setReadOnly(!0),l.codeEditorHideBtn(),l.selected="BLOCK";break;case"NEGATIVE":r.removeClass("icon-code-1").addClass("icon-block"),r.parent().attr("m-id","block-area"),o.setReadOnly(!1),l.codeEditorShowBtn(),l.selected="CODE";var t=l["py2BlockEditor"];t&&a.pythonToBlockly&&(t.fromCode=!0)}l.codeEditorMenuRender()},exitfull:function(e){switch(o.setReadOnly(!0),l.selected="BLOCK",l.codeEditorMenuRender(),l.codeEditorHideBtn(),e){case"POSITIVE":r.removeClass("icon-block").addClass("icon-code-1"),r.parent().attr("m-id","code-area");var t=l["py2BlockEditor"];t&&a.pythonToBlockly&&"function"==typeof t.updateBlock&&t.updateBlock(),l.blockEditorUpdateCode();break;case"NEGATIVE":i.removeClass("icon-show-bar-e").addClass("icon-hide-bar-e")}return!0}})},n.statusBarInit=()=>{const{blockEditor:e,codeEditor:t}=l,o=$("#nav").find('button[m-id="h-bar"]').children("a");return new n.HorizontalDrag("h-container",{min:"50px",sizeChanged:function(){$(e.getParentSvg()).attr({width:$("#"+l.DIV_NAME.BLOCK).width(),height:$("#"+l.DIV_NAME.BLOCK).height()}),t.resize(),Blockly.fireUiEvent(window,"resize")},onfull:function(e){"POSITIVE"===e&&o.removeClass("icon-hide-bar-s").addClass("icon-show-bar-s")},exitfull:function(e){switch(e){case"POSITIVE":break;case"NEGATIVE":o.removeClass("icon-show-bar-s").addClass("icon-hide-bar-s")}return!0}})},n.addBtnClickEvent=()=>{const{vDrag:t,hDrag:o}=n.items,i=$("#nav").find('button[m-id="v-bar"]').children("a");var r=$("#nav").find("button");for(let e=0;r[e];e++){const l=$(r[e]);l.click(function(){var e=l.children("a");l.attr("m-id");switch(l.attr("m-id")){case"h-bar":e.hasClass("icon-hide-bar-s")?(e.removeClass("icon-hide-bar-s"),e.addClass("icon-show-bar-s"),o.full("POSITIVE")):(e.removeClass("icon-show-bar-s"),e.addClass("icon-hide-bar-s"),o.show());break;case"v-bar":e.hasClass("icon-hide-bar-e")?(e.removeClass("icon-hide-bar-e"),e.addClass("icon-show-bar-e"),t.full("POSITIVE")):(e.removeClass("icon-show-bar-e"),e.addClass("icon-hide-bar-e"),t.show());break;case"code-area":l.attr("m-id","block-area"),e.removeClass("icon-code-1").addClass("icon-block"),i.removeClass("icon-show-bar-e").addClass("icon-hide-bar-e"),t.full("NEGATIVE");break;case"block-area":l.attr("m-id","code-area"),e.removeClass("icon-block").addClass("icon-code-1"),i.removeClass("icon-hide-bar-e").addClass("icon-show-bar-e"),t.full("POSITIVE")}})}}})(),(()=>{goog.require("fsWrapper"),goog.require("Mixly.Config"),goog.require("Mixly.Editor"),goog.require("Mixly.Drag"),goog.provide("Mixly.MicrobitFs");const{Config:e,MicrobitFs:n}=Mixly;var t=e["BOARD"],{nav:t={}}=t;n.init=()=>{fsWrapper.setupFilesystem().then(()=>{console.log("初始化成功")}).fail(()=>{console.log("初始化失败")})},!t.compile&&t.upload&&t.save?.hex&&n.init(),n.loadHex=(e,o)=>{var i=[];try{i=fsWrapper.importHexFiles(o)}catch(t){try{i=fsWrapper.importHexAppended(o)}catch(e){console.log(t.message)}}o="";-1<i.indexOf(e)?o=fsWrapper.read(e):alert("no "+e),Drag.items.vDrag.full("NEGATIVE"),Editor.codeEditor.setValue(o,-1)},n.loadFileToFilesystem=(t,e)=>{if("main.py"!==t)try{fsWrapper.exists(t)?(fsWrapper.remove(t),fsWrapper.create(t,e)):fsWrapper.write(t,e);fsWrapper.getUniversalHex()}catch(e){return fsWrapper.exists(t)&&fsWrapper.remove(t),alert(t+"\n"+e.message)}},n.updateMainPy=t=>{try{fsWrapper.exists("main.py")&&fsWrapper.remove("main.py");for(var o=0;o<py_module.length;o++)fsWrapper.exists(py_module[o].filename)&&fsWrapper.remove(py_module[o].filename);t&&fsWrapper.create("main.py",t);var i=t,r=new Array;i.trim().split("\n").forEach(function(e,t){r.push(e)});let e="";for(o=0;o<r.length;o++)if(0==r[o].indexOf("from")){if(e=(e=r[o].substring(4,r[o].indexOf("import"))).replace(/(^\s*)|(\s*$)/g,""),!fsWrapper.exists(e+".py"))for(var l=0;l<py_module.length;l++)py_module[l].filename==e+".py"&&n.loadFileToFilesystem(py_module[l].filename,py_module[l].code)}else if(0==r[o].indexOf("import")&&(e=(e=r[o].substring(6)).replace(/(^\s*)|(\s*$)/g,""),!fsWrapper.exists(e+".py")))for(l=0;l<py_module.length;l++)py_module[l].filename==e+".py"&&n.loadFileToFilesystem(py_module[l].filename,py_module[l].code)}catch(e){throw new Error(e.message)}},n.getHex=e=>{try{return n.updateMainPy(e),output=fsWrapper.getUniversalHex()}catch(e){return alert(e.message),null}}})(),(()=>{goog.require("layui"),goog.require("Mixly.LayerExt"),goog.require("Mixly.Boards"),goog.require("Mixly.Editor"),goog.provide("Mixly.NavEvents");const e=layui["form"],{NavEvents:t,Boards:i,Editor:r}=Mixly;t.init=()=>{$(".layui-nav-third-child").hide(),$(".third-class").hover(function(){$(".layui-nav-third-child").hide(),$(this).next().css("left",$(this).parent().parent().width()+1),$(this).next().toggle()},function(){$(".layui-nav-third-child").hide()}),$(".layui-nav-third-child").hover(function(){$(this).toggle()},function(){$(".layui-nav-third-child").hide()}),$(".layui-nav-item").hover(function(){"0px"==$(this).find("dl").css("right")&&($(this).find("dl").css("left",parseInt(parseInt($(this).width()-parseInt($(this).find("dl").width()))/2)),$(this).find("dl").css("right","auto"))},function(){}),e.on("select(boards-type)",function(e){var t=i.getSelectedBoardName();if(i.changeTo(t),i.selected!==t)try{var o=Blockly.Xml.workspaceToDom(r.blockEditor);r.blockEditor.clear(),Blockly.Xml.domToWorkspace(r.blockEditor,o),"BLOCK"===r.selected&&r.blockEditorUpdateCode()}catch(e){console.log(e)}i.updateCategories(t)}),e.on("select(ports-type)",function(e){$("#mixly-footer-port-div").css("display","inline-flex"),$("#mixly-footer-port").html(e.value)})}})(),(()=>{goog.require("Mixly.Env"),goog.require("Mixly.XML"),goog.require("Mixly.Config"),goog.require("Mixly.Drag"),goog.provide("Mixly.StatusBar");const{StatusBar:r,Config:e,Drag:o}=Mixly,t=(r.selected=!1,e)["USER"];let l;r.init=()=>{l=ace.edit("div_inout_middle"),r.Ace=l,"dark"===t.theme?l.setOption("theme","ace/theme/terminal"):l.setOption("theme","ace/theme/xcode"),l.getSession().setMode("ace/mode/python"),l.setFontSize(document.body.clientWidth/95),l.setReadOnly(!1),l.setScrollSpeed(.3),l.setShowPrintMargin(!1),l.renderer.setShowGutter(!1),l.commands.addCommands([{name:"increaseFontSize",bindKey:"Ctrl-=|Ctrl-+",exec:e=>{var t=parseInt(e.getFontSize(),10)||12;e.setFontSize(t+1)}},{name:"decreaseFontSize",bindKey:"Ctrl+-|Ctrl-_",exec:e=>{var t=parseInt(e.getFontSize(),10)||12;e.setFontSize(Math.max(t-1||1))}},{name:"resetFontSize",bindKey:"Ctrl+0|Ctrl-Numpad0",exec:e=>{e.setFontSize(12)}},{name:"sendCtrlC",bindKey:"Ctrl-Shift-C",exec:e=>{(Mixly.Env.isElectron?Mixly.Electron:Mixly.Web).Serial.writeCtrlC()}},{name:"sendCtrlD",bindKey:"Ctrl-Shift-D",exec:e=>{(Mixly.Env.isElectron?Mixly.Electron:Mixly.Web).Serial.writeCtrlD()}},{name:"Empty",bindKey:"Ctrl-E",exec:e=>{r.setValue("")}}])},r.show=e=>{var t=o.items["hDrag"];switch(e){case 1:t.show();break;case 2:t.full("POSITIVE");break;default:t.onfull&&"POSITIVE"===t.onfull?t.show():t.full("POSITIVE")}},r.setValue=(e,t=!0)=>{var o,i;l&&(l.updateSelectionMarkers(),o=l["selection"],i=o.getCursor(),r.getValue()!==e)&&(l.setValue(e,-1),t?(l.gotoLine(l.session.getLength()),o.moveCursorLineEnd()):(o.moveCursorTo(i.row,i.column,!0),o.clearSelection()))},r.getValue=function(){return l?l.getValue():""},r.addValue=(e,t=!0)=>{var o,i,r;l&&(l.updateSelectionMarkers(),{selection:o,session:i}=l,r=o.getCursor(),l.gotoLine(i.getLength()),o.moveCursorLineEnd(),l.insert(e),t?(l.gotoLine(i.getLength()),o.moveCursorLineEnd()):o.moveCursorTo(r.row,r.column,!0))},r.scrollToTheBottom=()=>{l&&(l.updateSelectionMarkers(),l.gotoLine(l.session.getLength()))},r.scrollToTheTop=()=>{l&&l.gotoLine(0)}})(),(()=>{goog.require("LazyLoad"),goog.require("layui"),goog.require("Code"),goog.require("Mixly.Env"),goog.require("Mixly.Modules"),goog.require("Mixly.XML"),goog.require("Mixly.ScriptLoader"),goog.require("Mixly.CssLoader"),goog.require("Mixly.Boards"),goog.require("Mixly.LayerExt"),goog.require("Mixly.Config"),goog.require("Mixly.Nav"),goog.require("Mixly.Electron.CloudDownload"),goog.provide("Mixly.Electron.LibManager");const{Env:h,Modules:e,Electron:t,XML:y,ScriptLoader:o,CssLoader:i,Boards:r,LayerExt:n,Config:l,Nav:p}=Mixly,{fs:m,fs_extra:g,fs_extend:f,path:x,compressing:a,electron_remote:s}=e,{BOARD:d,USER:c}=l,{CloudDownload:A,LibManager:b}=t,{table:C,element:v}=layui,{dialog:u,shell:B}=s;b.URL={mixly:d?.lib?.mixly?.url[0],arduino:d?.lib?.arduino?.url[0],python:d?.lib?.python?.url[0]},b.LOCAL_IMPORT_FILTERS={MIXLY:[{name:"Mixly Lib File",extensions:["xml","mil","zip"]}],ARDUINO:[{name:"ZIP File",extensions:["zip"]}],PYTHON:[{name:"Python File",extensions:["py"]}]},b.getDefaultXML=()=>{return $("#toolbox").html()},b.getLibs=e=>{var t,i=[],r=[],l=[];if(f.isdir(e))for(t of m.readdirSync(e)){var o,n=x.resolve(e,"./"+t);if(f.isdir(n))for(o of m.readdirSync(n)){var a=x.extname(o);if(".xml"===a){var a=m.readFileSync(x.resolve(n,"./"+o),"utf8"),s=y.getDom(a,{libPath:n});for(let o=0;s[o];o++)if(["SCRIPT","LINK"].includes(s[o].nodeName)){let e,t;t="SCRIPT"==s[o].nodeName?(e=r,s[o].src):(e=l,s[o].href);try{t=decodeURIComponent(t.replace("file:///",""));var d=x.relative(h.indexDirPath,t),c=x.relative(h.indexDirPath,x.resolve(n,d)),u=x.resolve(h.indexDirPath,d),p=x.resolve(h.indexDirPath,c);f.isfile(u)?e.push(d):f.isfile(p)&&e.push(c)}catch(e){console.log(e)}}else"CATEGORY"==s[o].nodeName&&i.push(s[o].outerHTML)}}else{var g=x.extname(n),A=x.basename(n,".mil");".mil"===g&&(g=m.readFileSync(n,"utf8"),(A=$('<category name="'+A+'" colour="#74a55b"></category>')).append($(g).html()),i.push(A[0].outerHTML))}}return{xml:i,js:r,css:l}},b.convertLibs=e=>{var t;if(f.isdir(e))for(t of m.readdirSync(e)){var o=x.resolve(e,"./"+t);if(f.isdir(o)){var i,r,l=m.readdirSync(o),n=x.resolve(o,"./block");for(i of l){var a=x.extname(i);if(".xml"===a){a=x.resolve(o,"./"+i);let e=m.readFileSync(a,"utf8");try{e=(e=e.replace(/\.\.\/\.\.\/blocks\/company\//g,"libraries/ThirdParty/"+t+"/block/")).replace(/\.\.\/\.\.\/generators\/arduino\/company\//g,"libraries/ThirdParty/"+t+"/generator/"),m.writeFileSync(a,e)}catch(e){console.log(e)}}}if(!f.isdir(n))return;for(r of m.readdirSync(n)){var s=x.resolve(n,"./"+r);if(!f.isdir(s)){let e=m.readFileSync(s,"utf8");try{e=(e=(e=(e=e.replace(/\.\.\/\.\.\/media\//g,"./libraries/ThirdParty/"+t+"/media/")).replace(/Blockly\.Block\.obtain\([\s]*workspace[\s]*\,/g,"workspace.newBlock(")).replace(/Blockly\.FieldTextArea/g,"Blockly.FieldMultilineInput")).replace(/Blockly\.Blocks\.[\u4E00-\u9FA5A-Za-z0-9_]+\.[\u4E00-\u9FA5A-Za-z0-9_]+/g,function(e){var t=e.split(".");return 4!==t.length?e:`Blockly.Msg['${t[2].toUpperCase()}_${t[3].toUpperCase()}']`}),m.writeFileSync(s,e)}catch(e){console.log(e)}}}}}},b.loadLibsAndUpdateJsCssList=(e=()=>{})=>{const{js:o,css:i,xml:t}=b.getLibs(x.resolve(h.indexDirPath,"./libraries/ThirdParty/"));h.thirdPartyXML=t;var r=[];o.length&&r.push(new Promise((e,t)=>{LazyLoad.js(o,function(){e()})})),i.length&&r.push(new Promise((e,t)=>{LazyLoad.css(i,function(){e()})})),r.length?Promise.all(r).catch(e=>{console.log(e)}).finally(()=>{e()}):e(),h.thirdPartyCSS=[...h.thirdPartyCSS,...i??[]],h.thirdPartyJS=[...h.thirdPartyJS,...o??[]]},b.init=()=>{h.defaultXML=b.getDefaultXML(),h.thirdPartyXML=[],b.reloadThirdPartyLibs()},b.reloadThirdPartyLibs=()=>{b.convertLibs(x.resolve(h.indexDirPath,"./libraries/ThirdParty/"));for(let e=0;e<h.thirdPartyJS.length;e++)o.removeScript(h.thirdPartyJS[e]);for(let e=0;e<h.thirdPartyCSS.length;e++)i.removeCss(h.thirdPartyCSS[e]);h.thirdPartyJS=[],h.thirdPartyCSS=[],Code.loadThirdPartyLanJs(),$("#toolbox").html(h.defaultXML),b.loadLibsAndUpdateJsCssList(function(){var e=r.getSelectedBoardName();r.updateCategories(e,!0)})},b.menuAddEvent=e=>{const c=x.resolve(h.indexDirPath,"./libraries/ThirdParty");let u=[0,0,0];v.tab({headerElem:"#libs-menu-options>li",bodyElem:"#libs-menu-body>.menu-body"}),v.render("nav","libs-menu-filter"),v.on("tab(libs-menu-filter)",function(e){e=e.index;e!==u[0]&&(e?b.onclickManageLibs():b.onclickImportLibs(),u[0]=e)}),v.on("tab(import-lib-page-filter)",function(e){var t=e["index"];t!==u[1]&&(e.index,u[1]=t)}),v.on("tab(del-lib-page-filter)",function(e){var t=e["index"];t!==u[2]&&(e.index,u[2]=t)}),e.find("button").off().click(function(){var t=$(this).attr("m-id");let o,i;switch(o=u[1]?"c"===p.codeEnv?"ARDUINO":"PYTHON":"MIXLY",i=u[2]?"c"===p.codeEnv?"ARDUINO":"PYTHON":"MIXLY",t){case"cloud-import":var r=u[1]?"cloud-code-lib-table":"cloud-mixly-lib-table",l=C.checkStatus(r).data,n=[];for(let e=0;e<l.length;e++)n.push({desPath:c,...l[e]});0<n.length?b.showCloudImportProgress(n):layer.msg(indexText["请选择至少一个库"]+"!",{time:1e3});break;case"local-import":b.showLocalImportDialog(o);break;case"del":var r=u[2]?"del-code-lib-table":"del-mixly-lib-table",l=C.checkStatus(r).data,a=[];for(let e=0;e<l.length;e++)a.push(l[e].path);0<a.length?b.showDelLibsProgress(e=>{b.delLibs(i,a,e)}):layer.msg(indexText["请选择至少一个库"]+"!",{time:1e3});break;case"open-folder":var s=x.resolve(h.indexDirPath,"libraries/myLib"),d=x.resolve(h.indexDirPath,"build/lib");let e;switch(i){case"ARDUINO":e=s;break;case"PYTHON":e=d;break;default:e=c}g.ensureDir(e).then(()=>B.openPath(e)).catch(console.log)}})},b.showManageDialog=()=>{var e=y.render(y.TEMPLATE_STR.LIB_MANAGER_DIV,{importBoard:indexText["导入库"],delBoard:indexText["管理库"],mixlyLib:"Mixly",codeLib:"c"===p.codeEnv?"Arduino":"Python",cloudImport:indexText["云端导入"],localImport:indexText["本地导入"],openFolder:indexText["打开对应文件夹"],del:indexText["删除"]});n.open({title:[indexText["库管理器"],"35px"],id:"lib-manage-layer",content:e,shade:n.SHADE_ALL,area:["60%","60%"],min:["400px","200px"],max:["800px","400px"],success:e=>{b.onclickImportLibs(),b.menuAddEvent(e)}})},b.compareLibConfig=e=>{var{version:t,url:o}=e,o=(e.downloadIndex=!0,x.resolve(h.indexDirPath,"libraries/ThirdParty",x.basename(o,".zip")));return f.isdir(o)?(o=x.resolve(o,"./config.json"),null!==(o=g.readJsonSync(o,{throws:!1}))&&o.version===t&&(e.downloadIndex=!1),e.downloadIndex?e.status=indexText["待更新"]:e.status=indexText["已安装"]):e.status=indexText["待安装"],e},b.onclickImportLibs=()=>{let i={id:"cloud-mixly-lib-table",elem:"#import-mixly-lib-page",data:[],defaultToolbar:[],title:indexText["云端库"],cols:[[{type:"checkbox",unresize:!1,align:"center"},{field:"status",title:indexText["状态"],sort:!0,unresize:!1,align:"center",minWidth:100},{field:"name",title:indexText["名称"],sort:!0,unresize:!1,align:"center",minWidth:200},{field:"version",title:indexText["版本"],unresize:!1,align:"center",minWidth:80},{field:"desc",title:indexText["介绍"],unresize:!1,align:"center",minWidth:250}]],limit:1e3,skin:"line",even:!1,size:"sm"},r={id:"cloud-code-lib-table",elem:"#import-code-lib-page",data:[],defaultToolbar:[],title:indexText["云端库"],cols:[[{type:"checkbox",unresize:!1,align:"center"},{field:"name",title:indexText["名称"],sort:!0,unresize:!1,align:"center",minWidth:200},{field:"version",title:indexText["版本"],unresize:!1,align:"center",minWidth:80},{field:"desc",title:indexText["介绍"],unresize:!1,align:"center",minWidth:250}]],limit:1e3,skin:"line",even:!1,size:"sm"};C.render({...i,text:{none:indexText["云端库JSON下载中"]+"..."}}),C.render({...r,text:{none:indexText["云端库JSON下载中"]+"..."}});var e=x.resolve(h.indexDirPath,"./libraries/ThirdParty");b.URL.mixly?A.getJson(b.URL.mixly,e,e=>{if(e[0])console.log(e[0]),C.render({...i,text:{none:indexText["无数据"]}});else{var t,o=[];for(t of e[1])o.push(b.compareLibConfig({...t}));i.data=o,C.render(i)}}):C.render({...i,text:{none:indexText["无数据"]}});let t,o;(o="c"===p.codeEnv?(t=x.resolve(h.indexDirPath,"./libraries/myLib"),b.URL.arduino):(t=x.resolve(h.indexDirPath,"./build/lib"),b.URL.python))?A.getJson(o,t,e=>{if(e[0])console.log(e[0]),C.render({...r,text:{none:indexText["无数据"]}});else{var t,o=[];for(t of e[1])o.push(b.compareLibConfig({...t}));r.data=o,C.render(r)}}):C.render({...r,text:{none:indexText["无数据"]}})},b.onclickManageLibs=()=>{var e={id:"del-mixly-lib-table",elem:"#del-mixly-lib-page",data:[],defaultToolbar:[],title:indexText["管理库"],cols:[[{type:"checkbox",unresize:!1,align:"center"},{field:"name",title:indexText["名称"],sort:!0,unresize:!1,align:"center",minWidth:150},{field:"path",title:indexText["路径"],unresize:!1,align:"center",minWidth:300}]],limit:1e3,skin:"line",even:!1,size:"sm"},t={id:"del-code-lib-table",elem:"#del-code-lib-page",data:[],defaultToolbar:[],title:indexText["管理库"],cols:e.cols,limit:1e3,skin:"line",even:!1,size:"sm"},o=(C.render({...e,text:{none:indexText["本地库读取中"]+"..."}}),C.render({...t,text:{none:indexText["本地库读取中"]+"..."}}),x.resolve(h.indexDirPath,"libraries/ThirdParty")),i=x.resolve(h.indexDirPath,"libraries/myLib"),l=x.resolve(h.indexDirPath,"build/lib");for(let r of[{path:o,tableConfig:e},{path:"c"===p.codeEnv?i:l,tableConfig:t}])f.isdir(r.path)?m.readdir(r.path,(e,t)=>{if(e)console.log(e),C.render({...r.tableConfig,text:{none:indexText["读取失败"]}});else{var o,i=[];for(o of t)".json"!==x.extname(o)&&i.push({name:o,path:x.resolve(r.path,o)});i.length?C.render({...r.tableConfig,data:i}):C.render({...r.tableConfig,text:{none:indexText["无数据"]}})}}):C.render({...r.tableConfig,text:{none:indexText["无数据"]}})},b.showLocalImportDialog=t=>{e.currentWindow.focus();let o;u.showOpenDialog(e.currentWindow,{title:indexText["导入库"],defaultPath:h.clientPath,buttonLabel:indexText["确定"],filters:b.LOCAL_IMPORT_FILTERS[t],properties:["openFile","showHiddenFiles"],message:indexText["导入库"]}).then(e=>{e=e.filePaths[0];e&&(console.log("待导入文件路径：",e),b.importFromLocal(t,e,()=>{o=layer.open({type:1,id:"import-local-lib-layer",title:indexText["导入中"]+"...",content:$("#mixly-loader-div"),shade:n.SHADE_ALL,closeBtn:0,success:function(e){$("#mixly-loader-btn").css("display","none")},end:function(){$("#mixly-loader-btn").css("display","inline-block"),$("#layui-layer-shade"+o).remove()}})},e=>{console.log(e),layer.msg(e,{time:1e3})},e=>{layer.close(o),e?(console.log(e),layer.msg(indexText["导入失败"],{time:1e3})):layer.msg(indexText["导入成功"],{time:1e3})}))}).catch(e=>{layer.close(o),console.log(e),layer.msg(indexText["导入失败"],{time:1e3})})},b.importFromLocal=(e,t,o,i,r)=>{var l=x.extname(t),n=x.resolve(h.indexDirPath,"./build/lib"),a=x.resolve(h.indexDirPath,"./libraries/ThirdParty");if(f.isfile(t))switch(l){case".py":n===x.resolve(t,"../")?i(indexText["此库已导入"]):(o(),b.importFromLocalWithFile(e,t,r));break;case".mil":a===x.resolve(t,"../")?i(indexText["此库已导入"]):(o(),b.importFromLocalWithFile(e,t,r));break;case".xml":x.resolve(t,"../../")===a?i(indexText["此库已导入"]):(o(),b.importFromLocalWithFile(e,t,r));break;case".zip":o(),b.importFromLocalWithZip(e,t,r);break;default:i(indexText["所选文件非配置文件"])}else i(indexText["文件不存在"])},b.importFromLocalWithFile=(t,e,o)=>{var i=x.resolve(h.indexDirPath,"./libraries/ThirdParty"),r=x.extname(e),l=x.basename(e),n=[];switch(r){case".xml":var a,s={FILE:["CHANGELOG.md","README.md","config.json",l],DIR:["block","generator","converter","css","media","language","companypin","examples","wiki","libraries"]},d=x.dirname(e),c=x.basename(d);for(a of m.readdirSync(d)){var u,p=x.resolve(d,"./"+a);f.isfile(p)?s.FILE.includes(a)&&(u=x.resolve(i,c,a),n.push(b.copyFile(p,u))):s.DIR.includes(a)&&(u=x.resolve(i,c,a),n.push(b.copyDir(p,u)))}break;case".mil":var g=x.resolve(i,x.basename(e));n.push(b.copyFile(e,g));break;case".py":g=x.resolve(h.indexDirPath,"build/lib",x.basename(e));n.push(b.copyFile(e,g));break;default:layer.msg(indexText["文件后缀错误"],{time:1e3}),o(indexText["文件后缀错误"])}Promise.all(n).then(e=>{"MIXLY"===t&&b.reloadThirdPartyLibs(),o(null)}).catch(e=>{o(e)}).finally(()=>{})},b.importFromLocalWithZip=(t,e,o)=>{var i=x.resolve(h.indexDirPath,"./libraries/ThirdParty/"),r=x.resolve(h.indexDirPath,"./libraries/myLib/");let l;switch(t){case"MIXLY":l=i;break;case"ARDUINO":l=r;break;default:return void o(indexText["解压出错"])}b.unZip(e,l,!1,e=>{"MIXLY"===t&&b.reloadThirdPartyLibs(),o(e)})},b.delLibs=(t,e,o)=>{var i=[];for(let o of e)i.push(new Promise((t,e)=>{g.remove(o,e=>{t(e)})}));Promise.all(i).then(e=>{b.onclickManageLibs(),"MIXLY"===t&&b.reloadThirdPartyLibs()}).catch(e=>{console.log(e)}).finally(()=>{layer.close(o)})},b.showDelLibsProgress=o=>{const e=layer.open({type:1,id:"del-local-lib-layer",title:indexText["删除中"]+"...",content:$("#mixly-loader-div"),shade:n.SHADE_ALL,closeBtn:0,success:function(e,t){$("#mixly-loader-btn").css("display","none"),o(t)},end:function(){$("#layui-layer-shade"+e).remove(),$("#mixly-loader-btn").css("display","inline-block")}})},b.unZip=(e,t,o,i=e=>{})=>{var r=x.basename(e,".zip");x.resolve(t,r);a.zip.uncompress(e,t,{zipFileNameEncoding:"GBK"}).then(()=>{if(o)try{m.unlinkSync(e)}catch(e){console.log(e)}i(null)}).catch(e=>{i(e)})},b.copyDir=(o,i)=>new Promise((e,t)=>{g.ensureDir(i).then(()=>g.emptyDir(i)).then(()=>g.copy(o,i)).then(()=>{e({error:null,endPath:i})}).catch(e=>{resolve({error:e,endPath:i})})}),b.copyFile=(i,r)=>new Promise((e,t)=>{var o=x.dirname(r);g.ensureDir(o).then(()=>g.copy(i,r)).then(()=>{e({error:null,endPath:r})}).catch(e=>{resolve({error:e,endPath:r})})}),b.showCloudImportProgress=(o,e=0)=>{const t=$("<div></div>");t.css({overflow:"hidden","background-color":"dark"===c.theme?"#807b7b":"#fff",width:"100%",height:"100%",display:"none"});var i,r=$("<div></div>");for(i in r.css({"overflow-x":"hidden","overflow-y":"auto","background-color":"dark"===c.theme?"#807b7b":"#fff",left:"5px",right:"5px",top:"5px",bottom:"5px",position:"absolute"}),o){var l=o[i],l={panelId:i+"-panel-id",name:l.name,progressFilter:i+"-progress-filter",progressStatusId:i+"-progress-status-id"};r.append(y.render(y.TEMPLATE_STR.PROGRESS_BAR_DIV,l))}t.append(r),$("body").append(t),v.render("progress"),n.open({title:indexText["导入中"]+"...",id:"setting-menu-layer1",content:t,shade:n.SHADE_ALL,area:["40%","60%"],max:["800px",106*o.length+42+"px"],min:["500px","100px"],success:(e,t)=>{e.find(".layui-layer-setwin").css("display","none"),b.importFromCloud(o,e,t)},end:()=>{t.remove()}})},b.importFromCloud=(e,t,n)=>{var o,i=[];for(o in e)e[o].index=o,i.push(b.importWithUrl(e[o]));Promise.all(i).then(e=>{let t=0,o=0;for(var i of e){var r=$("#"+i.index+"-progress-status-id"),l=$("#"+i.index+"-panel-id").children(".layui-card-header").first();r.removeClass("layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop"),i.error?(r.addClass("layui-icon-close-fill"),l.html(i.name+" - "+indexText["导入失败"]),o++,console.log(i.error)):(r.addClass("layui-icon-ok-circle"),l.html(i.name+" - "+indexText["导入完成"]),t++)}layer.title(indexText["导入完成"]+" "+t+'<i class="layui-icon layui-icon-ok" style="font-size:13px;color:#41ce28;"></i> '+o+'<i class="layui-icon layui-icon-close" style="font-size:13px;color:#b9063b;"></i>',n)}).catch(e=>{layer.title(indexText["导入失败"],n)}).finally(()=>{t.find(".layui-layer-setwin").css("display","block"),b.onclickImportLibs(),b.reloadThirdPartyLibs()})},b.writeLibConfig=e=>{var{desPath:e,version:t,name:o,url:i}=e;if(o){o=x.resolve(e,x.basename(i,".zip"));if(f.isdir(o)){e=x.resolve(o,"config.json"),i={version:t};try{g.outputJsonSync(e,i,{spaces:"    "})}catch(e){console.log(e)}}}},b.importWithUrl=r=>new Promise((i,e)=>{r.url||(r.error="url读取出错",i(r)),b.downloadPromise(r,{desPath:x.resolve(h.clientPath,"./download"),url:r.downloadIndex?r.url:"None",startMessage:indexText["下载中"]+"...",endMessage:indexText["下载完成"],errorMessage:indexText["下载失败"]}).then(e=>{if(e.error)throw e.error;return b.unZipPromise(e,{desPath:e.desPath,zipPath:e.downloadPath,startMessage:indexText["解压中"]+"...",endMessage:indexText["解压完成"],errorMessage:indexText["解压失败"]})}).then(e=>{if(e.error)throw e.error;var t=$("#"+e.index+"-panel-id").children(".layui-card-header").first(),o=$("#"+e.index+"-progress-status-id");r.downloadIndex?b.writeLibConfig(e):(o.removeClass("layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop"),t.html(e.name+" - "+indexText["已是最新版"]),o.addClass("layui-icon-ok-circle"),v.progress(e.index+"-progress-filter","100%"),v.render("progress",e.index+"-progress-filter")),i(e)}).catch(e=>{r.error=e,i(r)})}),b.downloadPromise=(c,u)=>new Promise((t,e)=>{var o={desPath:x.resolve(h.clientPath,"./download"),url:null,startMessage:indexText["下载中"]+"...",endMessage:indexText["下载完成"],errorMessage:indexText["下载失败"]};const{desPath:i,url:r,startMessage:l,endMessage:n,errorMessage:a}=u="object"!=typeof u?o:{...o,...u};if(r&&"None"!==r&&i){try{g.ensureDirSync(i)}catch(e){return c.error=e,c.downloadPath=null,void t(c)}const s=$("#"+c.index+"-panel-id").children(".layui-card-header").first(),d=(s.html(c.name+" - "+l),$("#"+c.index+"-progress-status-id"));d.removeClass("layui-icon-ok-circle layui-icon-close-fill"),d.addClass("layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop"),v.progress(c.index+"-progress-filter","0%"),v.render("progress",c.index+"-progress-filter"),A.download(r,i,{progress:e=>{var{speed:e,progress:t}=e;let o=0;parseInt(t);let i=e;for(let e=0;e<3&&1<i/1e3;e++)i/=1024,o++;i=i.toFixed(1),s.html(c.name+" - "+l+" - "+i+["B/s","KB/s","MB/s","GB/s"][o]),v.progress(c.index+"-progress-filter",parseInt(t)+"%"),v.render("progress",c.index+"-progress-filter")},error:e=>{d.removeClass("layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop"),d.addClass("layui-icon-close-fill"),s.html(c.name+" - "+a)},end:e=>{d.removeClass("layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop"),d.addClass("layui-icon-ok-circle"),s.html(c.name+" - "+n)},timeout:this.error}).then(e=>{if(e[0])throw e[0];c.error=null,c.downloadPath=e[1],t(c)}).catch(e=>{c.error=e,c.downloadPath=null,t(c)})}else c.error=null,c.downloadPath=null,t(c)}),b.unZipPromise=(u,p)=>new Promise((t,e)=>{var o={desPath:x.resolve(h.clientPath,"./download"),zipPath:null,startMessage:indexText["解压中"]+"...",endMessage:indexText["解压完成"],errorMessage:indexText["解压失败"],delZip:!0};const{zipPath:i,desPath:r,delZip:l,startMessage:n,endMessage:a,errorMessage:s}=p="object"!=typeof p?o:{...o,...p};if(i&&r){const d=$("#"+u.index+"-panel-id").children(".layui-card-header").first(),c=(d.html(u.name+" - "+n),$("#"+u.index+"-progress-status-id"));c.removeClass("layui-icon-ok-circle layui-icon-close-fill"),c.addClass("layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop"),v.progress(u.index+"-progress-filter","0%"),v.render("progress",u.index+"-progress-filter"),b.unZip(i,r,l,e=>{e?(c.removeClass("layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop"),c.addClass("layui-icon-close-fill"),d.html(u.name+" - "+s),u.error=e,u.unZipPath=null):(c.removeClass("layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop"),c.addClass("layui-icon-ok-circle"),d.html(u.name+" - "+a),u.error=null,u.unZipPath=r,v.progress(u.index+"-progress-filter","100%"),v.render("progress",u.index+"-progress-filter")),t(u)})}else u.error=null,u.unZipPath=null,t(u)})})(),(()=>{goog.require("Mixly.MString"),goog.require("Mixly.StatusBar"),goog.require("Mixly.Web"),goog.provide("Mixly.Web.Ampy");const{Web:e,StatusBar:s}=Mixly;e.Ampy=class{constructor(e,t=!0){this.operator_=e,this.encoder_=new TextEncoder,this.decoder_=new TextDecoder,this.writeBuffer_=t}async readUntil(t,o=!0,e,i){var r=Number(new Date);let l=r,n="";for(;l-r<e;){const l=Number(new Date);var a=this.operator_.output.length;if(a)for(let e=0;e<a;e++){var s=this.operator_.output.shift(),d=s.toLowerCase().indexOf(t);if(-1!==d)return this.operator_.output.unshift(s.substring(o?d+t.length:d)),n+=s.substring(0,o?d+t.length:d);n+=e===a-1?s:s+"\n"}if((l-r)%500||"function"!=typeof i||await i(),l-r>=e)return console.log(t+"查找失败"),!1;await this.operator_.sleep(100)}}async getFilesInfo(e=5e3){if(this.exec(`
try:
    import os
except ImportError:
    import uos as os

def listdir(directory):
    try:
        if directory == '/':
            return sorted([directory + f for f in os.listdir(directory)])
        else:
            return sorted([directory + '/' + f for f in os.listdir(directory)])
    except:
        return sorted([f for f in os.listdir()])

r = []
for f in listdir(''):
    try:
        size = os.stat(f)[6]
    except:
        size = os.size(f)
    r.append([f, size])
print(r)`),await this.sleep(100),!await this.readUntil("ok",!0,e))return null;let t=await this.readUntil(">",!1,e);var o={};try{t=(t=t.replaceAll("'",'"')).substring(0,t.lastIndexOf("]")+1);for(var i of JSON.parse(t))o[i[0].substring(i[0].lastIndexOf("/")+1)]=i[1]}catch(e){console.log(e)}return o}async interrupt(e=5e3){return await this.operator_.writeCtrlC(),await this.sleep(100),!!await this.readUntil(">>>",!0,e,this.operator_.writeCtrlC)}async enterRawREPL(e=5e3){return await this.operator_.writeCtrlA(),await this.sleep(100),!!await this.readUntil("raw repl; ctrl-b to exit",!0,e,this.operator_.writeCtrlA)}async exitRawREPL(e=5e3){return await this.operator_.writeCtrlB(),await this.sleep(100),!!await this.readUntil(">>>",e,!0,this.operator_.writeCtrlB)}async exitREPL(e=5e3){return await this.operator_.writeCtrlD(),await this.sleep(100),!!await this.readUntil("soft reboot",!1,e,this.operator_.writeCtrlD)}put(l,n,a=null){return new Promise(async(e,t)=>{try{if(await this.operator_.writeCtrlB(),await this.interrupt())if(await this.enterRawREPL()){if(a){var o,i=await this.getFilesInfo();for(o in a){var r=goog.get(a[o]);r&&new TextEncoder("utf8").encode(r).length!==i[o+".py"]?await this.writeFile(o+".py",r):s.addValue("Skip "+o+".py\n")}}await this.writeFile(l,n),await this.exitRawREPL()?await this.exitREPL()?e():t(indexText["无法退出REPL"]):t(indexText["无法退出Raw REPL"])}else t(indexText["无法进入Raw REPL"]);else t(indexText["中断失败"])}catch(e){t(e.toString())}})}async writeFile(e,t){s.addValue(`Writing ${e} `);let o=`file = open('${e}', 'w')
`;var i,r=this.encoder_.encode(t),l=Math.ceil(r.length/500);for(let e=0;e<l;e++){let t="";for(i of r.slice(500*e,Math.min(500*(e+1),r.length))){let e=i.toString(16);1===e.length&&(e="0"+e),t+="\\x"+e}o+=`file.write(b'${t}')
`}o+=`file.close()
`,await this.exec(o),s.addValue("Done!\n")}async exec(t){if(this.writeBuffer_){var o=this.encoder_.encode(t),i=Math.ceil(o.length/250);for(let e=0;e<i;e++){var r=o.slice(250*e,Math.min(250*(e+1),o.length));await this.operator_.writeByteArr(r)}}else for(let e=0;e<t.length/60;e++){var l=t.substring(60*e,60*(e+1));await this.operator_.writeString(l)}await this.operator_.writeByteArr([4])}sleep(t){return new Promise(e=>setTimeout(e,t))}}})(),(()=>{goog.require("Mixly.Web.Ampy"),goog.provide("Mixly.Web.SerialPort");var e=Mixly["Web"];const n=e["SerialPort"];n.output=[],n.inputBuffer=[],n.outputBuffer=[],n.refreshInputBuffer=!1,n.refreshOutputBuffer=!0,n.obj=null,n.onDataLine=null,n.encoder=new TextEncoder,n.decoder=new TextDecoder,n.dtr=!1,n.rts=!1,n.connect=(o=115200,i=e=>{})=>new Promise((e,t)=>{n.isConnected()?e():navigator.serial.requestPort().then(e=>(n.obj=e).open({baudRate:o})).then(()=>{n.keepReading=!0,n.onDataLine=i,n.addReadEvent(i),e()}).catch(e=>{n.obj=null,t(e)})}),n.close=async()=>{if(n.isConnected()&&(n.keepReading=!1,n.isConnected())){var e=n.obj;if(e.readable&&e.readable.locked)try{await n.reader.cancel(),n.reader.releaseLock()}catch(e){console.log(e)}if(e.writable&&e.writable.locked)try{n.writer.releaseLock()}catch(e){console.log(e)}try{await e.close()}catch(e){console.log(e)}n.obj=null}},n.isConnected=()=>n.obj,n.readLine=()=>{for(var e,t="",o=!1;(e=n.readChar()).length&&("\n"===e?o=!0:t+=e),e.length&&!o;);return{text:t,endWithLF:o}},n.readChar=()=>{for(var e=[],t=0,o="",i=n.outputBuffer.length,r=0;r<i;r++){var l=n.outputBuffer.shift();if(0==(128&l)){o=String.fromCharCode(l);break}if(128==(192&l)){if(e.push(l),t<=e.length){o=n.decoder.decode(new Uint8Array(e));break}}else{switch(224&l){case 252:t=6;break;case 248:t=5;break;case 240:t=4;break;case 224:t=3;break;default:t=2}e.push(l)}}return o},n.startReadLine=(o=e=>{})=>{n.readLineTimer=window.setTimeout(()=>{if(n.keepReading){do{var e=n.readLine(),t=e.endWithLF,e=e["text"];n.output.push((n.output.length?n.output.pop():"")+e),t&&((e=n.output.length)&&o(n.output[e-1]),n.output.push(""))}while(t);for(;500<n.output.length;)n.output.shift();n.keepReading&&n.startReadLine(o)}else window.clearTimeout(n.readLineTimer)},100)},n.addReadEvent=async(e=e=>{})=>{for(n.output=[],n.inputBuffer=[],n.outputBuffer=[],n.refreshInputBuffer=!1,n.refreshOutputBuffer=!0,n.startReadLine(e);n.obj.readable&&n.keepReading;){n.reader=n.obj.readable.getReader();try{for(;;){var{value:t,done:o}=await n.reader.read();if(n.refreshOutputBuffer&&t&&(n.outputBuffer=[...n.outputBuffer,...t]),n.refreshInputBuffer&&t&&(n.inputBuffer=[...n.inputBuffer,...t]),o)break}}catch(e){console.log(e)}finally{n.reader.releaseLock()}}},n.AddOnConnectEvent=t=>{navigator.serial.addEventListener("connect",e=>{t()})},n.AddOnDisconnectEvent=t=>{navigator.serial.addEventListener("disconnect",e=>{n.obj&&n.close(),t()})},n.writeString=async e=>{e=n.encoder.encode(e);await n.writeByteArr(e)},n.writeByteArr=async e=>{var t=n.obj.writable.getWriter();await t.write(new Int8Array(e).buffer),t.releaseLock(),await n.sleep(200)},n.writeCtrlA=async()=>{await n.writeByteArr([1,13,10])},n.writeCtrlB=async()=>{await n.writeByteArr([2,13,10])},n.writeCtrlC=async()=>{await n.writeByteArr([3,13,10])},n.writeCtrlD=async()=>{await n.writeByteArr([3,4])},n.setBaudRate=async e=>{n.keepReading=!1;var t=n.obj;await n.close(),await t.open({baudRate:+e}),n.obj=t,n.keepReading=!0,n.setSignals(n.dtr,n.rts),n.addReadEvent(n.onDataLine)},n.setDTR=async e=>{n.dtr=e,await n.obj.setSignals({dataTerminalReady:e})},n.setRTS=async e=>{n.rts=e,await n.obj.setSignals({requestToSend:e})},n.setSignals=async(e,t)=>{n.dtr=e,n.rts=t,await n.obj.setSignals({dataTerminalReady:e,requestToSend:t})},n.sleep=t=>new Promise(e=>setTimeout(e,t))})(),(()=>{goog.require("Mixly.Web.Ampy"),goog.provide("Mixly.Web.USB");var e=Mixly["Web"];const l=e["USB"];l.output=[],l.encoder=new TextEncoder,l.decoder=new TextDecoder,l.obj=null,l.onDataLine=null,l.connect=(o=115200,i=e=>{})=>new Promise((e,t)=>{l.isConnected()?e():navigator.usb.requestDevice({filters:[{vendorId:3368}]}).then(e=>(l.obj=e,l.WebUSB=new DAPjs.WebUSB(e),l.DAPLink=new DAPjs.DAPLink(l.WebUSB),l.DAPLink.connect())).then(()=>l.setBaudRate(o)).then(()=>{l.onDataLine=i,l.addReadEvent(i),e()}).catch(t)}),l.close=()=>{l.isConnected()&&(l.DAPLink.removeAllListeners(DAPjs.DAPLink.EVENT_SERIAL_DATA),l.DAPLink.stopSerialRead(),l.DAPLink.disconnect().then(()=>l.WebUSB.close()).then(()=>l.obj.close()).catch(e=>{console.log(e)}))},l.isConnected=()=>l.obj&&l.obj.opened,l.addReadEvent=(r=e=>{})=>{l.DAPLink.removeAllListeners(DAPjs.DAPLink.EVENT_SERIAL_DATA),l.DAPLink.on(DAPjs.DAPLink.EVENT_SERIAL_DATA,t=>{var o=t.split("\n");if(o.length){var i;l.output.length&&(t=l.output.pop(),l.output.push(t+o.shift()),o.length)&&r(l.output[l.output.length-1]);let e=0;for(i of o)e++,l.output.push(i),e<o.length&&r(i);for(;500<l.output.length;)l.output.shift()}}),l.DAPLink.startSerialRead(l.obj)},l.AddOnConnectEvent=t=>{navigator.usb.addEventListener("connect",e=>{t()})},l.AddOnDisconnectEvent=t=>{navigator.usb.addEventListener("disconnect",e=>{t()})},l.writeString=async e=>{await l.DAPLink.serialWrite(e),await l.sleep(200)},l.writeByteArr=async e=>{"function"==typeof e.unshift&&(e.unshift(e.length),e=new Uint8Array(e).buffer),await l.DAPLink.send(132,e),await l.sleep(200)},l.writeCtrlA=async()=>{await l.writeByteArr([1,13,10])},l.writeCtrlB=async()=>{await l.writeByteArr([2,13,10])},l.writeCtrlC=async()=>{await l.writeByteArr([3,13,10])},l.writeCtrlD=async()=>{await l.writeByteArr([3,4])},l.write=async(e,t,o)=>"string"!==e?(await l.writeByteArr(t),l.writeString(o)):l.writeString(t+o),l.setSignals=async(e,t)=>{},l.setBaudRate=e=>l.DAPLink.setSerialBaudrate(e),l.flash=e=>l.DAPLink.flash(e),l.sleep=t=>new Promise(e=>setTimeout(e,t))})(),(()=>{goog.require("layui"),goog.require("Blockly"),goog.require("Base64"),goog.require("Mixly.Config"),goog.require("Mixly.MArray"),goog.require("Mixly.Boards"),goog.require("Mixly.XML"),goog.require("Mixly.LayerExt"),goog.require("Mixly.MicrobitFs"),goog.require("Mixly.Editor"),goog.require("Mixly.Drag"),goog.provide("Mixly.MFile");const{form:t,util:C}=layui,{Config:e,Boards:v,XML:o,LayerExt:n,MicrobitFs:i,Editor:B,Drag:E,MFile:w}=Mixly,{BOARD:a,SOFTWARE:s}=e;w.SAVE_FILTER_TYPE={mix:{name:indexText["Mixly文件"],extensions:["mix"]},py:{name:indexText["Python文件"],extensions:["py"]},ino:{name:indexText["Arduino文件"],extensions:["ino"]},hex:{name:indexText["Hex文件"],extensions:["hex"]},bin:{name:indexText["Bin文件"],extensions:["bin"]},png:{name:indexText["图像文件"],extensions:["png"]},mil:{name:indexText["Mixly库文件"],extensions:["mil"]}},w.saveFilters=[w.SAVE_FILTER_TYPE.mix],w.OPEN_FILTER_TYPE=["mix","xml","py","ino","hex","bin"],w.openFilters=["mix"],w.updateSaveFilters=(e,t=null)=>{"object"!=typeof e&&(e=[]),w.saveFilters=[w.SAVE_FILTER_TYPE.mix];var o,i=["mix"];for(o of e)w.SAVE_FILTER_TYPE[o]&&!i.includes(o)&&(i.push(o),o===t?w.saveFilters.unshift(w.SAVE_FILTER_TYPE[o]):w.saveFilters.push(w.SAVE_FILTER_TYPE[o]))},w.updateOpenFilters=(e,t)=>{"object"!=typeof e&&(e=[]),w.openFilters=["mix","xml"];for(var o of e)w.OPEN_FILTER_TYPE.includes(o)&&!w.openFilters.includes(o)&&w.openFilters.push(o)},w.init=()=>{var e,t=a?.nav?.save??{},o=[],i=[];for(e in t)t[e]&&("img"!==e?(o.push(e),i.push(e)):o.push("png"));a?.nav?.setting?.thirdPartyLibrary&&o.push("mil"),w.updateOpenFilters(i),w.updateSaveFilters(o)},w.init(),w.getCode=e=>{let t;return t=e?"py"===e?Blockly.Python:Blockly.Arduino:Blockly?.Python??Blockly.Arduino,"CODE"===B.selected?B.codeEditor.getValue():t.workspaceToCode(B.blockEditor)||""},w.getHex=()=>{var e=w.getCode();return i.getHex(e)},w.loadHex=e=>{i.loadHex("main.py",e)},w.getMix=()=>{var e=$(Blockly.Xml.workspaceToDom(B.blockEditor)),t=s?.version??"Mixly 2.0",o=v.getSelectedBoardName(),i=a?.boardType??"default",r=v.getSelectedBoardConfig(!0);e.removeAttr("xmlns").attr("version",t).attr("board",i+"@"+o);let l=e[0].outerHTML;t=w.getCode();if(r)try{l+=`<config>${JSON.stringify(r)}</config>`}catch(e){console.log(e)}return a.saveMixWithCode&&(t=Base64.encode(t),l+=`<code>${t}</code>`),l},w.getMil=()=>{var t=$(w.getMix());let o,i,r;for(let e=0;t[e];e++)switch(t[e].nodeName){case"XML":o=$(t[e]);break;case"CONFIG":i=$(t[e]);break;case"CODE":r=$(t[e])}if(!o)return"";i&&i.remove(),r&&r.remove(),o.attr("type","lib"),o.find("block,shadow").removeAttr("id varid x y");var l=o.children("block"),n=[];for(let e=0;l[e];e++){var a=l[e].outerHTML;n.includes(a)?l[e].remove():n.push(a)}return o[0].outerHTML},w.getBlocksPng=()=>new Promise((t,e)=>{var o=B.blockEditor.svgBlockCanvas_.cloneNode(!0),i=(o.removeAttribute("width"),o.removeAttribute("height"),o.removeAttribute("transform"),document.createElementNS("http://www.w3.org/2000/svg","style")),i=(Blockly.Css.CONTENT=[".blocklySvg {","background-color: #fff;","outline: none;","overflow: hidden;","position: absolute;","display: block;","}",".blocklyWidgetDiv {","display: none;","position: absolute;","z-index: 99999;","}",".injectionDiv {","height: 100%;","position: relative;","overflow: hidden;","}",".blocklyNonSelectable {","user-select: none;","-moz-user-select: none;","-webkit-user-select: none;","-ms-user-select: none;","}",".blocklyWsDragSurface {","display: none;","position: absolute;","overflow: visible;","top: 0;","left: 0;","}",".blocklyBlockDragSurface {","display: none;","position: absolute;","top: 0;","left: 0;","right: 0;","bottom: 0;","overflow: visible !important;","z-index: 50;","}",".blocklyTooltipDiv {","background-color: #ffffc7;","border: 1px solid #ddc;","box-shadow: 4px 4px 20px 1px rgba(0,0,0,.15);","color: #000;","display: none;","font-family: PingFang SC, sans-serif;","font-size: 9pt;","opacity: 0.9;","padding: 2px;","position: absolute;","z-index: 100000;","}",".blocklyResizeSE {","cursor: se-resize;","fill: #aaa;","}",".blocklyResizeSW {","cursor: sw-resize;","fill: #aaa;","}",".blocklyResizeLine {","stroke: #888;","stroke-width: 1;","}",".blocklyHighlightedConnectionPath {","fill: none;","stroke: #fc3;","stroke-width: 4px;","}",".blocklyPathLight {","fill: none;","stroke-linecap: round;","stroke-width: 1;","}",".blocklySelected>.blocklyPath {","stroke: #fc3;","stroke-width: 3px;","}",".blocklySelected>.blocklyPathLight {","display: none;","}",".blocklyDraggable {",'cursor: url("<<<PATH>>>/handopen.cur"), auto;',"cursor: grab;","cursor: -webkit-grab;","cursor: -moz-grab;","}",".blocklyDragging {",'cursor: url("<<<PATH>>>/handclosed.cur"), auto;',"cursor: grabbing;","cursor: -webkit-grabbing;","cursor: -moz-grabbing;","}",".blocklyDraggable:active {",'cursor: url("<<<PATH>>>/handclosed.cur"), auto;',"cursor: grabbing;","cursor: -webkit-grabbing;","cursor: -moz-grabbing;","}",".blocklyBlockDragSurface .blocklyDraggable {",'cursor: url("<<<PATH>>>/handclosed.cur"), auto;',"cursor: grabbing;","cursor: -webkit-grabbing;","cursor: -moz-grabbing;","}",".blocklyDragging.blocklyDraggingDelete {",'cursor: url("<<<PATH>>>/handdelete.cur"), auto;',"}",".blocklyToolboxDelete {",'cursor: url("<<<PATH>>>/handdelete.cur"), auto;',"}",".blocklyDragging>.blocklyPath,",".blocklyDragging>.blocklyPathLight {","fill-opacity: .8;","stroke-opacity: .8;","}",".blocklyDragging>.blocklyPathDark {","display: none;","}",".blocklyDisabled>.blocklyPath {","fill-opacity: .5;","stroke-opacity: .5;","}",".blocklyDisabled>.blocklyPathLight,",".blocklyDisabled>.blocklyPathDark {","display: none;","}",".blocklyText {","cursor: default;","fill: #fff;","font-family: PingFang SC, sans-serif;","font-size: 11pt;","}",".blocklyNonEditableText>text {","pointer-events: none;","}",".blocklyNonEditableText>rect,",".blocklyEditableText>rect {","fill: #fff;","fill-opacity: .6;","}",".blocklyNonEditableText>text,",".blocklyEditableText>text {","fill: #000;","}",".blocklyEditableText:hover>rect {","stroke: #fff;","stroke-width: 2;","}",".blocklyBubbleText {","fill: #000;","}",".blocklyFlyout {","position: absolute;","z-index: 20;","}",".blocklyFlyoutButton {","fill: #888;","cursor: default;","}",".blocklyFlyoutButtonShadow {","fill: #666;","}",".blocklyFlyoutButton:hover {","fill: #aaa;","}",".blocklyFlyoutLabel {","cursor: default;","}",".blocklyFlyoutLabelBackground {","opacity: 0;","}",".blocklyFlyoutLabelText {","fill: #000;","}",".blocklySvg text, .blocklyBlockDragSurface text {","user-select: none;","-moz-user-select: none;","-webkit-user-select: none;","cursor: inherit;","}",".blocklyHidden {","display: none;","}",".blocklyFieldDropdown:not(.blocklyHidden) {","display: block;","}",".blocklyIconGroup {","cursor: default;","}",".blocklyIconGroup:not(:hover),",".blocklyIconGroupReadonly {","opacity: .6;","}",".blocklyIconShape {","fill: #00f;","stroke: #fff;","stroke-width: 1px;","}",".blocklyIconSymbol {","fill: #fff;","}",".blocklyMinimalBody {","margin: 0;","padding: 0;","}",".blocklyCommentTextarea {","background-color: #ffc;","border: 0;","margin: 0;","padding: 2px;","resize: none;","}",".blocklyHtmlInput {","border: none;","border-radius: 4px;","font-family: PingFang SC, sans-serif;","height: 100%;","margin: 0;","outline: none;","padding: 0 1px;","width: 100%","}",".blocklyMainBackground {","stroke-width: 1;","stroke: #c6c6c6;","}",".blocklyMutatorBackground {","fill: #fff;","stroke: #ddd;","stroke-width: 1;","}",".blocklyFlyoutBackground {","fill: #666;","fill-opacity: .8;","}",".blocklyMainWorkspaceScrollbar {","z-index: 20;","}",".blocklyFlyoutScrollbar {","z-index: 30;","}",".blocklyScrollbarHorizontal, .blocklyScrollbarVertical {","position: absolute;","outline: none;","}",".blocklyScrollbarBackground {","opacity: 0;","}",".blocklyScrollbarHandle {","fill: #ccc;","}",".blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,",".blocklyScrollbarHandle:hover {","fill: #bbb;","}",".blocklyZoom>image {","opacity: .4;","}",".blocklyZoom>image:hover {","opacity: .6;","}",".blocklyZoom>image:active {","opacity: .8;","}",".blocklyFlyout .blocklyScrollbarHandle {","fill: #bbb;","}",".blocklyFlyout .blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,",".blocklyFlyout .blocklyScrollbarHandle:hover {","fill: #aaa;","}",".blocklyInvalidInput {","background: #faa;","}",".blocklyAngleCircle {","stroke: #444;","stroke-width: 1;","fill: #ddd;","fill-opacity: .8;","}",".blocklyAngleMarks {","stroke: #444;","stroke-width: 1;","}",".blocklyAngleGauge {","fill: #f88;","fill-opacity: .8;","}",".blocklyAngleLine {","stroke: #f00;","stroke-width: 2;","stroke-linecap: round;","pointer-events: none;","}",".blocklyContextMenu {","border-radius: 4px;","}",".blocklyDropdownMenu {","padding: 0 !important;","}",".blocklyWidgetDiv .goog-option-selected .goog-menuitem-checkbox,",".blocklyWidgetDiv .goog-option-selected .goog-menuitem-icon {","background: url(<<<PATH>>>/sprites.png) no-repeat -48px -16px !important;","}",".blocklyToolboxDiv {","background-color: #272727;","overflow-x: visible;","overflow-y: auto;","position: absolute;","z-index: 70;","}",".blocklyTreeRoot {","padding: 4px 0;","}",".blocklyTreeRoot:focus {","outline: none;","}",".blocklyTreeRow {","height: 36px;","line-height: 32px;","margin-bottom: 6px;","padding-right: 8px;","border-radius: 4px;","white-space: nowrap;","}",".blocklyHorizontalTree {","float: left;","margin: 1px 5px 8px 0;","}",".blocklyHorizontalTreeRtl {","float: right;","margin: 1px 0 8px 5px;","}",'.blocklyToolboxDiv[dir="RTL"] .blocklyTreeRow {',"margin-left: 8px;","}",".blocklyTreeRow:not(.blocklyTreeSelected):hover {","background-color: #ccc;","}",".blocklyTreeSeparator {","border-bottom: solid #e5e5e5 1px;","height: 0;","margin: 5px 0;","}",".blocklyTreeSeparatorHorizontal {","border-right: solid #e5e5e5 1px;","width: 0;","padding: 5px 0;","margin: 0 5px;","}",".blocklyTreeIcon {","background-image: url(<<<PATH>>>/sprites.png);","height: 16px;","vertical-align: middle;","width: 16px;","}",".blocklyTreeIconClosedLtr {","background-position: -32px -1px;","}",".blocklyTreeIconClosedRtl {","background-position: 0px -1px;","}",".blocklyTreeIconOpen {","background-position: -16px -1px;","}",".blocklyTreeSelected>.blocklyTreeIconClosedLtr {","background-position: -32px -17px;","}",".blocklyTreeSelected>.blocklyTreeIconClosedRtl {","background-position: 0px -17px;","}",".blocklyTreeSelected>.blocklyTreeIconOpen {","background-position: -16px -17px;","}",".blocklyTreeIconNone,",".blocklyTreeSelected>.blocklyTreeIconNone {","background-position: -48px -1px;","}",".blocklyTreeLabel {","cursor: default;","font-family: PingFang SC, sans-serif;","font-size: 16px;","padding: 0 8px;","vertical-align: middle;","}",".blocklyTreeSelected .blocklyTreeLabel {","color: #fff;","}",".blocklyWidgetDiv .goog-palette {","outline: none;","cursor: default;","}",".blocklyWidgetDiv .goog-palette-table {","border: 1px solid #666;","border-collapse: collapse;","}",".blocklyWidgetDiv .goog-palette-cell {","height: 13px;","width: 15px;","margin: 0;","border: 0;","text-align: center;","vertical-align: middle;","border-right: 1px solid #666;","font-size: 1px;","}",".blocklyWidgetDiv .goog-palette-colorswatch {","position: relative;","height: 13px;","width: 15px;","border: 1px solid #666;","}",".blocklyWidgetDiv .goog-palette-cell-hover .goog-palette-colorswatch {","border: 1px solid #FFF;","}",".blocklyWidgetDiv .goog-palette-cell-selected .goog-palette-colorswatch {","border: 1px solid #000;","color: #fff;","}",".blocklyWidgetDiv .goog-menu {","background: #fff;","border-color: #ccc #666 #666 #ccc;","border-style: solid;","border-width: 1px;","cursor: default;","font: normal 13px Arial, sans-serif;","margin: 0;","outline: none;","padding: 4px 0;","position: absolute;","overflow-y: auto;","overflow-x: hidden;","max-height: 100%;","z-index: 20000;","}",".blocklyWidgetDiv .goog-menuitem {","color: #000;","font: normal 13px Arial, sans-serif;","list-style: none;","margin: 0;","padding: 4px 7em 4px 28px;","white-space: nowrap;","}",".blocklyWidgetDiv .goog-menuitem.goog-menuitem-rtl {","padding-left: 7em;","padding-right: 28px;","}",".blocklyWidgetDiv .goog-menu-nocheckbox .goog-menuitem,",".blocklyWidgetDiv .goog-menu-noicon .goog-menuitem {","padding-left: 12px;","}",".blocklyWidgetDiv .goog-menu-noaccel .goog-menuitem {","padding-right: 20px;","}",".blocklyWidgetDiv .goog-menuitem-content {","color: #000;","font: normal 13px Arial, sans-serif;","}",".blocklyWidgetDiv .goog-menuitem-disabled .goog-menuitem-accel,",".blocklyWidgetDiv .goog-menuitem-disabled .goog-menuitem-content {","color: #ccc !important;","}",".blocklyWidgetDiv .goog-menuitem-disabled .goog-menuitem-icon {","opacity: 0.3;","-moz-opacity: 0.3;","filter: alpha(opacity=30);","}",".blocklyWidgetDiv .goog-menuitem-highlight,",".blocklyWidgetDiv .goog-menuitem-hover {","background-color: #d6e9f8;","border-color: #d6e9f8;","border-style: dotted;","border-width: 1px 0;","padding-bottom: 3px;","padding-top: 3px;","}",".blocklyWidgetDiv .goog-menuitem-checkbox,",".blocklyWidgetDiv .goog-menuitem-icon {","background-repeat: no-repeat;","height: 16px;","left: 6px;","position: absolute;","right: auto;","vertical-align: middle;","width: 16px;","}",".blocklyWidgetDiv .goog-menuitem-rtl .goog-menuitem-checkbox,",".blocklyWidgetDiv .goog-menuitem-rtl .goog-menuitem-icon {","left: auto;","right: 6px;","}",".blocklyWidgetDiv .goog-option-selected .goog-menuitem-checkbox,",".blocklyWidgetDiv .goog-option-selected .goog-menuitem-icon {","background: url(//ssl.gstatic.com/editor/editortoolbar.png) no-repeat -512px 0;","}",".blocklyWidgetDiv .goog-menuitem-accel {","color: #999;","direction: ltr;","left: auto;","padding: 0 6px;","position: absolute;","right: 0;","text-align: right;","}",".blocklyWidgetDiv .goog-menuitem-rtl .goog-menuitem-accel {","left: 0;","right: auto;","text-align: left;","}",".blocklyWidgetDiv .goog-menuitem-mnemonic-hint {","text-decoration: underline;","}",".blocklyWidgetDiv .goog-menuitem-mnemonic-separator {","color: #999;","font-size: 12px;","padding-left: 4px;","}",".blocklyWidgetDiv .goog-menuseparator {","border-top: 1px solid #ccc;","margin: 4px 0;","padding: 0;","}",""],i.textContent=Blockly.Css.CONTENT.join(""),o.insertBefore(i,o.firstChild),B.blockEditor.svgBlockCanvas_.getBBox()),o=(new XMLSerializer).serializeToString(o),o='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+i.width+'" height="'+i.height+'" viewBox="'+i.x+" "+i.y+" "+i.width+" "+i.height+'"><rect width="100%" height="100%" style="fill-opacity:0"></rect>'+o+"</svg>",o="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(o))),r=new Image,l=(r.src=o,document.createElement("canvas")),n=(l.width=2*Math.ceil(i.width),l.height=2*Math.ceil(i.height),l.getContext("2d"));n.scale(2,2),r.onload=function(){n.drawImage(r,0,0);var e=Base64.toUint8Array(l.toDataURL("image/png").replace("data:image/png;base64,",""));t(e)}}),w.parseMix=(i,r=!1,l=!1,n=e=>{})=>{var a=i;let s,d,c;for(let e=0;a[e];e++)switch(a[e].nodeName){case"XML":s=$(a[e]);break;case"CONFIG":d=$(a[e]);break;case"CODE":c=$(a[e])}if(s||c){for(var u of["version","id","type","varid","name","x","y","items"]){var p=s.find("*["+u+"]");if(p.length)for(let t=0;p[t];t++){let e=$(p[t]).attr(u);try{e=e.replaceAll('\\"',"")}catch(e){console.log(e)}$(p[t]).attr(u,e)}}let e,t=d&&d.html();try{t&&(e=JSON.parse(t))}catch(e){console.log(e)}i=s.attr("board")??"";v.setSelectedBoard(i,e);let o=c?c.html():"";if(Base64.isValid(o))o=Base64.decode(o);else try{o=(o=C.unescape(o)).replace(/(_E[0-9A-F]{1}_[0-9A-F]{2}_[0-9A-F]{2})+/g,function(t){try{return decodeURIComponent(t.replace(/_/g,"%"))}catch(e){return t}})}catch(e){console.log(e)}if(r)return c?(E.items.vDrag.full("NEGATIVE"),B.codeEditor.setValue(o,-1),B.blockEditor.clear(),void n("USE_CODE")):void layer.msg(indexText["未找到有效数据"],{time:1e3});var g=a.find("block"),A=a.find("shadow"),h=(g.removeAttr("id varid"),A.removeAttr("id varid"),[]),y=[];for(let e=0;g[e];e++){var m=$(g[e]).attr("type");m&&!h.includes(m)&&h.push(m)}for(let e=0;A[e];e++){var f=$(A[e]).attr("type");f&&!h.includes(f)&&h.push(f)}var x,b=Blockly?.Python??Blockly.Arduino;for(x of h)Blockly.Blocks[x]&&b[x]||y.push(x);y.length?w.showParseMixErrorDialog(a,y,n):(B.blockEditor.clear(),Blockly.Xml.domToWorkspace(B.blockEditor,s[0]),B.blockEditor.scrollCenter(),Blockly.hideChaff(),!l&&c?(w.getCode()!==o&&(E.items.vDrag.full("NEGATIVE"),B.codeEditor.setValue(o,-1)),n()):(E.items.vDrag.full("POSITIVE"),l?n("USE_INCOMPLETE_BLOCKS"):n()))}else layer.msg(indexText["未找到有效数据"],{time:1e3})},w.removeUndefinedBlocks=(e,t)=>{for(var o of t)e.find("*[type="+o+"]").remove()},w.showParseMixErrorDialog=(i,r,l=()=>{})=>{var e=o.TEMPLATE_STR["PARSE_MIX_ERROR_DIV"],e=o.render(e,{text:r.join("<br/>"),btn1Name:indexText["取消"],btn2Name:indexText["忽略未定义块"],btn3Name:indexText["读取代码"]});n.open({title:indexText["一些图形化模块尚未定义"],id:"parse-mix-error-layer",area:["50%","250px"],max:["500px","250px"],min:["350px","100px"],shade:n.SHADE_ALL,content:e,borderRadius:"5px",success:(e,o)=>{$("#parse-mix-error-layer").css("overflow","hidden"),t.render(null,"parse-mix-error-filter"),e.find("button").click(e=>{switch(layer.close(o),$(e.currentTarget).attr("m-id")){case"0":break;case"1":for(var t of r)i.find("*[type="+t+"]").remove();w.parseMix(i,!1,!0,l);break;case"2":w.parseMix(i,!0,!1,l)}})}})},w.openFile=(e,t="text",o=()=>{})=>{var i=$("<input></input>");i.attr({id:"web-open-file",type:"file",name:"web-open-file",accept:e}),i.change(function(e){w.onclickOpenFile(this,t,e=>{o(e)})}),i.css("display","none"),$("#web-open-file").remove(),$("body").append(i),i.click()},w.onclickOpenFile=(e,t,o)=>{if(5242880<e.files[0].size)return layer.msg("所选择文件大小必须在5MB内",{time:1e3}),$("#web-open-file").remove(),o(null),!1;var i=e.files[0];if(i){const l=i.name;var r=new FileReader;switch(t){case"text":r.readAsText(i);break;case"bin":r.readAsBinaryString(i);break;case"url":r.readAsDataURL(i);break;default:r.readAsArrayBuffer(i)}r.onload=function(e){e=e.target.result;$("#web-open-file").remove(),o({data:e,filename:l})}}else o(null)}})(),(()=>{goog.provide("Mixly.StatusBarPort"),goog.require("Mixly.StatusBar"),goog.require("Mixly.Config"),goog.require("layui");const n=layui["element"],{StatusBarPort:a,Config:e,StatusBar:s}=Mixly,d=e["USER"];a.portAce={},a.portsName=[];let{portAce:c,portsName:u}=a;a.addDefaultCommand=e=>{c[e].commands.addCommands([{name:"increaseFontSize",bindKey:"Ctrl-=|Ctrl-+",exec:e=>{var t=parseInt(e.getFontSize(),10)||12;e.setFontSize(t+1)}},{name:"decreaseFontSize",bindKey:"Ctrl+-|Ctrl-_",exec:e=>{var t=parseInt(e.getFontSize(),10)||12;e.setFontSize(Math.max(t-1||1))}},{name:"resetFontSize",bindKey:"Ctrl+0|Ctrl-Numpad0",exec:e=>{e.setFontSize(12)}}])},a.tabAdd=(t,o=!0,i=e=>{},r=e=>{})=>{if(u.includes(t))a.open(t);else{let e=t;try{e=(e=e.replaceAll("/","-")).replaceAll(".","-")}catch(e){console.log(e)}var l=`<pre class="tab-ace" id="tab-${e}-ace" align="center"></pre>`;n.tabAdd("status-bar-ace",{title:t+`<span id="tab-ace-${e}-span" class="layui-badge-dot layui-bg-orange"></span>`,content:l,id:"tab-ace-"+e}),u.push(t),c[t]=ace.edit(`tab-${e}-ace`),"dark"===d.theme?c[t].setOption("theme","ace/theme/terminal"):c[t].setOption("theme","ace/theme/xcode"),c[t].getSession().setMode("ace/mode/python"),c[t].setFontSize(document.body.clientWidth/95),c[t].setReadOnly(!1),c[t].setScrollSpeed(.3),c[t].setShowPrintMargin(!1),c[t].renderer.setShowGutter(!1),o&&a.addDefaultCommand(t),"function"==typeof i&&i(t),n.on("tabDelete(status-bar-ace)",e=>{var t=u[e.index-1];c[t].destroy(),c[t].container.remove(),u.splice(e.index-1,1),delete c[t],"function"==typeof r&&r(t)}),n.on("tab(status-bar-ace)",e=>{0==e.index?s.scrollToTheBottom():a.scrollToTheBottom(u[e.index-1])})}},a.tabChange=e=>{let t=e;try{t=(t=t.replaceAll("/","-")).replaceAll(".","-")}catch(e){console.log(e)}n.tabChange("status-bar-ace","tab-ace-"+t)},a.tabDelete=e=>{let t=e;try{t=(t=t.replaceAll("/","-")).replaceAll(".","-")}catch(e){console.log(e)}n.tabDelete("status-bar-ace","tab-ace-"+t)},a.setValue=(e,t,o=!0)=>{var i,r;c[e]&&(c[e].updateSelectionMarkers(),i=c[e]["selection"],r=i.getCursor(),a.getValue(e)!==t)&&(c[e].setValue(t),o?(c[e].gotoLine(c[e].session.getLength()),i.moveCursorLineEnd()):(i.moveCursorTo(r.row,r.column,!0),i.clearSelection()))},a.getValue=e=>c[e]?c[e].getValue():"",a.getValueRange=(e,t,o)=>{return c[e]&&t&&o&&"object"==typeof t&&"object"==typeof o?c[e].getSession().getTextRange(new ace.Range(t.row,t.column,o.row,o.column)):""},a.addValue=(e,t,o=!0)=>{var i,r;c[e]&&(c[e].updateSelectionMarkers(),i=c[e]["selection"],r=i.getCursor(),c[e].gotoLine(c[e].session.getLength()),i.moveCursorLineEnd(),c[e].insert(t),o?(c[e].gotoLine(c[e].session.getLength()),i.moveCursorLineEnd()):i.moveCursorTo(r.row,r.column,!0))},a.getEndPos=e=>{var t;if(c[e])return{row:t=(e=c[e].getSession()).getLength()-1,column:e.getLine(t).length}},a.scrollToTheBottom=e=>{c[e]&&(c[e].updateSelectionMarkers(),c[e].gotoLine(c[e].session.getLength()),c[e].selection.moveCursorLineEnd())},a.scrollToTheTop=e=>{c[e]&&c[e].gotoLine(0)},a.open=e=>{let t=e;try{t=(t=t.replaceAll("/","-")).replaceAll(".","-")}catch(e){console.log(e)}e=$(`#tab-ace-${t}-span`);e&&e[0]&&(e[0].className="layui-badge-dot layui-bg-orange")},a.close=e=>{let t=e;try{t=(t=t.replaceAll("/","-")).replaceAll(".","-")}catch(e){console.log(e)}e=$(`#tab-ace-${t}-span`);e&&e[0]&&(e[0].className="layui-badge-dot layui-bg-blue")}})(),(()=>{goog.require("Blockly"),goog.require("Mixly.StatusBar"),goog.require("Mixly.StatusBarPort"),goog.require("Mixly.Editor"),goog.provide("Mixly.Theme");const{Theme:t,StatusBar:n,StatusBarPort:a,Editor:s}=Mixly;t.changeTo=function(e){var{blockEditor:t,codeEditor:o}=s;let i,r,l;if(l="dark"===e?($("#nav").removeClass("layui-bg-green").addClass("layui-bg-cyan"),$("body").removeClass("light").addClass("dark"),i=Blockly.Themes.Dark,r="ace/theme/dracula","ace/theme/terminal"):($("#nav").removeClass("layui-bg-cyan").addClass("layui-bg-green"),$("body").removeClass("dark").addClass("light"),i=Blockly.Themes.Classic,r="ace/theme/crimson_editor",Blockly.Arduino&&(r="ace/theme/xcode"),"ace/theme/xcode"),t.setTheme(i),o.setOption("theme",r),n.Ace&&n.Ace.setOption("theme",l),a?.portsName)for(let e=0,t=a.portsName.length;e<t;e++)a.portAce[a.portsName[e]].setOption("theme",l)},t.changeEditorTheme_dark=function(){$("#nav").removeClass("layui-nav layui-bg-green"),$("#nav").addClass("layui-nav layui-bg-cyan"),$("body").removeClass("light"),$("body").addClass("dark");var e="ace/theme/dracula";null!=editor&&(editor.setOption("theme",e),$("#content_arduino").css("background-color","#282a36"));try{if(null!=editor_side_code&&editor_side_code.setOption("theme",e),null!=n.Ace&&n.Ace.setOption("theme","ace/theme/terminal"),a?.portsName)for(let e=0,t=a.portsName.length;e<t;e++)a.portAce[a.portsName[e]].setOption("theme","ace/theme/terminal")}catch(e){}},window.matchMedia("(prefers-color-scheme: light)").addListener(e=>{e.matches?t.changeTo("light"):t.changeTo("dark")})})(),(()=>{goog.require("Mixly.Modules"),goog.require("Mixly.MFile"),goog.require("Mixly.StatusBar"),goog.require("Mixly.Env"),goog.require("Mixly.Electron"),goog.provide("Mixly.Electron.PythonShell");const{Electron:e,Modules:t,StatusBar:l,Env:n}=Mixly,o=e["PythonShell"];t.iconvLite=require("iconv-lite"),t.PythonShell=require("python-shell").PythonShell;var a="",s=-1,d=-1,c=-1,u={pythonPath:n.python3Path,pythonOptions:["-u"],encoding:"binary",mode:"utf-8"};let p=null;function g(e){if(e)try{return unescape(e.replace(/_([0-9a-fA-F]{3})/gm,"%$1"))}catch(e){}return e}o.run=function(){const r=o.addEvent();l.show(1),l.setValue(indexText["程序正在运行"]+"...\n");var e=(e=Mixly.MFile.getCode()).replace(/(_[0-9A-F]{2}_[0-9A-F]{2}_[0-9A-F]{2})+/g,function(e){return decodeURIComponent(e.replace(/_/g,"%"))});try{e.match(/(?<![\w+])input\(/g)&&(e=(e="import pyinput\n"+e).replace(/(?<![\w+])input\(/g,"pyinput.input("))}catch(e){console.log(e)}-1!=e.indexOf("import turtle")&&(e+="\nturtle.done()\n"),p&&p.terminate("SIGKILL"),t.fs.writeFile(n.pyFilePath,e,"utf8",function(e){if(e=g(e))layer.msg(indexText["写文件出错了，错误是："]+e,{time:1e3}),l.setValue(indexText["写文件出错了，错误是："]+e+"\n"),l.show(1);else{p=new t.PythonShell(n.pyFilePath,u);let o=t.iconvLite;var i=Number(new Date);p.childProcess.on("exit",e=>{l.Ace.getSession().selection.removeEventListener("changeCursor",r);var t=Number(new Date)-i,t=(parseInt(t/60),t+"ms");l.getValue().lastIndexOf("\n")==l.getValue().length-1?l.addValue("=="+indexText["程序运行完成"]+"("+indexText["用时"]+" "+t+")==\n"):l.addValue("\n=="+indexText["程序运行完成"]+"("+indexText["用时"]+" "+t+")==\n"),l.scrollToTheBottom(),p=null}),p.stdout.setEncoding("binary"),p.stdout.on("data",function(e){try{e=(e=g(e="darwin"===n.currentPlatform?decode(o.decode(o.encode(e,"iso-8859-1"),"utf-8")):decode(o.decode(o.encode(e,"iso-8859-1"),"gbk")))).replace(/(?<![\w+])pyinput.input\(/g,"input(")}catch(e){console.log(e)}l.addValue(e),-1!=e.lastIndexOf(">>>")&&p&&(a=e.substring(e.lastIndexOf(">>>")),s=l.Ace.session.getLength(),l.Ace.selection.moveCursorLineEnd(),d=l.Ace.selection.getCursor().row,c=l.Ace.selection.getCursor().column)}),p.stderr.setEncoding("binary"),p.stderr.on("data",function(t){console.log("stderr: "+t);try{t=t.replace(/(?<![\w+])pyinput.input\(/g,"input(")}catch(e){console.log(e)}try{"darwin"===n.currentPlatform?l.addValue(o.decode(o.encode(t,"iso-8859-1"),"utf-8")):l.addValue(o.decode(o.encode(t,"iso-8859-1"),"gbk")),t=g(t)}catch(e){t=g(t),l.addValue(t)}l.scrollToTheBottom(),p=null})}})},o.stop=function(){l.show(1),p?(p.terminate("SIGKILL"),p=null):l.addValue("\n=="+indexText["无程序在运行"]+"==\n"),l.scrollToTheBottom()},o.clearOutput=function(){l.setValue("")},o.addEvent=()=>l.Ace.getSession().selection.on("changeCursor",function(e){p&&-1!=s&&((l.Ace.selection.getCursor().row<d||l.Ace.selection.getCursor().row<=d&&l.Ace.selection.getCursor().column<=c)&&l.Ace.selection.moveCursorTo(d,c,!0),-1!=(last_row_data=l.Ace.session.getLine(s-1)).indexOf(">>>"))&&l.Ace.selection.getCursor().row==s&&0==l.Ace.selection.getCursor().column&&(-1==last_row_data.indexOf(a)?(last_row_data=(last_row_data=last_row_data.replace(">>> ","")).replace(">>>",""),p.stdin.write(escape(last_row_data.replace(">>>",""))+"\n")):p.stdin.write(escape(last_row_data.replace(a,""))+"\n"),s=-1,last_row_data="")})})(),(()=>{goog.require("layui"),goog.require("Mixly.Modules"),goog.require("Mixly.Charts"),goog.require("Mixly.StatusBar"),goog.require("Mixly.StatusBarPort"),goog.require("Mixly.Config"),goog.require("Mixly.Tools"),goog.require("Mixly.Env"),goog.require("Mixly.LayerExt"),goog.require("Mixly.XML"),goog.require("Mixly.MArray"),goog.provide("Mixly.Electron.Serial");const i=layui["laytpl"],{Electron:e,Modules:t,Charts:s,StatusBar:d,StatusBarPort:c,Config:o,Tools:u,Env:n,LayerExt:a,XML:p,MArray:l}=Mixly,g=e["Serial"],{BOARD:r,USER:A}=o,{serialport:h,child_process:y,minimist:m}=(t.serialport=require("serialport"),t.minimist=require("minimist"),t),f=h["SerialPort"],x=c["portAce"];g.TOOL_DEFAULT_CONFIG={ctrlCBtn:!1,ctrlDBtn:!1,baudRates:115200,yMax:100,yMin:0,pointNum:100,rts:!1,dtr:!1,scroll:!0,sendStr:!0,receiveStr:!0,sendWith:"\\r\\n",tabIndex:0,...r?.serial??{}},g.DEFAULT_BAUD=[9600,19200,28800,38400,57600,115200],g.DEFAULT_SEND_WITH=["\\r\\n","\\r","\\n","no"],g.PORT_SELECT={BURN:r?.burn?.portSelect??"all",UPLOAD:r?.upload?.portSelect??"all"},g.UPLOAD_RESET=r?.upload?.reset??{},g.HAS_PORT={BURN:r?.nav?.burn??!1,UPLOAD:r?.nav?.upload??!1},g.MAX_OUTPUT_LINE=500,g.REFRESH_OUTPUT_TIME=100,g.BAUDRATES=[9600,19200,28800,38400,57600,115200],g.TERMINAL_COMMAND={config:{"-d|--dtr":{help:"设置DTR, 可选值: [0, 1], 例如: config -d 1",key:"DTR"},"-r|--rts":{help:"设置RTS, 可选值: [0, 1], 例如: config -r 1",key:"RTS"},"-b|--baud":{help:"设置波特率, 可选值: ["+g.DEFAULT_BAUD.join(", ")+"], 例如: config -b "+g.DEFAULT_BAUD[0],key:"BAUD"},"-t|--rtype":{help:"设置串口接收数据的类型, 可选值: [0, 1], 例如: config -t 1",key:"RTYPE"},"-w|--swith":{help:"设置发送数据时的结尾字符串, 可选值: ["+g.DEFAULT_SEND_WITH.join(", ")+"], 例如: config -w "+g.DEFAULT_SEND_WITH[0],key:"SWITH"},"-s|--scroll":{help:"设置接收框滑动条是否一直在最下方, 可选值: [0, 1], 例如: config -s 1",key:"SCROLL"},"-h|--help":{help:"输出帮助信息, 例如: config -h",key:"HELP"},callback:"terminalConfigCallback"},port:{"-o|--open":{help:"打开当前串口, 例如: port -o",key:"OPEN"},"-c|--close":{help:"关闭当前串口, 例如: port -c",key:"CLOSE"},"-h|--help":{help:"输出帮助信息, 例如: port -h",key:"HELP"},callback:"terminalPortCallback"},send:{"-s|--str":{help:"发送字符串, 可选值: 字符串, 例如: send -s 你好Mixly",key:"STR"},"-b|--bytes":{help:"发送字节数组, 可选值: 字符串, 例如: send -b 0x01,0x02,0x03",key:"BYTES"},"-w|--with":{help:"发送数据时的结尾字符串, 可选值: ["+g.DEFAULT_SEND_WITH.join(", ")+"], 例如: send -s 你好Mixly -w \\r\\n",key:"WITH"},"-h|--help":{help:"输出帮助信息, 例如: send -h",key:"HELP"},callback:"terminalSendCallback"},exit:{callback:"terminalExitCallback"}},g.portsOperator={},g.deadPortsOperator={},g.selectedUploadPort={},g.selectedBurnPort={},g.ports=[],g.burnPorts=[],g.uploadPorts=[],g.initPorts=(l=e=>{})=>{f.list().then(t=>{var o=[];for(let e=0;e<t.length;e++){var i=t[e];"linux"===n.currentPlatform&&-1!==i.path.indexOf("ttyS")||o.push({vendorId:i.vendorId,productId:i.productId,name:i.path})}l(o)}).catch(e=>{console.log(e),y.exec("ls /dev/ttyACM* /dev/ttyUSB*",(e,t,o)=>{var i=t.split("\n"),r=[];for(let e=0;e<i.length;e++)i[e]&&r.push({vendorId:"None",productId:"None",name:i[e]});l(r)})})},g.getPorts=(t,o)=>{if("object"!=typeof t)return[];var i=[];if("string"==typeof o&&"all"===o)for(let e=0;e<t.length;e++){var r={...t[e]};"linux"!==n.currentPlatform?(r.vendorId||(r.vendorId="None"),r.productId||(r.productId="None"),i.push(r)):r.vendorId&&r.productId&&i.push(r)}else if("object"==typeof o)for(let e=0;e<t.length;e++){var l={...t[e]};for(let e=0;e<o.length;e++)if(o[e].vendorId&&o[e].productId&&l.vendorId&&l.productId&&o[e].vendorId.toLowerCase()===l.vendorId.toLowerCase()&&o[e].productId.toLowerCase()===l.productId.toLowerCase()){i.push(l);break}}return i},g.getBurnPorts=()=>g.getPorts(g.ports,g.PORT_SELECT.BURN),g.getUploadPorts=()=>g.getPorts(g.ports,g.PORT_SELECT.UPLOAD),g.refreshPorts=()=>{g.initPorts(e=>{if(!l.equals(e,g.ports)){g.ports=e,g.HAS_PORT.BURN?g.burnPorts=g.getBurnPorts():g.burnPorts=[],g.HAS_PORT.UPLOAD?g.uploadPorts=g.getUploadPorts():g.uploadPorts=[];var t,o,i=[...g.burnPorts],r=[];for(t of i)r.push(t.name);for(o of g.uploadPorts)r.includes(o.name)||i.push({...o});g.refreshPortOperator(i),g.refreshUploadPortSelectBox(i)}})},g.refreshUploadPortSelectBox=e=>{var t=layui["form"];const o=$("#ports-type"),i=o.val();o.empty(),e.map(e=>{e=e.name;i==e?o.append($(`<option value="${e}" selected>${e}</option>`)):o.append($(`<option value="${e}">${e}</option>`))}),t.render("select","ports-type-filter"),e.length?($("#mixly-footer-port-div").css("display","inline-flex"),$("#mixly-footer-port").html(g.getSelectedPortName())):($("#mixly-footer-port-div").hide(),$("#mixly-footer-port").html(""))},g.refreshToolPortSelectBox=e=>{var t,o=layui["form"];for(t in g.portsOperator){var i,r=g.portsOperator[t]["dom"];r&&(i=r.id["selectPortId"],r=r.filter["formFilter"],(i=$("#"+i)).empty(),i.append($(`<option value="${t}" selected>${t}</option>`)),o.render("select",r))}},g.refreshPortOperator=t=>{var e,o,i,r,l,n,a={...g.portsOperator},s=(g.portsOperator={},[]);for(let e=0;e<t.length;e++){var d,c=t[e];s.push(c.name),a[c.name]?g.portsOperator[c.name]=a[c.name]:g.deadPortsOperator[c.name]?(g.portsOperator[c.name]={...g.deadPortsOperator[c.name]},delete g.deadPortsOperator[c.name],g.refreshToolPortSelectBox(c.name)):(d={toolConfig:{...g.TOOL_DEFAULT_CONFIG},toolOpened:!1,portOpened:!1,vendorId:c.vendorId,productId:c.productId,dom:null,serialport:null,output:[]},g.portsOperator[c.name]=d),g.refreshTerminalMenu(c.name)}for(e in a)s.includes(e)||(i=(o=a[e])["dom"],i&&(o.toolOpened?(r=layui["form"],l=i.id["selectPortId"],n=i.filter["formFilter"],$("#"+l).empty(),r.render("select",n),g.deadPortsOperator[e]={...o}):i.destroy()),g.refreshTerminalMenu(e))},window.addEventListener("DOMContentLoaded",()=>{g.refreshPorts(),g.refreshPortsTimer=setInterval(()=>{g.refreshPorts()},1e4)}),g.getOpenedPortsName=()=>{var e,t=[];for(e in g.portsOperator)g.portsOperator[e].portOpened&&t.push(e);return t},g.getSelectedPortName=()=>{return $("#ports-type").val()},g.refreshOutputBox=t=>{var o=g.portsOperator[t];if(o){var{toolConfig:i,toolOpened:r,output:l,endPos:n}=o;for(let e=l.length;e>g.MAX_OUTPUT_LINE;e--)l.shift();let e=l.join("\n");if(r)g.receiveBoxSetValue(t,e,i.scroll);else{if(e=e.replaceAll("\r\n","\n"),n&&"object"==typeof n){r=c.getValueRange(t,{row:0,column:0},n);if(e===r)return}c.setValue(t,e,i.scroll),o.endPos=c.getEndPos(t),x[t]&&x[t].setReadOnly(!1)}}},g.openTool=()=>{var e=g.getSelectedPortName();if(e){let i=g.portsOperator[e];e=i["toolConfig"];const l=e["baudRates"];var t=e=>{i.dom||(i.dom=e),g.refreshToolPortSelectBox(g.uploadPorts);var t=e.id["selectPortId"],t=(i.toolOpened=!0,d.show(1),e.nowPort=$("#"+t+" option:selected").val(),e.prevPort=null,layui.element),o=e.filter["tabFilter"];t.tabChange(o,i.toolConfig.tabIndex),g.refreshConnectStatus(e.nowPort),g.connect(e.nowPort,l??9600)},o=e=>{try{s.chart&&s.chart.destroy(),s.chart=null}catch(e){console.log(e)}s.draw&&clearInterval(s.draw),s.addData&&clearInterval(s.addData);var t=g.portsOperator[e],o=g.deadPortsOperator[e];t?t.toolOpened=!1:o&&(o.dom.destroy(),delete g.deadPortsOperator[e]),g.refreshTerminalMenu(e)};let r=i.dom;i.dom?(r.updateTool(e),r.open(t,o)):r=a.openSerialTool(e,t,o),r.onClickSetDtr((e,t)=>{g.portsOperator[e].toolConfig.dtr=t.elem.checked,g.updateDtrAndRts(e)}),r.onClickSetRts((e,t)=>{g.portsOperator[e].toolConfig.rts=t.elem.checked,g.updateDtrAndRts(e)}),r.onClickSendType((e,t)=>{var o=r.id["sendId"],o=$("#"+o);g.portsOperator[e].toolConfig.sendStr=t.elem.checked,t.elem.checked?o.attr("placeholder",indexText["请输入内容"]):o.attr("placeholder",indexText["请输入内容"]+"  "+indexText["例如"]+":0x03,0x04")}),r.onClickSelectPort((e,t,o)=>{const i=g.portsOperator[t];e=g.portsOperator[e],i.toolConfig={...e.toolConfig},i.dom=e.dom,e.dom=null,e.toolOpened=!1,i.toolOpened=!0,e=e.serialport;e&&e.isOpen&&e.close(()=>{g.connect(t,i.toolConfig.baudRates)})}),r.onClickSelectBaud((e,t)=>{g.portsOperator[e].toolConfig.baudRates=t.elem.value,g.setBaudRate(e,t.elem.value)}),r.onClickTab((e,t)=>{g.portsOperator[e].toolConfig.tabIndex=t.index,1===t.index?(e=(t=g.portsOperator[e])["dom"],s.init(t.portOpened,e)):Mixly.Charts.destroy()}),r.onClickConnectBtn(e=>{g.portOpenOrClose(e)}),r.onClickSendBtn(e=>{g.write(e,0)}),r.onClickClearBtn(e=>{g.clearContent(e)}),r.onClickChartSendBtn(e=>{g.write(e,1)}),r.onClickCtrlCBtn(e=>{g.writeCtrlC(e)}),r.onClickCtrlDBtn(e=>{g.writeCtrlD(e)}),r.onClickScroll((e,t)=>{g.portsOperator[e].toolConfig.scroll=t.elem.checked}),r.onClickReceiveType((e,t)=>{g.portsOperator[e].toolConfig.receiveStr=t.elem.checked}),r.onClickSelectPointNum((e,t)=>{g.portsOperator[e].toolConfig.pointNum=t.elem.value}),r.onClickSelectSendWith((e,t)=>{g.portsOperator[e].toolConfig.sendWith=t.elem.value})}else layer.msg(indexText["无可用设备"]+"!",{time:1e3})},g.refreshConnectStatus=e=>{var t=g.portsOperator[e],e=g.deadPortsOperator[e];(t||e)&&({dom:t,portOpened:e}=t??e,t)&&(t=t.id["connectBtnId"],t=$("#"+t),e?(t.text(indexText["关闭"]),t.attr("class","layui-btn layui-btn-danger")):(t.text(indexText["打开"]),t.attr("class","layui-btn layui-btn-normal")))},g.receiveBoxAddValue=(e,t,o=!1)=>{t=g.receiveBoxGetValue(e)+t;g.receiveBoxSetValue(e,t,o)},g.receiveBoxSetValue=(e,t,o=!1)=>{var e=g.portsOperator[e];e&&(e=e["dom"],e)&&(e=e.id["receiveId"],(e=$("#"+e)).val(t),o)&&e.scrollTop(e[0].scrollHeight)},g.receiveBoxGetValue=e=>{var e=g.portsOperator[e];return e&&(e=e.dom,e)?(e=e.id["receiveId"],$("#"+e).val()):""},g.receiveBoxScrollToTheBottom=()=>{var e=g.portsOperator[port]["dom"];e&&(e=e.id["receiveId"],(e=$("#"+e)).scrollTop(e[0].scrollHeight))},g.receiveBoxScrollToTheTop=()=>{},g.statusBarPortAddHotKey=i=>{const r=x[i].getSession();x[i].commands.addCommands([{name:"Empty",bindKey:"Ctrl-E",exec:e=>{var t=g.portsOperator[i];t&&(t.output=[])}},{name:"Terminal",bindKey:"Ctrl-T",exec:e=>{g.statusBarPortEnterTerminal(i)}},{name:"ChangeEditor",bindKey:"Delete|Ctrl-X|Backspace",exec:e=>{var t,o=g.portsOperator[i];return!(!o||!o.portOpened)&&(o=o["endPos"],o&&"object"==typeof o?(t=r.selection.getCursor()).row<o.row||t.row===o.row&&t.column<=o.column:(x[i].setReadOnly(!0),!1))}},{name:"Enter",bindKey:"Enter",exec:e=>{var t,o=g.portsOperator[i];return o&&o.portOpened&&(o=o["endPos"],o)&&"object"==typeof o&&r.selection.getCursor().row===o.row&&(t=c.getEndPos(i),o=c.getValueRange(i,o,t),g.writeString(i,o,"\r\n")),!1}}]),r.selection.on("changeCursor",function(){var e,t=g.portsOperator[i];t&&t.portOpened&&(t=t.endPos,t)&&"object"==typeof t&&((e=r.selection.getCursor()).row<t.row||e.row===t.row&&e.column<t.column)?x[i].setReadOnly(!0):x[i].setReadOnly(!1)}),g.portsOperator[i]&&g.refreshTerminalMenu(i)},g.statusBarPortEnterTerminal=e=>{var t=g.portsOperator[e];t&&!t.toolOpened&&(g.statusBarPortRemoveCursorEvent(e),t.refreshOutputBoxTimer&&clearInterval(t.refreshOutputBoxTimer),t.refreshOutputBoxTimer=null,setTimeout(()=>{g.statusBarPortAddCursorEvent(e)},g.REFRESH_OUTPUT_TIME+100))},g.refreshTerminalMenu=i=>{const r=g.portsOperator[i];let l=i;try{l=(l=l.replaceAll("/","-")).replaceAll(".","-")}catch(e){console.log(e)}var e,t='<div style="float:left;">{{d.name}}&nbsp</div><div style="float:right;">{{d.hotKey}}</div>',o={elem:`#tab-${l}-ace`,trigger:"contextmenu",isAllowSpread:!0,id:`tab-${l}-ace-terminal`,className:"editor-dropdown-menu",click:function(e,t){var o;e.id===`tab-${l}-ace-terminal-exit`?g.statusBarPortAddCommand(i,"exit"):e.id===`tab-${l}-ace-terminal-open`?g.statusBarPortEnterTerminal(i):e.id===`tab-${l}-ace-terminal-close`?c.tabDelete(i):e.id===`tab-${l}-ace-terminal-help`?g.statusBarPortAddCommand(i,"config port send -h"):e.id===`tab-${l}-ace-fontsize-decrease`?(o=parseInt(x[i].getFontSize(),10)||12,x[i].setFontSize(Math.max(o-1||1))):e.id===`tab-${l}-ace-fontsize-increase`?(o=parseInt(x[i].getFontSize(),10)||12,x[i].setFontSize(o+1)):e.id===`tab-${l}-ace-fontsize-default`?x[i].setFontSize(12):e.id===`tab-${l}-ace-terminal-port-close`?g.statusBarPortAddCommand(i,"port -c"):e.id===`tab-${l}-ace-terminal-port-open`?g.statusBarPortAddCommand(i,"port -o"):e.id===`tab-${l}-ace-terminal-send-ctrlc`?g.statusBarPortAddCommand(i,"send -b 0x03,0x0d,0x0a -w no"):e.id===`tab-${l}-ace-terminal-send-ctrld`?g.statusBarPortAddCommand(i,"send -b 0x03,0x04 -w no"):e.id===`tab-${l}-ace-terminal-send-str`?g.statusBarPortAddCommand(i,"send -w \\r\\n -s ",!1):e.id===`tab-${l}-tool-close`?r.dom.close():e.id===`tab-${l}-ace-close`?c.tabDelete(i):e.id===`tab-${l}-ace-empty`?r.output=[]:e.id===`tab-${l}-serial-send-ctrlc`?g.writeCtrlC(i):e.id===`tab-${l}-serial-send-ctrld`&&g.writeCtrlD(i)}};r?r&&r.toolOpened?o.data=[{title:indexText["关闭串口工具"],id:`tab-${l}-tool-close`}]:(e=r["toolConfig"],e={portOpend:{terminalOpend:[{title:p.render(t,{name:indexText["关闭串口"],hotKey:"port -c"}),id:`tab-${l}-ace-terminal-port-close`},e.ctrlCBtn?{title:p.render(t,{name:indexText["中断"],hotKey:""}),id:`tab-${l}-ace-terminal-send-ctrlc`}:{},e.ctrlDBtn?{title:p.render(t,{name:indexText["复位"],hotKey:""}),id:`tab-${l}-ace-terminal-send-ctrld`}:{},{title:p.render(t,{name:indexText["发送字符串"],hotKey:""}),id:`tab-${l}-ace-terminal-send-str`},{title:p.render(t,{name:indexText["帮助"],hotKey:""}),id:`tab-${l}-ace-terminal-help`},{type:"-"},{title:p.render(t,{name:indexText["退出串口终端"],hotKey:"exit"}),id:`tab-${l}-ace-terminal-exit`}],terminalClosed:[{title:p.render(t,{name:indexText["清空"],hotKey:"Ctrl+E"}),id:`tab-${l}-ace-empty`},{type:"-"},{title:p.render(t,{name:indexText["增大字号"],hotKey:"Ctrl+="}),id:`tab-${l}-ace-fontsize-increase`},{title:p.render(t,{name:indexText["减小字号"],hotKey:"Ctrl+-"}),id:`tab-${l}-ace-fontsize-decrease`},{title:p.render(t,{name:indexText["默认字号"],hotKey:"Ctrl+0"}),id:`tab-${l}-ace-fontsize-default`},{type:"-"},e.ctrlCBtn?{title:p.render(t,{name:indexText["中断"],hotKey:""}),id:`tab-${l}-serial-send-ctrlc`}:{},e.ctrlDBtn?{title:p.render(t,{name:indexText["复位"],hotKey:""}),id:`tab-${l}-serial-send-ctrld`}:{},{title:p.render(t,{name:indexText["打开串口终端"],hotKey:"Ctrl+T"}),id:`tab-${l}-ace-terminal-open`}]},portClosed:{terminalOpend:[{title:p.render(t,{name:indexText["打开串口"],hotKey:"port -o"}),id:`tab-${l}-ace-terminal-port-open`},{title:p.render(t,{name:indexText["帮助"],hotKey:""}),id:`tab-${l}-ace-terminal-help`},{type:"-"},{title:p.render(t,{name:indexText["退出串口终端"],hotKey:"exit"}),id:`tab-${l}-ace-terminal-exit`}],terminalClosed:[{title:p.render(t,{name:indexText["清空"],hotKey:"Ctrl+E"}),id:`tab-${l}-ace-empty`},{type:"-"},{title:p.render(t,{name:indexText["增大字号"],hotKey:"Ctrl+="}),id:`tab-${l}-ace-fontsize-increase`},{title:p.render(t,{name:indexText["减小字号"],hotKey:"Ctrl+-"}),id:`tab-${l}-ace-fontsize-decrease`},{title:p.render(t,{name:indexText["默认字号"],hotKey:"Ctrl+0"}),id:`tab-${l}-ace-fontsize-default`},{type:"-"},{title:p.render(t,{name:indexText["打开串口终端"],hotKey:"Ctrl+T"}),id:`tab-${l}-ace-terminal-open`}]}},o.data=e[r.portOpened?"portOpend":"portClosed"][r.terminalOpend?"terminalOpend":"terminalClosed"]):o.data=[{title:indexText["关闭串口输出框"],id:`tab-${l}-ace-close`}],layui.dropdown.render(o)},g.statusBarPortAddCursorEvent=o=>{const i=g.portsOperator[o];""===i.output[i.output.length-1]?g.outputBoxAdd(o,">>>",!1):g.outputBoxAdd(o,">>>",!0),g.refreshOutputBox(o),i.terminalOpend=!0,g.refreshTerminalMenu(o);var e=x[o];const r=e["selection"],l=e.getSession(),n=l.getLength(),a=(e.gotoLine(n),r.moveCursorLineEnd(),r.getCursor());i.cursorCallback=l.selection.on("changeCursor",function(e){if(i.terminalOpend){var t=r.getCursor();(t.row<a.row||t.row===a.row&&t.column<=a.column)&&r.moveCursorTo(a.row,a.column,!0);let e=l.getLine(t.row-1);-1!==e.indexOf(">>>")&&t.row===a.row+1&&0===t.column?(e=e.replace(">>>",""),g.outputBoxAdd(o,e),g.handleCommand(o,e),g.statusBarPortRemoveCursorEvent(o)):l.getLength()!==n&&g.statusBarPortRemoveCursorEvent(o)}})},g.statusBarPortRemoveCursorEvent=e=>{var t=x[e],o=g.portsOperator[e];o&&t&&(t=t.getSession(),o.cursorCallback)&&(t.selection.removeEventListener("changeCursor",o.cursorCallback),g.refreshOutputBox(e),o.terminalOpend=!1,g.refreshTerminalMenu(e),o.portOpened)&&!o.refreshOutputBoxTimer&&(o.refreshOutputBoxTimer=setInterval(()=>{g.refreshOutputBox(e)},g.REFRESH_OUTPUT_TIME))},g.outputBoxAdd=(e,t,o=!1)=>{e=g.portsOperator[e];o&&e.output.push(""),e.output[e.output.length-1]+=t},g.handleCommand=(e,t)=>{g.portsOperator[e];var t=t.split(" "),o=m(t);if(1<=o._.length)for(var i of o._){var r;Object.keys(g.TERMINAL_COMMAND).includes(i)?(r=g.TERMINAL_COMMAND[i].callback,g[r]&&g[r](e,o)):(g.outputBoxAdd(e,i+"为无效指令",!0),g.outputBoxAdd(e,"",!0))}else g.outputBoxAdd(e,"无可用指令",!0),g.outputBoxAdd(e,"",!0)},g.parseOptions=(e,t)=>{var o,i=[],r=[],l=[];for(o in t){var n=o.split("|"),a=t[o]?.key;if(2===n.length&&a&&(-1!==n[0].indexOf("-")&&-1!==n[1].indexOf("-"))){l.push(a);for(var s of n)(2===s.length?i:r).push(s)}}var d,c=[i,r,l],u={};for(d in e)option=e[d],c[0].includes("-"+d)?(u[c[2][c[0].indexOf("-"+d)]]=option,c[1][d]=null):c[1].includes("--"+d)&&(u[c[2][c[1].indexOf("--"+d)]]=option);return u},g.terminalAddHelpInfo=(e,t,o)=>{var i,r;this.getSpace=e=>{return new Array(e).fill(" ").join("")},g.outputBoxAdd(e,t+"指令可用选项如下：",!0);let l=0;for(i of Object.keys(o))i.length>l&&(l=i.length);for(r in o)if("callback"!==r)try{g.outputBoxAdd(e,r+this.getSpace(l-r.length)+"    "+(o[r].help??""),!0)}catch(e){console.log(e)}g.outputBoxAdd(e,"",!0)},g.terminalConfigCallback=(e,t)=>{var o=g.portsOperator[e],i=o["toolConfig"];o&&(o=g.TERMINAL_COMMAND.config,(t=g.parseOptions(t,o)).HELP?g.terminalAddHelpInfo(e,"config",o):(g.outputBoxAdd(e,"获取指令"+JSON.stringify(t),!0),g.outputBoxAdd(e,"",!0),i.dtr=t.DTR??i.dtr,i.rts=t.RTS??i.rts,i.scroll=t.SCROLL??i.scroll,i.baudRates=t.BAUD&&g.DEFAULT_BAUD.includes(t.BAUD)?t.BAUD:i.baudRates,i.receiveStr=t.RTYPE??i.receiveStr,i.sendWith=t.SWITH&&g.DEFAULT_SEND_WITH.includes(t.SWITH)?t.SWITH:i.sendWith,g.setDtrAndRts(e,i.dtr,i.rts),g.setBaudRate(e,i.baudRates)))},g.terminalPortCallback=(e,t)=>{var o,i=g.portsOperator[e],{}=i;i&&(o=g.TERMINAL_COMMAND.port,(t=g.parseOptions(t,o)).HELP?g.terminalAddHelpInfo(e,"port",o):(g.outputBoxAdd(e,"获取指令"+JSON.stringify(t),!0),g.outputBoxAdd(e,"",!0),t.OPEN?i.portOpened||g.connect(e,i.toolConfig.baudRates):t.CLOSE?i.portOpened&&g.portClose(e):(g.outputBoxAdd(e,"无效指令",!1),g.outputBoxAdd(e,"",!0))))},g.terminalSendCallback=(t,o)=>{var e=g.portsOperator[t],i=e["toolConfig"];if(e){var r=g.TERMINAL_COMMAND.send,o=g.parseOptions(o,r);if(o.HELP)g.terminalAddHelpInfo(t,"send",r);else if(g.outputBoxAdd(t,"获取指令"+JSON.stringify(o),!0),g.outputBoxAdd(t,"",!0),e.portOpened){let e=i.sendWith??"\\r\\n";o.WITH&&g.DEFAULT_SEND_WITH.includes(o.WITH)&&(e=o.WITH),o.STR?g.writeString(t,o.STR,e):o.BYTES?g.writeByteArr(t,o.BYTES,e):(g.outputBoxAdd(t,"无效指令",!1),g.outputBoxAdd(t,"",!0))}else g.outputBoxAdd(t,"串口已关闭，无法发送数据！",!1),g.outputBoxAdd(t,"",!0)}},g.terminalExitCallback=(e,t)=>{g.portsOperator[e]&&g.outputBoxAdd(e,"",!0)},g.statusBarPortAddCommand=(e,t,o=!0)=>{c.addValue(e,t+(o?"\n":""),!0),o&&g.refreshOutputBox(e)},g.connect=function(l=null,e=null,t=e=>{}){if(l){c.tabChange(l);const a=g.portsOperator[l];var n=a["toolConfig"],{}=(e=e||(n.baudRates??9600),a);if(a.serialport&&(a.serialport.isOpen||a.serialport.opening))return a.serialport.path===l?void 0:void a.serialport.close();a.serialport=new f({path:l,baudRate:+e,dataBits:8,parity:"none",stopBits:1,flowControl:!1,autoOpen:!1},!1);n=h.ReadlineParser,e=h.ByteLengthParser;let o=[],i="",r=0;n=new n,e=a.serialport.pipe(new e({length:1}));a.serialport.pipe(n),a.refreshOutputBoxTimer=null,a.serialport.open(function(e){c.tabAdd(l,!0,e=>{g.$menu[0].hide(),g.statusBarPortAddHotKey(e)},e=>{var t=g.portsOperator[e];t&&t.serialport&&t.serialport.isOpen&&(t.serialport.close(),c.tabChange("output"),d.getValue().lastIndexOf("\n")!=d.getValue().length-1?d.addValue("\n"+indexText["已关闭串口"]+e+"\n"):d.addValue(indexText["已关闭串口"]+e+"\n"))}),c.tabChange(l),e?(c.close(l),console.log("failed to open: "+e),c.setValue(l,e+"\n",!0),g.receiveBoxAddValue(l,e+"\n",!0),a.serialport=null,g.refreshConnectStatus(l),a.portOpened=!1,t(0)):(t(1),a.portOpened=!0,g.refreshTerminalMenu(l),g.refreshConnectStatus(l),c.setValue(l,indexText["已打开串口"]+": "+l+"\n",!0),g.receiveBoxSetValue(l,indexText["已打开串口"]+": "+l+"\n",!0),a.output.push(""),g.outputBoxAdd(l,indexText["已打开串口"]+": "+l),a.output.push(""),a.refreshOutputBoxTimer=setInterval(()=>{g.refreshOutputBox(l)},g.REFRESH_OUTPUT_TIME))}),e.on("data",function(t){if(a.refreshOutputBoxTimer)if(a.toolConfig&&!a.toolConfig.receiveStr)if(10===t[0])g.outputBoxAdd(l,"0x0A",!1),g.outputBoxAdd(l,"",!0);else{let e=t[0].toString(16).toUpperCase();1===e.length&&(e="0"+e),g.outputBoxAdd(l,"0x"+e+" ",!1)}else if(0==(128&t[0]))if(o=[],""!==i)try{var e=String.fromCharCode(t[0]).match(/[\w|\\]/g);e&&0<e.length?i+=t:(g.outputBoxAdd(l,u.messageDecode(i)),g.outputBoxAdd(l,String.fromCharCode(t[0])),i="")}catch(e){console.log(e),g.outputBoxAdd(l,u.messageDecode(i)),g.outputBoxAdd(l,t[0]),i=""}else 10===t[0]?a.output.push(""):[92,95].includes(t[0])?i=String.fromCharCode(t[0]):g.outputBoxAdd(l,t);else if(128==(192&t[0]))o.push(t[0]),o.length>=r&&(g.outputBoxAdd(l,Buffer.from(o)),o=[]);else{switch(224&t[0]){case 252:r=6;break;case 248:r=5;break;case 240:r=4;break;case 224:r=3;break;default:r=2}o.push(t[0])}}),n.on("data",function(e){s.addData(e),a&&"function"==typeof a.userOnData&&a.userOnData(e)}),a.serialport.on("error",function(e){c.tabChange("output"),g.showErrorData(l,a.toolOpened,e)}),a.serialport.on("open",async()=>{await g.reset(l),g.updateDtrAndRts(l)}),a.serialport.on("close",()=>{a.portOpened=!1,c.close(l),g.refreshConnectStatus(l),g.refreshTerminalMenu(l),a.refreshOutputBoxTimer&&clearInterval(a.refreshOutputBoxTimer),a.refreshOutputBoxTimer=null,s.stopRefresh();var e=g.receiveBoxGetValue(l);e&&e.lastIndexOf("\n")!=e.length-1?g.receiveBoxAddValue(l,"\n"+indexText["已关闭串口"]+": "+l+"\n",!0):g.receiveBoxAddValue(l,indexText["已关闭串口"]+": "+l+"\n",!0),c.getValue(l).lastIndexOf("\n")!=c.getValue(l).length-1?c.addValue(l,"\n"+indexText["已关闭串口"]+": "+l+"\n",!0):c.addValue(l,indexText["已关闭串口"]+": "+l+"\n",!0),a.serialport=null,a.output=[]})}},g.portOpenOrClose=function(e){var t,o=g.portsOperator[e];o&&(t=o["toolConfig"],(o=o.serialport)&&(o.isOpen||o.opening)?o.close():(g.connect(e,t.baudRates),d.show(1)))},g.portClose=(e,t=()=>{})=>{var o,e=g.portsOperator[e];e&&(o=e.serialport,e.portOpened)?o.close(t):t()},g.showErrorData=function(e,t,o){var{toolOpened:i,toolConfig:r}=g.portsOperator[e];r.receiveStr||(o=(o=u.uint8ArrayToStr(u.strToByte(o))).replace(/^\s*/,""),o+="\n"),i?g.receiveBoxAddValue(e,o,r.scroll):c.addValue(e,o,!0)},g.writeByteArr=function(e,t,o){e=g.portsOperator[e].serialport;let i="";for(var r=(i="string"!=typeof t?t.toString():t).trim().split(/,+/),l=[],n=0;n<r.length;n++)isNaN(r[n])?l=[...l,...u.strToByte(r[n])]:(r[n]=r[n].toLowerCase(),2<r[n].length&&"0o"===r[n].substring(0,2)?l.push(parseInt(r[n].substring(2),8)):l.push(parseInt(+r[n],10)));e.write(l),(o="no"==(o=(o=o.replace("\\r","\r")).replace("\\n","\n"))?"":o)&&e.write(o)},g.writeString=function(e,t,o){e=g.portsOperator[e].serialport;e&&("no"===(o=(o=o.replace("\\r","\r")).replace("\\n","\n"))&&(o=""),t)&&e.write(t+o)},g.write=function(t,o=0){var i=g.portsOperator[t],r=i["dom"];if(i.serialport){var{sendId:i,sendWithId:r,sendTypeId:l,chartSendId:n}=r.id,i=$("#"+i),n=$("#"+n);let e="";(o?(e=n.val(),n):(e=i.val(),i)).val("");o=$("#"+r+" option:selected").val();0==$("#"+l)[0].checked?g.writeByteArr(t,e,o):g.writeString(t,e,o)}},g.writeCtrlC=function(e){e=g.portsOperator[e].serialport;e&&e.write([3,13,10])},g.writeCtrlD=function(e){e=g.portsOperator[e].serialport;e&&e.write([3,4])},g.clearContent=function(e){g.receiveBoxSetValue(e,"");e=g.portsOperator[e];e&&(e.output=[])},g.updateDtrAndRts=function(e){var e=g.portsOperator[e],t=e["toolConfig"],e=e.serialport;e&&e.isOpen&&e.set({dtr:t.dtr,rts:t.rts})},g.reset=async function(e){var t=g.UPLOAD_RESET;if("object"==typeof t)for(var o,i,r=t.length,l=0;l<r;l++)void 0!==t[l].dtr||void 0!==t[l].rts?(o=i=!1,t[l]?.dtr&&(i=!0),t[l]?.rts&&(o=!0),await g.setDtrAndRts(e,i,o)):t[l]?.sleep&&(i=parseInt(t[l].sleep)||100,await g.sleep(i))},g.setDtrAndRts=function(i,r,l){return new Promise((t,e)=>{const o=g.portsOperator[i].serialport;console.log("dtr:"+r,"rts:"+l),o.set({brk:!1,cts:!1,dsr:!1,dtr:r,rts:l},e=>{e&&o&&o.isOpen&&o.close(),t()})})},g.setBaudRate=(e,t)=>{e=g.portsOperator[e].serialport;e&&e.isOpen&&e.update({baudRate:+t},e=>{})},g.sleep=async function(t){return new Promise(e=>setTimeout(e,t))},g.getMenu=e=>{var t,o=[];for(t of e)c.portsName.includes(t.name)||o.push(t.name);return o},g.addBtnToStatusBar=()=>{var e=`
    <button type="button" id="tab-ace-add-btn" class="layui-btn${"dark"===A.theme?" layui-btn-normal":""} layui-btn-xs m-btn" style="
        display: inline-flex;
        justify-content: center;
        align-items: center;
    ">
        <i class="layui-icon layui-icon-addition"></i>
    </button>`;$("#tab-ace-output").after(e);const o=`
    <div class="scrollbar1" style="width: 100%; height: 100%;">
        <div style="max-height: 100px; overflow-x: hidden; overflow-y: auto; padding: 0 2px;">
            {{#  layui.each(d.list, function(index, item){ }}
                <li class="tab-ace-port-add-btn m-btn" value="{{ item }}" lay-unselect style="
                    display: block;
                    padding: 0 3px;
                ">{{ item }}</li>
            {{#  }); }}
            {{#  if(d.list.length === 0){ }}
                ${indexText["无可用串口"]}
            {{#  } }}
        </div>
    </div>`;g.$menu=tippy("#tab-ace-add-btn",{allowHTML:!0,content:"",trigger:"click",interactive:!0,maxWidth:"none",offset:[0,6],onMount(e){var t=i(o).render({list:g.getMenu(g.uploadPorts)});e.setContent(t),$(".tab-ace-port-add-btn").off().click(e=>{var e=$(e.currentTarget).attr("value"),t=g.portsOperator[e];g.connect(e,t.toolConfig.baudRates),g.$menu[0].hide(500)})}}),$(window).on("resize",()=>{g.$menu[0].hide()})}})(),(()=>{goog.require("Mixly.StatusBar"),goog.require("Mixly.Web.Utilities"),goog.require("Mixly.Web.SerialPort"),goog.provide("Mixly.Web.Esptool");const{StatusBar:p,Web:e}=Mixly,{SerialPort:a,Esptool:t}=e;const i=toByteArray(" UUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUU"),s=33382,c=12882,u=12883,g=12995;const A=3e3,r={ESP8266:{chipId:s,chipName:"ESP8266EX",magicVal:[4293968129],baseFuseAddr:1072693328,macFuseAddr:1072693328,stubFile:"esp8266",spiRegBase:1610613248,spiUsrOffs:28,spiUsr1Offs:32,spiUsr2Offs:36,spiMosiDlenOffs:null,spiMisoDlenOffs:null,spiW0Offs:64},ESP32:{chipId:50,chipName:"ESP32",magicVal:[15736195],baseFuseAddr:1073061888,macFuseAddr:1073061888,stubFile:"esp32",spiRegBase:1072963584,spiUsrOffs:28,spiUsr1Offs:32,spiUsr2Offs:36,spiMosiDlenOffs:40,spiMisoDlenOffs:44,spiW0Offs:128},ESP32S2:{chipId:c,chipName:"ESP32-S2",magicVal:[1990],baseFuseAddr:1061265408,macFuseAddr:1061265476,stubFile:"esp32s2",spiRegBase:1061167104,spiUsrOffs:24,spiUsr1Offs:28,spiUsr2Offs:32,spiMosiDlenOffs:36,spiMisoDlenOffs:40,spiW0Offs:88},ESP32S3:{chipId:u,chipName:"ESP32-S3",magicVal:[9],baseFuseAddr:1610641408,macFuseAddr:1610641476,stubFile:"esp32s3",spiRegBase:1610620928,spiUsrOffs:24,spiUsr1Offs:28,spiUsr2Offs:32,spiMosiDlenOffs:36,spiMisoDlenOffs:40,spiW0Offs:88},ESP32C3:{chipId:g,chipName:"ESP32-C3",magicVal:[1763790959,456216687],baseFuseAddr:1610647552,macFuseAddr:1610647620,stubFile:"esp32c3",spiRegBase:1610620928,spiUsrOffs:24,spiUsr1Offs:28,spiUsr2Offs:32,spiMosiDlenOffs:36,spiMisoDlenOffs:40,spiW0Offs:88}},l={esp8266:{text:"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",text_start:1074847744,entry:1074847748,data:"CIH+PwUFBAACAwcAAwMLAFHnEECH5xBAtecQQFToEEAF9xBAuugQQBDpEEBc6RBABfcQQCLqEECf6hBAYOsQQAX3EEAF9xBA+OsQQAX3EEDX7hBAn+8QQNjvEEAF9xBABfcQQHXwEEAF9xBAW/EQQAHyEEBA8xBA//MQQND0EEAF9xBABfcQQAX3EEAF9xBA/vUQQAX3EED09hBAL+0QQCfoEEBC9RBAS+oQQJjpEEAF9xBAiPYQQM/2EEAF9xBABfcQQAX3EEAF9xBABfcQQAX3EEAF9xBABfcQQMDpEED/6RBAWvUQQAEAAAACAAAAAwAAAAQAAAAFAAAABwAAAAkAAAANAAAAEQAAABkAAAAhAAAAMQAAAEEAAABhAAAAgQAAAMEAAAABAQAAgQEAAAECAAABAwAAAQQAAAEGAAABCAAAAQwAAAEQAAABGAAAASAAAAEwAAABQAAAAWAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAUAAAAGAAAABgAAAAcAAAAHAAAACAAAAAgAAAAJAAAACQAAAAoAAAAKAAAACwAAAAsAAAAMAAAADAAAAA0AAAANAAAAAAAAAAAAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAANAAAADwAAABEAAAATAAAAFwAAABsAAAAfAAAAIwAAACsAAAAzAAAAOwAAAEMAAABTAAAAYwAAAHMAAACDAAAAowAAAMMAAADjAAAAAgEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAgAAAAMAAAADAAAAAwAAAAMAAAAEAAAABAAAAAQAAAAEAAAABQAAAAUAAAAFAAAABQAAAAAAAAAAAAAAAAAAABAREgAIBwkGCgULBAwDDQIOAQ8AAQEAAAEAAAAEAAAA",data_start:1073720488},esp32:{text:"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",text_start:1074520064,entry:1074521496,data:"CMD8Pw==",data_start:1073605544},esp32s2:{text:"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",text_start:1073905664,entry:1073907516,data:"CAD9Pw==",data_start:1073622004},esp32c3:{text:"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",text_start:1077411840,entry:1077413488,data:"DEDIPw==",data_start:1070164904}};class o{constructor(e){this.encoder=new TextEncoder,this.decoder=new TextDecoder,this._chipfamily=null,this.readTimeout=3e3,this._efuses=new Array(4).fill(0),this._flashsize=4194304,this.isFunction(e.updateProgress)?this.updateProgress=e.updateProgress:this.updateProgress=null,this.isFunction(e.logMsg)?this.logMsg=e.logMsg:this.logMsg=console.log,this.debug=!1,this.isFunction(e.debugMsg)?(!1!==e.debug&&(this.debug=!0),this._debugMsg=e.debugMsg):this._debugMsg=this.logMsg(),this.IS_STUB=!1,this.syncStubDetected=!1}isFunction(e){return e&&"[object Function]"==={}.toString.call(e)}toHex(e,t=2){return"0x"+e.toString(16).toUpperCase().padStart(t,"0")}getChromeVersion(){var e=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);return!!e&&parseInt(e[2],10)}slipEncode(e){let t=[192];for(var o of e)219==o?t=t.concat([219,221]):192==o?t=t.concat([219,220]):t.push(o);return t.push(192),t}macAddr(){var e=new Array(6).fill(0),t=this._efuses[0],o=this._efuses[1],i=this._efuses[2],r=this._efuses[3];let l;if(this._chipfamily==s){if(0!=r)l=[r>>16&255,r>>8&255,255&r];else if(0==(o>>16&255))l=[24,254,52];else{if(1!=(o>>16&255))throw"Couldnt determine OUI";l=[172,208,116]}e[0]=l[0],e[1]=l[1],e[2]=l[2],e[3]=o>>8&255,e[4]=255&o,e[5]=t>>24&255}else if(50==this._chipfamily)e[0]=i>>8&255,e[1]=255&i,e[2]=o>>24&255,e[3]=o>>16&255,e[4]=o>>8&255,e[5]=255&o;else{if(![c,u,g].includes(this._chipfamily))throw"Unknown chip family";e[0]=o>>8&255,e[1]=255&o,e[2]=t>>24&255,e[3]=t>>16&255,e[4]=t>>8&255,e[5]=255&t}return e}debugMsg(e,...t){this.debug&&this._debugMsg(e,...t)}async _readEfuses(){var e=await this.chipType(),t=this.getChipInfo(e);for(let e=0;e<4;e++)this._efuses[e]=await this.readRegister(t.macFuseAddr+4*e)}async readRegister(e){this.debug&&this.debugMsg(1,"Reading from Register "+this.toHex(e,8));var e=struct.pack("<I",e),[e,,]=(await this.command(10,e),await this.getResponse(10));return e}async writeRegister(e,t,o=4294967295,i=0,r=0){this.debug&&this.debugMsg(1,"Writing to Register "+this.toHex(e,8));let l=struct.pack("<IIII",e,t,o,i);return 0<r&&(l=l.concat(struct.pack("<IIII",1610612856,0,0,r))),await this.checkCommand(9,l)}sleep(t){return new Promise(e=>setTimeout(e,t))}async chipType(){return null===this._chipfamily&&(this._chipfamily=await this.detectChip()),this._chipfamily}getChipInfo(e){for(var[t,o]of Object.entries(r))if(o.chipId==e)return o;throw"Chip Id is not Supported"}async detectChip(){var e,t,o=await this.readRegister(1073745920);for([e,t]of Object.entries(r))if(t.magicVal.includes(o))return t.chipId;throw"Unable to detect Chip"}async chipName(){var e=await this.chipType(),t=this.getChipInfo(e);return await this._readEfuses(),e==s&&(16&this._efuses[0]||65536&this._efuses[2])?"ESP8285":t.chipName}async checkCommand(e,t,o=0,i=A){i=Math.min(i,24e4),await this.command(e,t,o);let[r,l]=await this.getResponse(e,i),n;if(null!==l&&(this.IS_STUB||this._chipfamily==s?n=2:[50,c,u,g].includes(this._chipfamily)?n=4:[2,4].includes(l.length)&&(n=l.length)),null===l||l.length<n)throw"Didn't get enough status bytes";t=l.slice(-n,l.length);if(l=l.slice(0,-n),this.debug&&(this.debugMsg(1,"status",t),this.debugMsg(1,"value",r),this.debugMsg(1,"data",l)),1==t[0])throw 5==t[1]?"Invalid (unsupported) command "+this.toHex(e):"Command failure error code "+this.toHex(t[1]);return 0<l.length?l:r}timeoutPerMb(e,t){e=Math.floor(e*(t/486));return e<A?A:e}async command(e,t,o=0){let i=struct.pack("<BBHI",0,e,t.length,o);i=i.concat(t),i=this.slipEncode(i),this.debugMsg(2,"Writing "+i.length+" byte"+(1==i.length?"":"s")+":",i),await a.writeByteArr(i)}async reset(){await a.obj.getSignals();this.logMsg("尝试复位"),Mixly.StatusBar.addValue(indexText["尝试复位"]+"\n",!0),await a.obj.setSignals({dataTerminalReady:!1,requestToSend:!0}),await a.obj.setSignals({dataTerminalReady:!0,requestToSend:!1}),await this.sleep(1e3)}hexFormatter(e){return"["+e.map(e=>this.toHex(e)).join(", ")+"]"}async readPacket(){let e=null,t=!1;var o=[];for(this.debugMsg(2,"Read Timeout",this.readTimeout);;){for(var i,r,l=Date.now(),o=[];Date.now()-l<this.readTimeout;){if(0<a.inputBuffer.length){o.push(a.inputBuffer.shift());break}await this.sleep(10)}if(0==o.length)throw i=null===e?"header":"content",this.debugMsg(1,"Timed out waiting for packet "+i),console.error("Timed out waiting for packet "+i),new n("Timed out waiting for packet "+i);this.debugMsg(2,"Read "+o.length+" bytes: "+this.hexFormatter(o));for(r of o)if(null===e){if(192!=r)throw this.debugMsg(1,"Read invalid data: "+this.hexFormatter(o)),this.debugMsg(1,"Remaining data in serial buffer: "+this.hexFormatter(a.inputBuffer)),new n("Invalid head of packet ("+this.toHex(r)+")");e=[]}else if(t)if(t=!1,220==r)e.push(192);else{if(221!=r)throw this.debugMsg(1,"Read invalid data: "+this.hexFormatter(o)),this.debugMsg(1,"Remaining data in serial buffer: "+this.hexFormatter(a.inputBuffer)),new n("Invalid SLIP escape (0xdb, "+this.toHex(r)+")");e.push(219)}else if(219==r)t=!0;else{if(192==r)return this.debugMsg(2,"Received full packet: "+this.hexFormatter(e)),e;e.push(r)}}return""}async getResponse(t,e=A){this.readTimeout=e;let o;var i,r,l,n;for(let e=0;e<100;e++){try{o=await this.readPacket()}catch(e){return this.debugMsg(1,"Timed out after "+this.readTimeout+" milliseconds"),[null,null]}if(!(o.length<8)&&([n,i,r,l]=struct.unpack("<BBHI",o.slice(0,8)),1==n)){if(n=o.slice(8),null==t||i==t)return[l,n];if(0!=n[0]&&5==n[1])throw a.inputBuffer=[],"Invalid (unsupported) command "+this.toHex(t)}}throw"Response doesn't match request"}async readBuffer(e=A){this.readTimeout=e;let t;try{t=await this.readPacket()}catch(e){return this.debugMsg(1,"Timed out after "+this.readTimeout+" milliseconds"),null}return t}checksum(e,t=239){for(var o of e)t^=o;return t}setPortBaudRate(e){this.getChromeVersion()<86?port.baudrate=e:port.baudRate=e}getPortBaudRate(){return this.getChromeVersion()<86?port.baudrate:port.baudRate}async setBaudrate(t){if(this._chipfamily==s)this.logMsg("Baud rate can only change on ESP32 and ESP32-S2"),p.addValue(indexText["只能在ESP32和ESP32-S2上修改波特率"]+"\n");else{this.logMsg("Attempting to change baud rate to "+t+"..."),p.addValue(indexText["尝试修改波特率为"]+t+"\n");try{var e=this.IS_STUB?this.getPortBaudRate():0,o=struct.pack("<II",t,e);await this.checkCommand(15,o),this.setPortBaudRate(t),await this.sleep(50),this.logMsg("Changed baud rate to "+t),p.addValue(indexText["已修改波特率为"]+t+"\n")}catch(e){throw"Unable to change the baud rate, please try setting the connection speed from "+t+" to 115200 and reconnecting."}}}async sync(){this.logMsg("Performing sync...");for(let e=0;e<5;e++){if(a.inputBuffer=[],await this._sync())return await this.sleep(100),this.logMsg("Successfully synced."),!0;await this.sleep(100)}throw"Couldn't sync to ESP. Try resetting."}async _sync(){await this.command(8,i);var[e,,]=await this.getResponse(8,100);this.syncStubDetected=0===e?1:0;for(let e=0;e<8;e++){var[t,o]=await this.getResponse(8,100);if(this.syncStubDetected&=0===t?1:0,null!==o&&(1<o.length&&0==o[0]&&0==o[1]))return!0}return!1}getFlashWriteSize(){return 1024}async flashData(e,t=0,o=0){var i=e.byteLength,r=(this.logMsg("\nWriting data with filesize:"+i),p.addValue(indexText["写入数据，文件大小："]+i+"\n"),await this.flashBegin(i,t));let l=[],n=0,a=0;var s=t;let d=0;for(var t=Date.now(),c=this.getFlashWriteSize();0<i-d;){var u=Math.floor(100*(n+1)/r);-1==p.getValue().lastIndexOf("("+u+" %)")&&p.addValue(indexText["写入数据到"]+" "+this.toHex(s+n*c,8)+"... ("+u+" %)\n"),null!==this.updateProgress&&this.updateProgress(o,u),l=i-d>=c?Array.from(new Uint8Array(e,d,c)):(l=Array.from(new Uint8Array(e,d,i-d))).concat(new Array(c-l.length).fill(255)),await this.flashBlock(l,n),n+=1,a+=l.length,d+=c}this.logMsg("Took "+(Date.now()-t)+"ms to write "+i+" bytes"),p.addValue(indexText["写入"]+" "+i+" bytes "+indexText["耗时"]+" "+(Date.now()-t)+" ms\n")}async flashDeflBegin(e,t,o){let i;var r=this.getFlashWriteSize(),l=Math.floor((t+r-1)/r),n=Math.floor((e+r-1)/r),a=Date.now();let s,d;return d=this.IS_STUB?(s=e,A):(s=n*self.FLASH_WRITE_SIZE,this.timeoutPerMb(3e4,s)),this.logMsg("Compressed "+e+" bytes to "+t+"..."),i=struct.pack("<IIII",s,l,r,o),[c,u,g].includes(this._chipfamily)&&!this.IS_STUB&&(i=i.concat(struct.pack("<I",0))),await this.checkCommand(16,i,0,d),0==e||this.IS_STUB||this.logMsg("Took "+(Date.now()-a)+"ms to erase flash block"),l}async flashDeflBlock(e,t,o=A){await this.checkCommand(17,struct.pack("<IIII",e.length,t,0,0).concat(e),this.checksum(e),o)}async flashDeflFinish(e=!1){(e||this.IS_STUB)&&(e=struct.pack("<I",e?0:1),await this.checkCommand(18,e))}async flashBegin(e=0,t=0,o=!1){let i;var r=this.getFlashWriteSize(),l=(this.IS_STUB||[50,c,u,g].includes(this._chipfamily)&&await this.checkCommand(13,new Array(8).fill(0)),50==this._chipfamily&&(i=struct.pack("<IIIIII",0,this._flashsize,65536,4096,256,65535),await this.checkCommand(11,i)),Math.floor((e+r-1)/r)),n=this.getEraseSize(t,e);let a;a=this.IS_STUB?A:this.timeoutPerMb(3e4,e);var s=Date.now();return i=struct.pack("<IIII",n,l,r,t),[c,u,g].includes(this._chipfamily)&&!this.IS_STUB&&(i=i.concat(struct.pack("<I",o?1:0))),this.logMsg("Erase size "+n+", blocks "+l+", block size "+r+", offset "+this.toHex(t,4)+", encrypted "+(o?"yes":"no")),await this.checkCommand(2,i,0,a),0==e||this.IS_STUB||this.logMsg("Took "+(Date.now()-s)+"ms to erase "+l+" bytes"),l}async flashBlock(e,t,o=A){await this.checkCommand(3,struct.pack("<IIII",e.length,t,0,0).concat(e),this.checksum(e),o)}async flashFinish(){var e=struct.pack("<I",1);await this.checkCommand(4,e)}async runSpiflashCommand(e,t=[],o=0,i=null,r=0,l=0){var n=await this.chipType();let a=this.getChipInfo(n);const s=a.spiRegBase,d=s+0;var n=s+4,c=s+a.spiUsrOffs;const u=s+a.spiUsr1Offs;var p=s+a.spiUsr2Offs,g=s+a.spiW0Offs;const A=26,h=1<<18;let y,m;if(y=(y=null!=a.spiMosiDlenOffs?async function(e,t){var o=s+a.spiMosiDlenOffs,i=s+a.spiMisoDlenOffs;0<e&&await this.writeRegister(o,e-1),0<t&&await this.writeRegister(i,t-1),(m=0)<l&&(m|=l-1),0<r&&(m|=r-1<<A),m&&await this.writeRegister(u,m)}:async function(e,t){var o=u,e=0==e?0:e-1,t=0==t?0:t-1;m=t<<8|e<<17,0<l&&(m|=l-1),0<r&&(m|=r-1<<A),await this.writeRegister(o,m)}).bind(this),32<o)throw new v("Reading more than 32 bits back from a SPI flash operation is unsupported");if(64<t.length)throw new v("Writing more than 64 bytes of data with one SPI command is unsupported");var f,x=8*t.length,b=await this.readRegister(c),C=await this.readRegister(p);if(m=1<<31,0<o&&(m|=1<<28),0<x&&(m|=1<<27),0<r&&(m|=1<<30),0<l&&(m|=1<<29),await y(x,o),await this.writeRegister(c,m),await this.writeRegister(p,7<<28|e),null!=i&&0<r&&await this.writeRegister(n,i),0==x)await this.writeRegister(g,0);else{t=t.concat(new Array(4-t.length).fill(0));let e=g;for(f of struct.unpack("I"*Math.floor(t.length/4),t))await this.writeRegister(e,f),e+=4}await this.writeRegister(d,h);await async function(){for(let e=0;e<10;e++)if(0==(await this.readRegister(d)&h))return;throw new v("SPI command did not complete in time")}.bind(this)();o=await this.readRegister(g);return await this.writeRegister(c,b),await this.writeRegister(p,C),o}async flashId(){return this.runSpiflashCommand(159,[],24)}getEraseSize(e,t){if(this._chipfamily!=s||this.IS_STUB)return t;var o=4096,t=Math.floor((t+o-1)/o);let i=16-Math.floor(e/o)%16;return t<2*(i=t<i?t:i)?Math.floor((t+1)/2*o):(t-i)*o}async memBegin(e,t,o,i){if(this.IS_STUB){var r,l,n=await this.getStubCode(),a=i,s=i+e;console.log(a,s),console.log(n.data_start,n.data.length,n.text_start,n.text.length);for([r,l]of[[n.data_start,n.data_start+n.data.length],[n.text_start,n.text_start+n.text.length]])if(a<l&&s>r)throw"Software loader is resident at "+this.toHex(r,8)+"-"+this.toHex(l,8)+". Can't load binary at overlapping address range "+this.toHex(a,8)+"-"+this.toHex(s,8)+". Try changing the binary loading address."}return this.checkCommand(5,struct.pack("<IIII",e,t,o,i))}async memBlock(e,t){return this.checkCommand(7,struct.pack("<IIII",e.length,t,0,0).concat(e),this.checksum(e))}async memFinish(e=0){var t=this.IS_STUB?A:500,e=struct.pack("<II",parseInt(0==e),e);try{return await this.checkCommand(6,e,0,t)}catch(e){if(this.IS_STUB)throw e}}async getStubCode(){var e=await this.chipType(),t=this.getChipInfo(e),o={},i=["text","text_start","entry","data","data_start"];for(let e=0;e<i.length;e++)l[t.stubFile]&&l[t.stubFile][i[e]]&&("text"==i[e]||"data"==i[e]?o[i[e]]=toByteArray(atob(l[t.stubFile][i[e]])):o[i[e]]=parseInt(l[t.stubFile][i[e]]));return o}getStubLoaderClass(){}getRomClass(){}async runStub(o=null){if(null===o&&(o=await this.getStubCode()),this.syncStubDetected||this.IS_STUB)this.logMsg("Stub is already running. No upload is necessary.");else{let t=6144;[c,u,g].includes(this._chipfamily)&&(t=2048),this.logMsg("Uploading stub..."),p.addValue(indexText["上传"]+" stub...\n");for(var i of["text","data"])if(Object.keys(o).includes(i)){var r,e=o[i+"_start"],l=o[i].length,n=Math.floor((l+t-1)/t);await this.memBegin(l,n,t,e);for(r of Array(n).keys()){var a=r*t;let e=a+t;e>l&&(e=l),await this.memBlock(o[i].slice(a,e),r)}}this.logMsg("Running stub..."),p.addValue(indexText["运行"]+" stub...\n"),await this.memFinish(o.entry);var s=await this.readBuffer(500);if("OHAI"!=(s=String.fromCharCode(...s)))throw"Failed to start stub. Unexpected response: "+s;this.logMsg("Stub is now running..."),p.addValue("Stub "+indexText["正在运行中"]+"...\n"),this.stubClass=new d({updateProgress:this.updateProgress,logMsg:this.logMsg,debugMsg:this._debugMsg,debug:this.debug})}return this.stubClass}}class d extends o{constructor(e){super(e),this.IS_STUB=!0}async eraseFlash(){await this.checkCommand(208,[],0,12e4)}getFlashWriteSize(){return 16384}}(class extends d{});class n extends Error{constructor(e){super(e),this.name="SlipReadError"}}class v extends Error{constructor(e){super(e),this.name="FatalError"}}t.EspLoader=o,t.EspStubLoader=d,t.SlipReadError=n,t.FatalError=v})(),(()=>{goog.require("Mixly.MFile"),goog.require("Mixly.Editor"),goog.require("Mixly.Drag"),goog.require("Mixly.LayerExt"),goog.provide("Mixly.Web.File");const{MFile:l,Editor:o,Drag:i,Web:e,LayerExt:t}=Mixly,n=e["File"];n.obj=null,n.open=async()=>{if("https:"===window.location.protocol){let t=[];l.openFilters.map(e=>{t.push("."+e)});var e={multiple:!1,types:[{description:"Mixly File",accept:{"application/xml":t}}],suggestedStartLocation:"pictures-library"};try{var o,i,[r]=await window.showOpenFilePicker(e);r&&(o=(n.obj=r).name.substring(r.name.lastIndexOf(".")),i=await n.obj.getFile())&&n.parseData(o,await i.text())}catch(e){console.log(e)}}else{e="."+l.openFilters.join(",.");l.openFile(e,"text",e=>{var{data:e,filename:t}=e,t=t.substring(t.lastIndexOf("."));n.parseData(t,e)})}},n.parseData=(e,t)=>{switch(e){case".mix":case".xml":try{t=t.replace(/\\(u[0-9a-fA-F]{4})/g,function(e){return unescape(e.replace(/\\(u[0-9a-fA-F]{4})/g,"%$1"))})}catch(e){console.log(e)}l.parseMix($(t),!1,!1,e=>{e&&(o.blockEditor.scrollCenter(),Blockly.hideChaff())});break;case".ino":case".py":i.items.vDrag.full("NEGATIVE"),o.codeEditor.setValue(t,-1);break;case".bin":case".hex":l.loadHex(t);break;default:layer.msg(indexText["文件后缀错误"],{time:1e3}),n.obj=null}},n.save=async()=>{if(n.obj){let e="";switch(n.obj.name.substring(n.obj.name.lastIndexOf("."))){case".mix":case".xml":e=l.getMix();break;case".ino":case".py":e=l.getCode();break;default:return}try{var t=await n.obj.createWritable();await t.write(e),layer.msg("写入新数据到"+n.obj.name,{time:1e3}),await t.close()}catch(e){console.log(e)}}else n.saveAs()},n.saveAs=async()=>{let t=[];l.saveFilters.map(e=>{t.push("."+e.extensions[0])});var e={types:[{description:"Mixly File",accept:{"application/xml":t}}]};try{var o=await window.showSaveFilePicker(e);o&&(n.obj=o,n.save())}catch(e){console.log(e)}},n.new=async()=>{layer.confirm(MSG.confirm_newfile,{title:!1,shade:t.SHADE_ALL,resize:!1,success:e=>{e[0].childNodes[1].childNodes[0].classList.remove("layui-layer-close2"),e[0].childNodes[1].childNodes[0].classList.add("layui-layer-close1")},btn:[MSG.newfile_yes,MSG.newfile_no],btn2:function(e,t){layer.close(e)}},async function(e,t){mixlyjs.createFn(),layer.close(e),n.obj=null})},n.saveCode=()=>{},n.saveMix=()=>{},n.saveImg=()=>{},n.saveHex=()=>{}})(),(()=>{goog.require("Mixly.Charts"),goog.require("Mixly.StatusBar"),goog.require("Mixly.StatusBarPort"),goog.require("Mixly.Config"),goog.require("Mixly.Tools"),goog.require("Mixly.Env"),goog.require("Mixly.LayerExt"),goog.require("Mixly.XML"),goog.require("Mixly.MArray"),goog.require("Mixly.Web.USB"),goog.require("Mixly.Web.SerialPort"),goog.provide("Mixly.Web.Serial");const{Web:e,Charts:n,StatusBar:a,StatusBarPort:s,Config:t,Tools:d,LayerExt:c,XML:u}=Mixly,{Serial:p,USB:l,SerialPort:g}=e,{BOARD:o,SELECTED_BOARD:A}=t,h=s["portAce"];p.TOOL_DEFAULT_CONFIG={ctrlCBtn:!1,ctrlDBtn:!1,baudRates:115200,yMax:100,yMin:0,pointNum:100,rts:!1,dtr:!1,scroll:!0,sendStr:!0,receiveStr:!0,sendWith:"\\r\\n",tabIndex:0,...o?.serial??{}},p.DEFAULT_BAUD=[9600,19200,28800,38400,57600,115200],p.DEFAULT_SEND_WITH=["\\r\\n","\\r","\\n","no"],p.PORT_SELECT={BURN:o?.burn?.portSelect??"all",UPLOAD:o?.upload?.portSelect??"all"},p.UPLOAD_RESET=o?.upload?.reset??{},p.HAS_PORT={BURN:o?.nav?.burn??!1,UPLOAD:o?.nav?.upload??!1},p.MAX_OUTPUT_LINE=500,p.REFRESH_OUTPUT_TIME=100,p.BAUDRATES=[9600,19200,28800,38400,57600,115200],p.TERMINAL_COMMAND={config:{"-d|--dtr":{help:"设置DTR, 可选值: [0, 1], 例如: config -d 1",key:"DTR"},"-r|--rts":{help:"设置RTS, 可选值: [0, 1], 例如: config -r 1",key:"RTS"},"-b|--baud":{help:"设置波特率, 可选值: ["+p.DEFAULT_BAUD.join(", ")+"], 例如: config -b "+p.DEFAULT_BAUD[0],key:"BAUD"},"-t|--rtype":{help:"设置串口接收数据的类型, 可选值: [0, 1], 例如: config -t 1",key:"RTYPE"},"-w|--swith":{help:"设置发送数据时的结尾字符串, 可选值: ["+p.DEFAULT_SEND_WITH.join(", ")+"], 例如: config -w "+p.DEFAULT_SEND_WITH[0],key:"SWITH"},"-s|--scroll":{help:"设置接收框滑动条是否一直在最下方, 可选值: [0, 1], 例如: config -s 1",key:"SCROLL"},"-h|--help":{help:"输出帮助信息, 例如: config -h",key:"HELP"},callback:"terminalConfigCallback"},port:{"-o|--open":{help:"打开当前串口, 例如: port -o",key:"OPEN"},"-c|--close":{help:"关闭当前串口, 例如: port -c",key:"CLOSE"},"-h|--help":{help:"输出帮助信息, 例如: port -h",key:"HELP"},callback:"terminalPortCallback"},send:{"-s|--str":{help:"发送字符串, 可选值: 字符串, 例如: send -s 你好Mixly",key:"STR"},"-b|--bytes":{help:"发送字节数组, 可选值: 字符串, 例如: send -b 0x01,0x02,0x03",key:"BYTES"},"-w|--with":{help:"发送数据时的结尾字符串, 可选值: ["+p.DEFAULT_SEND_WITH.join(", ")+"], 例如: send -s 你好Mixly -w \\r\\n",key:"WITH"},"-h|--help":{help:"输出帮助信息, 例如: send -h",key:"HELP"},callback:"terminalSendCallback"},exit:{callback:"terminalExitCallback"}},p.portsOperator={},p.deadPortsOperator={},p.refreshToolPortSelectBox=()=>{var e,t=layui["form"];for(e in p.portsOperator){var o,i=p.portsOperator[e]["dom"];i&&(o=i.id["selectPortId"],i=i.filter["formFilter"],(o=$("#"+o)).empty(),o.append($(`<option value="${e}" selected>${e}</option>`)),t.render("select",i))}},p.refreshPortOperator=t=>{var e,o,i,r,l,n,a={...p.portsOperator},s=(p.portsOperator={},[]);for(let e=0;e<t.length;e++){var d,c=t[e];s.push(c.name),a[c.name]?p.portsOperator[c.name]=a[c.name]:p.deadPortsOperator[c.name]?(p.portsOperator[c.name]={...p.deadPortsOperator[c.name]},delete p.deadPortsOperator[c.name],p.refreshToolPortSelectBox()):(d={toolConfig:{...p.TOOL_DEFAULT_CONFIG},toolOpened:!1,portOpened:!1,vendorId:c.vendorId,productId:c.productId,dom:null,serialport:null,output:[]},p.portsOperator[c.name]=d),p.refreshTerminalMenu(c.name)}for(e in a)s.includes(e)||(i=(o=a[e])["dom"],i&&(o.toolOpened?(r=layui["form"],l=i.id["selectPortId"],n=i.filter["formFilter"],$("#"+l).empty(),r.render("select",n),p.deadPortsOperator[e]={...o}):i.destroy()),p.refreshTerminalMenu(e))},p.refreshOutputBox=t=>{var o=p.portsOperator[t];if(o&&!o.busy){var{toolConfig:i,toolOpened:r,endPos:l,serialport:n}=o,a=n.output;for(let e=a.length;e>p.MAX_OUTPUT_LINE;e--)a.shift();let e=a.join("\n");if(r)p.receiveBoxSetValue(t,e,i.scroll);else{if(e=e.replaceAll("\r\n","\n"),l&&"object"==typeof l){n=s.getValueRange(t,{row:0,column:0},l);if(e===n)return}s.setValue(t,e,i.scroll),o.endPos=s.getEndPos(t),h[t]&&h[t].setReadOnly(!1)}}},p.openTool=()=>{var e="web-"+A.web.com,t=p.portsOperator[e]?.toolConfig?.baudRates??p.TOOL_DEFAULT_CONFIG.baudRates;p.connect(e,t,l=>{if(l){let i=p.portsOperator[l];var e=i["toolConfig"],{}=e,t=e=>{i.dom||(i.dom=e),p.refreshToolPortSelectBox();var{}=e.id,t=(i.toolOpened=!0,a.show(1),e.nowPort=l,e.prevPort=null,layui.element),o=e.filter["tabFilter"];t.tabChange(o,i.toolConfig.tabIndex),p.refreshConnectStatus(e.nowPort)},o=e=>{try{n.chart&&n.chart.destroy(),n.chart=null}catch(e){console.log(e)}n.draw&&clearInterval(n.draw),n.addData&&clearInterval(n.addData);var t=p.portsOperator[e],o=p.deadPortsOperator[e];t?t.toolOpened=!1:o&&(o.dom.destroy(),delete p.deadPortsOperator[e]),p.refreshTerminalMenu(e)};let r=i.dom;i.dom?(r.updateTool(e),r.open(t,o)):r=c.openSerialTool(e,t,o),r.onClickSetDtr((e,t)=>{var e=p.portsOperator[e],{portOpened:o,serialport:i,toolConfig:r}=e,{dtr:r,rts:t}=(r.dtr=t.elem.checked,e.toolConfig);o&&i.setSignals(r,t)}),r.onClickSetRts((e,t)=>{var e=p.portsOperator[e],{portOpened:o,serialport:i,toolConfig:r}=e,{dtr:r,rts:t}=(r.rts=t.elem.checked,e.toolConfig);o&&i.setSignals(r,t)}),r.onClickSendType((e,t)=>{var o=r.id["sendId"],o=$("#"+o);p.portsOperator[e].toolConfig.sendStr=t.elem.checked,t.elem.checked?o.attr("placeholder",indexText["请输入内容"]):o.attr("placeholder",indexText["请输入内容"]+"  "+indexText["例如"]+":0x03,0x04")}),r.onClickSelectBaud((e,t)=>{var{portOpened:e,serialport:o,toolConfig:i}=p.portsOperator[e];i.baudRates=+t.elem.value,e&&o.setBaudRate(+t.elem.value)}),r.onClickTab((e,t)=>{p.portsOperator[e].toolConfig.tabIndex=t.index,1===t.index?(e=(t=p.portsOperator[e])["dom"],n.init(t.portOpened,e)):Mixly.Charts.destroy()}),r.onClickConnectBtn(e=>{p.portsOperator[e].portOpened?p.portClose(e):p.openTool()}),r.onClickSendBtn(e=>{p.write(e,0)}),r.onClickClearBtn(e=>{p.clearContent(e)}),r.onClickChartSendBtn(e=>{p.write(e,1)}),r.onClickCtrlCBtn(e=>{p.writeCtrlC(e)}),r.onClickCtrlDBtn(e=>{p.writeCtrlD(e)}),r.onClickScroll((e,t)=>{p.portsOperator[e].toolConfig.scroll=t.elem.checked}),r.onClickReceiveType((e,t)=>{p.portsOperator[e].toolConfig.receiveStr=t.elem.checked}),r.onClickSelectPointNum((e,t)=>{p.portsOperator[e].toolConfig.pointNum=t.elem.value}),r.onClickSelectSendWith((e,t)=>{p.portsOperator[e].toolConfig.sendWith=t.elem.value})}else layer.msg(indexText["已取消连接"],{time:1e3})})},p.refreshConnectStatus=e=>{var t=p.portsOperator[e],e=p.deadPortsOperator[e];(t||e)&&({dom:t,portOpened:e}=t??e,t&&(t=t.id["connectBtnId"],t=$("#"+t),e?(t.text(indexText["关闭"]),t.attr("class","layui-btn layui-btn-danger")):(t.text(indexText["打开"]),t.attr("class","layui-btn layui-btn-normal"))),e?($("#operate-connect-btn").html(MSG.disconnect),$("#operate-connect-btn").removeClass("icon-link").addClass("icon-unlink"),$("#connect-btn").html(MSG.disconnect),$("#connect-btn").removeClass("icon-link").addClass("icon-unlink")):($("#operate-connect-btn").html(MSG.connect),$("#operate-connect-btn").removeClass("icon-unlink").addClass("icon-link"),$("#connect-btn").html(MSG.connect),$("#connect-btn").removeClass("icon-unlink").addClass("icon-link")))},p.receiveBoxAddValue=(e,t,o=!1)=>{t=p.receiveBoxGetValue(e)+t;p.receiveBoxSetValue(e,t,o)},p.receiveBoxSetValue=(e,t,o=!1)=>{var e=p.portsOperator[e];e&&(e=e["dom"],e)&&(e=e.id["receiveId"],(e=$("#"+e)).val(t),o)&&e.scrollTop(e[0].scrollHeight)},p.receiveBoxGetValue=e=>{var e=p.portsOperator[e];return e&&(e=e.dom,e)?(e=e.id["receiveId"],$("#"+e).val()):""},p.receiveBoxScrollToTheBottom=()=>{var e=p.portsOperator[port]["dom"];e&&(e=e.id["receiveId"],(e=$("#"+e)).scrollTop(e[0].scrollHeight))},p.receiveBoxScrollToTheTop=()=>{},p.statusBarPortAddHotKey=i=>{const r=h[i].getSession();h[i].commands.addCommands([{name:"Empty",bindKey:"Ctrl-E",exec:e=>{var t=p.portsOperator[i];t&&(t.output=[])}},{name:"Terminal",bindKey:"Ctrl-T",exec:e=>{p.statusBarPortEnterTerminal(i)}},{name:"ChangeEditor",bindKey:"Delete|Ctrl-X|Backspace",exec:e=>{var t,o=p.portsOperator[i];return!(!o||!o.portOpened)&&(o=o["endPos"],o&&"object"==typeof o?(t=r.selection.getCursor()).row<o.row||t.row===o.row&&t.column<=o.column:(h[i].setReadOnly(!0),!1))}},{name:"Enter",bindKey:"Enter",exec:e=>{var t,o=p.portsOperator[i];return o&&o.portOpened&&(o=o["endPos"],o)&&"object"==typeof o&&r.selection.getCursor().row===o.row&&(t=s.getEndPos(i),o=s.getValueRange(i,o,t),p.writeString(i,o,"\r\n")),!1}}]),r.selection.on("changeCursor",function(){var e,t=p.portsOperator[i];t&&t.portOpened&&(t=t.endPos,t)&&"object"==typeof t&&((e=r.selection.getCursor()).row<t.row||e.row===t.row&&e.column<t.column)?h[i].setReadOnly(!0):h[i].setReadOnly(!1)}),p.portsOperator[i]&&p.refreshTerminalMenu(i)},p.statusBarPortEnterTerminal=e=>{var t=p.portsOperator[e];t&&!t.toolOpened&&(p.statusBarPortRemoveCursorEvent(e),t.refreshOutputBoxTimer&&clearInterval(t.refreshOutputBoxTimer),t.refreshOutputBoxTimer=null,setTimeout(()=>{p.statusBarPortAddCursorEvent(e)},p.REFRESH_OUTPUT_TIME+100))},p.refreshTerminalMenu=i=>{const r=p.portsOperator[i];let l=i;try{l=(l=l.replaceAll("/","-")).replaceAll(".","-")}catch(e){console.log(e)}var e,t='<div style="float:left;">{{d.name}}&nbsp</div><div style="float:right;">{{d.hotKey}}</div>',o={elem:`#tab-${l}-ace`,trigger:"contextmenu",isAllowSpread:!0,id:`tab-${l}-ace-terminal`,className:"editor-dropdown-menu",click:function(e,t){var o;e.id===`tab-${l}-ace-terminal-exit`?p.statusBarPortAddCommand(i,"exit"):e.id===`tab-${l}-ace-terminal-open`?p.statusBarPortEnterTerminal(i):e.id===`tab-${l}-ace-terminal-close`?s.tabDelete(i):e.id===`tab-${l}-ace-terminal-help`?p.statusBarPortAddCommand(i,"config port send -h"):e.id===`tab-${l}-ace-fontsize-decrease`?(o=parseInt(h[i].getFontSize(),10)||12,h[i].setFontSize(Math.max(o-1||1))):e.id===`tab-${l}-ace-fontsize-increase`?(o=parseInt(h[i].getFontSize(),10)||12,h[i].setFontSize(o+1)):e.id===`tab-${l}-ace-fontsize-default`?h[i].setFontSize(12):e.id===`tab-${l}-ace-terminal-port-close`?p.statusBarPortAddCommand(i,"port -c"):e.id===`tab-${l}-ace-terminal-port-open`?p.statusBarPortAddCommand(i,"port -o"):e.id===`tab-${l}-ace-terminal-send-ctrlc`?p.statusBarPortAddCommand(i,"send -b 0x03,0x0d,0x0a -w no"):e.id===`tab-${l}-ace-terminal-send-ctrld`?p.statusBarPortAddCommand(i,"send -b 0x03,0x04 -w no"):e.id===`tab-${l}-ace-terminal-send-str`?p.statusBarPortAddCommand(i,"send -w \\r\\n -s ",!1):e.id===`tab-${l}-tool-close`?r.dom.close():e.id===`tab-${l}-ace-close`?s.tabDelete(i):e.id===`tab-${l}-ace-empty`?p.clearContent(i):e.id===`tab-${l}-serial-send-ctrlc`?p.writeCtrlC(i):e.id===`tab-${l}-serial-send-ctrld`&&p.writeCtrlD(i)}};r?r&&r.toolOpened?o.data=[{title:indexText["关闭串口工具"],id:`tab-${l}-tool-close`}]:(e=r["toolConfig"],e={portOpend:{terminalOpend:[{title:u.render(t,{name:indexText["关闭串口"],hotKey:"port -c"}),id:`tab-${l}-ace-terminal-port-close`},e.ctrlCBtn?{title:u.render(t,{name:indexText["中断"],hotKey:""}),id:`tab-${l}-ace-terminal-send-ctrlc`}:{},e.ctrlDBtn?{title:u.render(t,{name:indexText["复位"],hotKey:""}),id:`tab-${l}-ace-terminal-send-ctrld`}:{},{title:u.render(t,{name:indexText["发送字符串"],hotKey:""}),id:`tab-${l}-ace-terminal-send-str`},{title:u.render(t,{name:indexText["帮助"],hotKey:""}),id:`tab-${l}-ace-terminal-help`}],terminalClosed:[{title:u.render(t,{name:indexText["清空"],hotKey:"Ctrl+E"}),id:`tab-${l}-ace-empty`},{type:"-"},{title:u.render(t,{name:indexText["增大字号"],hotKey:"Ctrl+="}),id:`tab-${l}-ace-fontsize-increase`},{title:u.render(t,{name:indexText["减小字号"],hotKey:"Ctrl+-"}),id:`tab-${l}-ace-fontsize-decrease`},{title:u.render(t,{name:indexText["默认字号"],hotKey:"Ctrl+0"}),id:`tab-${l}-ace-fontsize-default`},{type:"-"},e.ctrlCBtn?{title:u.render(t,{name:indexText["中断"],hotKey:""}),id:`tab-${l}-serial-send-ctrlc`}:{},e.ctrlDBtn?{title:u.render(t,{name:indexText["复位"],hotKey:""}),id:`tab-${l}-serial-send-ctrld`}:{}]},portClosed:{terminalOpend:[{title:u.render(t,{name:indexText["打开串口"],hotKey:"port -o"}),id:`tab-${l}-ace-terminal-port-open`},{title:u.render(t,{name:indexText["帮助"],hotKey:""}),id:`tab-${l}-ace-terminal-help`}],terminalClosed:[{title:u.render(t,{name:indexText["清空"],hotKey:"Ctrl+E"}),id:`tab-${l}-ace-empty`},{type:"-"},{title:u.render(t,{name:indexText["增大字号"],hotKey:"Ctrl+="}),id:`tab-${l}-ace-fontsize-increase`},{title:u.render(t,{name:indexText["减小字号"],hotKey:"Ctrl+-"}),id:`tab-${l}-ace-fontsize-decrease`},{title:u.render(t,{name:indexText["默认字号"],hotKey:"Ctrl+0"}),id:`tab-${l}-ace-fontsize-default`}]}},o.data=e[r.portOpened?"portOpend":"portClosed"][r.terminalOpend?"terminalOpend":"terminalClosed"]):o.data=[{title:indexText["关闭串口输出框"],id:`tab-${l}-ace-close`}],layui.dropdown.render(o)},p.statusBarPortAddCursorEvent=o=>{const i=p.portsOperator[o];""===i.output[i.output.length-1]?p.outputBoxAdd(o,">>>",!1):p.outputBoxAdd(o,">>>",!0),p.refreshOutputBox(o),i.terminalOpend=!0,p.refreshTerminalMenu(o);var e=h[o];const r=e["selection"],l=e.getSession(),n=l.getLength(),a=(e.gotoLine(n),r.moveCursorLineEnd(),r.getCursor());i.cursorCallback=l.selection.on("changeCursor",function(e){if(i.terminalOpend){var t=r.getCursor();(t.row<a.row||t.row===a.row&&t.column<=a.column)&&r.moveCursorTo(a.row,a.column,!0);let e=l.getLine(t.row-1);-1!==e.indexOf(">>>")&&t.row===a.row+1&&0===t.column?(e=e.replace(">>>",""),p.outputBoxAdd(o,e),p.handleCommand(o,e),p.statusBarPortRemoveCursorEvent(o)):l.getLength()!==n&&p.statusBarPortRemoveCursorEvent(o)}})},p.statusBarPortRemoveCursorEvent=e=>{var t=h[e],o=p.portsOperator[e];o&&t&&(t=t.getSession(),o.cursorCallback)&&(t.selection.removeEventListener("changeCursor",o.cursorCallback),p.refreshOutputBox(e),o.terminalOpend=!1,p.refreshTerminalMenu(e),o.portOpened)&&!o.refreshOutputBoxTimer&&(o.refreshOutputBoxTimer=setInterval(()=>{p.refreshOutputBox(e)},p.REFRESH_OUTPUT_TIME))},p.outputBoxAdd=(e,t,o=!1)=>{e=p.portsOperator[e].serialport;o&&e.output.push(""),e.output[e.output.length-1]+=t},p.handleCommand=(e,t)=>{p.portsOperator[e];var t=t.split(" "),o=minimist(t);if(1<=o._.length)for(var i of o._){var r;Object.keys(p.TERMINAL_COMMAND).includes(i)?(r=p.TERMINAL_COMMAND[i].callback,p[r]&&p[r](e,o)):(p.outputBoxAdd(e,i+"为无效指令",!0),p.outputBoxAdd(e,"",!0))}else p.outputBoxAdd(e,"无可用指令",!0),p.outputBoxAdd(e,"",!0)},p.parseOptions=(e,t)=>{var o,i=[],r=[],l=[];for(o in t){var n=o.split("|"),a=t[o]?.key;if(2===n.length&&a&&(-1!==n[0].indexOf("-")&&-1!==n[1].indexOf("-"))){l.push(a);for(var s of n)(2===s.length?i:r).push(s)}}var d,c=[i,r,l],u={};for(d in e)option=e[d],c[0].includes("-"+d)?(u[c[2][c[0].indexOf("-"+d)]]=option,c[1][d]=null):c[1].includes("--"+d)&&(u[c[2][c[1].indexOf("--"+d)]]=option);return u},p.terminalAddHelpInfo=(e,t,o)=>{var i,r;this.getSpace=e=>{return new Array(e).fill(" ").join("")},p.outputBoxAdd(e,t+"指令可用选项如下：",!0);let l=0;for(i of Object.keys(o))i.length>l&&(l=i.length);for(r in o)if("callback"!==r)try{p.outputBoxAdd(e,r+this.getSpace(l-r.length)+"    "+(o[r].help??""),!0)}catch(e){console.log(e)}p.outputBoxAdd(e,"",!0)},p.terminalConfigCallback=(e,t)=>{var o=p.portsOperator[e],i=o["toolConfig"];o&&(o=p.TERMINAL_COMMAND.config,(t=p.parseOptions(t,o)).HELP?p.terminalAddHelpInfo(e,"config",o):(p.outputBoxAdd(e,"获取指令"+JSON.stringify(t),!0),p.outputBoxAdd(e,"",!0),i.dtr=t.DTR??i.dtr,i.rts=t.RTS??i.rts,i.scroll=t.SCROLL??i.scroll,i.baudRates=t.BAUD&&p.DEFAULT_BAUD.includes(t.BAUD)?t.BAUD:i.baudRates,i.receiveStr=t.RTYPE??i.receiveStr,i.sendWith=t.SWITH&&p.DEFAULT_SEND_WITH.includes(t.SWITH)?t.SWITH:i.sendWith,p.setDtrAndRts(e,i.dtr,i.rts),p.setBaudRate(e,i.baudRates)))},p.terminalPortCallback=(e,t)=>{var o,i=p.portsOperator[e],{}=i;i&&(o=p.TERMINAL_COMMAND.port,(t=p.parseOptions(t,o)).HELP?p.terminalAddHelpInfo(e,"port",o):(p.outputBoxAdd(e,"获取指令"+JSON.stringify(t),!0),p.outputBoxAdd(e,"",!0),t.OPEN?i.portOpened||p.connect(e,i.toolConfig.baudRates):t.CLOSE?i.portOpened&&p.portClose(e):(p.outputBoxAdd(e,"无效指令",!1),p.outputBoxAdd(e,"",!0))))},p.terminalSendCallback=(t,o)=>{var e=p.portsOperator[t],i=e["toolConfig"];if(e){var r=p.TERMINAL_COMMAND.send,o=p.parseOptions(o,r);if(o.HELP)p.terminalAddHelpInfo(t,"send",r);else if(p.outputBoxAdd(t,"获取指令"+JSON.stringify(o),!0),p.outputBoxAdd(t,"",!0),e.portOpened){let e=i.sendWith??"\\r\\n";o.WITH&&p.DEFAULT_SEND_WITH.includes(o.WITH)&&(e=o.WITH),o.STR?p.writeString(t,o.STR,e):o.BYTES?p.writeByteArr(t,o.BYTES,e):(p.outputBoxAdd(t,"无效指令",!1),p.outputBoxAdd(t,"",!0))}else p.outputBoxAdd(t,"串口已关闭，无法发送数据！",!1),p.outputBoxAdd(t,"",!0)}},p.terminalExitCallback=(e,t)=>{p.portsOperator[e]&&p.outputBoxAdd(e,"",!0)},p.statusBarPortAddCommand=(e,t,o=!0)=>{s.addValue(e,t+(o?"\n":""),!0),o&&p.refreshOutputBox(e)},p.connect=function(t=null,e=null,o=e=>{}){if(t){s.tabChange(t),p.refreshPortOperator([{name:t,vendorId:"None",productId:"None"}]);const r=p.portsOperator[t];var i=r["toolConfig"],{}=(e=e||(i.baudRates??9600),r);r.portOpened?o(t):(r.refreshOutputBoxTimer=null,"usb"===A.web.com?r.serialport=l:r.serialport=g,r.serialport.connect(e,e=>{n.addData(e)}).then(()=>(p.onConnect(t),r.serialport.AddOnDisconnectEvent(()=>{p.onDisconnect(t)}),o(t),p.reset(t,"upload"))).catch(e=>{console.log(e),p.onDisconnect(t),o(null)}).finally(()=>{p.refreshConnectStatus(t)}))}else o(null)},p.onConnect=e=>{var t=p.portsOperator[e],o=t["serialport"];t.portOpened=!0,s.tabAdd(e,!0,p.statusBarPortAddHotKey,e=>{var t=p.portsOperator[e];t&&t.serialport&&t.portOpened&&(p.portClose(e),s.tabChange("output"),a.getValue().lastIndexOf("\n")!=a.getValue().length-1?a.addValue("\n"+indexText["已关闭串口"]+e+"\n"):a.addValue(indexText["已关闭串口"]+e+"\n"))}),s.tabChange(e),p.refreshTerminalMenu(e),s.setValue(e,indexText["已打开串口"]+": "+e+"\n",!0),p.receiveBoxSetValue(e,indexText["已打开串口"]+": "+e+"\n",!0),o.output.push(""),p.outputBoxAdd(e,indexText["已打开串口"]+": "+e),o.output.push(""),t.refreshOutputBoxTimer=setInterval(()=>{p.refreshOutputBox(e)},p.REFRESH_OUTPUT_TIME),$("#operate-connect-btn").html(MSG.disconnect),$("#operate-connect-btn").removeClass("icon-link").addClass("icon-unlink"),$("#connect-btn").html(MSG.disconnect),$("#connect-btn").removeClass("icon-link").addClass("icon-unlink")},p.onDisconnect=e=>{layer.closeAll();var t,o=p.portsOperator[e],i=o["serialport"];l.DAPLink&&l.DAPLink.connected&&l.DAPLink.removeAllListeners(DAPjs.DAPLink.EVENT_SERIAL_DATA),o.portOpened&&(o.portOpened=!1,s.close(e),p.refreshConnectStatus(e),p.refreshTerminalMenu(e),o.refreshOutputBoxTimer&&clearInterval(o.refreshOutputBoxTimer),o.refreshOutputBoxTimer=null,n.stopRefresh(),(t=p.receiveBoxGetValue(e))&&t.lastIndexOf("\n")!=t.length-1?p.receiveBoxAddValue(e,"\n"+indexText["已关闭串口"]+": "+e+"\n",!0):p.receiveBoxAddValue(e,indexText["已关闭串口"]+": "+e+"\n",!0),s.getValue(e).lastIndexOf("\n")!=s.getValue(e).length-1?s.addValue(e,"\n"+indexText["已关闭串口"]+": "+e+"\n",!0):s.addValue(e,indexText["已关闭串口"]+": "+e+"\n",!0),i&&(i.output=[],o.serialport=null),$("#operate-connect-btn").html(MSG.connect),$("#operate-connect-btn").removeClass("icon-unlink").addClass("icon-link"),$("#connect-btn").html(MSG.connect),$("#connect-btn").removeClass("icon-unlink").addClass("icon-link"))},p.portClose=(e,t=()=>{})=>{var o=p.portsOperator[e];o&&o.portOpened&&(o.serialport.close(),p.onDisconnect(e)),t()},p.showErrorData=function(e,t,o){var{toolOpened:i,toolConfig:r}=p.portsOperator[e];r.receiveStr||(o=(o=d.uint8ArrayToStr(d.strToByte(o))).replace(/^\s*/,""),o+="\n"),i?p.receiveBoxAddValue(e,o,r.scroll):s.addValue(e,o,!0)},p.writeByteArr=function(e,t,o){const i=p.portsOperator[e].serialport;let r="";for(var l=(r="string"!=typeof t?t.toString():t).trim().split(/,+/),n=[],a=0;a<l.length;a++)isNaN(l[a])?n=[...n,...d.strToByte(l[a])]:(l[a]=l[a].toLowerCase(),2<l[a].length&&"0o"===l[a].substring(0,2)?n.push(parseInt(l[a].substring(2),8)):n.push(parseInt(+l[a],10)));i.writeByteArr(n).then(()=>{(o="no"==(o=(o=o.replace("\\r","\r")).replace("\\n","\n"))?"":o)&&i.writeString(o)}).catch(console.log)},p.writeString=function(e,t,o){e=p.portsOperator[e].serialport;e&&("no"===(o=(o=o.replace("\\r","\r")).replace("\\n","\n"))&&(o=""),t)&&e.writeString(t+o)},p.write=function(t,o=0){var i=p.portsOperator[t],r=i["dom"];if(i.serialport){var{sendId:i,sendWithId:r,sendTypeId:l,chartSendId:n}=r.id,i=$("#"+i),n=$("#"+n);let e="";(o?(e=n.val(),n):(e=i.val(),i)).val("");o=$("#"+r+" option:selected").val();0==$("#"+l)[0].checked?p.writeByteArr(t,e,o):p.writeString(t,e,o)}},p.writeCtrlC=function(e){e=p.portsOperator[e].serialport;e&&e.writeCtrlC()},p.writeCtrlD=function(e){e=p.portsOperator[e].serialport;e&&e.writeCtrlD()},p.clearContent=function(e){p.receiveBoxSetValue(e,"");var t=(p.portsOperator[e]??{})["serialport"];t?t.output=[]:s.setValue(e,"")},p.updateDtrAndRts=async function(e){var e=p.portsOperator[e],t=e["toolConfig"],o=e.serialport;e.portOpened&&o&&await o.setSignals(t.dtr,t.rts)},p.reset=async function(e,t){var o=p.getResetConfig(t),i=p.portsOperator[e].serialport;if("object"==typeof o)for(var r,l,n=o.length,a=0;a<n;a++)void 0!==o[a].dtr||void 0!==o[a].rts?(r=l=!1,o[a]?.dtr&&(l=!0),o[a]?.rts&&(r=!0),await i.setSignals(l,r)):o[a]?.sleep&&(l=parseInt(o[a].sleep)||100,await p.sleep(l))},p.setBaudRate=(e,t)=>{e=p.portsOperator[e].serialport;e&&e.isOpen&&e.setBaudRate(t)},p.sleep=async function(t){return new Promise(e=>setTimeout(e,t))},p.getResetConfig=e=>{if("object"!=typeof A)return null;let t=null;return A.web&&A.web[e]&&A.web[e].reset?t=A.web[e].reset:A[e]&&(t=A[e].reset),t}})(),(()=>{goog.require("Mixly.Env"),goog.require("Mixly.Config"),goog.require("Mixly.Boards"),goog.require("Mixly.Charts"),goog.require("Mixly.StatusBar"),goog.require("Mixly.StatusBarPort"),goog.require("Mixly.Command"),goog.require("Mixly.MJSON"),goog.require("Mixly.LayerExt"),goog.require("Mixly.WebSocket"),goog.provide("Mixly.WebSocket.Socket");const{Env:t,Config:e,Boards:o,StatusBar:i,StatusBarPort:r,Command:l,MJSON:n,LayerExt:a}=Mixly,{BOARD:s,SOFTWARE:d}=e,c=Mixly.WebSocket["Socket"];c.obj=null,c.url="ws://127.0.0.1:8082/",c.jsonArr=[],c.connected=!1,c.initFunc=null,c.port=d.webSocket.port,c.debug=d.debug,s.server={...d.webSocket};var u=window.location["hostname"];c.url=d.webSocket.protocol+"//"+u+":"+c.port+"/",c.IPAddress=u;let p=!1,g=!0,A,h=0;function y(){p||(p=!0,setTimeout(function(){g=!0,c.init(),console.info(`正在重连第${h+1}次`),h++,p=!1},5e3))}const m={timeout:5e3,timeoutObj:null,serverTimeoutObj:null,reset:function(){return clearInterval(this.timeoutObj),clearTimeout(this.serverTimeoutObj),this},start:function(){let e=0,t=c;this.timeoutObj=setInterval(()=>{e<3?(1===t.obj.readyState&&(t.obj.send("HeartBeat"),console.info(`HeartBeat第${e+1}次`)),e++):(clearInterval(this.timeoutObj),(e=0)===t.obj.readyState&&1===t.obj.readyState&&t.obj.close())},this.timeout)}};c.init=(e=e=>{},t=()=>{})=>{if(c.connected)c.initFunc&&(c.initFunc(),c.initFunc=null),t();else{A=setTimeout(()=>{g&&h<3&&(console.info("重连"),h++,c.init())},5e3);let o=c;o.obj=new WebSocket(o.url),o.obj.onopen=()=>{console.log("已连接"+o.url),i.show(1),r.tabChange("output"),i.setValue(o.url+"连接成功\n"),o.connected=!0,c.toggleUIToolbar(!0),c.initFunc=t,h=0,g=!1,clearTimeout(A),m.reset().start(),e(o)},o.obj.onmessage=e=>{m.reset().start();var t=l.parse(e.data),t=n.decode(t);c.debug&&console.log("receive -> ",e.data),l.run(t)},o.obj.onerror=e=>{console.log("WebSocket error: ",e),y()},o.obj.onclose=e=>{o.connected=!1,console.log("已断开"+o.url),i.show(1),r.tabChange("output"),i.setValue(o.url+"连接断开，请在设置中重新连接\n");var t=r.portsName;for(let e=0;e<t.length;e++)r.close(t[e]);c.toggleUIToolbar(!1),layer.closeAll(),Mixly.WebSocket.BU.burning=!1,Mixly.WebSocket.BU.uploading=!1,Mixly.WebSocket.ArduShell.compiling=!1,Mixly.WebSocket.ArduShell.uploading=!1,console.info("关闭",e.code),1e3!==e.code?(g=!1,clearTimeout(A),y()):(clearInterval(m.timeoutObj),clearTimeout(m.serverTimeoutObj))}}},c.sendCommand=t=>{var o=Mixly.WebSocket.Socket;if(o.connected){let e="";try{e=JSON.stringify(n.encode(t)),c.debug&&console.log("send -> ",e)}catch(e){return void console.log(e)}o.obj.send(e)}else layer.msg("未连接"+o.url,{time:1e3})},c.clickConnect=()=>{c.connected?c.disconnect():c.connect(e=>{layer.closeAll(),layer.msg(e.url+"连接成功",{time:1e3})})},c.openLoadingBox=(e,t=()=>{},o=()=>{})=>{layer.open({type:1,title:e,content:$("#mixly-loader-div"),shade:a.SHADE_ALL,closeBtn:0,success:function(){$("#webusb-cancel").css("display","none"),$(".layui-layer-page").css("z-index","198910151"),t()},end:function(){$("#mixly-loader-div").css("display","none"),$(".layui-layer-shade").remove(),$("#webusb-cancel").css("display","unset"),c.connected&&o()}})},c.connect=(e=e=>{},t=()=>{})=>{c.connected?t():c.openLoadingBox("连接中...",()=>{setTimeout(()=>{c.init(e)},1e3)},t)},c.disconnect=()=>{c.connected&&c.openLoadingBox("断开中...",()=>{c.obj.close()})},c.toggleUIToolbar=e=>{try{e?($("#socket-connect-btn").html(MSG.disconnect),$("#socket-connect-btn").removeClass("icon-link").addClass("icon-unlink")):($("#socket-connect-btn").html(MSG.connect),$("#socket-connect-btn").removeClass("icon-unlink").addClass("icon-link"))}catch(e){console.log(e)}},c.updateSelectedBoardConfig=e=>{t.currentPlatform=e.currentPlatform,e.clientPath=e.clientPath.replaceAll("\\","/"),t.clientPath=e.clientPath,e.appPath=e.appPath.replaceAll("\\","/"),t.srcPath=e.appPath,t.indexDirPath=goog.normalizePath_(t.srcPath+"/"+s.boardIndex+"/../"),t.python3Path=e.python3Path;e=o.getSelectedBoardName();o.changeTo(e)}})(),(()=>{goog.require("tippy"),goog.require("layui"),goog.require("Mixly.MFile"),goog.require("Mixly.Title"),goog.require("Mixly.XML"),goog.require("Mixly.Editor"),goog.provide("Mixly.Example");const{MFile:o,Title:i,XML:r,Editor:l}=Mixly,n=layui["tree"];Mixly.Example=function(e,t){this.DEPTH=5,this.containerId_=e,this.exampleBtnId_=t,this.$container_=$("#"+e),this.$container_.children().first().prepend(`
        <button
            id="${t}"
            type="button"
            m-title="${indexText["例程"]}"
            class="layui-btn layui-btn-xs layui-btn-primary m-btn"
            style="cursor:pointer;border:none;margin-left:12px;padding:3px;display:inline-flex;align-items:center;"
        >
            <a
                class="icon-doc-text"
                style="color:#fff;font-size:12px;line-height:12px;"
            >${indexText["例程"]}</a>
        </button>
    `),(_this=this).menuHTML=r.render(r.TEMPLATE_STR.EXAMPLE_MENU_DIV,{id:_this.exampleBtnId_,close:indexText["关闭窗口"]}),$("#"+_this.exampleBtnId_).off().click(function(){_this.menu&&_this.menu.length&&!_this.menu[0].state.isDestroyed?_this.menu[0].state.isShown?(_this.menu[0].destroy(),_this.menu=null):_this.menu[0].show():(_this.render(),_this.menu[0].show())})},Mixly.Example.prototype.render=function(){const t=this;t.menu=tippy("#"+t.exampleBtnId_,{allowHTML:!0,content:t.menuHTML,trigger:"manual",interactive:!0,hideOnClick:!1,maxWidth:"none",offset:[0,6],onMount(e){$(`#${t.exampleBtnId_}-tree-colse`).off().click(function(){t.menu[0].destroy(),t.menu=null}),t.examplesTree_=n.render({elem:`#${t.exampleBtnId_}-tree-body`,data:t.getExampleList(),id:t.exampleBtnId_+"-tree-dom",accordion:!0,anim:!1,icon:["icon-folder-empty","icon-folder-open-empty-1","icon-file-code"],getChildren:function(e){return t.getExamples(e.data.id)},click:function(e){e.data.children||t.dataToWorkspace(e.data.id)},statusChange:function(){t.menu[0].setProps({})}}),t.examplesTree_.config.statusChange()}})},Mixly.Example.prototype.getExampleList=function(){},Mixly.Example.prototype.getExamples=function(e){},Mixly.Example.prototype.dataToWorkspace=function(e){},Mixly.Example.prototype.updateCode=(e,t)=>{switch(e){case".mix":case".xml":try{t=(t=r.convert(t,!0)).replace(/\\(u[0-9a-fA-F]{4})/g,function(e){return unescape(e.replace(/\\(u[0-9a-fA-F]{4})/g,"%$1"))})}catch(e){console.log(e)}"CODE"===l.selected&&l.items.vDrag.full("POSITIVE"),o.parseMix($(t),!1,!1,e=>{l.blockEditor.scrollCenter(),Blockly.hideChaff()});break;case".ino":case".py":editor.setValue(t,-1)}i.updateTitle(i.title)}})(),(()=>{goog.require("layui"),goog.require("Blockly"),goog.require("Mixly.Modules"),goog.require("Mixly.Env"),goog.require("Mixly.LayerExt"),goog.require("Mixly.Config"),goog.require("Mixly.StatusBar"),goog.require("Mixly.StatusBarPort"),goog.require("Mixly.Title"),goog.require("Mixly.Boards"),goog.require("Mixly.MFile"),goog.require("Mixly.MArray"),goog.require("Mixly.Electron.Serial"),goog.provide("Mixly.Electron.ArduShell");const{Modules:e,Env:p,Electron:t,LayerExt:g,StatusBar:A,StatusBarPort:h,Title:s,Boards:i,MFile:y,MArray:r,Config:o}=Mixly,{SOFTWARE:l,USER:m}=o,{fs:f,fs_extend:x,fs_extra:d,path:b,child_process:c}=e,{ArduShell:C,Serial:v}=t;C.DEFAULT_CONFIG={board_manager:{additional_urls:[]},daemon:{port:"50051"},directories:{data:"",downloads:"",user:""},library:{enable_unsafe_install:!1},logging:{file:"",format:"text",level:"info"},metrics:{addr:"9090",enabled:!0},sketch:{always_export_binaries:!1}},C.binFilePath="",C.shellPath=null,C.shell=null,C.updateShellPath=()=>{let e=b.resolve(p.clientPath,"./arduino-cli");var t;e="win32"===p.currentPlatform?b.resolve(e,"./arduino-cli.exe"):b.resolve(e,"./arduino-cli"),x.isfile(e)||({defaultPath:t={}}=l,"object"==typeof t[p.currentPlatform]&&(t=t[p.currentPlatform].arduinoCli??"",t=b.resolve(p.clientPath,t),e=x.isfile(t)?t:null)),C.shellPath=e},C.updateConfig=e=>{var t,o;C.shellPath&&(t=b.resolve(C.shellPath,"../arduino-cli.json"),o=d.readJsonSync(t,{throws:!1})??{...C.DEFAULT_CONFIG},"object"!=typeof e||r.equals(o.directories,e.directories)||(o={...o,...e},d.outputJson(t,o,{spaces:"    "}).then(()=>{console.log("arduino-cli.json已更新")}).catch(e=>{console.log(e)})))},C.init=()=>{C.updateShellPath(),C.shellPath&&C.updateConfig({directories:{data:b.resolve(C.shellPath,"../Arduino15"),downloads:b.resolve(C.shellPath,"../staging"),user:b.resolve(C.shellPath,"../Arduino")}})},C.init(),C.burn=()=>{Mixly.Electron.BU.initBurn()},C.initCompile=()=>{C.compile(()=>{})},C.compile=(d=()=>{})=>{C.shellPath||(C.shellPath=""),h.tabChange("output"),C.compiling=!0,C.uploading=!1;const c=i.getSelectedBoardCommandParam(),u=(A.show(1),layer.open({type:1,title:indexText["编译中"]+"...",content:$("#mixly-loader-div"),shade:g.SHADE_NAV,resize:!1,closeBtn:0,success:()=>{$(".layui-layer-page").css("z-index","198910151"),$("#mixly-loader-btn").off("click").click(()=>{$("#mixly-loader-btn").css("display","none"),layer.title(indexText["编译终止中"]+"...",u),C.cancel()})},end:()=>{$("#mixly-loader-div").css("display","none"),$("layui-layer-shade"+u).remove(),$("#mixly-loader-btn").off("click"),$("#mixly-loader-btn").css("display","inline-block")}}));setTimeout(()=>{A.setValue(indexText["编译中"]+"...\n");let e=p.indexDirPath+"/libraries/myLib/";x.isdir(e)?e+='","':e="";var t,o=b.resolve(p.indexDirPath,"libraries/ThirdParty");if(x.isdir(o))for(t of f.readdirSync(o)){var i=b.resolve(o,t,"libraries");x.isdir(i)&&(e+=i+",")}var r=b.resolve(C.shellPath,"../arduino-cli.json"),l=b.resolve(C.shellPath,"../libraries"),n=b.resolve(p.clientPath,"./mixlyBuild"),a=b.resolve(p.clientPath,"./mixlyBuildCache"),s=b.resolve(p.clientPath,"./testArduino/testArduino.ino"),r='"'+C.shellPath+'" compile -b '+c+' --config-file "'+r+'" --build-cache-path "'+a+'" --verbose --libraries "'+e+l+'" --build-path "'+n+'" "'+s+'" --no-color';C.runCmd(u,"compile",r,d)},100)},C.initUpload=()=>{C.compiling=!1,C.uploading=!0;const e=i.getSelectedBoardCommandParam();var t=i.getSelectedBoardConfigParam("upload_method");let o=v.getSelectedPortName();switch(t){case"STLinkMethod":case"jlinkMethod":case"usb":o="None"}o?v.portClose(o,()=>{C.upload(e,o)}):layer.msg(indexText["无可用设备"]+"!",{time:1e3})},C.upload=(t,o)=>{C.shellPath||(C.shellPath=""),h.tabChange("output");const e=layer.open({type:1,title:indexText["上传中"]+"...",content:$("#mixly-loader-div"),shade:g.SHADE_NAV,resize:!1,closeBtn:0,success:function(){$(".layui-layer-page").css("z-index","198910151"),$("#mixly-loader-btn").off("click").click(()=>{$("#mixly-loader-btn").css("display","none"),layer.title(indexText["上传终止中"]+"...",e),C.cancel()})},end:function(){$("#mixly-loader-div").css("display","none"),$("layui-layer-shade"+e).remove(),$("#mixly-loader-btn").off("click"),$("#mixly-loader-btn").css("display","inline-block")}});A.show(1),A.setValue(indexText["上传中"]+"...\n");var i=b.resolve(C.shellPath,"../arduino-cli.json"),r=b.resolve(C.shellPath,"../libraries"),l=b.resolve(p.clientPath,"./mixlyBuild"),n=b.resolve(p.clientPath,"./mixlyBuildCache"),a=b.resolve(p.clientPath,"./testArduino/testArduino.ino");let s="";if(""!==C.binFilePath)s='"'+C.shellPath+'" -b '+t+" upload -p "+o+' --config-file "'+i+'" --verbose -i "'+C.binFilePath+'" --no-color',C.binFilePath="";else{let e=p.indexDirPath+"/libraries/myLib/";x.isdir(e)?e+='","':e="";var d,c=b.resolve(p.indexDirPath,"libraries/ThirdParty");if(x.isdir(c))for(d of f.readdirSync(c)){var u=b.resolve(c,d,"libraries");x.isdir(u)&&(e+=u+",")}s='"'+C.shellPath+'" compile -b '+t+" --upload -p "+o+' --config-file "'+i+'" --build-cache-path "'+n+'" --verbose --libraries "'+e+r+'" --build-path "'+l+'" "'+a+'" --no-color'}C.runCmd(e,"upload",s,function(){var e=y.getCode(),t=(A.show(1),v.portsOperator[o]);t&&(t=t["toolConfig"],(e=e.match(/(?<=Serial.begin[\s]*\([\s]*)[0-9]*(?=[\s]*\))/g))&&v.BAUDRATES.includes(+e[0])&&(t.baudRates=+e[0]),"no"!==m.autoOpenPort)&&v.connect(o,t.baudRates)})},C.cancel=function(){C.shell&&(C.shell.stdin.end(),C.shell.stdout.end(),"win32"===p.currentPlatform?c.exec("taskkill /pid "+C.shell.pid+" /f /t"):C.shell.kill("SIGTERM"),C.shell=null)},C.checkFileNameExtension=(e,t)=>{var o;return!!e&&(o=e.length,e=e.substring(e.lastIndexOf("."),o),!!t.includes(e))},C.isCppOrHpp=e=>C.checkFileNameExtension(e,[".c",".cpp",".h",".hpp"]),C.isMixOrIno=e=>C.checkFileNameExtension(e,[".mix",".xml",".ino"]),C.clearDirCppAndHppFiles=t=>{if(x.isdir(t)){var o,i=f.readdirSync(t);for(let e=0;e<i.length;e++)C.isCppOrHpp(i[e])&&(o=b.resolve(t,i[e]),f.unlinkSync(o))}},C.copyHppAndCppFiles=(t,o)=>{if(x.isdir(t)&&x.isdir(o)){var i=f.readdirSync(t);for(let e=0;e<i.length;e++)if(C.isCppOrHpp(i[e])){var r=b.resolve(t,i[e]),l=b.resolve(o,i[e]);try{f.copyFileSync(r,l)}catch(e){console.log(e)}}}},C.writeLibFiles=n=>new Promise((e,t)=>{var o,i=[];for(o in Blockly.Arduino.libs_){const r=Blockly.Arduino.libs_[o],l=b.resolve(n,o+".h");i.push(new Promise((e,t)=>{d.outputFile(l,r).finally(()=>{e()})}))}i.length?Promise.all(i).finally(()=>{e()}):e()}),C.runCmd=(r,l,e,n)=>{const t=y.getCode();var o=b.resolve(p.clientPath,"testArduino");const i=b.resolve(o,"testArduino.ino");C.clearDirCppAndHppFiles(o);var a=s.getFilePath();"yes"===m.compileCAndH&&x.isfile(a)&&C.isMixOrIno(a)&&(a=b.dirname(a),C.copyHppAndCppFiles(a,o)),C.writeLibFiles(o).then(()=>d.outputFile(i,t)).then(()=>{let i=Number(new Date);C.shell=c.exec(e,{maxBuffer:4096e6},(e,t,o)=>{null!==e&&console.log("exec error"+e)}),C.shell.stdout.on("data",e=>{e.length<1e3&&A.addValue(e)}),C.shell.stderr.on("data",e=>{try{e=e.replace(/(_[0-9A-F]{2}_[0-9A-F]{2}_[0-9A-F]{2})+/g,function(e){return decodeURIComponent(e.replace(/_/g,"%"))})}catch(e){console.log(e)}A.addValue(e)}),C.shell.on("close",e=>{layer.close(r);var t=parseInt((Number(new Date)-i)/1e3),o=t%60,t=parseInt(t/60),t=(t?t+"m":"")+o+"s";0===e?(o="compile"===l?indexText["编译成功"]:indexText["上传成功"],A.addValue("=="+o+"("+indexText["用时"]+" "+t+")==\n"),layer.msg(o+"！",{time:1e3}),n()):(e="compile"===l?indexText["编译失败"]:indexText["上传失败"],A.addValue("=="+e+"==\n")),A.scrollToTheBottom()})}).catch(e=>{console.log(e),layer.close(r);e="compile"===l?indexText["编译失败"]:indexText["上传失败"];A.addValue("=="+e+"==\n")})},C.saveBinOrHex=function(e){C.writeFile(p.clientPath+"/mixlyBuild",e)},C.writeFile=function(c,u){C.compile(function(){window.setTimeout(function(){const d=layer.open({type:1,title:indexText["保存中"]+"...",content:$("#mixly-loader-div"),shade:g.SHADE_ALL,resize:!1,closeBtn:0,success:function(){$(".layui-layer-page").css("z-index","198910151"),$("#mixly-loader-btn").off("click").click(()=>{layer.close(d),C.cancel()}),window.setTimeout(function(){try{c=c.replace(/\\/g,"/"),u=u.replace(/\\/g,"/")}catch(e){console.log(e)}try{var t=u.substring(0,u.lastIndexOf(".")),o=u.substring(u.lastIndexOf("/")+1,u.lastIndexOf(".")),e=u.substring(u.lastIndexOf(".")+1),i=(f.existsSync(t)||f.mkdirSync(t),f.existsSync(u)&&f.unlinkSync(u),c+"/testArduino.ino."+e),r=f.readFileSync(i),l=(f.writeFileSync(u,r),[".eep",".hex",".with_bootloader.bin",".with_bootloader.hex",".bin",".elf",".map",".partitions.bin",".bootloader.bin"]);for(let e=0;e<l.length;e++){var n,a=c+"/testArduino.ino"+l[e],s=t+"/"+o+l[e];f.existsSync(a)&&(n=f.readFileSync(a),f.writeFileSync(s,n))}layer.msg(indexText["保存成功"]+"！",{time:1e3})}catch(e){console.log(e),A.addValue(e+"\n")}layer.close(d)},500)},end:function(){$("#mixly-loader-div").css("display","none"),$("layui-layer-shade"+d).remove(),$("#mixly-loader-btn").off("click")}})},1e3)})},C.showUploadBox=function(e){var t=b.dirname(e),o=b.basename(e,b.extname(e));x.isdir(b.resolve(t,o))&&(e=b.resolve(t,o,b.basename(e)));const i=layer.msg(indexText["所打开文件可直接上传"],{time:-1,btn:[indexText["取消"],indexText["上传"]],shade:g.SHADE_ALL,btnAlign:"c",yes:function(){layer.close(i),C.binFilePath="",layer.msg(indexText["已取消上传"],{time:1e3})},btn2:function(){layer.close(i),C.uploadWithBinOrHex(e)},end:function(){C.binFilePath=""}})},C.uploadWithBinOrHex=function(e){layer.closeAll(),C.binFilePath=e,C.initUpload()}})(),(()=>{goog.require("layui"),goog.require("Mixly.Config"),goog.require("Mixly.StatusBar"),goog.require("Mixly.StatusBarPort"),goog.require("Mixly.Modules"),goog.require("Mixly.LayerExt"),goog.require("Mixly.Env"),goog.require("Mixly.Boards"),goog.require("Mixly.MFile"),goog.require("Mixly.MString"),goog.require("Mixly.Electron.Serial"),goog.provide("Mixly.Electron.BU");const{Electron:e,Config:t,StatusBar:m,StatusBarPort:a,Modules:o,LayerExt:c,Env:u,MFile:p,MString:i}=Mixly,{BU:f,Serial:s}=e,{SELECTED_BOARD:x,USER:d}=t;o.iconv_lite=require("iconv-lite");const g=layui["form"],{fs:b,fs_extra:A,fs_extend:C,iconv_lite:h,os:y,child_process:v,path:B}=o;f.uploading=!1,f.burning=!1,f.shell=null,f.checkNumOfDisks=function(o,e,i){let t=e,r=(t=(t=t.replace(/\s+/g,"")).replace("DeviceID","")).split(":"),l="win32"===u.currentPlatform?":":"";if(e.indexOf(":")!=e.lastIndexOf(":")){var e=layui.form,n=$("#mixly-selector-type"),a=$("#mixly-selector-type option:selected").val();n.empty();for(let e=0;e<r.length;e++)r[e]&&(a==r[e]+l?n.append('<option value="'+r[e]+l+'" selected>'+r[e]+l+"</option>"):n.append('<option value="'+r[e]+l+'">'+r[e]+l+"</option>"));e.render();let t=!1;const s=layer.open({type:1,id:"serial-select",title:indexText["检测到多个同类型设备，请选择："],area:["350px","150px"],content:$("#mixly-selector-div"),shade:c.SHADE_ALL,resize:!1,closeBtn:0,success:function(e){$("#serial-select").css("height","195px"),$(".layui-layer-page").css("z-index","198910151"),$("#mixly-selector-btn1").off("click").click(()=>{layer.close(s),f.cancel()}),$("#mixly-selector-btn2").off("click").click(()=>{layer.close(s),t=!0})},end:function(){$("#mixly-selector-div").css("display","none"),$("#layui-layer-shade"+s).remove(),t&&f.initWithDropdownBox(o,i),$("#mixly-selector-btn1").off("click"),$("#mixly-selector-btn2").off("click")}})}else{const d=layer.open({type:1,title:("burn"===o?indexText["烧录中"]:indexText["上传中"])+"...",content:$("#mixly-loader-div"),shade:c.SHADE_ALL,resize:!1,closeBtn:0,success:function(e,t){"burn"===o?f.copyFiles(o,t,i,r[0]+l+"/"):A.outputFile(i,p.getCode()).then(()=>{f.copyFiles(o,t,i,r[0]+l+"/")}).catch(e=>{layer.close(t),f.burning=!1,f.uploading=!1,layer.msg(indexText["写文件出错了，错误是："]+e,{time:1e3}),m.setValue(indexText["写文件出错了，错误是："]+e+"\n")}),$("#mixly-loader-btn").off("click").click(()=>{layer.close(t),f.cancel()})},end:function(){$("#mixly-selector-div").css("display","none"),$("#layui-layer-shade"+d).remove(),$("#mixly-loader-btn").off("click")}})}},f.copyFiles=(t,o,e,i)=>{var r=x["upload"];"upload"===t&&r.copyLib&&(B.dirname(r.filePath),f.copyLib(e,p.getCode()),e=B.dirname(e)),C.isfile(e)&&(i=B.resolve(i,B.basename(e))),A.copy(e,i).then(()=>{layer.close(o);var e="burn"===t?indexText["烧录成功"]:indexText["上传成功"];layer.msg(e+"!",{time:1e3}),m.setValue(`==${e}==`),"upload"===t&&1===s.uploadPorts.length&&"no"!==d.autoOpenPort&&s.connect(s.uploadPorts[0].name,null,e=>{e&&s.writeCtrlD(s.uploadPorts[0].name)})}).catch(e=>{layer.close(o),layer.msg(indexText["写文件出错了，错误是："]+e,{time:1e3}),m.setValue(indexText["写文件出错了，错误是："]+e+"\n"),console.log(e)}).finally(()=>{f.burning=!1,f.uploading=!1})},f.initWithDropdownBox=function(i,r){const e=layer.open({type:1,title:("burn"===i?indexText["烧录中"]:indexText["上传中"])+"...",content:$("#mixly-loader-div"),shade:c.SHADE_ALL,resize:!1,closeBtn:0,success:function(e,t){$(".layui-layer-page").css("z-index","198910151"),$("#mixly-loader-btn").off("click").click(()=>{layer.close(t),f.cancel()});const o=$("#mixly-selector-type option:selected").val();"burn"===i?f.copyFiles(i,t,r,o):A.outputFile(r,p.getCode()).then(()=>{f.copyFiles(i,t,r,o)}).catch(e=>{layer.close(t),f.burning=!1,f.uploading=!1,layer.msg(indexText["写文件出错了，错误是："]+err,{time:1e3}),m.setValue(indexText["写文件出错了，错误是："]+e+"\n")})},end:function(){$("#mixly-loader-div").css("display","none"),$("#layui-layer-shade"+e).remove()}})},f.getDisksWithVolumesName=function(r,l,n){var e=B.dirname(n);if(A.ensureDirSync(e),"win32"===u.currentPlatform)v.exec('wmic logicaldisk where "'+l+'" get DeviceID',function(e,t,o){e||o?($("#mixly-loader-div").css("display","none"),console.log("root path open failed"+e+o),layer.msg(indexText["无可用设备"]+"!",{time:1e3}),f.burning=!1,f.uploading=!1):f.checkNumOfDisks(r,t,n)});else{let e="/Volumes/",t=" ",o=("linux"===u.currentPlatform&&(e="/media/",t=""),"");var a=l.split("/");let i=0;for(var s=0;s<a.length;s++)if(""!==a[s])for(var d=0;;d++){if(C.isdir(e+a[s]+(0==d?"":t+d)))o+=e+a[s]+(0==d?"":t+d)+":";else{if(!C.isdir(e+y.userInfo().username+"/"+a[s]+(0==d?"":t+d)))break;o+=e+y.userInfo().username+"/"+a[s]+(0==d?"":t+d)+":"}i++}0===i?(layer.msg(indexText["无可用设备"]+"!",{time:1e3}),f.burning=!1,f.uploading=!1):f.checkNumOfDisks(r,o,n)}},f.cancel=function(){f.shell?(f.shell.stdout.end(),f.shell.stdin.end(),"win32"===u.currentPlatform?v.exec("taskkill /pid "+f.shell.pid+" /f /t"):f.shell.kill("SIGTERM"),f.shell=null):f.uploading?(f.uploading=!1,layer.msg(indexText["已取消上传"],{time:1e3})):f.burning&&(f.burning=!1,layer.msg(indexText["已取消烧录"],{time:1e3}))},f.initBurn=function(){var e,t;f.burning||(e=x["burn"],m.setValue(""),a.tabChange("output"),m.show(1),f.burning=!0,f.uploading=!1,"volume"===e.type?f.getDisksWithVolumesName("burn",e.volume,e.filePath):(t=s.getSelectedPortName(),f.burnWithPort(t,e.command)))},f.initUpload=function(){var e,t;f.uploading||(e=x["upload"],m.setValue(""),a.tabChange("output"),m.show(1),f.burning=!1,f.uploading=!0,"volume"===e.type?f.getDisksWithVolumesName("upload",e.volume,e.filePath):(t=s.getSelectedPortName(),f.uploadWithPort(t,e.command)))},f.copyLib=function(e,t){var o,i=B.dirname(e),r=B.basename(e);A.ensureDirSync(i);try{for(o of b.readdirSync(i))o!==r&&b.unlinkSync(B.resolve(i,o))}catch(e){console.log(e)}e=[];return f.searchLibs(i,t,e)},f.searchLibs=function(r,l,n){var a=x["upload"];let s=new Array,d=(l.trim().split("\n").forEach(function(e,t){s.push(e)}),"");var c=[];for(let i=0;i<s.length;i++){let t=s[i].indexOf("from"),o=s[i].indexOf("import");if(s[i].substring(0,-1===t?o:t).split("").forEach(e=>{" "!==e&&"\t"!==e&&(t=-1,o=-1)}),-1!==t)d=s[i].substring(t+4,s[i].indexOf("import"));else{if(-1===o)continue;{let e=s[i].indexOf("as");-1===e&&(e=s[i].length),d=s[i].substring(o+6,e)}}var u,p,g=(d=(d=d.replaceAll(" ","")).replaceAll("\r","")).split(",");for(let t=0;t<g.length;t++)if(!n.includes(g[t]+".py")&&!n.includes(g[t]+".mpy"))try{let e=null;if(!a.libPath||!a.libPath.length)return;for(var A of a.libPath){var h=B.resolve(A,g[t]+".mpy"),y=B.resolve(A,g[t]+".py");if(C.isfile(h)){e=h;break}C.isfile(y)&&(e=y)}e&&(u=B.extname(e),p=B.resolve(r,g[t]+u),m.addValue(indexText["拷贝库"]+" "+g[t]+"\n"),b.copyFileSync(e,p),n.push(g[t]+u),".py"===u)&&(c.push(g[t]+u),l=b.readFileSync(e,"utf8"),n=f.searchLibs(r,l,n))}catch(e){console.log(e)}}return n},f.burnByCmd=function(e,t,o){f.runCmd(e,"burn",t,o)},f.uploadByCmd=async function(t,e,o){var i=x["upload"],r=p.getCode();i.copyLib&&f.copyLib(i.filePath,r),A.outputFile(i.filePath,r).then(()=>{m.addValue(indexText["上传中"]+"...\n"),f.runCmd(t,"upload",e,o)}).catch(e=>{m.setValue(e.toString()+"\n"),console.log(e),layer.close(t),f.uploading=!1})},f.runCmd=function(r,l,n,e,t){e=i.tpl(e,{com:n});f.shell=v.exec(e,function(e,t,o){layer.close(r),f.burning=!1,f.uploading=!1,f.shell=null;var i=m.getValue();if(i.lastIndexOf("\n")!==i.length-1&&m.addValue("\n"),e){try{e=decode(h.decode(h.encode(e,"iso-8859-1"),"gbk"))}catch(e){console.log(e)}m.addValue(e+"\n")}else layer.msg("burn"===l?indexText["烧录成功"]+"！":indexText["上传成功"]+"！",{time:1e3}),m.addValue(("burn"===l?indexText["烧录成功"]+"！":indexText["上传成功"]+"！")+"\n"),"upload"===l&&(m.show(1),"no"!==d.autoOpenPort)&&s.connect(n,null,e=>{e&&s.writeCtrlD(n)})}),f.shell.stdout.on("data",function(e){if(f.uploading||f.burning){try{e=decode(h.decode(h.encode(e,"iso-8859-1"),"gbk"))}catch(e){console.log(e)}m.addValue(e)}})},f.burnWithSpecialBin=()=>{var e,t=$("#mixly-selector-type"),o=$("#mixly-selector-type option:selected").val(),i=(t.empty(),x.burn.special);let r={};for(e of i){if(!e?.name&&!e?.command)return;r[e.name]=e.command,""+e.name==o?t.append($(`<option value="${e.name}" selected>${e.name}</option>`)):t.append($(`<option value="${e.name}">${e.name}</option>`))}g.render();let l=!1;const n=layer.open({type:1,id:"serial-select",title:"请选择固件：",area:["350px","150px"],content:$("#mixly-selector-div"),shade:Mixly.LayerExt.SHADE_ALL,resize:!1,closeBtn:0,success:function(e){$("#serial-select").css("height","180px"),$("#serial-select").css("overflow","inherit"),$(".layui-layer-page").css("z-index","198910151"),$("#mixly-selector-btn1").off("click").click(()=>{layer.close(n)}),$("#mixly-selector-btn2").click(()=>{layer.close(n),l=!0})},end:function(){var e,t;$("#mixly-selector-btn1").off("click"),$("#mixly-selector-btn2").off("click"),$("#mixly-selector-div").css("display","none"),$(".layui-layer-shade").remove(),l?(e=$("#mixly-selector-type option:selected").val(),m.setValue(""),a.tabChange("output"),m.show(1),f.burning=!0,f.uploading=!1,t=s.getSelectedPortName(),f.burnWithPort(t,r[e])):layer.msg(indexText["已取消烧录"],{time:1e3})}})},f.operateWithPort=(o,i,r)=>{if(i){const t=("burn"===o?indexText["烧录中"]:indexText["上传中"])+"...";s.portClose(i,()=>{const e=layer.open({type:1,title:t,content:$("#mixly-loader-div"),shade:c.SHADE_NAV,resize:!1,closeBtn:0,success:function(e,t){$(".layui-layer-page").css("z-index","198910151"),"burn"===o?f.burnByCmd(t,i,r):f.uploadByCmd(t,i,r),$("#mixly-loader-btn").off("click").click(()=>{$("#mixly-loader-btn").css("display","none"),"burn"===o?layer.title(indexText["烧录终止中"]+"...",t):layer.title(indexText["上传终止中"]+"...",t),f.cancel(o)})},end:function(){$("#mixly-loader-div").css("display","none"),$("layui-layer-shade"+e).remove(),$("#mixly-loader-btn").off("click"),$("#mixly-loader-btn").css("display","inline-block")}})})}else layer.msg(indexText["无可用设备"]+"!",{time:1e3}),f.burning=!1,f.uploading=!1},f.burnWithPort=(e,t)=>{f.operateWithPort("burn",e,t)},f.uploadWithPort=(e,t)=>{f.operateWithPort("upload",e,t)}})(),(()=>{goog.require("Mixly.Modules"),goog.require("Mixly.Env"),goog.require("Mixly.LayerExt"),goog.require("Mixly.Config"),goog.require("Mixly.Title"),goog.require("Mixly.MFile"),goog.require("Mixly.XML"),goog.require("Mixly.Editor"),goog.require("Mixly.Drag"),goog.require("Mixly.Electron.ArduShell"),goog.require("Mixly.Electron.BU"),goog.provide("Mixly.Electron.File");const{Modules:r,LayerExt:a,Config:e,Title:s,MFile:l,XML:i,Editor:d,Drag:n,Electron:t}=Mixly,c=e["BOARD"],{File:u,ArduShell:p}=t,{fs_extra:g,fs_extend:A,fs:h,path:y,electron_remote:o,app:m}=r,f=o["dialog"];u.DEFAULT_PATH=y.resolve(m.getAppPath(),"src/sample"),u.workingPath=u.DEFAULT_PATH,u.openedFilePath=null,u.userPath={img:null,mix:null,code:null,hex:null},u.showSaveDialog=(e,t,o)=>{var i=r["currentWindow"];i.focus(),f.showSaveDialog(i,{title:e,defaultPath:u.workingPath,filters:t,showsTagField:!0,properties:["showHiddenFiles"],message:e}).then(e=>{e=e.filePath;e&&o(e)}).catch(e=>{console.log(e)})},u.showOpenDialog=(e,t,o)=>{var i=r["currentWindow"];i.focus(),f.showOpenDialog(i,{title:e,defaultPath:u.workingPath,filters:t,properties:["openFile","showHiddenFiles"],message:e}).then(e=>{e=e.filePaths[0];e&&o(e)}).catch(e=>{console.log(e)})},u.save=(t=()=>{})=>{if(u.openedFilePath){let e="";switch(y.extname(u.openedFilePath)){case".mix":e=l.getMix();break;case".py":case".ino":e=l.getCode();break;default:return void layer.msg(indexText["文件后缀错误"],{time:1e3})}g.outputFile(u.openedFilePath,e).then(()=>{s.updeteFilePath(u.openedFilePath),layer.msg(indexText["保存成功"],{time:1e3})}).catch(e=>{u.openedFilePath=null,console.log(e),layer.msg(indexText["写文件出错"],{time:1e3})}).finally(()=>{t()})}else u.saveAs(t)},u.saveAs=(i=()=>{})=>{u.showSaveDialog(indexText["另存为"],l.saveFilters,t=>{var e=y.extname(t);if([".mix",".py",".ino"].includes(e))u.openedFilePath=t,u.workingPath=y.dirname(t),u.save(i);else switch(e){case".bin":case".hex":c?.nav?.compile?p.saveBinOrHex(t):(o=l.getHex(),g.outputFile(t,o).then(()=>{layer.msg(indexText["保存成功"],{time:1e3})}).catch(e=>{console.log(e),layer.msg(indexText["写文件出错"],{time:1e3})}).finally(()=>{i()}));break;case".png":l.getBlocksPng().then(e=>g.outputFile(t,e)).then(()=>{layer.msg(indexText["保存成功"],{time:1e3})}).catch(e=>{console.log(e),layer.msg(indexText["写文件出错"],{time:1e3})}).finally(()=>{i()});break;case".mil":var o=l.getMil(),o=$(o);o.attr("name",y.basename(t,".mil")),g.outputFile(t,o[0].outerHTML).then(()=>{layer.msg("库导出成功",{time:1e3})}).catch(e=>{console.log(e),layer.msg(indexText["写文件出错"],{time:1e3})}).finally(()=>{i()});break;default:layer.msg(indexText["文件后缀错误"],{time:1e3}),i()}})},u.exportLib=(o=()=>{})=>{u.showSaveDialog("导出库",[l.SAVE_FILTER_TYPE.mil],e=>{var t=l.getMil(),t=$(t);t.attr("name",y.basename(e,".mil")),g.outputFile(e,t[0].outerHTML).then(()=>{layer.msg("库导出成功",{time:1e3})}).catch(e=>{console.log(e),layer.msg(indexText["写文件出错"],{time:1e3})}).finally(()=>{o()})})},u.newFile=()=>{var e=d.blockEditor.getAllBlocks();const{blockEditor:o,codeEditor:i,selected:t}=d,r=Blockly?.Python??Blockly.Arduino;if("CODE"===t){var l=i.getValue(),n=r.workspaceToCode(o)||"";if(!e.length&&n===l)return layer.msg(indexText["代码区已清空"],{time:1e3}),u.openedFilePath=null,void s.updateTitle(s.title)}else if(!e.length)return layer.msg(indexText["工作区已清空"],{time:1e3}),u.openedFilePath=null,void s.updateTitle(s.title);layer.confirm(MSG.confirm_newfile,{title:!1,shade:a.SHADE_ALL,resize:!1,success:e=>{e[0].childNodes[1].childNodes[0].classList.remove("layui-layer-close2"),e[0].childNodes[1].childNodes[0].classList.add("layui-layer-close1")},btn:[MSG.newfile_yes,MSG.newfile_no],btn2:(e,t)=>{layer.close(e)}},(e,t)=>{layer.close(e),o.clear(),o.scrollCenter(),Blockly.hideChaff(),i.setValue(r.workspaceToCode(o)||"",-1),u.openedFilePath=null,s.updateTitle(s.title)})},u.open=()=>{u.showOpenDialog(indexText["打开"],[{name:indexText["Mixly文件"],extensions:l.openFilters}],e=>{u.openFile(e)})},u.openFile=t=>{var e=y.extname(t);let o;if(A.isfile(t)){try{o=h.readFileSync(t,"utf-8")}catch(e){return void console.log(e)}switch(e){case".mix":case".xml":try{o=(o=i.convert(o,!0)).replace(/\\(u[0-9a-fA-F]{4})/g,function(e){return unescape(e.replace(/\\(u[0-9a-fA-F]{4})/g,"%$1"))})}catch(e){console.log(e)}l.parseMix($(o),!1,!1,e=>{e?(d.blockEditor.scrollCenter(),Blockly.hideChaff(),u.openedFilePath=null,s.updateTitle(s.title)):(u.openedFilePath=t,u.workingPath=y.dirname(t),s.updeteFilePath(u.openedFilePath))});break;case".ino":case".py":n.items.vDrag.full("NEGATIVE"),d.codeEditor.setValue(o,-1),u.openedFilePath=t,u.workingPath=y.dirname(t),s.updeteFilePath(u.openedFilePath);break;case".bin":case".hex":c?.nav?.compile?p.showUploadBox(t):l.loadHex(o);break;default:layer.msg(indexText["文件后缀错误"],{time:1e3})}}else console.log(t+"不存在")}})(),(()=>{goog.require("Mixly.Url"),goog.require("Mixly.Config"),goog.require("Mixly.Modules"),goog.require("Mixly.Env"),goog.require("Mixly.Electron.Serial"),goog.provide("Mixly.Electron.Loader");const{Url:a,Config:s,Electron:e,Env:d}=Mixly,c=s["BOARD"],{Serial:u,Loader:p}=e;p.onbeforeunload=function(t=!1){const e=e=>{t?window.location.reload(!0):window.location.replace(e)};let o=s.pathPrefix+"/index.html?"+a.jsonToUrl({boardType:c.boardType??"None"});u?.refreshPortsTimer&&clearInterval(u?.refreshPortsTimer);var i=u?.portsOperator??null;if(d.isElectron&&i&&"object"==typeof i&&Object.keys(i).length){var r,l=[];for(r in i){var n=i[r]["serialport"];n&&(n.isOpen||n.opening)&&l.push(p.closePort(n))}Promise.all(l).then(()=>{}).catch(e=>{}).finally(()=>{e(o)})}else e(o)},p.closePort=o=>new Promise((e,t)=>{o.close(()=>{e()})}),p.reload=()=>{p.onbeforeunload(!0)}})(),(()=>{goog.require("Mixly.StatusBar"),goog.require("Mixly.StatusBarPort"),goog.require("Mixly.LayerExt"),goog.require("Mixly.Config"),goog.require("Mixly.MFile"),goog.require("Mixly.Boards"),goog.require("Mixly.Web.Serial"),goog.require("Mixly.Web.Esptool"),goog.require("Mixly.Web.USB"),goog.require("Mixly.Web.SerialPort"),goog.require("Mixly.Web.Ampy"),goog.provide("Mixly.Web.BU");const{StatusBar:u,StatusBarPort:p,Web:e,LayerExt:i,Config:t,MFile:g}=Mixly,{Serial:A,Esptool:o,BU:h,USB:a,SerialPort:y,Ampy:d}=e,c=t["SELECTED_BOARD"];h.uploading=!1,h.burning=!1;let m=null;const f=new o.EspLoader({updateProgress:!1,logMsg:!1,debugMsg:!1,debug:!1});h.clickConnect=async function(){let e;e="usb"==c.web.com?"web-usb":"web-serial";var t=A.portsOperator[e];t&&t.portOpened?A.portClose(e):A.connect(e,115200,e=>{e?u.show(1):layer.msg(indexText["已取消连接"],{time:1e3})})};async function x(){return await f.sync()?(u.addValue(indexText["正在连接"]+" "+await f.chipName()+"\n"),u.addValue(indexText["MAC地址"]+"："+f.macAddr().map(e=>e.toString(16).toUpperCase().padStart(2,"0")).join(":")+"\n"),m=await f.runStub(),1):0}function b(t){return new Promise(e=>setTimeout(e,t))}async function C(e,t=null){u.addValue(indexText["正在烧录固件"]+"\n");e=parseInt(e,16);await m.flashData(t,e),await b(100)}h.initBurn=()=>{"usb"===c.web.com?h.burnByUSB():h.burnWithEsptool()},h.burnByUSB=()=>{A.connect("web-usb",115200,async e=>{if(e){const{toolConfig:o,serialport:r}=A.portsOperator["web-usb"],l=o.baudRates;115200!==l&&(o.baudRates=115200,await r.setBaudRate(o.baudRates));e=c["web"],e=e["burn"],e=goog.get(e.filePath);const n=await new Blob([e],{type:"text/plain"}).arrayBuffer();if(n){h.burning=!0,h.uploading=!1,u.setValue(indexText["烧录中"]+"...\n"),u.show(1),p.tabChange("output");const t=layer.open({type:1,title:indexText["烧录中"]+"...",content:$("#mixly-loader-div"),shade:i.SHADE_NAV,resize:!1,closeBtn:0,success:function(e,t){$(".layui-layer-page").css("z-index","198910151"),$("#mixly-loader-btn").hide();let i=0;a.DAPLink.on(DAPjs.DAPLink.EVENT_PROGRESS,e=>{var t,o,e=Math.floor(100*e);e>i&&(i=e,o=Math.floor(e/2),t=new Array(o).fill("=").join(""),o=new Array(50-o).fill("-").join(""),u.addValue(`[${t}${o}] ${e}%
`))}),a.flash(n).then(()=>{layer.close(t),layer.msg(indexText["烧录成功"],{time:1e3}),u.addValue(`==${indexText["烧录成功"]}==
`)}).catch(e=>{console.log(e),layer.close(t),u.addValue(`==${indexText["烧录失败"]}==
`)}).finally(async()=>{h.burning=!1,h.uploading=!1,o.baudRates!==l&&(o.baudRates=l,await r.setBaudRate(l)),a.DAPLink.removeAllListeners(DAPjs.DAPLink.EVENT_PROGRESS)})},end:function(){$("#mixly-loader-btn").css("display","inline-block"),$("#mixly-loader-div").css("display","none"),$("#layui-layer-shade"+t).remove()}})}else layer.msg(indexText["固件读取出错"],{time:1e3})}else layer.msg(indexText["已取消连接"],{time:1e3})})},h.burnWithEsptool=()=>{const d="web-serial";A.connect(d,115200,async e=>{if(e){const{toolConfig:l,serialport:n}=A.portsOperator[d],a=l.baudRates;115200!==a&&(l.baudRates=115200,await n.setBaudRate(l.baudRates));e=c["web"];const s=e["burn"];if(u.setValue(indexText["固件读取中"]+"..."),"object"!=typeof s.binFile)u.addValue(" Failed!\n"+indexText["配置文件读取出错"]+"！\n");else{var t,e=s["binFile"],o=[];u.addValue("\n");for(t of e)t.path&&t.offset&&(u.addValue(indexText["读取固件"]+" "+indexText["路径"]+`:${t.path}, ${indexText["偏移"]}:${t.offset}
`),o.push(((o,i)=>new Promise((t,e)=>{fetch(o).then(e=>e.blob()).then(e=>{t({offset:i,blob:e})}).catch(e=>{t({offset:i,blob:null})})}))(t.path,t.offset)));Promise.all(o).then(async e=>{console.log(e);let r=[];for(var t of e)t.blob&&t.offset&&r.push({offset:t.offset,binBuf:await(o=>{const i=new FileReader;return new Promise((e,t)=>{i.onerror=()=>{i.abort(),t(new DOMException("Problem parsing input file."))},i.onload=()=>{e(i.result)},i.readAsArrayBuffer(o)})})(t.blob)});if(!r.length)throw"";u.addValue("Done!\n"+indexText["即将开始烧录"]+"...\n"),h.burning=!0,h.uploading=!1,u.addValue(indexText["烧录中"]+"...\n"),u.show(1),p.tabChange("output");const o=layer.open({type:1,title:indexText["烧录中"]+"...",content:$("#mixly-loader-div"),shade:i.SHADE_NAV,resize:!1,closeBtn:0,success:async function(e,t){$(".layui-layer-page").css("z-index","198910151"),$("#mixly-loader-btn").hide();try{if(y.refreshOutputBuffer=!1,y.refreshInputBuffer=!0,await f.reset(),await x()){s.erase&&(u.addValue(indexText["正在擦除闪存，请稍等"]+"...\n"),i=Date.now(),await m.eraseFlash(),u.addValue(indexText["擦除完成，擦除耗时"]+(Date.now()-i)+"ms\n"),await b(100));for(var o of r)await C(o.offset,o.binBuf)}layer.close(t),layer.msg(indexText["烧录成功"],{time:1e3}),u.addValue(`==${indexText["烧录成功"]}==
`),A.reset(d,"burn")}catch(e){console.log(e),layer.close(t),u.addValue(`==${indexText["烧录失败"]}==
`)}finally{y.refreshOutputBuffer=!0,y.refreshInputBuffer=!1,l.baudRates!==a&&(l.baudRates=a,await n.setBaudRate(a))}var i},end:function(){$("#mixly-loader-btn").css("display","inline-block"),$("#mixly-loader-div").css("display","none"),$("#layui-layer-shade"+o).remove()}})}).catch(async e=>{u.addValue("Failed!\n"+indexText["无法获取文件，请检查网络"]+"！\n"),u.addValue("\n"+e+"\n",!0)})}}else layer.msg(indexText["已取消连接"],{time:1e3})})},h.getImportModulesName=e=>{var i,{web:t={}}=c,t=t["lib"];if(!(t instanceof Object))return[];let o=[],r=(e.trim().split("\n").forEach(function(e,t){o.push(e)}),""),l=[];for(i of o){let t=i.indexOf("from"),o=i.indexOf("import");if(i.substring(0,-1===t?o:t).split("").forEach(e=>{" "!==e&&"\t"!==e&&(t=-1,o=-1)}),-1!==t)r=i.substring(t+4,i.indexOf("import"));else{if(-1===o)continue;r=i.substring(o+6)}r=(r=r.replaceAll(" ","")).replaceAll("\r",""),l=[...l,...r.split(",")]}return l},h.searchLibs=(e,t=[])=>{var o,{web:i={}}=c,r=i["lib"];if(!(r instanceof Object))return[];for(o of e)t.includes(o)||r[o]&&(t.push(o),u.addValue(indexText["拷贝库"]+" "+o+".py\n"),r[o].import.length)&&(t=h.searchLibs(r[o].import,t));return t},h.initUpload=()=>{var e="web-"+(c.web.com??"serial");h.uploadWithAmpy(e)},h.uploadWithAmpy=e=>{A.connect(e,115200,async r=>{if(r){const l=A.portsOperator[r],{serialport:n,toolConfig:a}=l,s=a.baudRates,e=(115200!==s&&(a.baudRates=115200,await n.setBaudRate(a.baudRates)),h.burning=!1,h.uploading=!0,u.setValue(indexText["上传中"]+"...\n"),u.show(1),p.tabChange("output"),layer.open({type:1,title:indexText["上传中"]+"...",content:$("#mixly-loader-div"),shade:i.SHADE_NAV,resize:!1,closeBtn:0,success:function(e,t){$("#mixly-loader-btn").hide(),$(".layui-layer-page").css("z-index","198910151");const o=new d(n,"web-serial"===r),i=g.getCode();l.busy=!0,A.reset(r,"upload").then(()=>o.put("main.py",i)).then(()=>{layer.close(t),layer.msg(indexText["上传成功"],{time:1e3}),u.addValue(`==${indexText["上传成功"]}==
`),p.tabChange(r),p.scrollToTheBottom(r)}).catch(e=>{console.log(e),layer.close(t),u.addValue(`[Error] ${e}
`),u.addValue(`==${indexText["上传失败"]}==
`)}).finally(async()=>{l.busy=!1,h.burning=!1,h.uploading=!1,a.baudRates!==s&&(a.baudRates=s,await n.setBaudRate(s))})},end:function(){$("#mixly-loader-btn").css("display","inline-block"),$("#mixly-loader-div").css("display","none"),$("#layui-layer-shade"+e).remove()}}))}else layer.msg(indexText["已取消连接"],{time:1e3})})},h.uploadWithEsptool=async(e,t,o)=>{var i="web-serial",{serialport:r,toolConfig:l}=A.portsOperator[i];let n=l.baudRates;115200!==n&&(l.baudRates=115200,await r.setBaudRate(l.baudRates));t=t.data;if(e||"object"!=typeof t)u.addValue(indexText["固件获取失败"]+"！\n"),layer.close(o);else{layer.title(indexText["上传中"]+"...",o),u.addValue(indexText["固件读取中"]+"... ");var a,s,d=[];for(a of t)a.offset&&a.data&&(s={offset:a.offset,binBuf:(s=a.data,new Uint8Array(s.match(/[\da-f]{2}/gi).map(function(e){return parseInt(e,16)})).buffer)},d.push(s));u.addValue("Done!\n"+indexText["即将开始烧录"]+"...\n"),h.burning=!0,h.uploading=!1,u.addValue(indexText["上传中"]+"...\n"),u.show(1),p.tabChange("output");try{if(y.refreshOutputBuffer=!1,y.refreshInputBuffer=!0,await f.reset(),await x())for(var c of d)await C(c.offset,c.binBuf);layer.close(o),layer.msg(indexText["上传成功"],{time:1e3}),u.addValue(`==${indexText["上传成功"]}==
`),A.reset(i,"upload"),p.tabChange(i)}catch(e){console.log(e),layer.close(o),u.addValue(`==${indexText["上传失败"]}==
`)}finally{y.refreshOutputBuffer=!0,y.refreshInputBuffer=!1;e=g.getCode().match(/(?<=Serial.begin[\s]*\([\s]*)[0-9]*(?=[\s]*\))/g);e&&A.BAUDRATES.includes(+e[0])&&(n=+e[0]),l.baudRates!==n&&(l.baudRates=n,await r.setBaudRate(n))}}},h.uploadWithAvrUploader=async(e,o,i)=>{o=o.data;if(e||"object"!=typeof o)u.addValue(indexText["固件获取失败"]+"！\n"),layer.close(i);else{u.addValue(indexText["上传中"]+"...\n"),layer.title(indexText["上传中"]+"...",i);let t=!0;AvrUploader.upload(o[0].data,e=>{100<=e&&t&&(u.addValue(`==${indexText["上传成功"]}==
`),layer.msg(indexText["上传成功"],{time:1e3}),layer.close(i),t=!1)},!0).catch(e=>{layer.close(i),u.addValue(`==${indexText["上传失败"]}==
`)})}}})(),(()=>{goog.require("Mixly.Config"),goog.require("Mixly.Env"),goog.require("Mixly.MJSON"),goog.require("Mixly.Example"),goog.require("Mixly.Boards"),goog.provide("Mixly.Web.ExampleExt");const{Config:o,Env:e,Example:t,MJSON:i,Boards:r}=Mixly,l=o["BOARD"];class a extends t{constructor(e,t){super(e,t),this.render()}getExampleList(){var e=a["DIR_TREE"];let t=[];return t=e instanceof Object&&e[l.boardType]?[{title:l.boardType,id:l.boardType,children:[]}]:t}getExamples(e){var t,o=a["DIR_TREE"];let i=o;for(t of e.split("/")){if(!i[t])return[];i=i[t]}if(!(i instanceof Object))return[];var r,l=[];for(r in i){var n={title:r,id:e+"/"+r};i[r]instanceof Object&&(n.children=[]),l.push(n)}return l}dataToWorkspace(e){var t=goog.get(o.pathPrefix+"../sample/"+e);this.updateCode(e.substring(e.lastIndexOf(".")),t)}}Object.defineProperty(Mixly.Web,"ExampleExt",{value:a,writable:!0,enumerable:!0,configurable:!0}),e.isElectron||(a.DIR_TREE=i.get(`../../../sample/${r.getType()}.json`)??[])})(),(()=>{goog.require("Mixly.Url"),goog.require("Mixly.StatusBar"),goog.require("Mixly.StatusBarPort"),goog.require("Mixly.Config"),goog.require("Mixly.LayerExt"),goog.require("Mixly.Url"),goog.require("Mixly.Boards"),goog.require("Mixly.MFile"),goog.require("Mixly.Web.BU"),goog.require("Mixly.Web.Serial"),goog.provide("Mixly.WebCompiler.Compiler");const{WebCompiler:e,Url:l,Boards:n,MFile:a,StatusBar:s,StatusBarPort:i,Config:t,LayerExt:d,Web:o}=Mixly,{SOFTWARE:r,BOARD:c}=t,u=e["Compiler"],{BU:p,Serial:g}=o;var A=(u.CONFIG={enabled:!0,port:8082,protocol:"http:",ip:"localhost",domain:null,...r?.webCompiler??{}},u)["CONFIG"];A.ip="localhost"===A.ip?window.location.hostname:A.ip,u.URL=A.protocol+"//"+(A.domain||A.ip+":"+A.port)+"/",u.compile=()=>{s.show(1),s.setValue(""),u.generateCommand("compile",(e,t,o)=>{layer.close(o);let i=indexText["编译成功"];e&&(i=indexText["编译失败"]),layer.msg(i,{time:1e3}),s.addValue("=="+i+"("+indexText["用时"]+" "+t.timeCost+")==\n")})},u.upload=async()=>{s.show(1),s.setValue(""),p.burning=!1,p.uploading=!0;var t=n.getSelectedBoardCommandParam().split(":"),o="web-serial";if("avr"===t[1]){let e;switch(t[2]){case"uno":e="uno";break;case"nano":e=3<t.length&&"cpu=atmega328old"===t[3]?"nanoOldBootloader":"nano";break;case"pro":e="proMini"}g.portClose(o,async()=>{i.tabChange("output");try{await AvrUploader.connect(e,{}),u.generateCommand("upload",p.uploadWithAvrUploader)}catch(e){s.addValue(e.toString()+"\n")}})}else g.connect(o,115200,async e=>{e?(i.tabChange("output"),u.generateCommand("upload",p.uploadWithEsptool)):layer.msg(indexText["已取消连接"],{time:1e3})})},u.generateCommand=(e,t=(e,t,o)=>{})=>{var o=a.getCode(),i=n.getSelectedBoardCommandParam(),i={board:encodeURIComponent(i),code:encodeURIComponent(o),visitorId:c.visitorId.str32CRC32b,operate:e},o=u.URL+"/?"+l.jsonToUrl(i);s.setValue(indexText["编译中"]+"...\n"),console.log("send -> ",o);const r=layer.open({type:1,title:indexText["编译中"]+"...",content:$("#mixly-loader-div"),shade:d.SHADE_NAV,closeBtn:0,success:function(){$(".layui-layer-page").css("z-index","198910151"),$("#mixly-loader-btn").off("click").click(()=>{layer.close(r),layer.msg("已取消编译",{time:1e3})})},end:function(){$("#mixly-loader-div").css("display","none"),$(".layui-layer-shade").remove()}});u.sendCommand(r,o,t)},u.sendCommand=(t,e,o=(e,t,o)=>{})=>{e=new Request(e);fetch(e,{credentials:"omit",mode:"cors"}).then(e=>e.text()).then(e=>{e=JSON.parse(e);console.log(e),e.error?(s.addValue(decodeURIComponent(e.error)),o(!0,null,t)):(s.addValue(decodeURIComponent(e.compileMessage)),o(!1,{data:e.data,timeCost:decodeURIComponent(e.timeCost)},t))}).catch(e=>{o(!0,e.toString(),t)})}})(),(()=>{goog.require("layui"),goog.require("Blockly"),goog.require("Mixly.XML"),goog.require("Mixly.Editor"),goog.require("Mixly.MFile"),goog.require("Mixly.Boards"),goog.require("Mixly.LayerExt"),goog.require("Mixly.WebSocket.Socket"),goog.provide("Mixly.WebSocket.File");const{XML:o,Editor:i,MFile:r,Boards:e,LayerExt:t}=Mixly,{Socket:l,File:n}=Mixly.WebSocket,a=e.getType(),s=layui["form"];n.saveToCloud=()=>{l.connect(e=>{layer.closeAll()},()=>{layer.prompt({title:MSG.save_ser,shade:t.SHADE_ALL,value:"main.mix",success:function(e,t){$(e).find("input").attr("spellcheck",!1)}},function(t,o,e){layer.close(o);o=t.substring(t.lastIndexOf(".")).toLowerCase();let i=[];if(r.saveFilters.map(e=>{i=[...i,...e.extensions]}),i.includes(o.substring(1))){let e;switch(o){case".mix":e=r.getMix();break;case".ino":case".py":e=r.getCode();default:layer.msg(indexText["文件后缀错误"],{time:1e3})}e&&l.sendCommand({obj:"File",func:"saveAs",args:[a,t,e]})}else layer.msg(indexText["文件后缀错误"],{time:1e3})})})},n.saveSuccess=e=>{layer.msg(e+" "+indexText["保存成功"],{time:1e3})},n.saveError=(e,t)=>{layer.msg(e+" 保存失败",{time:1e3})},n.openFromCloud=()=>{l.sendCommand({obj:"File",func:"getUserFilesInfo",args:[a]})},n.showOpenDialog=e=>{const t=$("#mixly-selector-type");t.empty(),e.map(e=>{t.append($(`<option value="${e.path}">${e.name}</option>`))}),s.render();let o=!1;const i=layer.open({type:1,id:"serial-select",title:"请选择需要打开的文件：",area:["350px","150px"],content:$("#mixly-selector-div"),shade:Mixly.LayerExt.SHADE_ALL,resize:!1,closeBtn:0,success:function(e){$("#serial-select").css("height","180px"),$("#serial-select").css("overflow","inherit"),$(".layui-layer-page").css("z-index","198910151"),$("#mixly-selector-btn1").off("click").click(()=>{layer.close(i)}),$("#mixly-selector-btn2").click(()=>{layer.close(i),o=!0})},end:function(){var e;$("#mixly-selector-btn1").off("click"),$("#mixly-selector-btn2").off("click"),$("#mixly-selector-div").css("display","none"),$(".layui-layer-shade").remove(),o&&(e=$("#mixly-selector-type option:selected").val(),l.sendCommand({obj:"File",func:"open",args:[a,e]}))}})},n.open=(e,t)=>{switch(e){case".mix":case".xml":i.items.vDrag.full("POSITIVE");try{t=(t=o.convert(t,!0)).replace(/\\(u[0-9a-fA-F]{4})/g,function(e){return unescape(e.replace(/\\(u[0-9a-fA-F]{4})/g,"%$1"))})}catch(e){console.log(e)}r.parseMix($(t),!1,!1,e=>{i.blockEditor.scrollCenter(),Blockly.hideChaff()});break;case".ino":case".py":i.items.vDrag.full("NEGATIVE"),i.codeEditor.setValue(t,-1)}},n.openSuccess=e=>{layer.msg(e+" 打开成功",{time:1e3})},n.openError=(e,t)=>{layer.msg(e+" 打开失败",{time:1e3})}})(),(()=>{goog.require("Mixly.Modules"),goog.require("Mixly.Charts"),goog.require("Mixly.StatusBar"),goog.require("Mixly.StatusBarPort"),goog.require("Mixly.Config"),goog.require("Mixly.Tools"),goog.require("Mixly.Env"),goog.require("Mixly.LayerExt"),goog.require("Mixly.XML"),goog.require("Mixly.MArray"),goog.require("Mixly.WebSocket.Socket"),goog.provide("Mixly.WebSocket.Serial");const{Charts:n,StatusBar:a,StatusBarPort:s,Config:e,Tools:l,LayerExt:d,XML:c,MArray:t}=Mixly,{Socket:u,Serial:p}=Mixly.WebSocket,{BOARD:o,SELECTED_BOARD:g}=e,A=s["portAce"];p.TOOL_DEFAULT_CONFIG={ctrlCBtn:!1,ctrlDBtn:!1,baudRates:115200,yMax:100,yMin:0,pointNum:100,rts:!1,dtr:!1,scroll:!0,sendStr:!0,receiveStr:!0,sendWith:"\\r\\n",tabIndex:0,...o?.serial??{}},p.DEFAULT_BAUD=[9600,19200,28800,38400,57600,115200],p.DEFAULT_SEND_WITH=["\\r\\n","\\r","\\n","no"],p.PORT_SELECT={BURN:o?.burn?.portSelect??"all",UPLOAD:o?.upload?.portSelect??"all"},p.UPLOAD_RESET=o?.upload?.reset??{},p.HAS_PORT={BURN:o?.nav?.burn??!1,UPLOAD:o?.nav?.upload??!1},p.MAX_OUTPUT_LINE=500,p.REFRESH_OUTPUT_TIME=100,p.BAUDRATES=[9600,19200,28800,38400,57600,115200],p.TERMINAL_COMMAND={config:{"-d|--dtr":{help:"设置DTR, 可选值: [0, 1], 例如: config -d 1",key:"DTR"},"-r|--rts":{help:"设置RTS, 可选值: [0, 1], 例如: config -r 1",key:"RTS"},"-b|--baud":{help:"设置波特率, 可选值: ["+p.DEFAULT_BAUD.join(", ")+"], 例如: config -b "+p.DEFAULT_BAUD[0],key:"BAUD"},"-t|--rtype":{help:"设置串口接收数据的类型, 可选值: [0, 1], 例如: config -t 1",key:"RTYPE"},"-w|--swith":{help:"设置发送数据时的结尾字符串, 可选值: ["+p.DEFAULT_SEND_WITH.join(", ")+"], 例如: config -w "+p.DEFAULT_SEND_WITH[0],key:"SWITH"},"-s|--scroll":{help:"设置接收框滑动条是否一直在最下方, 可选值: [0, 1], 例如: config -s 1",key:"SCROLL"},"-h|--help":{help:"输出帮助信息, 例如: config -h",key:"HELP"},callback:"terminalConfigCallback"},port:{"-o|--open":{help:"打开当前串口, 例如: port -o",key:"OPEN"},"-c|--close":{help:"关闭当前串口, 例如: port -c",key:"CLOSE"},"-h|--help":{help:"输出帮助信息, 例如: port -h",key:"HELP"},callback:"terminalPortCallback"},send:{"-s|--str":{help:"发送字符串, 可选值: 字符串, 例如: send -s 你好Mixly",key:"STR"},"-b|--bytes":{help:"发送字节数组, 可选值: 字符串, 例如: send -b 0x01,0x02,0x03",key:"BYTES"},"-w|--with":{help:"发送数据时的结尾字符串, 可选值: ["+p.DEFAULT_SEND_WITH.join(", ")+"], 例如: send -s 你好Mixly -w \\r\\n",key:"WITH"},"-h|--help":{help:"输出帮助信息, 例如: send -h",key:"HELP"},callback:"terminalSendCallback"},exit:{callback:"terminalExitCallback"}},p.portsOperator={},p.deadPortsOperator={},p.selectedUploadPort={},p.selectedBurnPort={},p.ports=[],p.burnPorts=[],p.uploadPorts=[],p.initPorts=(t,e=e=>{})=>{var o=[];for(let e=0;e<t.length;e++){var i=t[e];o.push({vendorId:i.vendorId,productId:i.productId,name:i.path})}e(o)},p.getPorts=(t,o)=>{if("object"!=typeof t)return[];var i=[];if("string"==typeof o&&"all"===o)for(let e=0;e<t.length;e++){var r=t[e];r.vendorId||(r.vendorId="None"),r.productId||(r.productId="None"),i.push(r)}else if("object"==typeof o)for(let e=0;e<t.length;e++){var l=t[e];for(let e=0;e<o.length;e++)if(o[e].vendorId&&o[e].productId&&l.vendorId&&l.productId&&o[e].vendorId.toLowerCase()===l.vendorId.toLowerCase()&&o[e].productId.toLowerCase()===l.productId.toLowerCase()){i.push(l);break}}return i},p.getBurnPorts=()=>p.getPorts(p.ports,p.PORT_SELECT.BURN),p.getUploadPorts=()=>p.getPorts(p.ports,p.PORT_SELECT.UPLOAD),p.refreshPorts=e=>{t.equals(e,p.ports)||(p.ports=e,p.HAS_PORT.BURN?p.burnPorts=p.getBurnPorts():p.burnPorts=[],p.HAS_PORT.UPLOAD?p.uploadPorts=p.getUploadPorts():p.uploadPorts=[],e=[...p.burnPorts,...p.uploadPorts],e=t.unique(e),p.refreshPortOperator(e),p.refreshUploadPortSelectBox(e))},p.refreshUploadPortSelectBox=e=>{var t=layui["form"];const o=$("#ports-type"),i=o.val();o.empty(),e.map(e=>{e=e.name;i==e?o.append($(`<option value="${e}" selected>${e}</option>`)):o.append($(`<option value="${e}">${e}</option>`))}),t.render("select","ports-type-filter"),e.length?($("#mixly-footer-port-div").css("display","inline-flex"),$("#mixly-footer-port").html(p.getSelectedPortName())):($("#mixly-footer-port-div").hide(),$("#mixly-footer-port").html(""))},p.refreshToolPortSelectBox=e=>{var t,o=layui["form"];p.getOpenedPortsName();for(t in p.portsOperator){var i,r=p.portsOperator[t]["dom"];r&&(i=r.id["selectPortId"],r=r.filter["formFilter"],(i=$("#"+i)).empty(),i.append($(`<option value="${t}" selected>${t}</option>`)),o.render("select",r))}},p.refreshPortOperator=t=>{var e,o,i,r,l,n,a={...p.portsOperator},s=(p.portsOperator={},[]);for(let e=0;e<t.length;e++){var d,c=t[e];s.push(c.name),a[c.name]?p.portsOperator[c.name]=a[c.name]:p.deadPortsOperator[c.name]?(p.portsOperator[c.name]={...p.deadPortsOperator[c.name]},delete p.deadPortsOperator[c.name],p.refreshToolPortSelectBox(c.name)):(d={toolConfig:{...p.TOOL_DEFAULT_CONFIG},toolOpened:!1,portOpened:!1,vendorId:c.vendorId,productId:c.productId,dom:null,serialport:null,output:[]},p.portsOperator[c.name]=d),p.refreshTerminalMenu(c.name)}for(e in a)s.includes(e)||(i=(o=a[e])["dom"],i&&(o.toolOpened?(r=layui["form"],l=i.id["selectPortId"],n=i.filter["formFilter"],$("#"+l).empty(),r.render("select",n),p.deadPortsOperator[e]={...o}):i.destroy()),p.refreshTerminalMenu(e))},p.getOpenedPortsName=()=>{var e,t=[];for(e in p.portsOperator)p.portsOperator[e].portOpened&&t.push(e);return t},p.getSelectedPortName=()=>{return $("#ports-type").val()},p.refreshOutputBox=t=>{var o=p.portsOperator[t];if(o){var{toolConfig:i,toolOpened:r,output:l,endPos:n}=o;for(let e=l.length;e>p.MAX_OUTPUT_LINE;e--)l.shift();let e=l.join("\n");if(r)p.receiveBoxSetValue(t,e,i.scroll);else{if(e=e.replaceAll("\r\n","\n"),n&&"object"==typeof n){r=s.getValueRange(t,{row:0,column:0},n);if(e===r)return}s.setValue(t,e,i.scroll),o.endPos=s.getEndPos(t),A[t]&&A[t].setReadOnly(!1)}}},p.openTool=()=>{var e=p.getSelectedPortName();if(e){let i=p.portsOperator[e];e=i["toolConfig"];const l=e["baudRates"];var t=e=>{i.dom||(i.dom=e),p.refreshToolPortSelectBox(p.uploadPorts);var t=e.id["selectPortId"],t=(i.toolOpened=!0,a.show(1),e.nowPort=$("#"+t+" option:selected").val(),e.prevPort=null,layui.element),o=e.filter["tabFilter"];t.tabChange(o,i.toolConfig.tabIndex),p.refreshConnectStatus(e.nowPort),p.connect(e.nowPort,l??9600)},o=e=>{try{n.chart&&n.chart.destroy(),n.chart=null}catch(e){console.log(e)}n.draw&&clearInterval(n.draw),n.addData&&clearInterval(n.addData);var t=p.portsOperator[e],o=p.deadPortsOperator[e];t?t.toolOpened=!1:o&&(o.dom.destroy(),delete p.deadPortsOperator[e]),p.refreshTerminalMenu(e)};let r=i.dom;i.dom?(r.updateTool(e),r.open(t,o)):r=d.openSerialTool(e,t,o),r.onClickSetDtr((e,t)=>{p.portsOperator[e].toolConfig.dtr=t.elem.checked,p.updateDtrAndRts(e)}),r.onClickSetRts((e,t)=>{p.portsOperator[e].toolConfig.rts=t.elem.checked,p.updateDtrAndRts(e)}),r.onClickSendType((e,t)=>{var o=r.id["sendId"],o=$("#"+o);p.portsOperator[e].toolConfig.sendStr=t.elem.checked,t.elem.checked?o.attr("placeholder",indexText["请输入内容"]):o.attr("placeholder",indexText["请输入内容"]+"  "+indexText["例如"]+":0x03,0x04")}),r.onClickSelectPort((e,t,o)=>{const i=p.portsOperator[t];e=p.portsOperator[e],i.toolConfig={...e.toolConfig},i.dom=e.dom,e.dom=null,e.toolOpened=!1,i.toolOpened=!0,e=e.serialport;e&&e.isOpen&&e.close(()=>{p.connect(t,i.toolConfig.baudRates)})}),r.onClickSelectBaud((e,t)=>{p.portsOperator[e].toolConfig.baudRates=t.elem.value,p.setBaudRate(e,t.elem.value)}),r.onClickTab((e,t)=>{p.portsOperator[e].toolConfig.tabIndex=t.index,1===t.index?(e=(t=p.portsOperator[e])["dom"],n.init(t.portOpened,e)):Mixly.Charts.destroy()}),r.onClickConnectBtn(e=>{p.portOpenOrClose(e)}),r.onClickSendBtn(e=>{p.write(e,0)}),r.onClickClearBtn(e=>{p.clearContent(e)}),r.onClickChartSendBtn(e=>{p.write(e,1)}),r.onClickCtrlCBtn(e=>{p.writeCtrlC(e)}),r.onClickCtrlDBtn(e=>{p.writeCtrlD(e)}),r.onClickScroll((e,t)=>{p.portsOperator[e].toolConfig.scroll=t.elem.checked}),r.onClickReceiveType((e,t)=>{p.portsOperator[e].toolConfig.receiveStr=t.elem.checked}),r.onClickSelectPointNum((e,t)=>{p.portsOperator[e].toolConfig.pointNum=t.elem.value}),r.onClickSelectSendWith((e,t)=>{p.portsOperator[e].toolConfig.sendWith=t.elem.value})}else layer.msg(indexText["无可用设备"]+"!",{time:1e3})},p.refreshConnectStatus=e=>{var t=p.portsOperator[e],e=p.deadPortsOperator[e];(t||e)&&({dom:t,portOpened:e}=t??e,t)&&(t=t.id["connectBtnId"],t=$("#"+t),e?(t.text(indexText["关闭"]),t.attr("class","layui-btn layui-btn-danger")):(t.text(indexText["打开"]),t.attr("class","layui-btn layui-btn-normal")))},p.receiveBoxAddValue=(e,t,o=!1)=>{t=p.receiveBoxGetValue(e)+t;p.receiveBoxSetValue(e,t,o)},p.receiveBoxSetValue=(e,t,o=!1)=>{var e=p.portsOperator[e];e&&(e=e["dom"],e)&&(e=e.id["receiveId"],(e=$("#"+e)).val(t),o)&&e.scrollTop(e[0].scrollHeight)},p.receiveBoxGetValue=e=>{var e=p.portsOperator[e];return e&&(e=e.dom,e)?(e=e.id["receiveId"],$("#"+e).val()):""},p.receiveBoxScrollToTheBottom=()=>{var e=p.portsOperator[port]["dom"];e&&(e=e.id["receiveId"],(e=$("#"+e)).scrollTop(e[0].scrollHeight))},p.receiveBoxScrollToTheTop=()=>{},p.statusBarPortAddHotKey=i=>{const r=A[i].getSession();A[i].commands.addCommands([{name:"Empty",bindKey:"Ctrl-E",exec:e=>{var t=p.portsOperator[i];t&&(t.output=[])}},{name:"Terminal",bindKey:"Ctrl-T",exec:e=>{p.statusBarPortEnterTerminal(i)}},{name:"ChangeEditor",bindKey:"Delete|Ctrl-X|Backspace",exec:e=>{var t,o=p.portsOperator[i];return!(!o||!o.portOpened)&&(o=o["endPos"],o&&"object"==typeof o?(t=r.selection.getCursor()).row<o.row||t.row===o.row&&t.column<=o.column:(A[i].setReadOnly(!0),!1))}},{name:"Enter",bindKey:"Enter",exec:e=>{var t,o=p.portsOperator[i];return o&&o.portOpened&&(o=o["endPos"],o)&&"object"==typeof o&&r.selection.getCursor().row===o.row&&(t=s.getEndPos(i),o=s.getValueRange(i,o,t),p.writeString(i,o,"\r\n")),!1}}]),r.selection.on("changeCursor",function(){var e,t=p.portsOperator[i];t&&t.portOpened&&(t=t.endPos,t)&&"object"==typeof t&&((e=r.selection.getCursor()).row<t.row||e.row===t.row&&e.column<t.column)?A[i].setReadOnly(!0):A[i].setReadOnly(!1)}),p.portsOperator[i]&&p.refreshTerminalMenu(i)},p.statusBarPortEnterTerminal=e=>{var t=p.portsOperator[e];t&&!t.toolOpened&&(p.statusBarPortRemoveCursorEvent(e),t.refreshOutputBoxTimer&&clearInterval(t.refreshOutputBoxTimer),t.refreshOutputBoxTimer=null,setTimeout(()=>{p.statusBarPortAddCursorEvent(e)},p.REFRESH_OUTPUT_TIME+100))},p.refreshTerminalMenu=i=>{const r=p.portsOperator[i];let l=i;try{l=(l=l.replaceAll("/","-")).replaceAll(".","-")}catch(e){console.log(e)}var e,t='<div style="float:left;">{{d.name}}&nbsp</div><div style="float:right;">{{d.hotKey}}</div>',o={elem:`#tab-${l}-ace`,trigger:"contextmenu",isAllowSpread:!0,id:`tab-${l}-ace-terminal`,className:"editor-dropdown-menu",click:function(e,t){var o;e.id===`tab-${l}-ace-terminal-exit`?p.statusBarPortAddCommand(i,"exit"):e.id===`tab-${l}-ace-terminal-open`?p.statusBarPortEnterTerminal(i):e.id===`tab-${l}-ace-terminal-close`?s.tabDelete(i):e.id===`tab-${l}-ace-terminal-help`?p.statusBarPortAddCommand(i,"config port send -h"):e.id===`tab-${l}-ace-fontsize-decrease`?(o=parseInt(A[i].getFontSize(),10)||12,A[i].setFontSize(Math.max(o-1||1))):e.id===`tab-${l}-ace-fontsize-increase`?(o=parseInt(A[i].getFontSize(),10)||12,A[i].setFontSize(o+1)):e.id===`tab-${l}-ace-fontsize-default`?A[i].setFontSize(12):e.id===`tab-${l}-ace-terminal-port-close`?p.statusBarPortAddCommand(i,"port -c"):e.id===`tab-${l}-ace-terminal-port-open`?p.statusBarPortAddCommand(i,"port -o"):e.id===`tab-${l}-ace-terminal-send-ctrlc`?p.statusBarPortAddCommand(i,"send -b 0x03,0x0d,0x0a -w no"):e.id===`tab-${l}-ace-terminal-send-ctrld`?p.statusBarPortAddCommand(i,"send -b 0x03,0x04 -w no"):e.id===`tab-${l}-ace-terminal-send-str`?p.statusBarPortAddCommand(i,"send -w \\r\\n -s ",!1):e.id===`tab-${l}-tool-close`?r.dom.close():e.id===`tab-${l}-ace-close`?s.tabDelete(i):e.id===`tab-${l}-ace-empty`?r.output=[]:e.id===`tab-${l}-serial-send-ctrlc`?p.writeCtrlC(i):e.id===`tab-${l}-serial-send-ctrld`&&p.writeCtrlD(i)}};r?r&&r.toolOpened?o.data=[{title:indexText["关闭串口工具"],id:`tab-${l}-tool-close`}]:(e=r["toolConfig"],e={portOpend:{terminalOpend:[{title:c.render(t,{name:indexText["关闭串口"],hotKey:"port -c"}),id:`tab-${l}-ace-terminal-port-close`},e.ctrlCBtn?{title:c.render(t,{name:indexText["中断"],hotKey:""}),id:`tab-${l}-ace-terminal-send-ctrlc`}:{},e.ctrlDBtn?{title:c.render(t,{name:indexText["复位"],hotKey:""}),id:`tab-${l}-ace-terminal-send-ctrld`}:{},{title:c.render(t,{name:indexText["发送字符串"],hotKey:""}),id:`tab-${l}-ace-terminal-send-str`},{title:c.render(t,{name:indexText["帮助"],hotKey:""}),id:`tab-${l}-ace-terminal-help`},{type:"-"},{title:c.render(t,{name:indexText["退出串口终端"],hotKey:"exit"}),id:`tab-${l}-ace-terminal-exit`}],terminalClosed:[{title:c.render(t,{name:indexText["清空"],hotKey:"Ctrl+E"}),id:`tab-${l}-ace-empty`},{type:"-"},{title:c.render(t,{name:indexText["增大字号"],hotKey:"Ctrl+="}),id:`tab-${l}-ace-fontsize-increase`},{title:c.render(t,{name:indexText["减小字号"],hotKey:"Ctrl+-"}),id:`tab-${l}-ace-fontsize-decrease`},{title:c.render(t,{name:indexText["默认字号"],hotKey:"Ctrl+0"}),id:`tab-${l}-ace-fontsize-default`},{type:"-"},e.ctrlCBtn?{title:c.render(t,{name:indexText["中断"],hotKey:""}),id:`tab-${l}-serial-send-ctrlc`}:{},e.ctrlDBtn?{title:c.render(t,{name:indexText["复位"],hotKey:""}),id:`tab-${l}-serial-send-ctrld`}:{},{title:c.render(t,{name:indexText["打开串口终端"],hotKey:"Ctrl+T"}),id:`tab-${l}-ace-terminal-open`}]},portClosed:{terminalOpend:[{title:c.render(t,{name:indexText["打开串口"],hotKey:"port -o"}),id:`tab-${l}-ace-terminal-port-open`},{title:c.render(t,{name:indexText["帮助"],hotKey:""}),id:`tab-${l}-ace-terminal-help`},{type:"-"},{title:c.render(t,{name:indexText["退出串口终端"],hotKey:"exit"}),id:`tab-${l}-ace-terminal-exit`}],terminalClosed:[{title:c.render(t,{name:indexText["清空"],hotKey:"Ctrl+E"}),id:`tab-${l}-ace-empty`},{type:"-"},{title:c.render(t,{name:indexText["增大字号"],hotKey:"Ctrl+="}),id:`tab-${l}-ace-fontsize-increase`},{title:c.render(t,{name:indexText["减小字号"],hotKey:"Ctrl+-"}),id:`tab-${l}-ace-fontsize-decrease`},{title:c.render(t,{name:indexText["默认字号"],hotKey:"Ctrl+0"}),id:`tab-${l}-ace-fontsize-default`},{type:"-"},{title:c.render(t,{name:indexText["打开串口终端"],hotKey:"Ctrl+T"}),id:`tab-${l}-ace-terminal-open`}]}},o.data=e[r.portOpened?"portOpend":"portClosed"][r.terminalOpend?"terminalOpend":"terminalClosed"]):o.data=[{title:indexText["关闭串口输出框"],id:`tab-${l}-ace-close`}],layui.dropdown.render(o)},p.statusBarPortAddCursorEvent=o=>{const i=p.portsOperator[o];""===i.output[i.output.length-1]?p.outputBoxAdd(o,">>>",!1):p.outputBoxAdd(o,">>>",!0),p.refreshOutputBox(o),i.terminalOpend=!0,p.refreshTerminalMenu(o);var e=A[o];const r=e["selection"],l=e.getSession(),n=l.getLength(),a=(e.gotoLine(n),r.moveCursorLineEnd(),r.getCursor());i.cursorCallback=l.selection.on("changeCursor",function(e){if(i.terminalOpend){var t=r.getCursor();(t.row<a.row||t.row===a.row&&t.column<=a.column)&&r.moveCursorTo(a.row,a.column,!0);let e=l.getLine(t.row-1);-1!==e.indexOf(">>>")&&t.row===a.row+1&&0===t.column?(e=e.replace(">>>",""),p.outputBoxAdd(o,e),p.handleCommand(o,e),p.statusBarPortRemoveCursorEvent(o)):l.getLength()!==n&&p.statusBarPortRemoveCursorEvent(o)}})},p.statusBarPortRemoveCursorEvent=e=>{var t=A[e],o=p.portsOperator[e];o&&t&&(t=t.getSession(),o.cursorCallback)&&(t.selection.removeEventListener("changeCursor",o.cursorCallback),p.refreshOutputBox(e),o.terminalOpend=!1,p.refreshTerminalMenu(e),o.portOpened)&&!o.refreshOutputBoxTimer&&(o.refreshOutputBoxTimer=setInterval(()=>{p.refreshOutputBox(e)},p.REFRESH_OUTPUT_TIME))},p.outputBoxAdd=(e,t,o=!1)=>{e=p.portsOperator[e];o&&e.output.push(""),e.output[e.output.length-1]+=t},p.handleCommand=(e,t)=>{p.portsOperator[e];var t=t.split(" "),o=minimist(t);if(1<=o._.length)for(var i of o._){var r;Object.keys(p.TERMINAL_COMMAND).includes(i)?(r=p.TERMINAL_COMMAND[i].callback,p[r]&&p[r](e,o)):(p.outputBoxAdd(e,i+"为无效指令",!0),p.outputBoxAdd(e,"",!0))}else p.outputBoxAdd(e,"无可用指令",!0),p.outputBoxAdd(e,"",!0)},p.parseOptions=(e,t)=>{var o,i=[],r=[],l=[];for(o in t){var n=o.split("|"),a=t[o]?.key;if(2===n.length&&a&&(-1!==n[0].indexOf("-")&&-1!==n[1].indexOf("-"))){l.push(a);for(var s of n)(2===s.length?i:r).push(s)}}var d,c=[i,r,l],u={};for(d in e)option=e[d],c[0].includes("-"+d)?(u[c[2][c[0].indexOf("-"+d)]]=option,c[1][d]=null):c[1].includes("--"+d)&&(u[c[2][c[1].indexOf("--"+d)]]=option);return u},p.terminalAddHelpInfo=(e,t,o)=>{var i,r;this.getSpace=e=>{return new Array(e).fill(" ").join("")},p.outputBoxAdd(e,t+"指令可用选项如下：",!0);let l=0;for(i of Object.keys(o))i.length>l&&(l=i.length);for(r in o)if("callback"!==r)try{p.outputBoxAdd(e,r+this.getSpace(l-r.length)+"    "+(o[r].help??""),!0)}catch(e){console.log(e)}p.outputBoxAdd(e,"",!0)},p.terminalConfigCallback=(e,t)=>{var o=p.portsOperator[e],i=o["toolConfig"];o&&(o=p.TERMINAL_COMMAND.config,(t=p.parseOptions(t,o)).HELP?p.terminalAddHelpInfo(e,"config",o):(p.outputBoxAdd(e,"获取指令"+JSON.stringify(t),!0),p.outputBoxAdd(e,"",!0),i.dtr=t.DTR??i.dtr,i.rts=t.RTS??i.rts,i.scroll=t.SCROLL??i.scroll,i.baudRates=t.BAUD&&p.DEFAULT_BAUD.includes(t.BAUD)?t.BAUD:i.baudRates,i.receiveStr=t.RTYPE??i.receiveStr,i.sendWith=t.SWITH&&p.DEFAULT_SEND_WITH.includes(t.SWITH)?t.SWITH:i.sendWith,p.setDtrAndRts(e,i.dtr,i.rts),p.setBaudRate(e,i.baudRates)))},p.terminalPortCallback=(e,t)=>{var o,i=p.portsOperator[e],{}=i;i&&(o=p.TERMINAL_COMMAND.port,(t=p.parseOptions(t,o)).HELP?p.terminalAddHelpInfo(e,"port",o):(p.outputBoxAdd(e,"获取指令"+JSON.stringify(t),!0),p.outputBoxAdd(e,"",!0),t.OPEN?i.portOpened||p.connect(e,i.toolConfig.baudRates):t.CLOSE?i.portOpened&&p.portClose(e):(p.outputBoxAdd(e,"无效指令",!1),p.outputBoxAdd(e,"",!0))))},p.terminalSendCallback=(t,o)=>{var e=p.portsOperator[t];if(e){var i=e["toolConfig"],r=p.TERMINAL_COMMAND.send,o=p.parseOptions(o,r);if(o.HELP)p.terminalAddHelpInfo(t,"send",r);else if(p.outputBoxAdd(t,"获取指令"+JSON.stringify(o),!0),p.outputBoxAdd(t,"",!0),e.portOpened){let e=i.sendWith??"\\r\\n";o.WITH&&p.DEFAULT_SEND_WITH.includes(o.WITH)&&(e=o.WITH),o.STR?p.writeString(t,o.STR,e):o.BYTES?p.writeByteArr(t,o.BYTES,e):(p.outputBoxAdd(t,"无效指令",!1),p.outputBoxAdd(t,"",!0))}else p.outputBoxAdd(t,"串口已关闭，无法发送数据！",!1),p.outputBoxAdd(t,"",!0)}},p.terminalExitCallback=(e,t)=>{p.portsOperator[e]&&p.outputBoxAdd(e,"",!0)},p.statusBarPortAddCommand=(e,t,o=!0)=>{s.addValue(e,t+(o?"\n":""),!0),o&&p.refreshOutputBox(e)},p.connect=function(e=null,t=null){var o,i,r,l;e&&(l=p.portsOperator[e])&&(s.tabChange(e),l.portOpened||(l=l["toolConfig"],{baudRates:o=9600,dtr:i,rts:r}=l,t=t??o,p.DEFAULT_BAUD.includes(t)?l.baudRates=t:t=o,l=g.upload.reset??[],u.sendCommand({obj:"Serial",func:"open",args:[e,t,l,i,r]})))},p.onopen=o=>{var e=p.portsOperator[o];e&&(e.portOpened=!0,s.tabAdd(o,!0,p.statusBarPortAddHotKey,e=>{var t=p.portsOperator[e];t&&t.portOpened&&(p.portClose(o),s.tabChange("output"),a.getValue().lastIndexOf("\n")!=a.getValue().length-1?a.addValue("\n"+indexText["已关闭串口"]+e+"\n"):a.addValue(indexText["已关闭串口"]+e+"\n"))}),s.tabChange(o),p.refreshTerminalMenu(o),p.refreshConnectStatus(o),s.setValue(o,indexText["已打开串口"]+": "+o+"\n",!0),p.receiveBoxSetValue(o,indexText["已打开串口"]+": "+o+"\n",!0),e.output.push(""),p.outputBoxAdd(o,indexText["已打开串口"]+": "+o),e.output.push(""),e.refreshOutputBoxTimer=setInterval(()=>{p.refreshOutputBox(o)},p.REFRESH_OUTPUT_TIME),g.serial?.ctrlDBtn)&&p.writeCtrlD(o)},p.ondata=(e,t)=>{e=p.portsOperator[e];e&&(n.addData(t),e)&&"function"==typeof e.userOnData&&e.userOnData(t)},p.onbytes=(t,o)=>{o=+o;var i=p.portsOperator[t];if(i&&i.refreshOutputBoxTimer)if(i.receiveBuff=i.receiveBuff??[],i.chineseStr=i.chineseStr??"",i.buffLength=i.buffLength??0,i.toolConfig&&!i.toolConfig.receiveStr)if(10===o)p.outputBoxAdd(t,"0x0A",!1),p.outputBoxAdd(t,"",!0);else{let e=o.toString(16).toUpperCase();1===e.length&&(e="0"+e),p.outputBoxAdd(t,"0x"+e+" ",!1)}else if(0==(128&o))if(i.receiveBuff=[],""!==i.chineseStr)try{var e=String.fromCharCode(o).match(/[\w|\\]/g);e&&0<e.length?i.chineseStr+=String.fromCharCode(o):(p.outputBoxAdd(t,l.messageDecode(i.chineseStr)),p.outputBoxAdd(t,String.fromCharCode(o)),i.chineseStr="")}catch(e){console.log(e),p.outputBoxAdd(t,l.messageDecode(i.chineseStr)),p.outputBoxAdd(t,o),i.chineseStr=""}else 10===o?i.output.push(""):[92,95].includes(o)?i.chineseStr=String.fromCharCode(o):p.outputBoxAdd(t,String.fromCharCode(o));else if(128==(192&o))i.receiveBuff.push(o),i.receiveBuff.length>=i.buffLength&&(p.outputBoxAdd(t,Buffer.from(i.receiveBuff)),i.receiveBuff=[]);else{switch(224&o){case 252:i.buffLength=6;break;case 248:i.buffLength=5;break;case 240:i.buffLength=4;break;case 224:i.buffLength=3;break;default:i.buffLength=2}i.receiveBuff.push(o)}},p.onerror=(e,t)=>{var o=p.portsOperator[e];o&&(s.tabChange("output"),p.showErrorData(e,o.toolOpened,t))},p.onclose=e=>{var t,o=p.portsOperator[e];o&&(o.portOpened=!1,s.close(e),p.refreshConnectStatus(e),p.refreshTerminalMenu(e),o.refreshOutputBoxTimer&&clearInterval(o.refreshOutputBoxTimer),o.refreshOutputBoxTimer=null,n.stopRefresh(),(t=p.receiveBoxGetValue(e))&&t.lastIndexOf("\n")!=t.length-1?p.receiveBoxAddValue(e,"\n"+indexText["已关闭串口"]+": "+e+"\n",!0):p.receiveBoxAddValue(e,indexText["已关闭串口"]+": "+e+"\n",!0),s.getValue(e).lastIndexOf("\n")!=s.getValue(e).length-1?s.addValue(e,"\n"+indexText["已关闭串口"]+": "+e+"\n",!0):s.addValue(e,indexText["已关闭串口"]+": "+e+"\n",!0),o.output=[])},p.portOpenOrClose=function(e){var t,o=p.portsOperator[e];o&&(t=o["toolConfig"],o.portOpened?u.sendCommand({obj:"Serial",func:"close",args:[e]}):(p.connect(e,t.baudRates),a.show(1)))},p.portClose=(e,t=0)=>{var o=p.portsOperator[e];o&&o.portOpened&&u.sendCommand({obj:"Serial",func:"close",args:[e]})},p.showErrorData=function(e,t,o){var{toolOpened:i,toolConfig:r}=p.portsOperator[e];r.receiveStr||(o=(o=l.uint8ArrayToStr(l.strToByte(o))).replace(/^\s*/,""),o+="\n"),i?p.receiveBoxAddValue(e,o,r.scroll):s.addValue(e,o,!0)},p.writeByteArr=function(t,o,i){if(p.portsOperator[t].portOpened){let e="";e="string"!=typeof o?o.toString():o,"no"==(i=(i=i.replace("\\r","\r")).replace("\\n","\n"))&&(i=""),u.sendCommand({obj:"Serial",func:"sendByteArr",args:[t,e,i]})}},p.writeString=function(e,t,o){p.portsOperator[e].portOpened&&("no"===(o=(o=o.replace("\\r","\r")).replace("\\n","\n"))&&(o=""),t)&&u.sendCommand({obj:"Serial",func:"sendString",args:[e,t,o]})},p.write=function(t,o=0){var i=p.portsOperator[t],r=i["dom"];if(i.portOpened){var{sendId:i,sendWithId:r,sendTypeId:l,chartSendId:n}=r.id,i=$("#"+i),n=$("#"+n);let e="";(o?(e=n.val(),n):(e=i.val(),i)).val("");o=$("#"+r+" option:selected").val();0==$("#"+l)[0].checked?p.writeByteArr(t,e,o):p.writeString(t,e,o)}},p.writeCtrlC=function(e){p.portsOperator[e].portOpened&&u.sendCommand({obj:"Serial",func:"sendCtrlC",args:[e]})},p.writeCtrlD=function(e){p.portsOperator[e].portOpened&&u.sendCommand({obj:"Serial",func:"sendCtrlD",args:[e]})},p.clearContent=function(e){p.receiveBoxSetValue(e,"");e=p.portsOperator[e];e&&(e.output=[])},p.updateDtrAndRts=function(e){var t=p.portsOperator[e];t.portOpened&&(t=t["toolConfig"],u.sendCommand({obj:"Serial",func:"updateDtrAndRts",args:[e,t.dtr,t.rts]}))},p.reset=async function(e){var t=p.UPLOAD_RESET;"object"==typeof t&&u.sendCommand({obj:"Serial",func:"reset",args:[e,t]})},p.setDtrAndRts=function(e,t,o){p.portsOperator[e].portOpened&&u.sendCommand({obj:"Serial",func:"updateDtrAndRts",args:[e,t,o]})},p.setBaudRate=(e,t)=>{p.portsOperator[e].portOpened&&u.sendCommand({obj:"Serial",func:"onClickSelectBaud",args:[e,t]})}})(),(()=>{goog.require("layui"),goog.require("Mixly.Env"),goog.require("Mixly.Config"),goog.require("Mixly.Modules"),goog.require("Mixly.MFile"),goog.require("Mixly.Title"),goog.require("Mixly.XML"),goog.require("Mixly.Example"),goog.require("Mixly.Electron.BU"),goog.require("Mixly.Electron.File"),goog.provide("Mixly.Electron.ExampleExt");const{Env:l,Config:e,Modules:t,Example:o,Electron:i}=Mixly;var{}=layui;const r=i["File"],n=e["BOARD"],{fs:a,fs_extend:s,path:d,app:c}=t;function u(e,t){o.call(this,e,t),this.render()}u.prototype=Object.create(o.prototype),(u.constructor=u).prototype.getExampleList=function(){var e=[];let t;t=n.thirdPartyBoard?d.resolve(l.indexDirPath,"examples"):d.resolve(c.getAppPath(),"src/sample",n.boardType);this.getExamplesByPath(t,".mix").length&&e.push({id:t,title:n.boardType,children:[]});var o,i=d.resolve(l.indexDirPath,"libraries/ThirdParty");if(s.isdir(i))for(o of a.readdirSync(i)){var r=d.resolve(i,o);s.isfile(r)||(r=d.resolve(r,"examples"),s.isfile(r))||this.getExamplesByPath(r,".mix").length&&e.push({id:r,title:o,children:[]})}return e},u.prototype.getExamples=function(e){return this.getExamplesByPath(e,".mix")},u.prototype.dataToWorkspace=function(e){var t;s.isfile(e)&&(t=a.readFileSync(e,"utf8"),e=d.extname(e),this.updateCode(e,t),r.openedFilePath=null)},u.prototype.getExamplesByPath=function(e,t){var o,i=[];if(s.isdir(e))for(o of a.readdirSync(e)){var r=d.resolve(e,o);s.isdir(r)?i.push({title:o,id:r,children:[]}):d.extname(o)===t&&i.push({title:o,id:r})}return i},Object.defineProperty(Mixly.Electron,"ExampleExt",{value:u,writable:!0,enumerable:!0,configurable:!0})})(),(()=>{goog.require("layui"),goog.require("Mixly.Modules"),goog.require("Mixly.Env"),goog.require("Mixly.LayerExt"),goog.require("Mixly.Config"),goog.require("Mixly.StatusBar"),goog.require("Mixly.StatusBarPort"),goog.require("Mixly.Title"),goog.require("Mixly.Boards"),goog.require("Mixly.MFile"),goog.require("Mixly.MArray"),goog.require("Mixly.WebSocket.Socket"),goog.require("Mixly.WebSocket.Serial"),goog.provide("Mixly.WebSocket.ArduShell");const{LayerExt:t,StatusBar:n,StatusBarPort:o,Boards:r,MFile:l,Config:e}=Mixly;var{}=e;const{Socket:a,ArduShell:s,Serial:d}=Mixly.WebSocket;s.initCompile=()=>{a.connect(e=>{layer.closeAll()},()=>{s.compile()})},s.compile=()=>{o.tabChange("output"),s.compiling=!0,s.uploading=!1;const i=r.getSelectedBoardCommandParam(),e=(n.show(1),layer.open({type:1,title:indexText["编译中"]+"...",content:$("#mixly-loader-div"),shade:t.SHADE_NAV,resize:!1,closeBtn:0,success:(e,t)=>{$(".layui-layer-page").css("z-index","198910151"),$("#mixly-loader-btn").off("click").click(()=>{$("#mixly-loader-btn").css("display","none"),layer.title(indexText["编译终止中"]+"...",t),s.cancel()}),n.setValue(indexText["编译中"]+"...\n");var o=l.getCode();a.sendCommand({obj:"ArduShell",func:"compile",args:[t,i,o]})},end:()=>{$("#mixly-loader-div").css("display","none"),$("layui-layer-shade"+e).remove(),$("#mixly-loader-btn").off("click"),$("#mixly-loader-btn").css("display","inline-block")}}))},s.initUpload=()=>{a.connect(e=>{layer.closeAll()},()=>{s.compiling=!1,s.uploading=!0;var e=r.getSelectedBoardCommandParam(),t=r.getSelectedBoardConfigParam("upload_method");let o=d.getSelectedPortName();switch(t){case"STLinkMethod":case"jlinkMethod":case"usb":o="None"}o?s.upload(e,o):layer.msg(indexText["无可用设备"]+"!",{time:1e3})})},s.upload=(i,r)=>{o.tabChange("output");const e=layer.open({type:1,title:indexText["上传中"]+"...",content:$("#mixly-loader-div"),shade:t.SHADE_NAV,resize:!1,closeBtn:0,success:function(e,t){$(".layui-layer-page").css("z-index","198910151"),$("#mixly-loader-btn").off("click").click(()=>{$("#mixly-loader-btn").css("display","none"),layer.title(indexText["上传终止中"]+"...",t),s.cancel()}),n.show(1),n.setValue(indexText["上传中"]+"...\n");var o=l.getCode();a.sendCommand({obj:"ArduShell",func:"upload",args:[t,i,r,o]})},end:function(){$("#mixly-loader-div").css("display","none"),$("layui-layer-shade"+e).remove(),$("#mixly-loader-btn").off("click"),$("#mixly-loader-btn").css("display","inline-block")}})},s.operateSuccess=(e,t,o,i,r)=>{layer.close(t);t=n.getValue();let l="";t.lastIndexOf("\n")!==t.length-1&&(l="\n"),n.addValue(l);t="compile"===e?indexText["编译成功"]:indexText["上传成功"];n.addValue("=="+t+"("+indexText["用时"]+" "+r+")==\n"),layer.msg(t+"！",{time:1e3}),"upload"===e&&o&&d.connect(o,+i),s.compiling=!1,s.uploading=!1},s.operateOnError=(e,t,o)=>{n.addValue(o)},s.operateEndError=(e,t,o)=>{layer.close(t);t=n.getValue();let i="";t.lastIndexOf("\n")!==t.length-1&&(i="\n"),n.addValue(i),o&&n.addValue(o+"\n");t="compile"===e?indexText["编译失败"]:indexText["上传失败"];n.addValue("=="+t+"==\n"),s.compiling=!1,s.uploading=!1},s.cancel=function(){a.sendCommand({obj:"ArduShell",func:"cancel",args:[]})}})(),(()=>{goog.require("layui"),goog.require("Mixly.Config"),goog.require("Mixly.StatusBar"),goog.require("Mixly.StatusBarPort"),goog.require("Mixly.LayerExt"),goog.require("Mixly.Env"),goog.require("Mixly.Boards"),goog.require("Mixly.MFile"),goog.require("Mixly.MString"),goog.require("Mixly.WebSocket.Serial"),goog.require("Mixly.WebSocket.Socket"),goog.provide("Mixly.WebSocket.BU");const{Config:e,StatusBar:a,StatusBarPort:s,LayerExt:c,Env:u,MFile:d,MString:p}=Mixly,{BU:g,Serial:A,Socket:h}=Mixly.WebSocket,{BOARD:y,SELECTED_BOARD:m}=e,f=layui["form"];g.uploading=!1,g.burning=!1,g.shell=null,g.checkNumOfDisks=function(o,e,i){let t=e,r=(t=(t=t.replace(/\s+/g,"")).replace("DeviceID","")).split(":"),l="win32"===u.currentPlatform?":":"";if(e.indexOf(":")!=e.lastIndexOf(":")){var e=layui.form,n=$("#mixly-selector-type"),a=$("#mixly-selector-type option:selected").val();n.empty();for(let e=0;e<r.length;e++)r[e]&&(a==r[e]+l?n.append('<option value="'+r[e]+l+'" selected>'+r[e]+l+"</option>"):n.append('<option value="'+r[e]+l+'">'+r[e]+l+"</option>"));e.render();let t=!1;const s=layer.open({type:1,id:"serial-select",title:indexText["检测到多个同类型设备，请选择："],area:["350px","150px"],content:$("#mixly-selector-div"),shade:c.SHADE_ALL,resize:!1,closeBtn:0,success:function(e){$("#serial-select").css("height","195px"),$(".layui-layer-page").css("z-index","198910151"),$("#mixly-selector-btn1").off("click").click(()=>{layer.close(s),g.cancel()}),$("#mixly-selector-btn2").off("click").click(()=>{layer.close(s),t=!0})},end:function(){$("#mixly-selector-div").css("display","none"),$("#layui-layer-shade"+s).remove(),t&&g.initWithDropdownBox(o,i),$("#mixly-selector-btn1").off("click"),$("#mixly-selector-btn2").off("click")}})}else{const d=layer.open({type:1,title:("burn"===o?indexText["烧录中"]:indexText["上传中"])+"...",content:$("#mixly-loader-div"),shade:c.SHADE_NAV,resize:!1,closeBtn:0,success:function(e,t){g.copyFiles(o,t,i,r[0]+l+"/"),$("#mixly-loader-btn").off("click").click(()=>{layer.close(t),g.cancel()})},end:function(){$("#mixly-selector-div").css("display","none"),$("#layui-layer-shade"+d).remove(),$("#mixly-loader-btn").off("click")}})}},g.copyFiles=(e,t,o,i)=>{var r=d.getCode(),{copyLib:l=!1,libPath:n=[]}=m.upload;h.sendCommand({obj:"BU",func:"copyFiles",args:[e,t,o,i,r,l,n]})},g.operateSuccess=(e,t,o)=>{layer.close(t);var t="burn"===e?indexText["烧录成功"]:indexText["上传成功"],i=(layer.msg(t+"!",{time:1e3}),a.getValue());let r="";i.lastIndexOf("\n")!==i.length-1&&(r="\n"),a.addValue(r+`==${t}==
`),"upload"!==e||1!==A.uploadPorts.length&&!o||A.connect(o??A.uploadPorts[0].name,null),g.burning=!1,g.uploading=!1},g.operateError=(e,t,o)=>{layer.close(t);t=a.getValue();let i="";t.lastIndexOf("\n")!==t.length-1&&(i="\n"),a.addValue(i+o+"\n"),console.log(o),g.burning=!1,g.uploading=!1},g.noDevice=()=>{layer.msg(indexText["无可用设备"]+"!",{time:1e3}),g.burning=!1,g.uploading=!1},g.initWithDropdownBox=function(i,r){const e=layer.open({type:1,title:("burn"===i?indexText["烧录中"]:indexText["上传中"])+"...",content:$("#mixly-loader-div"),shade:c.SHADE_NAV,resize:!1,closeBtn:0,success:function(e,t){$(".layui-layer-page").css("z-index","198910151"),$("#mixly-loader-btn").off("click").click(()=>{layer.close(t),g.cancel()});var o=$("#mixly-selector-type option:selected").val();g.copyFiles(i,t,r,o)},end:function(){$("#mixly-loader-div").css("display","none"),$("#layui-layer-shade"+e).remove()}})},g.cancel=function(){h.sendCommand({obj:"BU",func:"cancel",args:[]}),g.uploading?(g.uploading=!1,layer.msg(indexText["已取消上传"],{time:1e3})):g.burning&&(g.burning=!1,layer.msg(indexText["已取消烧录"],{time:1e3}))},g.initBurn=function(){h.connect(e=>{layer.closeAll()},()=>{var e,t;g.burning||(e=m["burn"],a.setValue(""),s.tabChange("output"),a.show(1),g.burning=!0,g.uploading=!1,"volume"===e.type?h.sendCommand({obj:"BU",func:"getDisksWithVolumesName",args:["burn",e.volume,e.filePath]}):(t=A.getSelectedPortName(),g.burnWithPort(t,e.command)))})},g.initUpload=function(){h.connect(e=>{layer.closeAll()},()=>{var e,t;g.uploading||(e=m["upload"],a.setValue(""),s.tabChange("output"),a.show(1),g.burning=!1,g.uploading=!0,"volume"===e.type?h.sendCommand({obj:"BU",func:"getDisksWithVolumesName",args:["upload",e.volume,e.filePath]}):(t=A.getSelectedPortName(),g.uploadWithPort(t,e.command)))})},g.burnByCmd=function(e,t,o){o=p.tpl(o,{com:t});h.sendCommand({obj:"BU",func:"burnByCmd",args:[e,t,o]})},g.uploadByCmd=function(e,t,o){var o=p.tpl(o,{com:t}),i=m["upload"],{filePath:i,copyLib:r=!1,libPath:l=[]}=i,n=d.getCode();a.addValue(indexText["上传中"]+"...\n"),h.sendCommand({obj:"BU",func:"uploadByCmd",args:[e,t,o,n,i,r,l]})},g.burnWithSpecialBin=()=>{const t=$("#mixly-selector-type");let o=$("#mixly-selector-type option:selected").val();t.empty();var i=y.burn.special;let r={};for(let e=0;e<i.length;e++)r[i[e].name]=i[e].command;i.map(e=>{(e?.name||e?.command)&&(""+e.name==o?t.append($(`<option value="${e.name}" selected>${e.name}</option>`)):t.append($(`<option value="${e.name}">${e.name}</option>`)))}),f.render();let l=!1;const n=layer.open({type:1,id:"serial-select",title:"请选择固件：",area:["350px","150px"],content:$("#mixly-selector-div"),shade:Mixly.LayerExt.SHADE_ALL,resize:!1,closeBtn:0,success:function(e){$("#serial-select").css("height","180px"),$("#serial-select").css("overflow","inherit"),$(".layui-layer-page").css("z-index","198910151"),$("#mixly-selector-btn1").off("click").click(()=>{layer.close(n)}),$("#mixly-selector-btn2").click(()=>{layer.close(n),l=!0})},end:function(){if($("#mixly-selector-btn1").off("click"),$("#mixly-selector-btn2").off("click"),$("#mixly-selector-div").css("display","none"),$(".layui-layer-shade").remove(),l){var o=$("#mixly-selector-type option:selected").val();try{r[o]=r[o].replace(/\\/g,"/")}catch(e){console.log(e)}var i=["esptool","kflash","stm32loader","stm32bl"];let t="{path}/mixpyBuild/win_python3/Lib/site-packages/";"darwin"!=u.currentPlatform&&"linux"!=u.currentPlatform||(t="{path}/pyTools/");for(let e=0;e<i.length;e++)-1!=r[o].indexOf('"')?r[o]=replaceWithReg(r[o],u.python3Path+'" "'+t+i[e]+".py",i[e]):r[o]=replaceWithReg(r[o],u.python3Path+" "+t+i[e]+".py",i[e]);r[o]=replaceWithReg(r[o],u.clientPath,"path"),r[o]=replaceWithReg(r[o],u.indexDirPath,"indexPath"),a.setValue(""),s.tabChange("output"),a.show(1),g.burning=!0,g.uploading=!1;var e=A.getSelectedPortName();g.burnWithPort(e,r[o])}else layer.msg(indexText["已取消烧录"],{time:1e3})}})},g.operateWithPort=(o,i,r)=>{if(i){const e=("burn"===o?indexText["烧录中"]:indexText["上传中"])+"...";{const t=layer.open({type:1,title:e,content:$("#mixly-loader-div"),shade:c.SHADE_NAV,resize:!1,closeBtn:0,success:function(e,t){$(".layui-layer-page").css("z-index","198910151"),"burn"===o?g.burnByCmd(t,i,r):g.uploadByCmd(t,i,r),$("#mixly-loader-btn").off("click").click(()=>{$("#mixly-loader-btn").css("display","none"),"burn"===o?layer.title(indexText["烧录终止中"]+"...",t):layer.title(indexText["上传终止中"]+"...",t),g.cancel(o)})},end:function(){$("#mixly-loader-div").css("display","none"),$("layui-layer-shade"+t).remove(),$("#mixly-loader-btn").off("click"),$("#mixly-loader-btn").css("display","inline-block")}})}}else layer.msg(indexText["无可用设备"]+"!",{time:1e3}),g.burning=!1,g.uploading=!1},g.burnWithPort=(e,t)=>{g.operateWithPort("burn",e,t)},g.uploadWithPort=(e,t)=>{g.operateWithPort("upload",e,t)}})(),(()=>{goog.require("Mixly.Url"),goog.require("Mixly.Config"),goog.require("Mixly.NavEvents"),goog.require("Mixly.StatusBar"),goog.require("Mixly.XML"),goog.require("Mixly.Nav"),goog.require("Mixly.Env"),goog.require("Mixly.Boards"),goog.require("Mixly.Modules"),goog.require("Mixly.ToolboxSearcher"),goog.require("Mixly.Drag"),goog.require("Mixly.Editor"),goog.require("Mixly.LevelSelector"),goog.require("WorkspaceSearch"),goog.require("Backpack"),goog.require("ContentHighlight"),goog.require("ZoomToFitControl"),goog.require("Mixly.Electron.LibManager"),goog.require("Mixly.Electron.WikiManager"),goog.require("Mixly.Electron.ExampleExt"),goog.require("Mixly.Electron.Serial"),goog.require("Mixly.WebSocket.Socket"),goog.require("Mixly.Web.ExampleExt"),goog.require("Mixly.Electron.Loader"),goog.provide("Mixly.Interface");const{Url:o,Config:i,NavEvents:l,StatusBar:n,XML:a,Nav:s,Boards:d,Modules:r,Interface:c,Env:u,ToolboxSearcher:p,Drag:g,Editor:A,LevelSelector:h}=Mixly,{BOARD:y,USER:m}=i;c.init=()=>{$("body").append(a.TEMPLATE_DOM.APP_DIV);var e=(u.isElectron?Mixly.Electron:Mixly.Web)["ExampleExt"],e=(e instanceof Object&&(e.obj=new e("mixly-footer","mixly-examples")),s.init(),Code.init(),d.init(),u.isElectron?(e=Mixly["Electron"],{LibManager:e=void 0,WikiManager:t=void 0,Serial:i=void 0}=e,"object"==typeof e&&e.init(),"object"==typeof t&&s.CONFIG.setting.wiki&&t.registerContextMenu(),"object"!=typeof i||s.CONFIG.run||s.CONFIG.webrun||i.addBtnToStatusBar()):u.defaultXML=$("#toolbox").html(),d.getSelectedBoardName());if(d.changeTo(e),d.updateCategories(e),A.init(),window.addEventListener("resize",c.onresize,!1),c.onresize(),g.init(),y.nav.levelSelector){h.init();const r=$(".loading");var t=$(".blocklyToolboxDiv").width();r.children(".left-div").animate({width:t+"px"},()=>{r.fadeOut("fast",()=>{r.remove()})}),h.xmlToWorkspace(1)}else auto_save_and_restore_blocks();l.init(),n.init(),new ZoomToFitControl(A.blockEditor).init(),p.init();const o=new WorkspaceSearch(A.blockEditor);o.init();new Backpack(A.blockEditor).init(),"yes"===m.blocklyContentHighlight&&new ContentHighlight(A.blockEditor).init();var i={displayText:Blockly.Msg.WORKSPACE_SEARCH_OPEN,preconditionFn:function(e){return A.blockEditor.getAllBlocks().length?"enabled":"hidden"},callback:function(){o.open()},scopeType:Blockly.ContextMenuRegistry.ScopeType.WORKSPACE,id:"workspaceSearch_open",weight:200};Blockly.ContextMenuRegistry.registry.register(i),u.hasSocketServer&&(e=Mixly.WebSocket["Socket"],e.init())},c.onresize=e=>{var t=$("#nav"),o=$("#nav-left-btn-list"),i=$("#nav-right-btn-list"),r=$("#li_operate");if(i.offset().left<s.leftWidth+70||t[0].scrollWidth>t[0].offsetWidth){for(let e=0;e<s.navItemId.length;e++)$("#"+s.navItemId[e]).css("display","none");r.css("display","inline-block");t=o.offset().left+o.width();i.offset().left-t<70?$("#copyright").css("display","none"):$("#copyright").css("display","-webkit-box")}else{$("#copyright").css("display","-webkit-box"),r.css("display","none");for(let e=0;e<s.navItemId.length;e++)$("#"+s.navItemId[e]).css("display","inline-block");s.leftWidth=o.offset().left+o.width()}A.codeEditor.resize(),A.blockEditor.resize()},window.addEventListener("load",()=>{}),window.addEventListener("DOMContentLoaded",()=>{c.init()}),c.onbeforeunload=(e=!1)=>{var t=i.pathPrefix+"/index.html?"+o.jsonToUrl({boardType:y.boardType});t=t,e?window.location.reload(!0):window.location.replace(t)},c.feedback=()=>{var e,t="https://gitee.com/mixly2/mixly2.0_src/issues";u.isElectron?(e=r["electron"],e=e["shell"],e.openExternal(t)):window.open(t,"_blank")}})();